Dragger=function(a,b){this.handleStart=this.start.bind(this);this.handleStop=this.stop.bind(this);this.handleUpdate=this._updateMouse.bind(this);a.style.position="absolute";this.object=a;this.d={x:0,y:0};this.f=[];b&&(Event.observe(a,"mousedown",this.handleStart,!1),a.onmousedown=function(){return"Safari"==browser?!0:!1},Event.observe(document,"mouseup",this.handleStop,!1));Dragger.updatingMouse||(Event.observe(document,"mousemove",this.handleUpdate,!1),Dragger.updatingMouse=!0)};
with({p:Dragger.prototype,c:Dragger})p._updateMouse=function(a){var b=window,c=document.body;p.mouse={x:a.clientX+(b.scrollX||c.scrollLeft||c.parentNode.scrollLeft||0),y:a.clientY+(b.scrollY||c.scrollTop||c.parentNode.scrollTop||0)}},p.mouse={x:0,y:0},p.dragging=!1,p.setonbeforestart=function(a){this.onbeforestart=a;this.object.onmousedown=function(a){if(this.callEvent("onbeforestart",a))return"Safari"==browser?!0:!1}.bind(this)},p.start=function(a,b){var c,d,e,f;if(!(this.onbeforestart instanceof
Function)||this.callEvent("onbeforestart",a)){var g=this.mouse,j=this.object;c=j.offsetLeft;d=j.offsetTop;e=j.offsetWidth;for(f=j.offsetHeight;j=j.offsetParent;c+=j.offsetLeft,d+=j.offsetTop);!this.dragging&&(this.dragging=!0,j=this.object,this.d=b&&(g.x<c||g.x>c+e||g.y<d||g.y>d+f)?{x:e/2,y:f/2}:{x:g.x-j.offsetLeft,y:g.y-j.offsetTop},this.dragListener=this.drag.bindAsEventListener(this),Event.observe(document,"mousemove",this.dragListener,!1),this.callEvent("onstart"))}},p.drag=function(a){if("IE"==
browser)var b=document.body.parentNode.scrollTop,c=b+document.body.parentNode.clientHeight,d=event.clientY+b;else b=window.scrollY,c=window.scrollY+window.innerHeight,d=a.pageY;if(d>c-10)window.scrollBy(0,6);else if(d>c-25)window.scrollBy(0,4);else if(d>c-50)window.scrollBy(0,2);else{if(d<b+10)return;d<b+25?window.scrollBy(0,-4):d<b+50&&window.scrollBy(0,-2)}for(var c=this.object,e=(this._updateMouse(a),(e=this.mouse).x-=this.d.x,e.y-=this.d.y,e),b=this.f.length;b;this.f[--b]&&this.f[b][0].apply(e,
this.f[b][1]));c.style.posLeft?(c.style.posLeft=e.x,c.style.posTop=e.y):(c.style.left=e.x+"px",c.style.top=e.y+"px");return!!this.callEvent("ondrag",a)},p.stop=function(){this.dragging=!1;this.dragListener&&Event.stopObserving(document,"mousemove",this.dragListener,!1);this.callEvent("onstop")},p.addFilter=function(a,b,c,d,e){this.f[this.f.length]=[a,[].slice.call(arguments,1)]},p.removeFilters=function(){this.f=[]},p.callEvent=function(a){return this[a]instanceof Function?this[a].apply(this,[].slice.call(arguments,
1)):void 0};Dragger.prototype.disable=function(a){Event.stopObserving(a,"mousedown",this.handleStart,!1);Event.stopObserving(document,"mouseup",this.handleStop,!1);Event.stopObserving(document,"mousemove",this.handleUpdate,!1);this.dragListener&&Event.stopObserving(document,"mousemove",this.dragListener,!1)};
Dragger.prototype.enable=function(a){Event.observe(a,"mousedown",this.handleStart,!1);Event.observe(document,"mouseup",this.handleStop,!1);Event.observe(document,"mousemove",this.handleUpdate,!1)};
Dragger.filters=new function(){function a(a,b,e,f){return Math.sqrt((a-=e)*a+(b-=f)*b)}function b(b,d,e,f,g,j,h){var l;if(l=h){if(g-e)if(j-f){var m;l=-1/((j-f)/(g-e));l={x:m=(g*(b*l-d+f)+e*(b*-l+d-j))/(l*(g-e)+f-j),y:l*m-l*b+d}}else l={x:b,y:f};else l={x:e,y:d};l=!(h=l,h.x>=Math.min(e,g)&&h.x<=Math.max(e,g)&&h.y>=Math.min(f,j)&&h.y<=Math.max(f,j))}if(l)return e=a(b,d,e,f),b=a(b,d,g,j),e>b?b:e;h=f-j;m=g-e;return Math.abs(h*b+m*d+(e*j-f*g))/Math.sqrt(h*h+m*m)}this.SQUARE=function(a,b,e,f){this.x=this.x<
a?a:this.x>a+e?a+e:this.x;this.y=this.y<b?b:this.y>b+f?b+f:this.y};this.CIRCLE=function(b,d,e){var f;a(this.x,this.y,b+=e,d+=e)>e&&(this.x=Math.cos(f=Math.atan2(this.y-d,this.x-b))*e+b,this.y=Math.sin(f)*e+d)};this.LINE=function(a,b,e){if(!(e%90))return this.x=a;var f=Math.tan(-e*Math.PI/180);Math.sin(45*Math.PI/180)>=Math.sin(e*Math.PI/180)?this.y=(this.x-a)*f+b:this.x=(this.y-b)/f+a};this.POLY=function(a,d,e,f,g,j,h){for(var l=[].slice.call(arguments,0),m=[];3<l.length;m[m.length]={y1:l.pop(),x1:l.pop(),
y0:l.pop(),x0:l.pop()});if(m.length){for(var w,l=m.length-1,q=m[l],u={i:l,l:b(this.x,this.y,q.x0,q.y0,q.x1,q.y1,1)};l--;u.l>(w=b(this.x,this.y,(q=m[l]).x0,q.y0,q.x1,q.y1,1))&&(u={i:l,l:w}));this.y<Math.min((q=m[u.i]).y0,q.y1)?this.y=Math.min(q.y0,q.y1):this.y>Math.max(q.y0,q.y1)&&(this.y=Math.max(q.y0,q.y1));this.x<Math.min(q.x0,q.x1)?this.x=Math.min(q.x0,q.x1):this.x>Math.max(q.x0,q.x1)&&(this.x=Math.max(q.x0,q.x1));Math.abs(q.x0-q.x1)<Math.abs(q.y0-q.y1)?this.x=(this.y*(q.x0-q.x1)-q.x0*q.y1+q.y0*
q.x1)/(q.y0-q.y1):this.y=(this.x*(q.y0-q.y1)-q.y0*q.x1+q.x0*q.y1)/(q.x0-q.x1)}}};
function clickEditable(a,b){var c=0;this.suggested_id=b.suggested_id?b.suggested_id:"click_editable_suggested";this.suggestions=b.suggestions?b.suggestions:[];this.maxlength=b.maxlength?b.maxlength:0;this.inlineStyle=b.inlineStyle?b.inlineStyle:"";this.change_callback=b.change_callback;this.keyup_callback=b.keyup_callback?b.keyup_callback:function(){};this.postclick_callback=b.postclick_callback?b.postclick_callback:function(){};this.empty_shortcut=b.empty_shortcut?b.empty_shortcut:!1;this.growable=
b.growable?b.growable:!0;this.chars_per_row=b.chars_per_row?b.chars_per_row:18;this.height_per_row=b.height_per_row?b.height_per_row:15;this.show_suggestion_count=8;this.suggestion_mode=this.got_ajax_suggestions=!1;this.selector=a;var d=this;this.addSuggestions=function(a){d.suggestions=d.suggestions.concat(a);d.suggestions=d.suggestions.uniq();d.suggestions.sort(function(a,b){a=a.toLowerCase();b=b.toLowerCase();return a>b?1:b>a?-1:0})};this.showClickEditSuggestions=function(a,b){if(d.suggestions&&
d.suggestions.length){jq("#"+d.suggested_id+" li").removeClass("active");c=0;var g=jq.trim(b.attr("value")).toLowerCase(),j=[];if(""!=g)jq(d.suggestions).each(function(a,b){if(0==b.toLowerCase().indexOf(g)&&(j.push(b),j.length==d.show_suggestion_count))return!1}),this.empty_shortcut&&(j=[this.empty_shortcut].concat(j));else for(var h=0;h<Math.min(d.show_suggestion_count,d.suggestions.length);h++)j.push(d.suggestions[h]);h=jq("#"+d.suggested_id);if(j.length){h.remove();h=jq('<div id="'+d.suggested_id+
'"></div>');jq(b).offsetParent().append(h);var l=b.position(),m="<ul>";jQuery(j).each(function(a,b){m+="<li>"+b+"</li>"});m+="</ul>";h.html(m).css({left:l.left+"px",top:l.top+b.height()+6+"px",display:"block",position:"absolute"});jq("#"+d.suggested_id+" li").mouseover(function(){jq(this).addClass("active").siblings().removeClass("active");d.suggestion_mode=!0;c=jq(this).prevAll().size()+1}).mouseout(function(){d.suggestion_mode=!1}).click(function(){b.attr("value",jq(this).text());d.finish(a,b)})}else h.hide()}};
this.doneEditingCallback=function(a,b,c){b.replaceWith(a);d.observeClickEdit(0,a);c&&d.addSuggestions(c);a.removeClass("highlighted")};this.finish=function(a,b){c=0;jq("#"+d.suggested_id).hide();var g=b.val().replace(/<.*?>/ig,"");g==this.empty_shortcut&&(g="");b.val(g);d.change_callback.apply(null,[a,b,d.doneEditingCallback])};this.observeClickEdit=function(a,f){jq(f).hover(function(){jq(this).addClass("highlighted")},function(){jq(this).removeClass("highlighted")}).click(function(){var g=jq(this);
g.children("em").size()?priorHtml="":(priorHtml="",g.contents().each(function(){jq(this).hasClass("ignore")||(priorHtml+=jq(this).text())}));var f="clickedit_"+Math.floor(1E4*Math.random())+"_"+a,h;h="textarea"==b.type?jq('<textarea id="'+f+'" spellcheck="true"></textarea>'):jq('<input type="text" value="" style="'+(d.inlineStyle?d.inlineStyle:"")+'" maxlength="'+(d.maxlength?d.maxlength:"")+'" spellcheck="true">');g.replaceWith(h);var l=!1;"textarea"==b.type&&b.growable&&(0!=d.maxlength&&jq("#"+
f).keyup(function(){var a=jq(this).val();a.length>=d.maxlength&&jq(this).val(a.substr(0,d.maxlength))}),d.chars_per_row&&d.height_per_row?(makeGrowable(f,d.chars_per_row,d.height_per_row,50),l=!0):h.css("height","50px"));d.keyup_callback();jq("#"+f).keyup(d.keyup_callback);h.focus();h[0].createTextRange&&h[0].createTextRange().select();"textarea"==b.type?h.html(priorHtml):h.val(priorHtml);l&&growTextArea(document.getElementById(f),d.chars_per_row,d.height_per_row,50);d.showClickEditSuggestions(g,
h);h.blur(function(){d.suggestion_mode||d.finish(g,h)}).keyup(function(a){if(d.suggestions&&38==a.keyCode)0<c&&(a=--c,0<a&&jq("#"+d.suggested_id+" ul li:nth-child("+a+")").addClass("active"),jq("#"+d.suggested_id+" ul li:nth-child("+(a+1)+")").removeClass("active"));else if(d.suggestions&&40==a.keyCode)c<jq("#"+d.suggested_id+" ul").children().size()&&(a=++c,jq("#"+d.suggested_id+" ul li:nth-child("+a+")").addClass("active"),1<a&&jq("#"+d.suggested_id+" ul li:nth-child("+(a-1)+")").removeClass("active"));
else if(13==a.keyCode){if(d.suggestions){var b=jq("#"+d.suggested_id+" li.active").first();b.size()&&h.attr("value",b.text())}d.suggestion_mode||d.finish(g,h);a.stopPropagation()}else d.showClickEditSuggestions(g,h)}).keypress(function(a){13==a.keyCode&&a.preventDefault()});!d.got_ajax_suggestions&&b.suggestions_from_url&&(d.got_ajax_suggestions=!0,jq.get(b.suggestions_from_url,{},function(a){d.addSuggestions(a);d.showClickEditSuggestions(g,h)},"json"));d.postclick_callback()})};jq(this.selector).each(this.observeClickEdit);
return this}
(function(a,b){function c(c,e,g){if("string"!==typeof c)throw"invalid module definition, module id must be defined and be a string";if(e===b)throw"invalid module definition, dependencies must be specified";if(g===b)throw"invalid module definition, definition function must be specified";for(var f,r=[],L=0;L<e.length;++L){if(!(f=d[e[L]]))a:{f=a;for(var S=e[L].split(/[.\/]/),Q=0;Q<S.length;++Q){if(!f[S[Q]]){f=void 0;break a}f=f[S[Q]]}}if(!f)throw"module definition dependecy not found: "+e[L];r.push(f)}(function(){d[c]=
g.apply(null,arguments)}).apply(null,r)}var d={};c("moxie/core/utils/Basic",[],function(){var a=function(a){return void 0===a?"undefined":null===a?"null":a.nodeType?"node":{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},b=function(e){c(arguments,function(g,f){0<f&&c(g,function(c,g){void 0!==c&&(a(e[g])===a(c)&&~d(a(c),["array","object"])?b(e[g],c):e[g]=c)})});return e},c=function(a,b){var c,d;if(a){try{c=a.length}catch(e){c=void 0}if(void 0===c)for(d in a){if(a.hasOwnProperty(d)&&!1===
b(a[d],d))break}else for(d=0;d<c&&!1!==b(a[d],d);d++);}},d=function(a,b){if(b){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(b,a);for(var c=0,d=b.length;c<d;c++)if(b[c]===a)return c}return-1},e=0;return{guid:function(a){var b=(new Date).getTime().toString(32),c;for(c=0;5>c;c++)b+=Math.floor(65535*Math.random()).toString(32);return(a||"o_")+b+(e++).toString(32)},typeOf:a,extend:b,each:c,isEmptyObj:function(b){var c;if(!b||"object"!==a(b))return!0;for(c in b)return!1;return!0},inSeries:function(b,
c){function d(g){if("function"===a(b[g]))b[g](function(a){++g<e&&!a?d(g):c(a)})}var e=b.length;"function"!==a(c)&&(c=function(){});(!b||!b.length)&&c();d(0)},inArray:d,arrayDiff:function(b,c){var e=[];"array"!==a(b)&&(b=[b]);"array"!==a(c)&&(c=[c]);for(var g in b)-1===d(b[g],c)&&e.push(b[g]);return e.length?e:!1},arrayIntersect:function(a,b){var e=[];c(a,function(a){-1!==d(a,b)&&e.push(a)});return e.length?e:null},toArray:function(a){var b,c=[];for(b=0;b<a.length;b++)c[b]=a[b];return c},trim:function(a){return!a?
a:String.prototype.trim?String.prototype.trim.call(a):a.toString().replace(/^\s*/,"").replace(/\s*$/,"")},parseSizeStr:function(a){if("string"!==typeof a)return a;var b={t:1099511627776,g:1073741824,m:1048576,k:1024},c;a=/^([0-9]+)([mgk]?)$/.exec(a.toLowerCase().replace(/[^0-9mkg]/g,""));c=a[2];a=+a[1];b.hasOwnProperty(c)&&(a*=b[c]);return a}}});c("moxie/core/I18n",["moxie/core/utils/Basic"],function(a){var b={};return{addI18n:function(c){return a.extend(b,c)},translate:function(a){return b[a]||a},
_:function(a){return this.translate(a)},sprintf:function(b){var c=[].slice.call(arguments,1),d="";a.each(b.split(/%[a-z]/),function(a){d+=a;c.length&&(d+=c.shift())});return d}}});c("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(a,b){var c={mimes:{},extensions:{},addMimeType:function(a){a=a.split(/,/);var b,c,d;for(b=0;b<a.length;b+=2){d=a[b+1].split(/ /);for(c=0;c<d.length;c++)this.mimes[d[c]]=a[b];this.extensions[a[b]]=d}},extList2mimes:function(b,c){var d,e,g,f,q=
[];for(e=0;e<b.length;e++){d=b[e].extensions.split(/\s*,\s*/);for(g=0;g<d.length;g++){if("*"===d[g])return[];if(f=this.mimes[d[g]])-1===a.inArray(f,q)&&q.push(f);else if(c&&/^\w+$/.test(d[g]))q.push("."+d[g]);else return[]}}return q},mimes2exts:function(b){var c=this,d=[];a.each(b,function(b){if("*"===b)return d=[],!1;var e=b.match(/^(\w+)\/(\*|\w+)$/);e&&("*"===e[2]?a.each(c.extensions,function(a,b){RegExp("^"+e[1]+"/").test(b)&&[].push.apply(d,c.extensions[b])}):c.extensions[b]&&[].push.apply(d,
c.extensions[b]))});return d},mimes2extList:function(c){var d=[],e=[];"string"===a.typeOf(c)&&(c=a.trim(c).split(/\s*,\s*/));e=this.mimes2exts(c);d.push({title:b.translate("Files"),extensions:e.length?e.join(","):"*"});d.mimes=c;return d},getFileExtension:function(a){return(a=a&&a.match(/\.([^.]+)$/))?a[1].toLowerCase():""},getFileMime:function(a){return this.mimes[this.getFileExtension(a)]||""}};c.addMimeType("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/mp4,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");
return c});c("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(a){function b(a){for(var c,d,e=0;e<a.length;e++)if(c=a[e].s1,d=a[e].prop,g=a[e].sv||a[e].id,c){if(-1!=c.indexOf(a[e].s2))return a[e].id}else if(d)return a[e].id}function c(a){var b=a.indexOf(g);if(-1!=b)return parseFloat(a.substring(b+g.length+1))}var d=[{s1:navigator.userAgent,s2:"Android",id:"Android Browser",sv:"Version"},{s1:navigator.userAgent,s2:"Chrome",id:"Chrome"},{s1:navigator.vendor,s2:"Apple",id:"Safari",sv:"Version"},
{prop:window.opera&&window.opera.buildNumber,id:"Opera",sv:"Version"},{s1:navigator.vendor,s2:"KDE",id:"Konqueror"},{s1:navigator.userAgent,s2:"Firefox",id:"Firefox"},{s1:navigator.vendor,s2:"Camino",id:"Camino"},{s1:navigator.userAgent,s2:"Netscape",id:"Netscape"},{s1:navigator.userAgent,s2:"MSIE",id:"IE",sv:"MSIE"},{s1:navigator.userAgent,s2:"Trident",id:"IE",sv:"rv"},{s1:navigator.userAgent,s2:"Gecko",id:"Mozilla",sv:"rv"}],e=[{s1:navigator.platform,s2:"Win",id:"Windows"},{s1:navigator.platform,
s2:"Mac",id:"Mac"},{s1:navigator.userAgent,s2:"iPhone",id:"iOS"},{s1:navigator.userAgent,s2:"iPad",id:"iOS"},{s1:navigator.userAgent,s2:"Android",id:"Android"},{s1:navigator.platform,s2:"Linux",id:"Linux"}],g,f=document.createElement("canvas"),f=!(!f.getContext||!f.getContext("2d")),Q=new Image;Q.onload=function(){h.use_data_uri=1===Q.width&&1===Q.height};setTimeout(function(){Q.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1);var h={define_property:!1,
create_canvas:f,return_response_type:function(b){try{if(-1!==a.inArray(b,["","text","document"]))return!0;if(window.XMLHttpRequest){var c=new XMLHttpRequest;c.open("get","/");if("responseType"in c)return c.responseType=b,c.responseType!==b?!1:!0}}catch(d){}return!1},use_data_uri:!1,use_data_uri_over32kb:function(){return h.use_data_uri&&("IE"!==j.browser||9<=j.version)},use_data_uri_of:function(a){return h.use_data_uri&&33E3>a||h.use_data_uri_over32kb()},use_fileinput:function(){var a=document.createElement("input");
a.setAttribute("type","file");return!a.disabled}},j={can:function(b){var c=[].slice.call(arguments);c.shift();return"function"===a.typeOf(h[b])?h[b].apply(this,c):!!h[b]},browser:b(d),version:c(navigator.userAgent)||c(navigator.appVersion),OS:b(e),swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return j});c("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(a){var b=function(a,b){return!a.className?!1:RegExp("(^|\\s+)"+
b+"(\\s+|$)").test(a.className)};return{get:function(a){return"string"!==typeof a?a:document.getElementById(a)},hasClass:b,addClass:function(a,c){b(a,c)||(a.className=!a.className?c:a.className.replace(/\s+$/,"")+" "+c)},removeClass:function(a,b){a.className&&(a.className=a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)"),function(a,b,c){return" "===b&&" "===c?" ":""}))},getStyle:function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return window.getComputedStyle(a,
null)[b]},getPos:function(b,c){function d(a){var b,c=0;b=0;a&&(b=a.getBoundingClientRect(),a="CSS1Compat"===h.compatMode?h.documentElement:h.body,c=b.left+a.scrollLeft,b=b.top+a.scrollTop);return{x:c,y:b}}var e=0,g=0,f,h=document;c=c||h.body;if(b&&b.getBoundingClientRect&&"IE"===a.browser&&(!h.documentMode||8>h.documentMode))return e=d(b),g=d(c),{x:e.x-g.x,y:e.y-g.y};for(f=b;f&&f!=c&&f.nodeType;)e+=f.offsetLeft||0,g+=f.offsetTop||0,f=f.offsetParent;for(f=b.parentNode;f&&f!=c&&f.nodeType;)e-=f.scrollLeft||
0,g-=f.scrollTop||0,f=f.parentNode;return{x:e,y:g}},getSize:function(a){return{w:a.offsetWidth||a.clientWidth,h:a.offsetHeight||a.clientHeight}}}});c("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(a){function b(a,c){for(var d in a)if(a[d]===c)return d;return null}var c=function(a){this.code=a;this.name=b(d,a);this.message=this.name+": RuntimeError "+this.code},d={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};a.extend(c,d);c.prototype=Error.prototype;var e=function(a){this.code=a;this.name=
"OperationNotAllowedException"};a.extend(e,{NOT_ALLOWED_ERR:1});e.prototype=Error.prototype;var g=function(a){this.code=a;this.name=b(f,a);this.message=this.name+": ImageError "+this.code},f={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};a.extend(g,f);g.prototype=Error.prototype;var h=function(a){this.code=a;this.name=b(j,a);this.message=this.name+": FileException "+this.code},j={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,
SYNTAX_ERR:8};a.extend(h,j);h.prototype=Error.prototype;var W=function(a){this.code=a;this.name=b(B,a);this.message=this.name+": DOMException "+this.code},B={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,
SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};a.extend(W,B);W.prototype=Error.prototype;var D=function(a){this.code=a;this.name="EventException"};a.extend(D,{UNSPECIFIED_EVENT_TYPE_ERR:0});D.prototype=Error.prototype;return{RuntimeError:c,OperationNotAllowedException:e,ImageError:g,FileException:h,DOMException:W,EventException:D}});c("moxie/core/EventTarget",["moxie/core/Exceptions","moxie/core/utils/Basic"],
function(a,b){function c(){var d={};b.extend(this,{uid:null,init:function(){this.uid||(this.uid=b.guid("uid_"))},addEventListener:function(a,c,e,g){var f=this,m;a=b.trim(a);/\s/.test(a)?b.each(a.split(/\s+/),function(a){f.addEventListener(a,c,e,g)}):(a=a.toLowerCase(),e=parseInt(e,10)||0,m=d[this.uid]&&d[this.uid][a]||[],m.push({fn:c,priority:e,scope:g||this}),d[this.uid]||(d[this.uid]={}),d[this.uid][a]=m)},hasEventListener:function(a){return a?!(!d[this.uid]||!d[this.uid][a]):!!d[this.uid]},removeEventListener:function(a,
c){a=a.toLowerCase();var e=d[this.uid]&&d[this.uid][a],g;if(e){if(c)for(g=e.length-1;0<=g;g--){if(e[g].fn===c){e.splice(g,1);break}}else e=[];e.length||(delete d[this.uid][a],b.isEmptyObj(d[this.uid])&&delete d[this.uid])}},removeAllEventListeners:function(){d[this.uid]&&delete d[this.uid]},dispatchEvent:function(c){var e,g,f={},q=!0;if("string"!==b.typeOf(c))if(e=c,"string"===b.typeOf(e.type))c=e.type,e.total&&e.loaded&&(f.total=e.total,f.loaded=e.loaded),f.async=e.async||!1;else throw new a.EventException(a.EventException.UNSPECIFIED_EVENT_TYPE_ERR);
if(-1!==c.indexOf("::")){var h=c.split("::");e=h[0];c=h[1]}else e=this.uid;c=c.toLowerCase();if(e=d[e]&&d[e][c]){e.sort(function(a,b){return b.priority-a.priority});g=[].slice.call(arguments);g.shift();f.type=c;g.unshift(f);var j=[];b.each(e,function(a){g[0].target=a.scope;f.async?j.push(function(b){setTimeout(function(){b(!1===a.fn.apply(a.scope,g))},1)}):j.push(function(b){b(!1===a.fn.apply(a.scope,g))})});j.length&&b.inSeries(j,function(a){q=!a})}return q},bind:function(){this.addEventListener.apply(this,
arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(a){var c;"array"!==b.typeOf(a)&&(a=[a]);for(var d=0;d<a.length;d++)c="on"+a[d],"function"===b.typeOf(this[c])?this.addEventListener(a[d],this[c]):"undefined"===b.typeOf(this[c])&&(this[c]=null)}})}c.instance=new c;return c});c("moxie/core/utils/Encode",
[],function(){var a=function(a){return unescape(encodeURIComponent(a))},b=function(a){return decodeURIComponent(escape(a))};return{utf8_encode:a,utf8_decode:b,atob:function(a,c){if("function"===typeof window.atob)return c?b(window.atob(a)):window.atob(a);var d,e,g,f,m,h=0,j=0;f="";var D=[];if(!a)return a;a+="";do d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h++)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h++)),
f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h++)),m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h++)),g=d<<18|e<<12|f<<6|m,d=g>>16&255,e=g>>8&255,g&=255,64==f?D[j++]=String.fromCharCode(d):64==m?D[j++]=String.fromCharCode(d,e):D[j++]=String.fromCharCode(d,e,g);while(h<a.length);f=D.join("");return c?b(f):f},btoa:function(b,c){c&&a(b);if("function"===typeof window.btoa)return window.btoa(b);var d,e,g,f,h=0,j=0,w="",
w=[];if(!b)return b;do d=b.charCodeAt(h++),e=b.charCodeAt(h++),g=b.charCodeAt(h++),f=d<<16|e<<8|g,d=f>>18&63,e=f>>12&63,g=f>>6&63,f&=63,w[j++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f);while(h<b.length);w=w.join("");h=b.length%3;return(h?
w.slice(0,h-3):w)+"===".slice(h||3)}}});c("moxie/runtime/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(a,b,c){function d(c,e,f,h,q){var j=this,r,n=a.guid(e+"_");q=q||"browser";c=c||{};g[n]=this;f=a.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,
select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},f);c.preferred_caps&&(q=d.getMode(h,c.preferred_caps,q));var l={};r={exec:function(a,b,c,d){if(r[b]&&(l[a]||(l[a]={context:this,instance:new r[b]}),l[a].instance[c]))return l[a].instance[c].apply(this,d)},removeInstance:function(a){delete l[a]},removeAllInstances:function(){var b=this;a.each(l,function(c,d){"function"===
a.typeOf(c.instance.destroy)&&c.instance.destroy.call(c.context);b.removeInstance(d)})}};a.extend(this,{initialized:!1,uid:n,type:e,mode:d.getMode(h,c.required_caps,q),shimid:n+"_container",clients:0,options:c,can:function(b,c,e){e=e||f;"string"===a.typeOf(b)&&"undefined"===a.typeOf(c)&&(b=d.parseCaps(b));if("object"===a.typeOf(b)){for(var g in b)if(!this.can(g,b[g],e))return!1;return!0}return"function"===a.typeOf(e[b])?e[b].call(this,c):c===e[b]},getShimContainer:function(){var c,d=b.get(this.shimid);
d||(c=this.options.container?b.get(this.options.container):document.body,d=document.createElement("div"),d.id=this.shimid,d.className="moxie-shim moxie-shim-"+this.type,a.extend(d.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),c.appendChild(d));return d},getShim:function(){return r},shimExec:function(a,b){var c=[].slice.call(arguments,2);return j.getShim().exec.call(this,this.uid,a,b,c)},exec:function(a,b){var c=[].slice.call(arguments,2);return j[a]&&
j[a][b]?j[a][b].apply(this,c):j.shimExec.apply(this,arguments)},destroy:function(){if(j){var a=b.get(this.shimid);a&&a.parentNode.removeChild(a);r&&r.removeAllInstances();this.unbindAll();delete g[this.uid];n=j=r=this.uid=null}}});this.mode&&(c.required_caps&&!this.can(c.required_caps))&&(this.mode=!1)}var e={},g={};d.order="html5,flash,silverlight,html4";d.getRuntime=function(a){return g[a]?g[a]:!1};d.addConstructor=function(a,b){b.prototype=c.instance;e[a]=b};d.getConstructor=function(a){return e[a]||
null};d.getInfo=function(a){var b=d.getRuntime(a);return b?{uid:b.uid,type:b.type,can:function(){return b.can.apply(b,arguments)}}:null};d.parseCaps=function(b){var c={};if("string"!==a.typeOf(b))return b||{};a.each(b.split(","),function(a){c[a]=!0});return c};d.can=function(a,b){var c;c=d.getConstructor(a);var e;return c?(c=new c({required_caps:b}),e=c.mode,c.destroy(),!!e):!1};d.thatCan=function(a,b){var c=(b||d.order).split(/\s*,\s*/),e;for(e in c)if(d.can(c[e],a))return c[e];return null};d.getMode=
function(b,c,d){var e=null;"undefined"===a.typeOf(d)&&(d="browser");if(c&&!a.isEmptyObj(b)){a.each(c,function(c,d){if(b.hasOwnProperty(d)){var g=b[d](c);"string"===typeof g&&(g=[g]);if(e){if(!(e=a.arrayIntersect(e,g)))return e=!1}else e=g}});if(e)return-1!==a.inArray(d,e)?d:e[0];if(!1===e)return!1}return d};d.capTrue=function(){return!0};d.capFalse=function(){return!1};d.capTest=function(a){return function(){return!!a}};return d});c("moxie/runtime/RuntimeClient",["moxie/core/Exceptions","moxie/core/utils/Basic",
"moxie/runtime/Runtime"],function(a,b,c){return function(){var d;b.extend(this,{connectRuntime:function(e){function g(b){var h;b.length?(h=b.shift(),(h=c.getConstructor(h))?(d=new h(e),d.bind("Init",function(){d.initialized=!0;setTimeout(function(){d.clients++;f.trigger("RuntimeInit",d)},1)}),d.bind("Error",function(){d.destroy();g(b)}),d.mode?d.init():d.trigger("Error")):g(b)):(f.trigger("RuntimeError",new a.RuntimeError(a.RuntimeError.NOT_INIT_ERR)),d=null)}var f=this,h;"string"===b.typeOf(e)?h=
e:"string"===b.typeOf(e.ruid)&&(h=e.ruid);if(h){if(d=c.getRuntime(h))return d.clients++,d;throw new a.RuntimeError(a.RuntimeError.NOT_INIT_ERR);}g((e.runtime_order||c.order).split(/\s*,\s*/))},getRuntime:function(){return d&&d.uid?d:d=null},disconnectRuntime:function(){d&&0>=--d.clients&&(d.destroy(),d=null)}})}});c("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(a,b,c){function d(g,f){function h(b,c,g){var f=e[this.uid];if("string"!==
a.typeOf(f)||!f.length)return null;c=new d(null,{type:g,size:c-b});c.detach(f.substr(b,c.size));return c}c.call(this);g&&this.connectRuntime(g);f?"string"===a.typeOf(f)&&(f={data:f}):f={};a.extend(this,{uid:f.uid||a.guid("uid_"),ruid:g,size:f.size||0,type:f.type||"",slice:function(a,b,c){return this.isDetached()?h.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),a,b,c)},getSource:function(){return!e[this.uid]?null:e[this.uid]},detach:function(a){this.ruid&&(this.getRuntime().exec.call(this,
"Blob","destroy",e[this.uid]),this.disconnectRuntime(),this.ruid=null);a=a||"";var c=a.match(/^data:([^;]*);base64,/);c&&(this.type=c[1],a=b.atob(a.substring(a.indexOf("base64,")+7)));this.size=a.length;e[this.uid]=a},isDetached:function(){return!this.ruid&&"string"===a.typeOf(e[this.uid])},destroy:function(){this.detach();delete e[this.uid]}});f.data?this.detach(f.data):e[this.uid]=f}var e={};return d});c("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(a,
b,c){function d(e,g){var f,h;g||(g={});h=g.type&&""!==g.type?g.type:b.getFileMime(g.name);g.name?(f=g.name.replace(/\\/g,"/"),f=f.substr(f.lastIndexOf("/")+1)):(f=h.split("/")[0],f=a.guid((""!==f?f:"file")+"_"),b.extensions[h]&&(f+="."+b.extensions[h][0]));c.apply(this,arguments);a.extend(this,{type:h||"",name:f||a.guid("file_"),lastModifiedDate:g.lastModifiedDate||(new Date).toLocaleString()})}d.prototype=c.prototype;return d});c("moxie/file/FileInput","moxie/core/utils/Basic moxie/core/utils/Mime moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/core/I18n moxie/file/File moxie/runtime/Runtime moxie/runtime/RuntimeClient".split(" "),
function(a,b,c,d,e,g,f,h,j){function l(e){var r=this,n;-1!==a.inArray(a.typeOf(e),["string","node"])&&(e={browse_button:e});n=c.get(e.browse_button);if(!n)throw new d.DOMException(d.DOMException.NOT_FOUND_ERR);n={accept:[{title:g.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:n.parentNode||document.body};e=a.extend({},n,e);"string"===typeof e.required_caps&&(e.required_caps=h.parseCaps(e.required_caps));"string"===typeof e.accept&&(e.accept=b.mimes2extList(e.accept));
n=c.get(e.container);n||(n=document.body);"static"===c.getStyle(n,"position")&&(n.style.position="relative");n=n=null;j.call(r);a.extend(r,{uid:a.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){r.convertEventPropsToHandlers(B);r.bind("RuntimeInit",function(b,d){r.ruid=d.uid;r.shimid=d.shimid;r.bind("Ready",function(){r.trigger("Refresh")},999);r.bind("Change",function(){var b=d.exec.call(r,"FileInput","getFiles");r.files=[];a.each(b,function(a){if(0===a.size)return!0;r.files.push(new f(r.ruid,
a))})},999);r.bind("Refresh",function(){var b,g,f;g=c.get(e.browse_button);f=c.get(d.shimid);g&&(b=c.getPos(g,c.get(e.container)),g=c.getSize(g),f&&a.extend(f.style,{top:b.y+"px",left:b.x+"px",width:g.w+"px",height:g.h+"px"}))});d.exec.call(r,"FileInput","init",e)});r.connectRuntime(a.extend({},e,{required_caps:{select_file:!0}}))},disable:function(b){var c=this.getRuntime();c&&c.exec.call(this,"FileInput","disable","undefined"===a.typeOf(b)?!0:b)},refresh:function(){r.trigger("Refresh")},destroy:function(){var b=
this.getRuntime();b&&(b.exec.call(this,"FileInput","destroy"),this.disconnectRuntime());"array"===a.typeOf(this.files)&&a.each(this.files,function(a){a.destroy()});this.files=null}})}var B="ready change cancel mouseenter mouseleave mousedown mouseup".split(" ");l.prototype=e.instance;return l});c("moxie/file/FileDrop","moxie/core/I18n moxie/core/utils/Dom moxie/core/Exceptions moxie/core/utils/Basic moxie/file/File moxie/runtime/RuntimeClient moxie/core/EventTarget moxie/core/utils/Mime".split(" "),
function(a,b,c,d,e,g,f,h){function j(c){var f=this,q;"string"===typeof c&&(c={drop_zone:c});q={accept:[{title:a.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}};c="object"===typeof c?d.extend({},q,c):q;c.container=b.get(c.drop_zone)||document.body;"static"===b.getStyle(c.container,"position")&&(c.container.style.position="relative");"string"===typeof c.accept&&(c.accept=h.mimes2extList(c.accept));g.call(f);d.extend(f,{uid:d.guid("uid_"),ruid:null,files:null,init:function(){f.convertEventPropsToHandlers(l);
f.bind("RuntimeInit",function(a,b){f.ruid=b.uid;f.bind("Drop",function(){var a=b.exec.call(f,"FileDrop","getFiles");f.files=[];d.each(a,function(a){f.files.push(new e(f.ruid,a))})},999);b.exec.call(f,"FileDrop","init",c);f.dispatchEvent("ready")});f.connectRuntime(c)},destroy:function(){var a=this.getRuntime();a&&(a.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime());this.files=null}})}var l=["ready","dragenter","dragleave","drop","error"];j.prototype=f.instance;return j});c("moxie/runtime/RuntimeTarget",
["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(a,b,c){function d(){this.uid=a.guid("uid_");b.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}d.prototype=c.instance;return d});c("moxie/file/FileReader","moxie/core/utils/Basic moxie/core/utils/Encode moxie/core/Exceptions moxie/core/EventTarget moxie/file/Blob moxie/file/File moxie/runtime/RuntimeTarget".split(" "),function(a,b,c,d,e,g,f){function h(){function d(a,m){function L(a){g.readyState=
h.DONE;g.error=a;g.trigger("error");v()}function v(){u.destroy();u=null;g.trigger("loadend")}u=new f;this.convertEventPropsToHandlers(j);if(this.readyState===h.LOADING)return L(new c.DOMException(c.DOMException.INVALID_STATE_ERR));this.readyState=h.LOADING;this.trigger("loadstart");if(m instanceof e)if(m.isDetached()){var l=m.getSource();switch(a){case "readAsText":case "readAsBinaryString":this.result=l;break;case "readAsDataURL":this.result="data:"+m.type+";base64,"+b.btoa(l)}this.readyState=h.DONE;
this.trigger("load");v()}else{var W=u.connectRuntime(m.ruid);u.bind("Error",function(a,b){L(b)});u.bind("Progress",function(a){g.result=W.exec.call(u,"FileReader","getResult");g.trigger(a)});u.bind("Load",function(a){g.readyState=h.DONE;g.result=W.exec.call(u,"FileReader","getResult");g.trigger(a);v()});W.exec.call(u,"FileReader","read",a,m)}else L(new c.DOMException(c.DOMException.NOT_FOUND_ERR))}var g=this,u;a.extend(this,{uid:a.guid("uid_"),readyState:h.EMPTY,result:null,error:null,readAsBinaryString:function(a){d.call(this,
"readAsBinaryString",a)},readAsDataURL:function(a){d.call(this,"readAsDataURL",a)},readAsText:function(a){d.call(this,"readAsText",a)},abort:function(){this.result=null;-1===a.inArray(this.readyState,[h.EMPTY,h.DONE])&&(this.readyState===h.LOADING&&(this.readyState=h.DONE),u&&u.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort();u&&(u.getRuntime().exec.call(this,"FileReader","destroy"),u.disconnectRuntime());g=u=null}})}
var j="loadstart progress load abort error loadend".split(" ");h.EMPTY=0;h.LOADING=1;h.DONE=2;h.prototype=d.instance;return h});c("moxie/core/utils/Url",[],function(){var a=function(b,c){for(var d="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" "),e=d.length,g={http:80,https:443},f={},h=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(b||
"");e--;)h[e]&&(f[d[e]]=h[e]);if(!f.scheme){if(!c||"string"===typeof c)c=a(c||document.location.href);f.scheme=c.scheme;f.host=c.host;f.port=c.port;d="";/^[^\/]/.test(f.path)&&(d=c.path,d=/(\/|\/[^\.]+)$/.test(d)?d+"/":d.replace(/\/[^\/]+$/,"/"));f.path=d+(f.path||"")}f.port||(f.port=g[f.scheme]||80);f.port=parseInt(f.port,10);f.path||(f.path="/");delete f.source;return f};return{parseUrl:a,resolveUrl:function(b){b=a(b);return b.scheme+"://"+b.host+(b.port!=={http:80,https:443}[b.scheme]?":"+b.port:
"")+b.path+(b.query?b.query:"")},hasSameOrigin:function(b){function c(a){return[a.scheme,a.host,a.port].join("/")}"string"===typeof b&&(b=a(b));return c(a())===c(b)}}});c("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(a,b,c){return function(){function d(a,b){if(b.isDetached()){var e=b.getSource();switch(a){case "readAsBinaryString":return e;case "readAsDataURL":return"data:"+b.type+";base64,"+c.btoa(e);case "readAsText":for(var g=
"",f=0,h=e.length;f<h;f++)g+=String.fromCharCode(e[f]);return g}}else return e=this.connectRuntime(b.ruid).exec.call(this,"FileReaderSync","read",a,b),this.disconnectRuntime(),e}b.call(this);a.extend(this,{uid:a.guid("uid_"),readAsBinaryString:function(a){return d.call(this,"readAsBinaryString",a)},readAsDataURL:function(a){return d.call(this,"readAsDataURL",a)},readAsText:function(a){return d.call(this,"readAsText",a)}})}});c("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic",
"moxie/file/Blob"],function(a,b,c){return function(){var a,d=[];b.extend(this,{append:function(e,g){var f=this,h=b.typeOf(g);g instanceof c?a={name:e,value:g}:"array"===h?(e+="[]",b.each(g,function(a){f.append(e,a)})):"object"===h?b.each(g,function(a,b){f.append(e+"["+b+"]",a)}):"null"===h||"undefined"===h||"number"===h&&isNaN(g)?f.append(e,"false"):d.push({name:e,value:g.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return a&&a.value||null},getBlobName:function(){return a&&
a.name||null},each:function(c){b.each(d,function(a){c(a.value,a.name)});a&&c(a.value,a.name)},destroy:function(){a=null;d=[]}})}});c("moxie/xhr/XMLHttpRequest","moxie/core/utils/Basic moxie/core/Exceptions moxie/core/EventTarget moxie/core/utils/Encode moxie/core/utils/Url moxie/runtime/Runtime moxie/runtime/RuntimeTarget moxie/file/Blob moxie/file/FileReaderSync moxie/xhr/FormData moxie/core/utils/Env moxie/core/utils/Mime".split(" "),function(a,b,c,d,e,g,f,h,j,l,B,D){function t(){this.uid=a.guid("uid_")}
function n(){function c(a,b){if(q.hasOwnProperty(a)){if(1===arguments.length)return B.can("define_property")?q[a]:j[a];B.can("define_property")?q[a]=b:j[a]=b}}var j=this,q={timeout:0,readyState:n.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},X=!0,I,C,J={},K,Z,ma=null,ca=null,da=!1,aa=!1,ba=!1,na=!1,ea=!1,ga=!1,V={},N,fa="",T;a.extend(this,q,{uid:a.guid("uid_"),upload:new t,open:function(g,f,h,j,q){if(!g||!f)throw new b.DOMException(b.DOMException.SYNTAX_ERR);
if(/[\u0100-\uffff]/.test(g)||d.utf8_encode(g)!==g)throw new b.DOMException(b.DOMException.SYNTAX_ERR);~a.inArray(g.toUpperCase(),"CONNECT DELETE GET HEAD OPTIONS POST PUT TRACE TRACK".split(" "))&&(C=g.toUpperCase());if(~a.inArray(C,["CONNECT","TRACE","TRACK"]))throw new b.DOMException(b.DOMException.SECURITY_ERR);f=d.utf8_encode(f);g=e.parseUrl(f);ga=e.hasSameOrigin(g);I=e.resolveUrl(f);if((j||q)&&!ga)throw new b.DOMException(b.DOMException.INVALID_ACCESS_ERR);K=j||g.user;Z=q||g.pass;X=h||!0;if(!1===
X&&(c("timeout")||c("withCredentials")||""!==c("responseType")))throw new b.DOMException(b.DOMException.INVALID_ACCESS_ERR);da=!X;aa=!1;J={};c("responseText","");c("responseXML",null);c("response",null);c("status",0);c("statusText","");c("readyState",n.OPENED);this.convertEventPropsToHandlers(["readystatechange"]);this.dispatchEvent("readystatechange")},setRequestHeader:function(e,g){if(c("readyState")!==n.OPENED||aa)throw new b.DOMException(b.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(e)||
d.utf8_encode(e)!==e)throw new b.DOMException(b.DOMException.SYNTAX_ERR);e=a.trim(e).toLowerCase();if(~a.inArray(e,"accept-charset accept-encoding access-control-request-headers access-control-request-method connection content-length cookie cookie2 content-transfer-encoding date expect host keep-alive origin referer te trailer transfer-encoding upgrade user-agent via".split(" "))||/^(proxy\-|sec\-)/.test(e))return!1;J[e]=J[e]?J[e]+(", "+g):g;return!0},getAllResponseHeaders:function(){return fa||""},
getResponseHeader:function(b){b=b.toLowerCase();return ea||~a.inArray(b,["set-cookie","set-cookie2"])?null:fa&&""!==fa&&(T||(T={},a.each(fa.split(/\r\n/),function(b){b=b.split(/:\s+/);2===b.length&&(b[0]=a.trim(b[0]),T[b[0].toLowerCase()]={header:b[0],value:a.trim(b[1])})})),T.hasOwnProperty(b))?T[b].header+": "+T[b].value:null},overrideMimeType:function(d){var e;if(~a.inArray(c("readyState"),[n.LOADING,n.DONE]))throw new b.DOMException(b.DOMException.INVALID_STATE_ERR);d=a.trim(d.toLowerCase());
if(/;/.test(d)&&(e=d.match(/^([^;]+)(?:;\scharset\=)?(.*)$/)))d=e[1];if(!D.mimes[d])throw new b.DOMException(b.DOMException.SYNTAX_ERR);},send:function(e,j){V="string"===a.typeOf(j)?{ruid:j}:j?j:{};this.convertEventPropsToHandlers(v);this.upload.convertEventPropsToHandlers(v);if(this.readyState!==n.OPENED||aa)throw new b.DOMException(b.DOMException.INVALID_STATE_ERR);if(e instanceof h)V.ruid=e.ruid,ca=e.type||"application/octet-stream";else if(e instanceof l){if(e.hasBlob()){var q=e.getBlob();V.ruid=
q.ruid;ca=q.type||"application/octet-stream"}}else"string"===typeof e&&(ma="UTF-8",ca="text/plain;charset=UTF-8",e=d.utf8_encode(e));this.withCredentials||(this.withCredentials=V.required_caps&&V.required_caps.send_browser_cookies&&!ga);ba=!da&&this.upload.hasEventListener();ea=!1;na=!e;da||(aa=!0);var r=e,t=function(){N.destroy();N=null;B.dispatchEvent("loadend");B=null},D=function(b){N.bind("LoadStart",function(a){c("readyState",n.LOADING);B.dispatchEvent("readystatechange");B.dispatchEvent(a);
ba&&B.upload.dispatchEvent(a)});N.bind("Progress",function(a){c("readyState")!==n.LOADING&&(c("readyState",n.LOADING),B.dispatchEvent("readystatechange"));B.dispatchEvent(a)});N.bind("UploadProgress",function(a){ba&&B.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:a.total,loaded:a.loaded})});N.bind("Load",function(d){c("readyState",n.DONE);c("status",Number(b.exec.call(N,"XMLHttpRequest","getStatus")||0));c("statusText",F[c("status")]||"");c("response",b.exec.call(N,"XMLHttpRequest",
"getResponse",c("responseType")));~a.inArray(c("responseType"),["text",""])?c("responseText",c("response")):"document"===c("responseType")&&c("responseXML",c("response"));fa=b.exec.call(N,"XMLHttpRequest","getAllResponseHeaders");B.dispatchEvent("readystatechange");0<c("status")?(ba&&B.upload.dispatchEvent(d),B.dispatchEvent(d)):(ea=!0,B.dispatchEvent("error"));t()});N.bind("Abort",function(a){B.dispatchEvent(a);t()});N.bind("Error",function(a){ea=!0;c("readyState",n.DONE);B.dispatchEvent("readystatechange");
na=!0;B.dispatchEvent(a);t()});b.exec.call(N,"XMLHttpRequest","send",{url:I,method:C,async:X,user:K,password:Z,headers:J,mimeType:ca,encoding:ma,responseType:B.responseType,withCredentials:B.withCredentials,options:V},r)},B=this;(new Date).getTime();N=new f;"string"===typeof V.required_caps&&(V.required_caps=g.parseCaps(V.required_caps));V.required_caps=a.extend({},V.required_caps,{return_response_type:B.responseType});r instanceof l&&(V.required_caps.send_multipart=!0);ga||(V.required_caps.do_cors=
!0);V.ruid?D(N.connectRuntime(V)):(N.bind("RuntimeInit",function(a,b){D(b)}),N.bind("RuntimeError",function(a,b){B.dispatchEvent("RuntimeError",b)}),N.connectRuntime(V))},abort:function(){ea=!0;da=!1;if(~a.inArray(c("readyState"),[n.UNSENT,n.OPENED,n.DONE]))c("readyState",n.UNSENT);else{c("readyState",n.DONE);aa=!1;if(N)N.getRuntime().exec.call(N,"XMLHttpRequest","abort",na);else throw new b.DOMException(b.DOMException.INVALID_STATE_ERR);na=!0}},destroy:function(){N&&("function"===a.typeOf(N.destroy)&&
N.destroy(),N=null);this.unbindAll();this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var F={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",
402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",
502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};t.prototype=c.instance;var v="loadstart progress abort error load timeout loadend".split(" ");n.UNSENT=0;n.OPENED=1;n.HEADERS_RECEIVED=2;n.LOADING=3;n.DONE=4;n.prototype=c.instance;return n});c("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],
function(a,b,c,d){function e(){function d(b,c){var f=this;h=c;f.bind("TransportingProgress",function(b){l=b.loaded;l<u&&-1===a.inArray(f.state,[e.IDLE,e.DONE])&&g.call(f)},999);f.bind("TransportingComplete",function(){l=u;f.state=e.DONE;j=null;f.result=h.exec.call(f,"Transporter","getAsBlob",b||"")},999);f.state=e.BUSY;f.trigger("TransportingStarted");g.call(f)}function g(){var a;a=u-l;t>a&&(t=a);a=b.btoa(j.substr(l,t));h.exec.call(this,"Transporter","receive",a,u)}var f,h,j,u,l,t;c.call(this);a.extend(this,
{uid:a.guid("uid_"),state:e.IDLE,result:null,transport:function(b,c,e){var g=this;e=a.extend({chunk_size:204798},e);if(f=e.chunk_size%3)e.chunk_size+=3-f;t=e.chunk_size;u=l=0;j=this.result=null;j=b;u=b.length;if("string"===a.typeOf(e)||e.ruid)d.call(g,c,this.connectRuntime(e));else{var h=function(a,b){g.unbind("RuntimeInit",h);d.call(g,c,b)};this.bind("RuntimeInit",h);this.connectRuntime(e)}},abort:function(){this.state=e.IDLE;h&&(h.exec.call(this,"Transporter","clear"),this.trigger("TransportingAborted"));
u=l=0;j=this.result=null},destroy:function(){this.unbindAll();h=null;this.disconnectRuntime();u=l=0;j=this.result=null}})}e.IDLE=0;e.BUSY=1;e.DONE=2;e.prototype=d.instance;return e});c("moxie/image/Image","moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/Exceptions moxie/file/FileReaderSync moxie/xhr/XMLHttpRequest moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/runtime/Transporter moxie/core/utils/Env moxie/core/EventTarget moxie/file/Blob moxie/file/File moxie/core/utils/Encode".split(" "),
function(a,b,c,d,e,g,f,h,j,l,B,D,t){function n(){function d(b){var e=a.typeOf(b);try{if(b instanceof n){if(!b.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);u.apply(this,arguments)}else if(b instanceof B){if(!~a.inArray(b.type,["image/jpeg","image/png"]))throw new c.ImageError(c.ImageError.WRONG_FORMAT);l.apply(this,arguments)}else if(-1!==a.inArray(e,["blob","file"]))d.call(this,new D(null,b),arguments[1]);else if("string"===e)/^data:[^;]*;base64,/.test(b)?d.call(this,new B(null,
{data:b}),arguments[1]):W.apply(this,arguments);else if("node"===e&&"img"===b.nodeName.toLowerCase())d.call(this,b.src,arguments[1]);else throw new c.DOMException(c.DOMException.TYPE_MISMATCH_ERR);}catch(g){this.trigger("error",g)}}function u(b,c){var d=this.connectRuntime(b.ruid);this.ruid=d.uid;d.exec.call(this,"Image","loadFromImage",b,"undefined"===a.typeOf(c)?!0:c)}function l(b,c){function d(a){e.ruid=a.uid;a.exec.call(e,"Image","loadFromBlob",b)}var e=this;e.name=b.name||"";b.isDetached()?(this.bind("RuntimeInit",
function(a,b){d(b)}),c&&"string"===typeof c.required_caps&&(c.required_caps=g.parseCaps(c.required_caps)),this.connectRuntime(a.extend({required_caps:{access_image_binary:!0,resize_image:!0}},c))):d(this.connectRuntime(b.ruid))}function W(a,b){var c=this,d;d=new e;d.open("get",a);d.responseType="blob";d.onprogress=function(a){c.trigger(a)};d.onload=function(){l.call(c,d.response,!0)};d.onerror=function(a){c.trigger(a)};d.onloadend=function(){d.destroy()};d.bind("RuntimeError",function(a,b){c.trigger("RuntimeError",
b)});d.send(null,b)}f.call(this);a.extend(this,{uid:a.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){var a=void 0,a=this.getRuntime().exec.call(this,"Image","getInfo");this.size=a.size;this.width=a.width;this.height=a.height;this.type=a.type;this.meta=a.meta;""===this.name&&(this.name=a.name)},999);this.convertEventPropsToHandlers(F);d.apply(this,arguments)},downsize:function(b,
d,e,g){try{if(!this.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);if(this.width>n.MAX_RESIZE_WIDTH||this.height>n.MAX_RESIZE_HEIGHT)throw new c.ImageError(c.ImageError.MAX_RESOLUTION_ERR);if(!b&&!d||"undefined"===a.typeOf(e))e=!1;b=b||this.width;d=d||this.height;g="undefined"===a.typeOf(g)?!0:!!g;this.getRuntime().exec.call(this,"Image","downsize",b,d,e,g)}catch(f){this.trigger("error",f)}},crop:function(a,b,c){this.downsize(a,b,!0,c)},getAsCanvas:function(){if(!j.can("create_canvas"))throw new c.RuntimeError(c.RuntimeError.NOT_SUPPORTED_ERR);
return this.connectRuntime(this.ruid).exec.call(this,"Image","getAsCanvas")},getAsBlob:function(a,b){if(!this.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);a||(a="image/jpeg");"image/jpeg"===a&&!b&&(b=90);return this.getRuntime().exec.call(this,"Image","getAsBlob",a,b)},getAsDataURL:function(a,b){if(!this.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",a,b)},getAsBinaryString:function(a,b){var c=this.getAsDataURL(a,
b);return t.atob(c.substring(c.indexOf("base64,")+7))},embed:function(d,e){function g(){if(j.can("create_canvas")){var b=u.getAsCanvas();if(b){d.appendChild(b);b=null;u.destroy();f.trigger("embedded");return}}b=u.getAsDataURL(r,l);if(!b)throw new c.ImageError(c.ImageError.WRONG_FORMAT);if(j.can("use_data_uri_of",b.length))d.innerHTML='<img src="'+b+'" width="'+u.width+'" height="'+u.height+'" />',u.destroy(),f.trigger("embedded");else{var e=new h;e.bind("TransportingComplete",function(){D=f.connectRuntime(this.result.ruid);
f.bind("Embedded",function(){a.extend(D.getShimContainer().style,{top:"0px",left:"0px",width:u.width+"px",height:u.height+"px"});D=null},999);D.exec.call(f,"ImageView","display",this.result.uid,v,W);u.destroy()});e.transport(t.atob(b.substring(b.indexOf("base64,")+7)),r,a.extend({},S,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:d}))}}var f=this,u,r,l,L,S=e||{},v=this.width,W=this.height,D;try{if(!(d=b.get(d)))throw new c.DOMException(c.DOMException.INVALID_NODE_TYPE_ERR);
if(!this.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);if(this.width>n.MAX_RESIZE_WIDTH||this.height>n.MAX_RESIZE_HEIGHT)throw new c.ImageError(c.ImageError.MAX_RESOLUTION_ERR);r=S.type||this.type||"image/jpeg";l=S.quality||90;L="undefined"!==a.typeOf(S.crop)?S.crop:!1;if(S.width)v=S.width,W=S.height||v;else{var B=b.getSize(d);B.w&&B.h&&(v=B.w,W=B.h)}u=new n;u.bind("Resize",function(){g.call(f)});u.bind("Load",function(){u.downsize(v,W,L,!1)});u.clone(this,!1);return u}catch(F){this.trigger("error",
F)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime());this.unbindAll()}})}var F=["progress","load","error","resize","embedded"];n.MAX_RESIZE_WIDTH=6500;n.MAX_RESIZE_HEIGHT=6500;n.prototype=l.instance;return n});c("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(a,b,c,d){var e={};c.addConstructor("html5",function(b,g,f){var h=this,j=c.capTest,l=c.capTrue;
f=a.extend({access_binary:j(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return h.can("access_binary")&&!!e.Image},display_media:j(d.can("create_canvas")||d.can("use_data_uri_over32kb")),do_cors:j(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:j(function(){var a=document.createElement("div");return("draggable"in a||"ondragstart"in a&&"ondrop"in a)&&("IE"!==d.browser||9<d.version)}()),filter_by_extension:j("Chrome"===d.browser&&
28<=d.version||"IE"===d.browser&&10<=d.version),return_response_headers:l,return_response_type:function(a){return"json"===a&&window.JSON?!0:d.can("return_response_type",a)},return_status_code:l,report_upload_progress:j(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return h.can("access_binary")&&d.can("create_canvas")},select_file:function(){return d.can("use_fileinput")&&window.File},select_folder:function(){return h.can("select_file")&&"Chrome"===d.browser&&21<=d.version},
select_multiple:function(){return h.can("select_file")&&!("Safari"===d.browser&&"Windows"===d.OS)&&"iOS"!==d.OS},send_binary_string:j(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:j(window.XMLHttpRequest),send_multipart:function(){return!(!window.XMLHttpRequest||!(new XMLHttpRequest).upload||!window.FormData)||h.can("send_binary_string")},slice_blob:j(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),
stream_upload:function(){return h.can("slice_blob")&&h.can("send_multipart")},summon_file_dialog:j("Firefox"===d.browser&&4<=d.version||"Opera"===d.browser&&12<=d.version||"IE"===d.browser&&10<=d.version||!!~a.inArray(d.browser,["Chrome","Safari"])),upload_filesize:l},f);c.call(this,b,g||"html5",f);a.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(h);a=h=null}}(this.destroy)});a.extend(this.getShim(),e)});return e});c("moxie/runtime/html5/file/Blob",
["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(a,b){return a.Blob=function(){function a(b,c,d){var e;if(window.File.prototype.slice)try{return b.slice(),b.slice(c,d)}catch(g){return b.slice(c,d-c)}else return(e=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?e.call(b,c,d):null}this.slice=function(){return new b(this.getRuntime().uid,a.apply(this,arguments))}}});c("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(a){function b(){this.returnValue=!1}function c(){this.cancelBubble=
!0}var d={},e="moxie_"+a.guid(),g=function(b,c,g){var f;c=c.toLowerCase();if(b[e]&&d[b[e]]&&d[b[e]][c]){f=d[b[e]][c];for(var h=f.length-1;0<=h;h--)if(f[h].orig===g||f[h].key===g)if(b.removeEventListener?b.removeEventListener(c,f[h].func,!1):b.detachEvent&&b.detachEvent("on"+c,f[h].func),f[h].orig=null,f[h].func=null,f.splice(h,1),void 0!==g)break;f.length||delete d[b[e]][c];if(a.isEmptyObj(d[b[e]])){delete d[b[e]];try{delete b[e]}catch(j){b[e]=void 0}}}};return{addEvent:function(g,f,h,j){var l;f=
f.toLowerCase();g.addEventListener?(l=h,g.addEventListener(f,l,!1)):g.attachEvent&&(l=function(){var a=window.event;a.target||(a.target=a.srcElement);a.preventDefault=b;a.stopPropagation=c;h(a)},g.attachEvent("on"+f,l));g[e]||(g[e]=a.guid());d.hasOwnProperty(g[e])||(d[g[e]]={});g=d[g[e]];g.hasOwnProperty(f)||(g[f]=[]);g[f].push({func:l,orig:h,key:j})},removeEvent:g,removeAllEvents:function(b,c){b&&b[e]&&a.each(d[b[e]],function(a,d){g(b,d,c)})}}});c("moxie/runtime/html5/file/FileInput","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),
function(a,b,c,d,e,g){return a.FileInput=function(){var a=[],f;b.extend(this,{init:function(h){var j=this,m=j.getRuntime(),l,t,n;f=h;a=[];h=f.accept.mimes||e.extList2mimes(f.accept,m.can("filter_by_extension"));l=m.getShimContainer();l.innerHTML='<input id="'+m.uid+'" type="file" style="font-size:999px;opacity:0;"'+(f.multiple&&m.can("select_multiple")?"multiple":"")+(f.directory&&m.can("select_folder")?"webkitdirectory directory":"")+(h?' accept="'+h.join(",")+'"':"")+" />";h=c.get(m.uid);b.extend(h.style,
{position:"absolute",top:0,left:0,width:"100%",height:"100%"});t=c.get(f.browse_button);m.can("summon_file_dialog")&&("static"===c.getStyle(t,"position")&&(t.style.position="relative"),n=parseInt(c.getStyle(t,"z-index"),10)||1,t.style.zIndex=n,l.style.zIndex=n-1,d.addEvent(t,"click",function(a){var b=c.get(m.uid);b&&!b.disabled&&b.click();a.preventDefault()},j.uid));l=m.can("summon_file_dialog")?t:l;d.addEvent(l,"mouseover",function(){j.trigger("mouseenter")},j.uid);d.addEvent(l,"mouseout",function(){j.trigger("mouseleave")},
j.uid);d.addEvent(l,"mousedown",function(){j.trigger("mousedown")},j.uid);d.addEvent(c.get(f.container),"mouseup",function(){j.trigger("mouseup")},j.uid);h.onchange=function v(){a=[];f.directory?b.each(this.files,function(b){"."!==b.name&&a.push(b)}):a=[].slice.call(this.files);if("IE"!==g.browser)this.value="";else{var c=this.cloneNode(!0);this.parentNode.replaceChild(c,this);c.onchange=v}j.trigger("change")};j.trigger({type:"ready",async:!0});l=null},getFiles:function(){return a},disable:function(a){var b=
this.getRuntime();if(b=c.get(b.uid))b.disabled=!!a},destroy:function(){var b=this.getRuntime(),e=b.getShim(),b=b.getShimContainer();d.removeAllEvents(b,this.uid);d.removeAllEvents(f&&c.get(f.container),this.uid);d.removeAllEvents(f&&c.get(f.browse_button),this.uid);b&&(b.innerHTML="");e.removeInstance(this.uid);a=f=null}})}});c("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(a,
b,c,d,e){return a.FileDrop=function(){function a(c){c=e.getFileExtension(c.name);return!c||!h.length||-1!==b.inArray(c,h)}function g(c,d){var e=[];b.each(c,function(b){e.push(function(c){if(b.isFile)b.file(function(b){a(b)&&f.push(b);c()},function(){c()});else if(b.isDirectory){var d=function(a){h.readEntries(function(b){b.length?([].push.apply(e,b),d(a)):a()},a)},e=[],h=b.createReader();d(function(){g(e,c)})}else c()})});b.inSeries(e,function(){d()})}var f=[],h=[],j;b.extend(this,{init:function(c){var e=
this;j=c;c=j.accept;for(var m=[],q=0;q<c.length;q++)[].push.apply(m,c[q].extensions.split(/\s*,\s*/));h=-1===b.inArray("*",m)?m:[];c=j.container;d.addEvent(c,"dragover",function(a){a.preventDefault();a.stopPropagation();a.dataTransfer.dropEffect="copy"},e.uid);d.addEvent(c,"drop",function(c){c.preventDefault();c.stopPropagation();f=[];if(c.dataTransfer.items&&c.dataTransfer.items[0].webkitGetAsEntry){var d=[];b.each(c.dataTransfer.items,function(a){d.push(a.webkitGetAsEntry())});g(d,function(){e.trigger("drop")})}else b.each(c.dataTransfer.files,
function(b){a(b)&&f.push(b)}),e.trigger("drop")},e.uid);d.addEvent(c,"dragenter",function(a){a.preventDefault();a.stopPropagation();e.trigger("dragenter")},e.uid);d.addEvent(c,"dragleave",function(a){a.preventDefault();a.stopPropagation();e.trigger("dragleave")},e.uid)},getFiles:function(){return f},destroy:function(){d.removeAllEvents(j&&c.get(j.container),this.uid);f=h=j=null}})}});c("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],
function(a,b,c){return a.FileReader=function(){var a,d=!1;c.extend(this,{read:function(b,e){var g=this;a=new window.FileReader;a.addEventListener("progress",function(a){g.trigger(a)});a.addEventListener("load",function(a){g.trigger(a)});a.addEventListener("error",function(b){g.trigger(b,a.error)});a.addEventListener("loadend",function(){a=null});"function"===c.typeOf(a[b])?(d=!1,a[b](e.getSource())):"readAsBinaryString"===b&&(d=!0,a.readAsDataURL(e.getSource()))},getResult:function(){return a&&a.result?
d?b.atob(a.result.substring(a.result.indexOf("base64,")+7)):a.result:null},abort:function(){a&&a.abort()},destroy:function(){a=null}})}});c("moxie/runtime/html5/xhr/XMLHttpRequest","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/utils/Mime moxie/core/utils/Url moxie/file/File moxie/file/Blob moxie/xhr/FormData moxie/core/Exceptions moxie/core/utils/Env".split(" "),function(a,b,c,d,e,g,f,h,j){return a.XMLHttpRequest=function(){function a(b,c){var d=this,e,f;e=c.getBlob().getSource();
f=new window.FileReader;f.onload=function(){c.append(c.getBlobName(),new g(null,{type:e.type,data:f.result}));l.send.call(d,b,c)};f.readAsBinaryString(e)}function m(a){var b="----moxieboundary"+(new Date).getTime(),c="";if(!this.getRuntime().can("send_binary_string"))throw new h.RuntimeError(h.RuntimeError.NOT_SUPPORTED_ERR);t.setRequestHeader("Content-Type","multipart/form-data; boundary="+b);a.each(function(a,d){c=a instanceof g?c+("--"+b+'\r\nContent-Disposition: form-data; name="'+d+'"; filename="'+
unescape(encodeURIComponent(a.name||"blob"))+'"\r\nContent-Type: '+a.type+"\r\n\r\n"+a.getSource()+"\r\n"):c+("--"+b+'\r\nContent-Disposition: form-data; name="'+d+'"\r\n\r\n'+unescape(encodeURIComponent(a))+"\r\n")});return c+="--"+b+"--\r\n"}var l=this,t,n;b.extend(this,{send:function(c,e){var h=this,q="Mozilla"===j.browser&&4<=j.version&&7>j.version,l="Android Browser"===j.browser,r=!1;n=c.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase();var Q;if(window.XMLHttpRequest&&!("IE"===j.browser&&
8>j.version))Q=new window.XMLHttpRequest;else b:{for(var D=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],J=0;J<D.length;J++)try{Q=new ActiveXObject(D[J]);break b}catch(K){}Q=void 0}t=Q;t.open(c.method,c.url,c.async,c.user,c.password);if(e instanceof g)e.isDetached()&&(r=!0),e=e.getSource();else if(e instanceof f){if(e.hasBlob())if(e.getBlob().isDetached())e=m.call(h,e),r=!0;else if((q||l)&&"blob"===b.typeOf(e.getBlob().getSource())&&window.FileReader){a.call(h,c,e);return}if(e instanceof f){var Z=new window.FormData;
e.each(function(a,b){a instanceof g?Z.append(b,a.getSource()):Z.append(b,a)});e=Z}}t.upload?(c.withCredentials&&(t.withCredentials=!0),t.addEventListener("load",function(a){h.trigger(a)}),t.addEventListener("error",function(a){h.trigger(a)}),t.addEventListener("progress",function(a){h.trigger(a)}),t.upload.addEventListener("progress",function(a){h.trigger({type:"UploadProgress",loaded:a.loaded,total:a.total})})):t.onreadystatechange=function(){switch(t.readyState){case 3:var a,b;try{d.hasSameOrigin(c.url)&&
(a=t.getResponseHeader("Content-Length")||0),t.responseText&&(b=t.responseText.length)}catch(e){a=b=0}h.trigger({type:"progress",lengthComputable:!!a,total:parseInt(a,10),loaded:b});break;case 4:t.onreadystatechange=function(){},0===t.status?h.trigger("error"):h.trigger("load")}};b.isEmptyObj(c.headers)||b.each(c.headers,function(a,b){t.setRequestHeader(b,a)});""!==c.responseType&&"responseType"in t&&(t.responseType="json"===c.responseType&&!j.can("return_response_type","json")?"text":c.responseType);
if(r)if(t.sendAsBinary)t.sendAsBinary(e);else{q=new Uint8Array(e.length);for(l=0;l<e.length;l++)q[l]=e.charCodeAt(l)&255;t.send(q.buffer)}else t.send(e);h.trigger("loadstart")},getStatus:function(){try{if(t)return t.status}catch(a){}return 0},getResponse:function(a){var b=this.getRuntime();try{switch(a){case "blob":var d=new e(b.uid,t.response),g=t.getResponseHeader("Content-Disposition");if(g){var f=g.match(/filename=([\'\"'])([^\1]+)\1/);f&&(n=f[2])}d.name=n;d.type||(d.type=c.getFileMime(n));return d;
case "json":return!j.can("return_response_type","json")?200===t.status&&window.JSON?JSON.parse(t.responseText):null:t.response;case "document":var h;var m=t.responseXML,u=t.responseText;"IE"===j.browser&&(u&&m&&!m.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(t.getResponseHeader("Content-Type")))&&(m=new window.ActiveXObject("Microsoft.XMLDOM"),m.async=!1,m.validateOnParse=!1,m.loadXML(u));h=m&&("IE"===j.browser&&0!==m.parseError||!m.documentElement||"parsererror"===m.documentElement.tagName)?null:
m;return h;default:return""!==t.responseText?t.responseText:null}}catch(l){return null}},getAllResponseHeaders:function(){try{return t.getAllResponseHeaders()}catch(a){}return""},abort:function(){t&&t.abort()},destroy:function(){l=n=null}})}});c("moxie/runtime/html5/utils/BinaryReader",[],function(){return function(){function a(b,c){var g=d?0:-8*(c-1),f=0,h;for(h=0;h<c;h++)f|=e.charCodeAt(b+h)<<Math.abs(g+8*h);return f}function c(a,b,d){d=3===arguments.length?d:e.length-b-1;e=e.substr(0,b)+a+e.substr(d+
b)}var d=!1,e;return{II:function(a){if(a===b)return d;d=a},init:function(a){d=!1;e=a},SEGMENT:function(a,b,d){switch(arguments.length){case 1:return e.substr(a,e.length-a-1);case 2:return e.substr(a,b);case 3:c(d,a,b);break;default:return e}},BYTE:function(b){return a(b,1)},SHORT:function(b){return a(b,2)},LONG:function(e,g){if(g===b)return a(e,4);var f="",h=d?0:-24,j;for(j=0;4>j;j++)f+=String.fromCharCode(g>>Math.abs(h+8*j)&255);c(f,e,4)},SLONG:function(b){b=a(b,4);return 2147483647<b?b-4294967296:
b},STRING:function(b,c){var d="";for(c+=b;b<c;b++)d+=String.fromCharCode(a(b,1));return d}}}});c("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader"],function(a){return function q(b){var c=[],d,e,g,f=0;d=new a;d.init(b);if(65496===d.SHORT(0)){for(e=2;e<=b.length;)if(g=d.SHORT(e),65488<=g&&65495>=g)e+=2;else{if(65498===g||65497===g)break;f=d.SHORT(e+2)+2;65505<=g&&65519>=g&&c.push({hex:g,name:"APP"+(g&15),start:e,length:f,segment:d.SEGMENT(e,f)});e+=f}d.init(null);return{headers:c,
restore:function(a){var b;d.init(a);e=65504==d.SHORT(2)?4+d.SHORT(4):2;b=0;for(a=c.length;b<a;b++)d.SEGMENT(e,0,c[b].segment),e+=c[b].length;a=d.SEGMENT();d.init(null);return a},strip:function(a){var b,c;c=new q(a);b=c.headers;c.purge();d.init(a);for(a=b.length;a--;)d.SEGMENT(b[a].start,b[a].length,"");a=d.SEGMENT();d.init(null);return a},get:function(a){for(var b=[],d=0,e=c.length;d<e;d++)c[d].name===a.toUpperCase()&&b.push(c[d].segment);return b},set:function(a,b){var d=[],e,g,f;"string"===typeof b?
d.push(b):d=b;e=g=0;for(f=c.length;e<f&&!(c[e].name===a.toUpperCase()&&(c[e].segment=d[g],c[e].length=d[g].length,g++),g>=d.length);e++);},purge:function(){c=[];d.init(null);d=null}}}}});c("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(a,c){return function(){function d(a,c){var g=e.SHORT(a),f,m,l,q,r,w=[],L={};for(f=0;f<g;f++)if(r=a+12*f+2,l=c[e.SHORT(r)],l!==b){m=e.SHORT(r+=2);q=e.LONG(r+=2);r+=4;w=[];switch(m){case 1:case 7:4<
q&&(r=e.LONG(r)+h.tiffHeader);for(m=0;m<q;m++)w[m]=e.BYTE(r+m);break;case 2:4<q&&(r=e.LONG(r)+h.tiffHeader);L[l]=e.STRING(r,q-1);continue;case 3:2<q&&(r=e.LONG(r)+h.tiffHeader);for(m=0;m<q;m++)w[m]=e.SHORT(r+2*m);break;case 4:1<q&&(r=e.LONG(r)+h.tiffHeader);for(m=0;m<q;m++)w[m]=e.LONG(r+4*m);break;case 5:r=e.LONG(r)+h.tiffHeader;for(m=0;m<q;m++)w[m]=e.LONG(r+4*m)/e.LONG(r+4*m+4);break;case 9:r=e.LONG(r)+h.tiffHeader;for(m=0;m<q;m++)w[m]=e.SLONG(r+4*m);break;case 10:r=e.LONG(r)+h.tiffHeader;for(m=
0;m<q;m++)w[m]=e.SLONG(r+4*m)/e.SLONG(r+4*m+4);break;default:continue}q=1==q?w[0]:w;L[l]=j.hasOwnProperty(l)&&"object"!=typeof q?j[l][q]:q}return L}var e,g,f,h={},j;e=new c;g={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",
37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{"0":"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};j={ColorSpace:{1:"sRGB","0":"Uncalibrated"},MeteringMode:{"0":"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},
LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{"0":"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",
7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",
71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},
ExposureMode:{"0":"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{"0":"Auto white balance",1:"Manual white balance"},SceneCaptureType:{"0":"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{"0":"Normal",1:"Soft",2:"Hard"},Saturation:{"0":"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{"0":"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};return{init:function(a){h=
{tiffHeader:10};if(a===b||!a.length)return!1;e.init(a);return 65505===e.SHORT(0)&&"EXIF\x00"===e.STRING(4,5).toUpperCase()?(a=h.tiffHeader,e.II(18761==e.SHORT(a)),42!==e.SHORT(a+=2)?a=!1:(h.IFD0=h.tiffHeader+e.LONG(a+2),f=d(h.IFD0,g.tiff),"ExifIFDPointer"in f&&(h.exifIFD=h.tiffHeader+f.ExifIFDPointer,delete f.ExifIFDPointer),"GPSInfoIFDPointer"in f&&(h.gpsIFD=h.tiffHeader+f.GPSInfoIFDPointer,delete f.GPSInfoIFDPointer),a=!0),a):!1},TIFF:function(){return f},EXIF:function(){var b;b=d(h.exifIFD,g.exif);
if(b.ExifVersion&&"array"===a.typeOf(b.ExifVersion)){for(var c=0,e="";c<b.ExifVersion.length;c++)e+=String.fromCharCode(b.ExifVersion[c]);b.ExifVersion=e}return b},GPS:function(){var b;b=d(h.gpsIFD,g.gps);b.GPSVersionID&&"array"===a.typeOf(b.GPSVersionID)&&(b.GPSVersionID=b.GPSVersionID.join("."));return b},setExif:function(a,b){if("PixelXDimension"!==a&&"PixelYDimension"!==a)return!1;var c;c=a;var d,f,j,m=0;if("string"===typeof c)for(f in d=g.exif,d)if(d[f]===c){c=f;break}d=h.exifIFD;f=e.SHORT(d);
for(var q=0;q<f;q++)if(j=d+12*q+2,e.SHORT(j)==c){m=j+8;break}m?(e.LONG(m,b),c=!0):c=!1;return c},getBinary:function(){return e.SEGMENT()},purge:function(){e.init(null);e=f=null;h={}}}}});c("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(a,b,c,d,e){return function(g){var f,h,j,l,B,D;f=g;h=new d;h.init(f);if(65496!==h.SHORT(0))throw new b.ImageError(b.ImageError.WRONG_FORMAT);
j=new c(g);l=new e;D=!!l.init(j.get("app1")[0]);a:{g=0;for(var t;g<=f.length;){t=h.SHORT(g+=2);if(65472<=t&&65475>=t){g+=5;B={height:h.SHORT(g),width:h.SHORT(g+2)};break a}t=h.SHORT(g+=2);g+=t-2}B=null}a.extend(this,{type:"image/jpeg",size:f.length,width:B&&B.width||0,height:B&&B.height||0,setExif:function(b,c){if(!D)return!1;"object"===a.typeOf(b)?a.each(b,function(a,b){l.setExif(b,a)}):l.setExif(b,c);j.set("app1",l.getBinary())},writeHeaders:function(){return!arguments.length?f=j.restore(f):j.restore(arguments[0])},
stripHeaders:function(a){return j.strip(a)},purge:function(){l&&(j&&h)&&(l.purge(),j.purge(),h.init(null),f=B=j=l=h=null)}});D&&(this.meta={tiff:l.TIFF(),exif:l.EXIF(),gps:l.GPS()})}});c("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(a,b,c){return function(d){function e(){f&&(f.init(null),g=h=f=null)}var g,f,h;g=d;f=new c;f.init(g);for(var j=d=0,l=[35152,20039,3338,6666],j=0;j<l.length;j++,d+=2)if(l[j]!=f.SHORT(d))throw new a.ImageError(a.ImageError.WRONG_FORMAT);
d=8;var B,j=f.LONG(d),l=f.STRING(d+=4,4);B=d+=4;f.LONG(d+j);h="IHDR"==l?{width:f.LONG(B),height:f.LONG(B+4)}:null;b.extend(this,{type:"image/png",size:g.length,width:h.width,height:h.height,purge:function(){e.call(this)}});e.call(this)}});c("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(a,b,c,d){return function(e){var g=[c,d],f;a:{for(var h=0;h<g.length;h++)try{f=new g[h](e);break a}catch(j){}throw new b.ImageError(b.ImageError.WRONG_FORMAT);
}a.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(a){return a},stripHeaders:function(a){return a},purge:function(){}});a.extend(this,f);this.purge=function(){f.purge();f=null}}});c("moxie/runtime/html5/image/MegaPixel",[],function(){function a(b){var c=b.naturalWidth;if(1048576<c*b.naturalHeight){var d=document.createElement("canvas");d.width=d.height=1;d=d.getContext("2d");d.drawImage(b,-c+1,0);return 0===d.getImageData(0,0,1,1).data[3]}return!1}return{isSubsampled:a,
renderTo:function(b,c,d){var e=b.naturalWidth,f=b.naturalHeight,g=d.width,h=d.height,j=d.x||0;d=d.y||0;c=c.getContext("2d");a(b)&&(e/=2,f/=2);var l=document.createElement("canvas");l.width=l.height=1024;var B=l.getContext("2d"),D;D=f;var t=document.createElement("canvas");t.width=1;t.height=D;t=t.getContext("2d");t.drawImage(b,0,0);for(var t=t.getImageData(0,0,1,D).data,n=0,F=D,v=D;v>n;)0===t[4*(v-1)+3]?F=v:n=v,v=F+n>>1;D=v/D;D=0===D?1:D;for(t=0;t<f;){n=t+1024>f?f-t:1024;for(F=0;F<e;){v=F+1024>e?
e-F:1024;B.clearRect(0,0,1024,1024);B.drawImage(b,-F,-t);var A=F*g/e+j<<0,z=Math.ceil(v*g/e),H=t*h/f/D+d<<0,P=Math.ceil(n*h/f/D);c.drawImage(l,0,0,v,n,A,H,z,P);F+=1024}t+=1024}}}});c("moxie/runtime/html5/image/Image","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/Exceptions moxie/core/utils/Encode moxie/file/Blob moxie/runtime/html5/image/ImageInfo moxie/runtime/html5/image/MegaPixel moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(a,b,c,d,e,f,g,h,j){return a.Image=
function(){function a(){if(!z&&!v)throw new c.ImageError(c.DOMException.INVALID_STATE_ERR);return z||v}function m(a){return d.atob(a.substring(a.indexOf("base64,")+7))}function l(a){var b=this;v=new Image;v.onerror=function(){n.call(this);b.trigger("error",new c.ImageError(c.ImageError.WRONG_FORMAT))};v.onload=function(){b.trigger("load")};v.src=/^data:[^;]*;base64,/.test(a)?a:"data:"+(P.type||"")+";base64,"+d.btoa(a)}function t(c,d,e,f){var h,m=0,l=0,q,n;C=f;n=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||
1;-1!==b.inArray(n,[5,6,7,8])&&(q=c,c=d,d=q);q=a();h=(!e?Math.min:Math.max)(c/q.width,d/q.height);if(!(1<h&&(!e||f))){z||(z=document.createElement("canvas"));f=Math.round(q.width*h);h=Math.round(q.height*h);e?(z.width=c,z.height=d,f>c&&(m=Math.round((f-c)/2)),h>d&&(l=Math.round((h-d)/2))):(z.width=f,z.height=h);if(!C){c=z.width;d=z.height;switch(n){case 5:case 6:case 7:case 8:z.width=d;z.height=c;break;default:z.width=c,z.height=d}e=z.getContext("2d");switch(n){case 2:e.translate(c,0);e.scale(-1,
1);break;case 3:e.translate(c,d);e.rotate(Math.PI);break;case 4:e.translate(0,d);e.scale(1,-1);break;case 5:e.rotate(0.5*Math.PI);e.scale(1,-1);break;case 6:e.rotate(0.5*Math.PI);e.translate(0,-d);break;case 7:e.rotate(0.5*Math.PI);e.translate(c,-d);e.scale(-1,1);break;case 8:e.rotate(-0.5*Math.PI),e.translate(-c,0)}}n=z;m=-m;l=-l;"iOS"===j.OS?g.renderTo(q,n,{width:f,height:h,x:m,y:l}):n.getContext("2d").drawImage(q,m,l,f,h);this.width=z.width;this.height=z.height;I=!0}this.trigger("Resize")}function n(){A&&
(A.purge(),A=null);H=v=z=P=null;I=!1}var F=this,v,A,z,H,P,I=!1,C=!0;b.extend(this,{loadFromBlob:function(a){var b=this,d=b.getRuntime(),e=1<arguments.length?arguments[1]:!0;if(!d.can("access_binary"))throw new c.RuntimeError(c.RuntimeError.NOT_SUPPORTED_ERR);P=a;if(a.isDetached())H=a.getSource(),l.call(this,H);else{var d=a.getSource(),f=this,g;window.FileReader?(g=new FileReader,g.onload=function(){var a=this.result;e&&(H=m(a));l.call(b,a)},g.onerror=function(){f.trigger("error",new c.FileException(c.FileException.NOT_READABLE_ERR))},
g.readAsDataURL(d)):(d=d.getAsDataURL(),e&&(H=m(d)),l.call(b,d))}},loadFromImage:function(a,b){this.meta=a.meta;P=new e(null,{name:a.name,size:a.size,type:a.type});l.call(this,b?H=a.getAsBinaryString():a.getAsDataURL())},getInfo:function(){var b=this.getRuntime();!A&&(H&&b.can("access_image_binary"))&&(A=new f(H));return{width:a().width||0,height:a().height||0,type:P.type||h.getFileMime(P.name),size:H&&H.length||P.size||0,name:P.name||"",meta:A&&A.meta||this.meta||{}}},downsize:function(){t.apply(this,
arguments)},getAsCanvas:function(){z&&(z.id=this.uid+"_canvas");return z},getAsBlob:function(a,b){a!==this.type&&t.call(this,this.width,this.height,!1);return new e(null,{type:a,data:F.getAsBinaryString.call(this,a,b)})},getAsDataURL:function(a,b){var c=b||90;if(!I)return v.src;if("image/jpeg"!==a)return z.toDataURL("image/png");try{return z.toDataURL("image/jpeg",c/100)}catch(d){return z.toDataURL("image/jpeg")}},getAsBinaryString:function(a,b){if(!I)return H||(H=m(F.getAsDataURL(a,b))),H;if("image/jpeg"!==
a)H=m(F.getAsDataURL(a,b));else{var c;b||(b=90);try{c=z.toDataURL("image/jpeg",b/100)}catch(d){c=z.toDataURL("image/jpeg")}H=m(c);A&&(H=A.stripHeaders(H),C&&(A.meta&&A.meta.exif&&A.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),H=A.writeHeaders(H)),A.purge(),A=null)}I=!1;return H},destroy:function(){F=null;n.call(this);this.getRuntime().getShim().removeInstance(this.uid)}})}});c("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom",
"moxie/core/Exceptions","moxie/runtime/Runtime"],function(a,b,c,d,e){var f={};e.addConstructor("flash",function(g){var h=this,j;g=a.extend({swf_url:b.swf_url},g);e.call(this,g,"flash",{access_binary:function(a){return a&&"browser"===h.mode},access_image_binary:function(a){return a&&"browser"===h.mode},display_media:e.capTrue,do_cors:e.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===h.mode},resize_image:e.capTrue,return_response_headers:!1,return_response_type:function(b){return"json"===
b&&window.JSON?!0:!a.arrayDiff(b,["","text","document"])||"browser"===h.mode},return_status_code:function(b){return"browser"===h.mode||!a.arrayDiff(b,[200,404])},select_file:e.capTrue,select_multiple:e.capTrue,send_binary_string:function(a){return a&&"browser"===h.mode},send_browser_cookies:function(a){return a&&"browser"===h.mode},send_custom_headers:function(a){return a&&"browser"===h.mode},send_multipart:e.capTrue,slice_blob:e.capTrue,stream_upload:function(a){return a&&"browser"===h.mode},summon_file_dialog:!1,
upload_filesize:function(b){return 2097152>=a.parseSizeStr(b)||"client"===h.mode},use_http_method:function(b){return!a.arrayDiff(b,["GET","POST"])}},{access_binary:function(a){return a?"browser":"client"},access_image_binary:function(a){return a?"browser":"client"},report_upload_progress:function(a){return a?"browser":"client"},return_response_type:function(b){return a.arrayDiff(b,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(b){return a.arrayDiff(b,[200,
404])?"browser":["client","browser"]},send_binary_string:function(a){return a?"browser":"client"},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?"browser":"client"},stream_upload:function(a){return a?"client":"browser"},upload_filesize:function(b){return 2097152<=a.parseSizeStr(b)?"client":"browser"}},"client");var l;try{l=navigator.plugins["Shockwave Flash"],l=l.description}catch(B){try{l=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(D){l=
"0.0"}}l=l.match(/\d+/g);11.3>parseFloat(l[0]+"."+l[1])&&(this.mode=!1);a.extend(this,{getShim:function(){return c.get(this.uid)},shimExec:function(a,b){var c=[].slice.call(arguments,2);return h.getShim().exec(this.uid,a,b,c)},init:function(){var c,e,f;f=this.getShimContainer();a.extend(f.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});c='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+g.swf_url+'" ';"IE"===b.browser&&(c+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');
c+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+g.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+b.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';"IE"===b.browser?(e=document.createElement("div"),f.appendChild(e),e.outerHTML=c,e=f=null):f.innerHTML=c;j=setTimeout(function(){h&&!h.initialized&&h.trigger("Error",new d.RuntimeError(d.RuntimeError.NOT_INIT_ERR))},
5E3)},destroy:function(a){return function(){a.call(h);clearTimeout(j);g=j=a=h=null}}(this.destroy)},f)});return f});c("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(a,b){return a.Blob={slice:function(a,c,d,e){var f=this.getRuntime();0>c?c=Math.max(a.size+c,0):0<c&&(c=Math.min(c,a.size));0>d?d=Math.max(a.size+d,0):0<d&&(d=Math.min(d,a.size));(a=f.shimExec.call(this,"Blob","slice",c,d,e||""))&&(a=new b(f.uid,a));return a}}});c("moxie/runtime/flash/file/FileInput",
["moxie/runtime/flash/Runtime"],function(a){return a.FileInput={init:function(a){this.getRuntime().shimExec.call(this,"FileInput","init",{name:a.name,accept:a.accept,multiple:a.multiple});this.trigger("ready")}}});c("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(a,b){function c(a,d){switch(d){case "readAsText":return b.atob(a,"utf8");case "readAsBinaryString":return b.atob(a);case "readAsDataURL":return a}return null}var d="";return a.FileReader=
{read:function(a,b){var e=this.getRuntime();"readAsDataURL"===a&&(d="data:"+(b.type||"")+";base64,");this.bind("Progress",function(b,e){e&&(d+=c(e,a))});return e.shimExec.call(this,"FileReader","readAsBase64",b.uid)},getResult:function(){return d},destroy:function(){d=null}}});c("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(a,b){function c(a,d){switch(d){case "readAsText":return b.atob(a,"utf8");case "readAsBinaryString":return b.atob(a);
case "readAsDataURL":return a}return null}return a.FileReaderSync={read:function(a,b){var d;d=this.getRuntime().shimExec.call(this,"FileReaderSync","readAsBase64",b.uid);if(!d)return null;"readAsDataURL"===a&&(d="data:"+(b.type||"")+";base64,"+d);return c(d,a,b.type)}}});c("moxie/runtime/flash/xhr/XMLHttpRequest","moxie/runtime/flash/Runtime moxie/core/utils/Basic moxie/file/Blob moxie/file/File moxie/file/FileReaderSync moxie/xhr/FormData moxie/runtime/Transporter".split(" "),function(a,b,c,d,e,
f,g){return a.XMLHttpRequest={send:function(a,d){function e(){a.transport=m.mode;m.shimExec.call(l,"XMLHttpRequest","send",a,d)}function h(a,b){m.shimExec.call(l,"XMLHttpRequest","appendBlob",a,b.uid);d=null;e()}function j(a,b){var c=new g;c.bind("TransportingComplete",function(){b(this.result)});c.transport(a.getSource(),a.type,{ruid:m.uid})}var l=this,m=l.getRuntime();b.isEmptyObj(a.headers)||b.each(a.headers,function(a,b){m.shimExec.call(l,"XMLHttpRequest","setRequestHeader",b,a.toString())});
if(d instanceof f){var r;d.each(function(a,b){a instanceof c?r=b:m.shimExec.call(l,"XMLHttpRequest","append",b,a)});if(d.hasBlob()){var u=d.getBlob();u.isDetached()?j(u,function(a){u.destroy();h(r,a)}):h(r,u)}else d=null,e()}else d instanceof c?d.isDetached()?j(d,function(a){d.destroy();d=a.uid;e()}):(d=d.uid,e()):e()},getResponse:function(a){var c,f=this.getRuntime();if(c=f.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){c=new d(f.uid,c);if("blob"===a)return c;if(~b.inArray(a,["","text"]))return a=
new e,a.readAsText(c);if("arraybuffer"!==a&&"json"===a&&window.JSON){a=new e;try{return JSON.parse(a.readAsText(c))}catch(g){}}}return null},abort:function(){this.getRuntime().shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort")}}});c("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(a,b){return a.Transporter={getAsBlob:function(a){var c=this.getRuntime();return(a=c.shimExec.call(this,"Transporter",
"getAsBlob",a))?new b(c.uid,a):null}}});c("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(a,b,c,d,e){return a.Image={loadFromBlob:function(a){function b(a){e.shimExec.call(d,"Image","loadFromBlob",a.uid);d=e=null}var d=this,e=d.getRuntime();if(a.isDetached()){var f=new c;f.bind("TransportingComplete",function(){b(f.result.getSource())});f.transport(a.getSource(),a.type,{ruid:e.uid})}else b(a.getSource())},
loadFromImage:function(a){return this.getRuntime().shimExec.call(this,"Image","loadFromImage",a.uid)},getAsBlob:function(a,b){var c=this.getRuntime(),e=c.shimExec.call(this,"Image","getAsBlob",a,b);return e?new d(c.uid,e):null},getAsDataURL:function(){var a=this.getRuntime().Image.getAsBlob.apply(this,arguments);return!a?null:(new e).readAsDataURL(a)}}});c("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],
function(a,b,c,d,e){var f={};e.addConstructor("silverlight",function(g){var h=this,j;g=a.extend({xap_url:b.xap_url},g);e.call(this,g,"silverlight",{access_binary:e.capTrue,access_image_binary:e.capTrue,display_media:e.capTrue,do_cors:e.capTrue,drag_and_drop:!1,report_upload_progress:e.capTrue,resize_image:e.capTrue,return_response_headers:function(a){return a&&"client"===h.mode},return_response_type:function(a){return"json"!==a?!0:!!window.JSON},return_status_code:function(b){return"client"===h.mode||
!a.arrayDiff(b,[200,404])},select_file:e.capTrue,select_multiple:e.capTrue,send_binary_string:e.capTrue,send_browser_cookies:function(a){return a&&"browser"===h.mode},send_custom_headers:function(a){return a&&"client"===h.mode},send_multipart:e.capTrue,slice_blob:e.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:e.capTrue,use_http_method:function(b){return"client"===h.mode||!a.arrayDiff(b,["GET","POST"])}},{return_response_headers:function(a){return a?"client":"browser"},return_status_code:function(b){return a.arrayDiff(b,
[200,404])?"client":["client","browser"]},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?"client":"browser"},use_http_method:function(b){return a.arrayDiff(b,["GET","POST"])?"client":["client","browser"]}});var l=!1,B=null,D,t,n,F,v,A=0;try{try{B=new ActiveXObject("AgControl.AgControl"),B.IsVersionSupported("2.0.31005.0")&&(l=!0)}catch(z){var H=navigator.plugins["Silverlight Plug-In"];if(H){D=H.description;"1.0.30226.2"===D&&(D="2.0.30226.2");
for(t=D.split(".");3<t.length;)t.pop();for(;4>t.length;)t.push(0);for(n=["2","0","31005","0"];4<n.length;)n.pop();do F=parseInt(n[A],10),v=parseInt(t[A],10),A++;while(A<n.length&&F===v);F<=v&&!isNaN(F)&&(l=!0)}}}catch(P){l=!1}if(!l||"Opera"===b.browser)this.mode=!1;a.extend(this,{getShim:function(){return c.get(this.uid).content.Moxie},shimExec:function(a,b){var c=[].slice.call(arguments,2);return h.getShim().exec(this.uid,a,b,c)},init:function(){this.getShimContainer().innerHTML='<object id="'+this.uid+
'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+g.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+b.global_event_dispatcher+'"/></object>';j=setTimeout(function(){h&&!h.initialized&&h.trigger("Error",new d.RuntimeError(d.RuntimeError.NOT_INIT_ERR))},
"Windows"!==b.OS?1E4:5E3)},destroy:function(a){return function(){a.call(h);clearTimeout(j);g=j=a=h=null}}(this.destroy)},f)});return f});c("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(a,b,c){return a.Blob=b.extend({},c)});c("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime"],function(a){return a.FileInput={init:function(a){this.getRuntime().shimExec.call(this,"FileInput","init",
function(a){for(var b="",c=0;c<a.length;c++)b+=(""!==b?"|":"")+a[c].title+" | *."+a[c].extensions.replace(/,/g,";*.");return b}(a.accept),a.name,a.multiple);this.trigger("ready")}}});c("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(a,b,c){return a.FileDrop={init:function(){var a=this.getRuntime(),d;d=a.getShimContainer();c.addEvent(d,"dragover",function(a){a.preventDefault();a.stopPropagation();a.dataTransfer.dropEffect=
"copy"},this.uid);c.addEvent(d,"dragenter",function(c){c.preventDefault();b.get(a.uid).dragEnter(c)&&c.stopPropagation()},this.uid);c.addEvent(d,"drop",function(c){c.preventDefault();b.get(a.uid).dragDrop(c)&&c.stopPropagation()},this.uid);return a.shimExec.call(this,"FileDrop","init")}}});c("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(a,b,c){return a.FileReader=b.extend({},c)});c("moxie/runtime/silverlight/file/FileReaderSync",
["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(a,b,c){return a.FileReaderSync=b.extend({},c)});c("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(a,b,c){return a.XMLHttpRequest=b.extend({},c)});c("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],
function(a,b,c){return a.Transporter=b.extend({},c)});c("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/image/Image"],function(a,b,c){return a.Image=b.extend({},c,{getInfo:function(){var a=["tiff","exif","gps"],c={meta:{}},d=this.getRuntime().shimExec.call(this,"Image","getInfo");d.meta&&b.each(a,function(a){var b=d.meta[a],e,f,g,h;if(b&&b.keys){c.meta[a]={};f=0;for(g=b.keys.length;f<g;f++)if(e=b.keys[f],h=b[e])/^(\d|[1-9]\d+)$/.test(h)?
h=parseInt(h,10):/^\d*\.\d+$/.test(h)&&(h=parseFloat(h)),c.meta[a][e]=h}});c.width=parseInt(d.width,10);c.height=parseInt(d.height,10);c.size=parseInt(d.size,10);c.type=d.type;c.name=d.name;return c}})});c("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(a,b,c,d){var e={};c.addConstructor("html4",function(b){var f=this,g=c.capTest,h=c.capTrue;c.call(this,b,"html4",{access_binary:g(window.FileReader||window.File&&
File.getAsDataURL),access_image_binary:!1,display_media:g(e.Image&&(d.can("create_canvas")||d.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:g("Chrome"===d.browser&&28<=d.version||"IE"===d.browser&&10<=d.version),resize_image:function(){return e.Image&&f.can("access_binary")&&d.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(b){return"json"===b&&window.JSON?!0:!!~a.inArray(b,["text","document",""])},return_status_code:function(b){return!a.arrayDiff(b,
[200,404])},select_file:function(){return d.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return f.can("select_file")},summon_file_dialog:g("Firefox"===d.browser&&4<=d.version||"Opera"===d.browser&&12<=d.version||!!~a.inArray(d.browser,["Chrome","Safari"])),upload_filesize:h,use_http_method:function(b){return!a.arrayDiff(b,["GET","POST"])}});a.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(f);
a=f=null}}(this.destroy)});a.extend(this.getShim(),e)});return e});c("moxie/runtime/html4/file/FileInput","moxie/runtime/html4/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(a,b,c,d,e,f){return a.FileInput=function(){function a(){var e=this,m=e.getRuntime(),n,r,v,A,z;z=b.guid("uid_");n=m.getShimContainer();g&&(r=c.get(g+"_form"))&&b.extend(r.style,{top:"100%"});v=document.createElement("form");v.setAttribute("id",
z+"_form");v.setAttribute("method","post");v.setAttribute("enctype","multipart/form-data");v.setAttribute("encoding","multipart/form-data");b.extend(v.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});A=document.createElement("input");A.setAttribute("id",z);A.setAttribute("type","file");A.setAttribute("name",l.name||"Filedata");A.setAttribute("accept",j.join(","));b.extend(A.style,{fontSize:"999px",opacity:0});v.appendChild(A);n.appendChild(v);b.extend(A.style,
{position:"absolute",top:0,left:0,width:"100%",height:"100%"});"IE"===f.browser&&10>f.version&&b.extend(A.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});A.onchange=function(){var b;this.value&&(b=this.files?this.files[0]:{name:this.value},h=[b],this.onchange=function(){},a.call(e),e.bind("change",function I(){var a=c.get(z),b=c.get(z+"_form"),d;e.unbind("change",I);e.files.length&&(a&&b)&&(d=e.files[0],a.setAttribute("id",d.uid),b.setAttribute("id",d.uid+"_form"),b.setAttribute("target",
d.uid+"_iframe"))},998),A=v=null,e.trigger("change"))};m.can("summon_file_dialog")&&(m=c.get(l.browse_button),d.removeEvent(m,"click",e.uid),d.addEvent(m,"click",function(a){A&&!A.disabled&&A.click();a.preventDefault()},e.uid));g=z;n=r=m=null}var g,h=[],j=[],l;b.extend(this,{init:function(b){var f=this,g=f.getRuntime(),h;l=b;j=b.accept.mimes||e.extList2mimes(b.accept,g.can("filter_by_extension"));h=g.getShimContainer();var m,w;m=c.get(b.browse_button);g.can("summon_file_dialog")&&("static"===c.getStyle(m,
"position")&&(m.style.position="relative"),w=parseInt(c.getStyle(m,"z-index"),10)||1,m.style.zIndex=w,h.style.zIndex=w-1);g=g.can("summon_file_dialog")?m:h;d.addEvent(g,"mouseover",function(){f.trigger("mouseenter")},f.uid);d.addEvent(g,"mouseout",function(){f.trigger("mouseleave")},f.uid);d.addEvent(g,"mousedown",function(){f.trigger("mousedown")},f.uid);d.addEvent(c.get(b.container),"mouseup",function(){f.trigger("mouseup")},f.uid);m=null;a.call(this);h=null;f.trigger({type:"ready",async:!0})},
getFiles:function(){return h},disable:function(a){var b;if(b=c.get(g))b.disabled=!!a},destroy:function(){var a=this.getRuntime(),b=a.getShim(),a=a.getShimContainer();d.removeAllEvents(a,this.uid);d.removeAllEvents(l&&c.get(l.container),this.uid);d.removeAllEvents(l&&c.get(l.browse_button),this.uid);a&&(a.innerHTML="");b.removeInstance(this.uid);g=h=j=l=null}})}});c("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(a,b){return a.FileReader=
b});c("moxie/runtime/html4/xhr/XMLHttpRequest","moxie/runtime/html4/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Url moxie/core/Exceptions moxie/core/utils/Events moxie/file/Blob moxie/xhr/FormData".split(" "),function(a,b,c,d,e,f,g,h){return a.XMLHttpRequest=function(){function a(b){var d=this,e,g,h,j=!1;if(m){e=m.id.replace(/_iframe$/,"");if(e=c.get(e+"_form")){g=e.getElementsByTagName("input");for(h=g.length;h--;)switch(g[h].getAttribute("type")){case "hidden":g[h].parentNode.removeChild(g[h]);
break;case "file":j=!0}g=[];j||e.parentNode.removeChild(e);e=null}setTimeout(function(){f.removeEvent(m,"load",d.uid);m.parentNode&&m.parentNode.removeChild(m);var a=d.getRuntime().getShimContainer();a.children.length||a.parentNode.removeChild(a);m=null;b()},1)}}var j,l,m;b.extend(this,{send:function(t,n){var F=this,v=F.getRuntime(),A,z,H,P;j=l=null;if(n instanceof h&&n.hasBlob()){if(P=n.getBlob(),A=P.uid,H=c.get(A),z=c.get(A+"_form"),!z)throw new e.DOMException(e.DOMException.NOT_FOUND_ERR);}else A=
b.guid("uid_"),z=document.createElement("form"),z.setAttribute("id",A+"_form"),z.setAttribute("method",t.method),z.setAttribute("enctype","multipart/form-data"),z.setAttribute("encoding","multipart/form-data"),z.setAttribute("target",A+"_iframe"),v.getShimContainer().appendChild(z);n instanceof h&&n.each(function(a,c){if(a instanceof g)H&&H.setAttribute("name",c);else{var d=document.createElement("input");b.extend(d,{type:"hidden",name:c,value:a});H?z.insertBefore(d,H):z.appendChild(d)}});z.setAttribute("action",
t.url);var v=v.getShimContainer()||document.body,I=document.createElement("div");I.innerHTML='<iframe id="'+A+'_iframe" name="'+A+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';m=I.firstChild;v.appendChild(m);f.addEvent(m,"load",function(){var c;try{c=m.contentWindow.document||m.contentDocument||window.frames[m.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(c.title)?j=c.title.replace(/^(\d+).*$/,"$1"):(j=200,l=b.trim(c.body.innerHTML),F.trigger({type:"progress",loaded:l.length,
total:l.length}),P&&F.trigger({type:"uploadprogress",loaded:P.size||1025,total:P.size||1025}))}catch(e){if(d.hasSameOrigin(t.url))j=404;else{a.call(F,function(){F.trigger("error")});return}}a.call(F,function(){F.trigger("load")})},F.uid);z.submit();F.trigger("loadstart")},getStatus:function(){return j},getResponse:function(a){if("json"===a&&"string"===b.typeOf(l)&&window.JSON)try{return JSON.parse(l.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(c){return null}return l},abort:function(){var b=
this;m&&m.contentWindow&&(m.contentWindow.stop?m.contentWindow.stop():m.contentWindow.document.execCommand?m.contentWindow.document.execCommand("Stop"):m.src="about:blank");a.call(this,function(){b.dispatchEvent("abort")})}})}});c("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(a,b){return a.Image=b});for(var e="moxie/core/utils/Basic moxie/core/I18n moxie/core/utils/Mime moxie/core/utils/Env moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/core/utils/Encode moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/file/Blob moxie/file/File moxie/file/FileInput moxie/file/FileDrop moxie/runtime/RuntimeTarget moxie/file/FileReader moxie/core/utils/Url moxie/file/FileReaderSync moxie/xhr/FormData moxie/xhr/XMLHttpRequest moxie/runtime/Transporter moxie/image/Image moxie/core/utils/Events".split(" "),
f=0;f<e.length;f++){for(var g=a,j=e[f],h=j.split(/[.\/]/),l=0;l<h.length-1;++l)g[h[l]]===b&&(g[h[l]]={}),g=g[h[l]];g[h[h.length-1]]=d[j]}})(this);(function(){var a={},b=moxie.core.utils.Basic.inArray;(function d(e){var f,g;for(f in e)g=typeof e[f],"object"===g&&!~b(f,["Exceptions","Env","Mime"])?d(e[f]):"function"===g&&(a[f]=e[f])})(window.moxie);a.Env=window.moxie.core.utils.Env;a.Mime=window.moxie.core.utils.Mime;a.Exceptions=window.moxie.core.Exceptions;window.mOxie=a;window.o||(window.o=a);return a})();
(function(a,b,c){function d(a){function b(a,c,e){var f={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",max_file_size:"access_binary",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};f[a]?d[f[a]]=c:e||(d[a]=c)}var c=a.required_features,d={};"string"===typeof c?g.each(c.split(/\s*,\s*/),function(a){b(a,
!0)}):"object"===typeof c?g.each(c,function(a,c){b(c,a)}):!0===c&&(a.multipart||(d.send_binary_string=!0),0<a.chunk_size&&(d.slice_blob=!0),a.resize.enabled&&(d.send_binary_string=!0),g.each(a,function(a,c){b(c,!!a,!0)}));return d}var e=a.setTimeout,f={},g={VERSION:"2.0.0",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,
IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:b.mimes,ua:b.ua,typeOf:b.typeOf,extend:b.extend,guid:b.guid,get:function(a){var c=[],d;"array"!==b.typeOf(a)&&(a=[a]);for(var e=a.length;e--;)(d=b.get(a[e]))&&c.push(d);return c.length?c:null},each:b.each,getPos:b.getPos,getSize:b.getSize,xmlEncode:function(a){var b={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},c=/[<>&\"\']/g;return a?(""+a).replace(c,function(a){return b[a]?"&"+b[a]+";":a}):a},toArray:b.toArray,inArray:b.inArray,
addI18n:b.addI18n,translate:b.translate,isEmptyObj:b.isEmptyObj,hasClass:b.hasClass,addClass:b.addClass,removeClass:b.removeClass,getStyle:b.getStyle,addEvent:b.addEvent,removeEvent:b.removeEvent,removeAllEvents:b.removeAllEvents,cleanName:function(a){var b,c;c=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];
for(b=0;b<c.length;b+=2)a=a.replace(c[b],c[b+1]);a=a.replace(/\s+/g,"_");return a=a.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(a,b){var c="";g.each(b,function(a,b){c+=(c?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a)});c&&(a+=(0<a.indexOf("?")?"&":"?")+c);return a},formatSize:function(a){return a===c||/\D/.test(a)?g.translate("N/A"):1099511627776<a?Math.round(a/1099511627776,1)+" "+g.translate("tb"):1073741824<a?Math.round(a/1073741824,1)+" "+g.translate("gb"):1048576<a?Math.round(a/
1048576,1)+" "+g.translate("mb"):1024<a?Math.round(a/1024,1)+" "+g.translate("kb"):a+" "+g.translate("b")},parseSize:b.parseSizeStr,predictRuntime:function(a,b){var c,d;b&&(a.runtimes=b);c=new g.Uploader(a);d=c.runtime;c.destroy();return d},addFileFilter:function(a,b){f[a]=b}};g.addFileFilter("mime_types",function(a,b,c){a.length&&!a.regexp.test(b.name)?(this.trigger("Error",{code:g.FILE_EXTENSION_ERROR,message:g.translate("File extension error."),file:b}),c(!1)):c(!0)});g.addFileFilter("max_file_size",
function(a,b,c){void 0!==b.size&&a&&b.size>a?(this.trigger("Error",{code:g.FILE_SIZE_ERROR,message:g.translate("File size error."),file:b}),c(!1)):c(!0)});g.addFileFilter("prevent_duplicates",function(a,b,c){if(a)for(a=this.files.length;a--;)if(b.name===this.files[a].name&&b.size===this.files[a].size){this.trigger("Error",{code:g.FILE_DUPLICATE_ERROR,message:g.translate("Duplicate file error."),file:b});c(!1);return}c(!0)});g.Uploader=function(a){function j(){var a,b=0,c;if(this.state==g.STARTED){for(c=
0;c<A.length;c++)!a&&A[c].status==g.QUEUED?(a=A[c],this.trigger("BeforeUpload",a)&&(a.status=g.UPLOADING,this.trigger("UploadFile",a))):b++;b==A.length&&(this.state!==g.STOPPED&&(this.state=g.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",A))}}function m(a){a.percent=0<a.size?Math.ceil(100*(a.loaded/a.size)):100;w()}function w(){var a,b;C.reset();for(a=0;a<A.length;a++)b=A[a],b.size!==c?(C.size+=b.origSize,C.loaded+=b.loaded*b.origSize/b.size):C.size=c,b.status==g.DONE?C.uploaded++:
b.status==g.FAILED?C.failed++:C.queued++;C.size===c?C.percent=0<A.length?Math.ceil(100*(C.uploaded/A.length)):0:(C.bytesPerSec=Math.ceil(C.loaded/((+new Date-I||1)/1E3)),C.percent=0<C.size?Math.ceil(100*(C.loaded/C.size)):0)}function q(){var a=H[0]||P[0];return a?a.getRuntime().uid:!1}function u(a,c){var d=this,e=0,f=[],h={accept:a.filters.mime_types,runtime_order:a.runtimes,required_caps:a.required_features,preferred_caps:z,swf_url:a.flash_swf_url,xap_url:a.silverlight_xap_url};g.each(a.runtimes.split(/\s*,\s*/),
function(b){a[b]&&(h[b]=a[b])});a.browse_button&&g.each(a.browse_button,function(c){f.push(function(f){var j=new b.FileInput(g.extend({},h,{name:a.file_data_name,multiple:a.multi_selection,container:a.container,browse_button:c}));j.onready=function(){var a=b.Runtime.getInfo(this.ruid);b.extend(d.features,{chunks:a.can("slice_blob"),multipart:a.can("send_multipart"),multi_selection:a.can("select_multiple")});e++;H.push(this);f()};j.onchange=function(){d.addFile(this.files)};j.bind("mouseenter mouseleave mousedown mouseup",
function(d){J||(a.browse_button_hover&&("mouseenter"===d.type?b.addClass(c,a.browse_button_hover):"mouseleave"===d.type&&b.removeClass(c,a.browse_button_hover)),a.browse_button_active&&("mousedown"===d.type?b.addClass(c,a.browse_button_active):"mouseup"===d.type&&b.removeClass(c,a.browse_button_active)))});j.bind("error runtimeerror",function(){j=null;f()});j.init()})});a.drop_element&&g.each(a.drop_element,function(a){f.push(function(c){var f=new b.FileDrop(g.extend({},h,{drop_zone:a}));f.onready=
function(){var a=b.Runtime.getInfo(this.ruid);d.features.dragdrop=a.can("drag_and_drop");e++;P.push(this);c()};f.ondrop=function(){d.addFile(this.files)};f.bind("error runtimeerror",function(){f=null;c()});f.init()})});b.inSeries(f,function(){"function"===typeof c&&c(e)})}function r(a,c,e){function f(a,b,c){var d=v[a];switch(a){case "max_file_size":case "chunk_size":if(b=g.parseSize(b))v[a]=b,"max_file_size"===a&&(v.max_file_size=v.filters.max_file_size=b);break;case "filters":"array"===g.typeOf(b)&&
(b={mime_types:b});c?g.extend(v.filters,b):v.filters=b;if(b.mime_types){var e=v.filters.mime_types,l,m=[];g.each(v.filters.mime_types,function(a){g.each(a.extensions.split(/,/),function(a){/^\s*\*\s*$/.test(a)?m.push("\\.*"):m.push("\\."+a.replace(RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})});l=RegExp("("+m.join("|")+")$","i");e.regexp=l}break;case "resize":c?g.extend(v.resize,b,{enabled:!0}):v.resize=b;break;case "prevent_duplicates":v.prevent_duplicates=v.filters.prevent_duplicates=
!!b;break;case "browse_button":case "drop_element":b=g.get(b);case "container":case "runtimes":case "multi_selection":case "flash_swf_url":case "silverlight_xap_url":v[a]=b;c||(j=!0);break;default:v[a]=b}c||h.trigger("OptionChanged",a,b,d)}var h=this,j=!1;"object"===typeof a?g.each(a,function(a,b){f(b,a,e)}):f(a,c,e);e?(v.required_features=d(g.extend({},v)),z=d(g.extend({},v,{required_features:!0}))):j&&(h.trigger("Destroy"),u.call(h,v,function(a){a?(h.runtime=b.Runtime.getInfo(q()).type,h.trigger("Init",
{runtime:h.runtime}),h.trigger("PostInit")):h.trigger("Error",{code:g.INIT_ERROR,message:g.translate("Init error.")})}))}function L(a,b){[].push.apply(A,b);a.trigger("QueueChanged");a.refresh()}function S(a,b){if(v.unique_names){var c=b.name.match(/\.([^.]+)$/),d="part";c&&(d=c[1]);b.target_name=b.id+"."+d}}function Q(a,c){function d(){0<l--?e(f,1E3):(c.loaded=n,a.trigger("Error",{code:g.HTTP_ERROR,message:g.translate("HTTP Error."),file:c,response:K.responseText,status:K.status,responseHeaders:K.getAllResponseHeaders()}))}
function f(){var r,u,t,w;c.status==g.DONE||(c.status==g.FAILED||a.state==g.STOPPED)||(t={name:c.target_name||c.name},j&&m.chunks&&q.size>j?(w=Math.min(j,q.size-n),r=q.slice(n,n+w)):(w=q.size,r=q),j&&m.chunks&&(a.settings.send_chunk_number?(t.chunk=Math.ceil(n/j),t.chunks=Math.ceil(q.size/j)):(t.offset=n,t.total=q.size)),K=new b.XMLHttpRequest,K.upload&&(K.upload.onprogress=function(b){c.loaded=Math.min(c.size,n+b.loaded);a.trigger("UploadProgress",c)}),K.onload=function(){400<=K.status?d():(l=a.settings.max_retries,
w<q.size?(r.destroy(),n+=w,c.loaded=Math.min(n,q.size),a.trigger("ChunkUploaded",c,{offset:c.loaded,total:q.size,response:K.responseText,status:K.status,responseHeaders:K.getAllResponseHeaders()}),"Android Browser"===b.Env.browser&&a.trigger("UploadProgress",c)):c.loaded=c.size,r=u=null,!n||n>=q.size?(c.size!=c.origSize&&(q.destroy(),q=null),a.trigger("UploadProgress",c),c.status=g.DONE,a.trigger("FileUploaded",c,{response:K.responseText,status:K.status,responseHeaders:K.getAllResponseHeaders()})):
e(f,1))},K.onerror=function(){d()},K.onloadend=function(){this.destroy();K=null},a.settings.multipart&&m.multipart?(t.name=c.target_name||c.name,K.open("post",h,!0),g.each(a.settings.headers,function(a,b){K.setRequestHeader(b,a)}),u=new b.FormData,g.each(g.extend(t,a.settings.multipart_params),function(a,b){u.append(b,a)}),u.append(a.settings.file_data_name,r),K.send(u,{runtime_order:a.settings.runtimes,required_caps:a.settings.required_features,preferred_caps:z,swf_url:a.settings.flash_swf_url,xap_url:a.settings.silverlight_xap_url})):
(h=g.buildUrl(a.settings.url,g.extend(t,a.settings.multipart_params)),K.open("post",h,!0),K.setRequestHeader("Content-Type","application/octet-stream"),g.each(a.settings.headers,function(a,b){K.setRequestHeader(b,a)}),K.send(r,{runtime_order:a.settings.runtimes,required_caps:a.settings.required_features,preferred_caps:z,swf_url:a.settings.flash_swf_url,xap_url:a.settings.silverlight_xap_url})))}var h=a.settings.url,j=a.settings.chunk_size,l=a.settings.max_retries,m=a.features,n=0,q;c.loaded&&(n=c.loaded=
j*Math.floor(c.loaded/j));q=c.getSource();var r;if(r=a.settings.resize.enabled){a:{if(q.ruid&&(r=b.Runtime.getInfo(q.ruid))){r=r.can("send_binary_string");break a}r=!1}r=r&&!!~b.inArray(q.type,["image/jpeg","image/png"])}if(r){var u=q,t=a.settings.resize,w=function(a){q=a;c.size=a.size;f()},v=new b.Image;try{v.onload=function(){v.downsize(t.width,t.height,t.crop,t.preserve_headers)},v.onresize=function(){w(this.getAsBlob(u.type,t.quality));this.destroy()},v.onerror=function(){w(u)},v.load(u)}catch(A){w(u)}}else f()}
function X(a,b){m(b)}function W(a){if(a.state==g.STARTED)I=+new Date;else if(a.state==g.STOPPED)for(var b=a.files.length-1;0<=b;b--)a.files[b].status==g.UPLOADING&&(a.files[b].status=g.QUEUED,w())}function B(){K&&K.abort()}function D(a){w();e(function(){j.call(a)},1)}function t(a,b){b.file&&(b.file.status=g.FAILED,m(b.file),a.state==g.STARTED&&(a.trigger("CancelUpload"),e(function(){j.call(a)},1)))}function n(a){a.stop();g.each(A,function(a){a.destroy()});A=[];H.length&&(g.each(H,function(a){a.destroy()}),
H=[]);P.length&&(g.each(P,function(a){a.destroy()}),P=[]);z={};J=!1;v=I=K=null;C.reset()}var F=g.guid(),v,A=[],z={},H=[],P=[],I,C,J=!1,K;v={runtimes:b.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_chunk_number:!0};r.call(this,a,null,!0);C=new g.QueueProgress;g.extend(this,
{id:F,uid:F,state:g.STOPPED,features:{},runtime:null,files:A,settings:v,total:C,init:function(){var a=this;"function"==typeof v.preinit?v.preinit(a):g.each(v.preinit,function(b,c){a.bind(c,b)});!v.browse_button||!v.url?this.trigger("Error",{code:g.INIT_ERROR,message:g.translate("Init error.")}):(this.bind("FilesAdded",L),this.bind("CancelUpload",B),this.bind("BeforeUpload",S),this.bind("UploadFile",Q),this.bind("UploadProgress",X),this.bind("StateChanged",W),this.bind("QueueChanged",w),this.bind("Error",
t),this.bind("FileUploaded",D),this.bind("Destroy",n),u.call(this,v,function(c){"function"==typeof v.init?v.init(a):g.each(v.init,function(b,c){a.bind(c,b)});c?(a.runtime=b.Runtime.getInfo(q()).type,a.trigger("Init",{runtime:a.runtime}),a.trigger("PostInit")):a.trigger("Error",{code:g.INIT_ERROR,message:g.translate("Init error.")})}))},setOption:function(a,b){r.call(this,a,b,!this.runtime)},getOption:function(a){return!a?v:v[a]},refresh:function(){H.length&&g.each(H,function(a){a.trigger("Refresh")});
this.trigger("Refresh")},start:function(){this.state!=g.STARTED&&(this.state=g.STARTED,this.trigger("StateChanged"),j.call(this))},stop:function(){this.state!=g.STOPPED&&(this.state=g.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(a){J=a!==c?a:!0;H.length&&g.each(H,function(a){a.disable(J)});this.trigger("DisableBrowse",J)},getFile:function(a){var b;for(b=A.length-1;0<=b;b--)if(A[b].id===a)return A[b]},addFile:function(a,c){function d(a){var n=b.typeOf(a);
if(a instanceof b.File){if(!a.ruid&&!a.isDetached()){if(!m)return!1;a.ruid=m;a.connectRuntime(m)}d(new g.File(a))}else a instanceof b.Blob?(d(a.getSource()),a.destroy()):a instanceof g.File?(c&&(a.name=c),j.push(function(c){var d=[];b.each(h.settings.filters,function(b,c){f[c]&&d.push(function(d){f[c].call(h,b,a,function(a){d(!a)})})});b.inSeries(d,function(b){b||(l.push(a),h.trigger("FileFiltered",a));e(c,1)})})):-1!==b.inArray(n,["file","blob"])?d(new b.File(null,a)):"node"===n&&"filelist"===b.typeOf(a.files)?
b.each(a.files,d):"array"===n&&(c=null,b.each(a,d))}var h=this,j=[],l=[],m;m=q();d(a);j.length&&b.inSeries(j,function(){l.length&&h.trigger("FilesAdded",l)})},removeFile:function(a){a="string"===typeof a?a:a.id;for(var b=A.length-1;0<=b;b--)if(A[b].id===a)return this.splice(b,1)[0]},splice:function(a,b){var d=A.splice(a===c?0:a,b===c?A.length:b);this.trigger("FilesRemoved",d);g.each(d,function(a){a.destroy()});this.trigger("QueueChanged");this.refresh();return d},bind:function(a,b,c){var d=this;g.Uploader.prototype.bind.call(this,
a,function(){var a=[].slice.call(arguments);a.splice(0,1,d);return b.apply(this,a)},0,c)},destroy:function(){this.trigger("Destroy");C=null;this.unbindAll()}})};g.Uploader.prototype=b.EventTarget.instance;var j={};g.File=function(a){g.extend(this,{id:g.guid(),name:a.name||a.fileName,type:a.type||"",size:a.size||a.fileSize,origSize:a.size||a.fileSize,loaded:0,percent:0,status:g.QUEUED,lastModifiedDate:a.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var a=this.getSource().getSource();
return-1!==b.inArray(b.typeOf(a),["blob","file"])?a:null},getSource:function(){return!j[this.id]?null:j[this.id]},destroy:function(){var a=this.getSource();a&&(a.destroy(),delete j[this.id])}});j[this.id]=a};g.QueueProgress=function(){var a=this;a.size=0;a.loaded=0;a.uploaded=0;a.failed=0;a.queued=0;a.percent=0;a.bytesPerSec=0;a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}};a.plupload=g})(window,mOxie);
function friendlyPluploadError(a,b,c){var d=a.code;a="undefined"==typeof a.file?"":a.file.name+": ";switch(d){case -200:return a+"Something went wrong trying to upload your "+b+" to the server";case -300:return a+"Unable to read your "+b+" file";case -600:return a+"There was a problem with the size of your "+b+" file. Please make sure that it is "+("undefined"==typeof c?"not too big.":"no larger than "+c.toUpperCase()+".");case -601:return a+"There was a problem with the extension of your "+b+" file. Please make sure that it is one of the allowed file types.";
case -602:return a+"Please do not upload the same file twice.";case -700:return a+"There seems to be something wrong with your "+b+" file format";case -701:return a+"In danger of running out of memory";case -702:return a+"There is something wrong with the dimensions of your "+b+". Please make sure that it is not too big.";default:return a+"Something went wrong with your file. The error code is "+d}}
var isIE=-1!=navigator.appVersion.indexOf("MSIE")?!0:!1,isWin=-1!=navigator.appVersion.toLowerCase().indexOf("win")?!0:!1,isOpera=-1!=navigator.userAgent.indexOf("Opera")?!0:!1;
function ControlVersion(){var a,b;try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"),a=b.GetVariable("$version")}catch(c){}if(!a)try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),a="WIN 6,0,21,0",b.AllowScriptAccess="always",a=b.GetVariable("$version")}catch(d){}if(!a)try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3"),a=b.GetVariable("$version")}catch(e){}if(!a)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3"),a="WIN 3,0,18,0"}catch(f){}if(!a)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),
a="WIN 2,0,0,11"}catch(g){a=-1}return a}
function GetSwfVer(){var a=-1;if(null!=navigator.plugins&&0<navigator.plugins.length){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var a=navigator.plugins["Shockwave Flash"+(navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"")].description.split(" "),b=a[2].split("."),c=b[0],b=b[1],d=a[3];""==d&&(d=a[4]);"d"==d[0]?d=d.substring(1):"r"==d[0]&&(d=d.substring(1),0<d.indexOf("d")&&(d=d.substring(0,d.indexOf("d"))));a=c+"."+b+"."+d}}else-1!=navigator.userAgent.toLowerCase().indexOf("webtv/2.6")?
a=4:-1!=navigator.userAgent.toLowerCase().indexOf("webtv/2.5")?a=3:-1!=navigator.userAgent.toLowerCase().indexOf("webtv")?a=2:isIE&&(isWin&&!isOpera)&&(a=ControlVersion());return a}
function DetectFlashVer(a,b,c){versionStr=GetSwfVer();if(-1==versionStr)return!1;if(0!=versionStr){isIE&&isWin&&!isOpera?(tempArray=versionStr.split(" "),tempString=tempArray[1],versionArray=tempString.split(",")):versionArray=versionStr.split(".");var d=versionArray[0],e=versionArray[1],f=versionArray[2];return d>parseFloat(a)||d==parseFloat(a)&&(e>parseFloat(b)||e==parseFloat(b)&&f>=parseFloat(c))?!0:!1}}function AC_AddExtension(a,b){return-1!=a.indexOf("?")?a.replace(/\?/,b+"?"):a+b}
function AC_Generateobj(a,b,c){var d="";if(isIE&&isWin&&!isOpera){var d=d+"<object ",e;for(e in a)d+=e+'="'+a[e]+'" ';for(e in b)d+='><param name="'+e+'" value="'+b[e]+'" /> ';d+="></object>"}else{d+="<embed ";for(e in c)d+=e+'="'+c[e]+'" ';d+="> </embed>"}document.write(d)}function AC_FL_RunContent(){var a=AC_GetArgs(arguments,".swf","movie","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash");AC_Generateobj(a.objAttrs,a.params,a.embedAttrs)}
function AC_GetArgs(a,b,c,d,e){for(var f={embedAttrs:{},params:{},objAttrs:{}},g=0;g<a.length;g+=2)switch(a[g].toLowerCase()){case "classid":break;case "pluginspage":f.embedAttrs[a[g]]=a[g+1];break;case "src":case "movie":a[g+1]=AC_AddExtension(a[g+1],b);f.embedAttrs.src=a[g+1];f.params[c]=a[g+1];break;case "onafterupdate":case "onbeforeupdate":case "onblur":case "oncellchange":case "onclick":case "ondblClick":case "ondrag":case "ondragend":case "ondragenter":case "ondragleave":case "ondragover":case "ondrop":case "onfinish":case "onfocus":case "onhelp":case "onmousedown":case "onmouseup":case "onmouseover":case "onmousemove":case "onmouseout":case "onkeypress":case "onkeydown":case "onkeyup":case "onload":case "onlosecapture":case "onpropertychange":case "onreadystatechange":case "onrowsdelete":case "onrowenter":case "onrowexit":case "onrowsinserted":case "onstart":case "onscroll":case "onbeforeeditfocus":case "onactivate":case "onbeforedeactivate":case "ondeactivate":case "type":case "codebase":f.objAttrs[a[g]]=
a[g+1];break;case "id":case "width":case "height":case "align":case "vspace":case "hspace":case "class":case "title":case "accesskey":case "name":case "tabindex":f.embedAttrs[a[g]]=f.objAttrs[a[g]]=a[g+1];break;default:f.embedAttrs[a[g]]=f.params[a[g]]=a[g+1]}f.objAttrs.classid=d;e&&(f.embedAttrs.type=e);return f}var photoGalleryInserter=function(){this._init();return this};
photoGalleryInserter.prototype._init=function(){this.mode="none";this.close_on_select=this.hide_insert_menu=!0;this.style="simple";this.import_queue_limit=this.queue_limit=1;this.gallery_request_id=this.gallery_album=this.gallery_old=this.gallery_complete=this.gallery_position=0;this.gallery_recent_request=null;this.on_image_select=function(){};this.on_batch_complete=function(){};this.on_close=function(){};var a=this;jq("#photo_insert_close").click(function(){a.close();return!1});jq("#photo_insert_back").click(function(){a.switchMode("none");
return!1});jq("#photo_insert_upload").click(function(){a.switchMode("upload");var b='<h2 style="visibility: hidden;">'+(1==a.queue_limit?"Choose an image to upload (GIF, JPG, or PNG only).":'Choose <span id="queue_limit">up to '+a.queue_limit+" images</span> to upload (GIF, JPG, or PNG only).")+"</h2><p id=\"upload_multiple_instruct\" style=\"display: none;\">To select more than one photo, hold down the Ctrl key (or the Apple key on a Mac) on your keyboard while clicking on the files with your mouse.</p><input type='hidden' id='album_found' value=''><p>Assign uploaded photo"+
(1==a.queue_limit?"":"(s)")+' to <span id="album_name" style="display: none;" title="click to choose an album"><em>choose an album (optional)</em></span></p><ul id="insert_upload_errors"></ul><div id="insert_upload_button"></div><div id="insert_upload_progress"></div><p id="upload_wait">Please wait ...</p><div id="upload_files_wrapper"><a id="photo_browse_button" href="#" class="loud_button" style="visibility: hidden;">choose '+(1==a.queue_limit?"a photo":"photos")+"</a></div>";a.hideInsertMenu();
jq("#photo_gallery_menu").hide();jq("#photo_gallery_content").hide();jq("#photo_upload_content")[0].innerHTML="";jq("#photo_upload_content").html(b).show();var c={},d={runtimes:"html5,flash,html4",url:"/imgup/upload.php",flash_swf_url:"/x/Moxie.swf",multi_selection:1<a.queue_limit,filters:{max_file_size:window.upload_max_filesize?window.upload_max_filesize:"2mb",mime_types:[{title:"Image Files",extensions:"jpg,jpeg,png,gif,JPG,JPEG,PNG,GIF"}]},browse_button:"photo_browse_button",container:"upload_files_wrapper",
init:{FilesAdded:function(b,c){jq("#insert_upload_errors, #insert_upload_progress").html("");if(c.length>a.queue_limit)jq("#insert_upload_errors").html("<li>Please upload no more than "+a.queue_limit+" photos at once.</li>");else{for(var d=0;d<c.length;d++){var j=jq('<div style="width: 1%;"></div>');jq("#insert_upload_progress").append('<div class="progress" id="prog_'+c[d].id+'"><span>'+c[d].name.truncate(18)+"</span></div>").children(".progress:last").append(j)}0<jq("#album_found").val()&&(b.settings.multipart_params.album=
jq("#album_name").text());a.imageUploader.start()}return!1},UploadProgress:function(a,b){jq("#prog_"+b.id+" > div").css("width",b.percent+"%")},FileUploaded:function(b,d,g){if("undefined"!=typeof c[d.id])return!1;c[d.id]=!0;b=JSONstring.toObject(g.response);if(b.warnings.length){g="";for(var j=0;j<b.warnings.length;j++)g+="<li>"+b.warnings[j]+"</li>";jq("#insert_upload_errors").append(g)}else a.selectPhoto(b.images[0].id,b.images[0].format,b.images[0].width,b.images[0].height,""),a._clearGallery();
jq("#prog_"+d.id+" div").html('<div class="success"></div>')},Error:function(a,b){jq("#insert_upload_errors").append("<li>"+friendlyPluploadError(b,"image",window.upload_max_filesize?window.upload_max_filesize:"2mb")+"</li>").show()},PostInit:function(){jq("#upload_wait").remove();jq("#photo_browse_button").css("visibility","visible");jq("#album_name").show();new clickEditable("#album_name",{inlineStyle:"width:150px;",maxlength:40,suggested_id:"suggest_albums",suggestions_from_url:"/xml/photos/album.php?suggest=1",
empty_shortcut:"Don't assign to an album",change_callback:function(a,b,c){var d=jq.trim(jq(b).attr("value"));""==d?(jq("#photo_upload_gallery_album").attr("value",""),a.html("<em>choose an album (optional)</em>"),jq("#album_found").attr("value","0"),c(a,b)):jq.get("/xml/photos/album.php",{name:d},function(){a.html(d);jq("#photo_upload_gallery_album").attr("value",d);jq("#album_found").attr("value","1");c(a,b)})}})}}};jq.post("/imgup/login.php",{},function(b){d.multipart_params={login:b};a.imageUploader=
new plupload.Uploader(d);a.imageUploader.init()});return!1});jq("#photo_insert_import").click(function(){a.switchMode("import");for(var b='<h2>Import an image from another site</h2><p>Enter the image\'s full URL (GIF, JPG, or PNG only).<br/><strong class="warn">You should only import images that you have the legal right to use. '+("capsule"==a.style?"Provide attribution to the source, as necessary.":"")+'</strong></p><ul id="insert_import_errors" style="display: none;"></ul><ul id="insert_import_successes" style="display: none;"></ul><div id="insert_import_inputs">',
c=0;c<a.import_queue_limit;c++)b+='<label for="url_'+c+'">URL</label> <input class="urlbox" type="text" name="url_'+c+'" id="url_'+c+'" /><br/>';b+='<input id="photo_import_gallery_album" type="hidden" value="" name="album" /><p>Assign imported photo(s) to <span id="album_name_import" title="click to choose an album"><em>choose an album (optional)</em></span></p>';b+='<input type="submit" value="import" id="photo_import_submit" /></div><div id="photo_import_wait" style="display: none;"><img src="/x/feed_spinner.gif" /></div>';
a.hideInsertMenu();jq("#photo_gallery_menu").hide();jq("#photo_gallery_content").hide();jq("#photo_upload_content")[0].innerHTML="";jq("#photo_upload_content").html(b).show();new clickEditable("#album_name_import",{inlineStyle:"width:150px;",maxlength:40,suggested_id:"suggest_albums",suggestions_from_url:"/xml/photos/album.php?suggest=1",empty_shortcut:"Don't assign to an album",change_callback:function(a,b,c){var g=jq.trim(jq(b).attr("value"));""==g?(jq("#photo_import_gallery_album").attr("value",
""),a.html("<em>choose an album (optional)</em>"),c(a,b)):jq.get("/xml/photos/album.php",{name:g},function(){a.html(g);jq("#photo_import_gallery_album").attr("value",g);c(a,b)})}});jq("#photo_import_submit").click(function(){jq("#photo_import_wait").show();jq.post("/imgup/upload.php",jq("#insert_import_inputs input").serialize(),function(b){jq("#insert_import_errors, #insert_import_successes").html("").hide();jq("#photo_import_wait").hide();b=JSONstring.toObject(b);if(b.warnings.length){for(var c=
"",f=0;f<b.warnings.length;f++)c+="<li>"+b.warnings[f]+"</li>";jq("#insert_import_errors").html(c).css("display","list-item");if(b.success.length){c="";for(f=0;f<b.success.length;f++)var g=b.success[f],c=c+('<li><a href="'+g+'" title="'+g+'">'+g.truncate(30)+"</a> successfully imported</li>");jq("#insert_import_successes").html(c).css("display","list-item")}}for(f=0;f<b.images.length;f++)a.selectPhoto(b.images[f].id,b.images[f].format,b.images[f].width,b.images[f].height,"");jq("#photo_upload_content input[type=text]").val("");
b.images.length&&(a._clearGallery(),a.on_batch_complete(0==b.warnings.length,"import"))});return!1});return!1});jq("#photo_insert_gallery").click(function(){a.switchMode("gallery");a.hideInsertMenu();jq("#photo_upload_content").hide();jq("#photo_gallery_content").show();jq("#photo_gallery_menu").show();""==jq.trim(jq("#photo_gallery_menu").html())&&a._updateGalleryMenu();0==a.gallery_position&&a._showMoreGallery();return!1});jq("#photo_gallery_content").scroll(function(){"gallery"!=a.mode||a.gallery_complete||
!jq("#photo_insert_wait:visible").size()&&600>jq(this).prop("scrollHeight")-jq(this).prop("scrollTop")&&a._showMoreGallery()});jq("#photo_gallery_content .insert_row a").live("click",function(){for(var b=jq(this).attr("class").split(" "),c=jq(this).next("div[name=description]").text(),d,e,f,g,j=0;j<b.length;j++){var h=b[j];"img"==h.substring(0,3)?d=h.substring(4):"format"==h.substring(0,6)?f=h.substring(7):"width"==h.substring(0,5)?e=h.substring(6):"height"==h.substring(0,6)&&(g=h.substring(7))}"capsule"==
a.style&&jq(this).css({opacity:0.2});a.selectPhoto(d,f,e,g,c);a.on_batch_complete(!0,"gallery");return!1})};photoGalleryInserter.prototype.setOptions=function(a){void 0!=a.hide_insert_menu&&(this.hide_insert_menu=a.hide_insert_menu);void 0!=a.close_on_select&&(this.close_on_select=a.close_on_select);a.style&&(this.style=a.style);void 0!=a.import_queue_limit&&(this.import_queue_limit=a.import_queue_limit);void 0!=a.queue_limit&&(this.queue_limit=a.queue_limit)};
photoGalleryInserter.prototype.switchMode=function(a){"none"!=this.mode?(jq("#photo_gallery_content").hide(),jq("#photo_gallery_menu").hide(),jq("#photo_upload_content").hide(),jq("#photo_insert_menu").show(),jq("#photo_insert_menu .insert_box").removeClass("active"),jq("#photo_gallery_content .insert_row a").css({opacity:1}),jq("#photo_insert_back").hide()):(jq("#photo_insert_"+this.mode).addClass("active"),jq("#photo_insert_back").show());this.mode=a};
photoGalleryInserter.prototype.hideInsertMenu=function(){this.hide_insert_menu&&jq("#photo_insert_menu").hide()};photoGalleryInserter.prototype.selectPhoto=function(a,b,c,d,e){this.on_image_select(a,b,c,d,e);this.close_on_select&&this.close()};
photoGalleryInserter.prototype.close=function(){this.mode="none";jq("#photo_insert").hide();jq("#photo_gallery_menu").hide();jq("#photo_gallery_content").hide();jq("#photo_upload_content").hide();jq("#photo_insert_menu").show();jq("#photo_insert_back").hide();this.on_close();jq("#photo_insert_menu .insert_box").removeClass("active");jq("#photo_gallery_content .insert_row a").css({opacity:1})};photoGalleryInserter.prototype.setOnImageSelect=function(a){this.on_image_select=a};
photoGalleryInserter.prototype.setOnBatchComplete=function(a){this.on_batch_complete=a};photoGalleryInserter.prototype.setOnClose=function(a){this.on_close=a};photoGalleryInserter.instance=function(){photoGalleryInserter.pgi||(photoGalleryInserter.pgi=new photoGalleryInserter);return photoGalleryInserter.pgi};photoGalleryInserter.prototype._clearGallery=function(){jq("#photo_gallery_content").html("");this.gallery_complete=this.gallery_position=0};
photoGalleryInserter.prototype._updateGallery=function(){this.gallery_request_id++;this.gallery_recent_request&&this.gallery_recent_request.abort();jq("#photo_gallery_content").html('<div id="photo_insert_wait" style="display: none;"><img src="/x/feed_spinner.gif"></div>');this.gallery_old=jq("#photo_gallery_age").val();this.gallery_album=jq("#photo_gallery_album").val();this.gallery_complete=this.gallery_position=0;this._showMoreGallery()};
photoGalleryInserter.prototype._updateGalleryMenu=function(){jq("#photo_gallery_menu").html('<img src="/x/feed_spinner.gif" />');var a='<select id="photo_gallery_age"><option value="0">newest</option><option value="1">oldest</option></select> ',b=this;jq.get("/xml/photos/album.php",{suggest:1},function(c){0==JSONstring.toObject(c).length?(a+="photos",jq("#photo_gallery_menu").html(a)):(a+='photos in <div id="photo_album_edit" title="click to edit album name"><em>choose an album</em></div><input type="hidden" id="photo_gallery_album" name="photo_gallery_album" value=""/>',
jq("#photo_gallery_menu").html(a),jq("#photo_album_edit").hover(function(){jq(this).addClass("highlighted")},function(){jq(this).removeClass("highlighted")}),new clickEditable("#photo_album_edit",{maxlength:40,suggested_id:"suggest_albums",suggestions_from_url:"/xml/photos/album.php?suggest=1",empty_shortcut:"All Albums",change_callback:function(a,c,f){var g=jq.trim(jq(c).attr("value"));""==g?(jq("#photo_gallery_album").attr("value",0),a.html("<em>choose an album</em>"),b._updateGallery(),f(a,c)):
jq.get("/xml/photos/album.php",{name:g},function(j){-1==j?(alert("Album "+g+" not found"),a.html("<em>choose an album</em>")):(a.html(g),jq("#photo_gallery_album").attr("value",j),b._updateGallery());f(a,c)})}}));jq("#photo_gallery_age").change(function(){b._updateGallery()});jq("#photo_gallery_album").change(function(){b._updateGallery()})})};
photoGalleryInserter.prototype._showMoreGallery=function(){var a=jq("#photo_insert_wait");if(0==a.size())this._updateGallery();else{a.show();var b=this,c=this.gallery_position,d=this.gallery_request_id;this.gallery_recent_request=jq.post("/xml/photos/insert.php",{style:b.style,position:b.gallery_position,album:b.gallery_album,old:b.gallery_old,artId:"undefined"!=typeof article?article:0},function(c){b.gallery_request_id==d&&(c=JSONstring.toObject(c),c.more||(b.gallery_complete=!0),b.gallery_position=
c.position,a.hide().before(c.html))});setTimeout(function(){c==b.gallery_position&&d==b.gallery_request_id&&a.hide()},3E4)}};photoGalleryInserter.getUserImageDomain=function(a){return"production"==window.environment?"usercontent"+(a%2+1)+"."+window.userimg_domain:window.userimg_domain};
photoGalleryInserter.getImagePreviewURL=function(a,b,c,d){d||(d=248);return c>=d?"http://"+photoGalleryInserter.getUserImageDomain(a)+"/"+a+"_f"+d+".jpg":"http://"+photoGalleryInserter.getUserImageDomain(a)+"/"+a+"."+b};
function toggleStats(a,b){var c=a.target,d=jq("#authorcenter_pane");c.showing_stats?(d.hide(),c.innerHTML=c.showing_stats,c.showing_stats=!1):jq.ajax({type:"POST",url:"/xml/articlestats.php",success:function(a){jq("#authorcenter_pane").html(a);d.show();c.showing_stats=c.innerHTML;c.innerHTML="hide stats";jq("#chart_div").length&&(a=jq("#chart_div").width(),drawGenericTrafficChart("article",b,a,300));initializeInlineHelp()},data:{art_id:b},error:reportError,timeout:3E4});return!1}
function drawUserChart(a,b,c,d,e){google.visualization.drawChart({containerId:b,dataSourceUrl:"/stats/graph/"+("requests"==e?"userrequestdata":"userdata")+".php?user="+a,chartType:"ComboChart",options:{width:c,height:d,enableInteractivity:!1,legend:"bottom",legendTextStyle:{fontSize:11},lineWidth:1,series:[{targetAxisIndex:0,type:"bars",color:"#caa"},{targetAxisIndex:1,type:"line",color:"#8b9a18",lineWidth:3}],vAxes:[{title:"requests"==e?"Requests Published":"Hubs Published",titleTextStyle:{color:"#000000"}},
{title:"Views Per Day",titleTextStyle:{color:"#000"}}],hAxis:{titleTextStyle:{color:"#000"},maxAlternation:1,slantedText:!1}}})}
function toggleUserStats(a,b,c){var d=a.target,e=jq("#usercenter_pane"),f=950;if("requests"==c||"myaccount_hubs"==c)f=940;d.showing_stats?(e.hide(),d.innerHTML=d.showing_stats,d.showing_stats=!1):jq.ajax({type:"POST",url:"/xml/userstats.php",success:function(a){jq("#usercenter_pane").html(a);e.show();d.showing_stats=d.innerHTML;d.innerHTML="hide graph";jq("#chart_div").length&&drawUserChart(b,"chart_div",f,300,c)},data:{user_id:b},error:reportError,timeout:3E4});return!1}
function toggleGenericStats(a,b,c,d){var e=a.target,f=jq("#"+d);e.showing_stats?(f.hide(),e.innerHTML=e.showing_stats,e.showing_stats=!1):jq.ajax({type:"POST",url:"/xml/genericstats.php",success:function(a){jq("#"+d).html(a);f.show();e.showing_stats=e.innerHTML;e.innerHTML="hide stats";jq("#chart_div").length&&drawGenericTrafficChart(c,b,jq("#chart_div").width(),null)},data:{id:b,type:c},error:reportError,timeout:3E4});return!1}
function drawGenericTrafficChart(a,b,c,d,e,f){var g="";e&&(g="&sub_type="+e+"&sub_id="+f);f="chart_div";e&&(f=e+"_chart_div");google.visualization.drawChart({containerId:f,dataSourceUrl:"/stats/graph/genericdata.php?"+a+"_id="+b+g,chartType:"AreaChart",options:{width:(c?c:960)-20,height:d?d:300,enableInteractivity:!0,isStacked:!0,legend:"bottom",legendTextStyle:{fontSize:11},lineWidth:1,series:[{color:"#8B9A18"},{color:"#aaa"},{color:"#297ccf"},{color:"#9e2d2d"}],vAxis:{title:"Views Per Day",titleTextStyle:{color:"#000000"}},
hAxis:{titleTextStyle:{color:"#000"},maxAlternation:1,slantedText:!1}}})}function selectTrafficInterval(a,b,c,d){jq("#"+b+"_traffic_stats").load("/xml/traffic_pane.php",{tab:b,type:c,id:d,interval:a})}
function deleteRequest(a,b){confirm("Are you sure that you want to remove this request?")&&jq.ajax({type:"POST",url:"/xml/delete_request.php",success:function(a){jq(".adminlistwrap").first().prepend('<div style="color: red; font-style: italic;">'+a.responseText+"</div>")},data:{id:b},error:reportError,timeout:3E4});return!1}function toggleMyAccountHelp(){var a=jq("#show_myhelp"),b=jq("#myhelp");"help"==a.html()?(b.show(),a.html("hide")):(b.hide(),a.html("help"));return!1}
function toggleGlobalCommentSettings(){jq("#global_com_setting :visible").length?(jq("#settingswrap").slideDown(),jq("#global_com_setting").hide()):(jq("#settingswrap").slideUp(),jq("#global_com_setting").show());return!1}function showDupeHistory(){var a=jq("#toggle_history"),b=jq("#dupe_history");"hide history"==a.html()?(b.hide(),a.html("show history")):(b.show(),a.html("hide history"));return!1}
function updateDupes(a,b){var c=jq(a.target),d=jq("#dupe_history"),e=jq("#toggle_history");c.html("processing");jq.ajax({type:"POST",url:"/xml/dupecheck.php",success:function(a){jq("#dupe_history").html(a);a="<div>"+a.responseText+"</div>";a=jQuery(a).find("#dctotalscore").text();var b=jQuery("#admindupes").html(),b=b.replace(/<li>[^<]+/,"<li>[Revised score "+a+"% ]&nbsp;&nbsp;"),b=b.replace("processing","check");jQuery("#admindupes").html(b);d.show();c.html("check");e.html("hide history")},data:{articleId:b},
error:reportError,timeout:18E4});return!1}function request_reviewed(a){jq.ajax({type:"POST",url:"/xml/request_reviewed.php",data:{req_id:a},success:function(a){jq("#request_reviewed").html(a)},error:reportError})}function unquarantine_request(a){jq.ajax({type:"POST",url:"/xml/unquarantine_request.php",data:{req_id:a},success:function(a){jq("#request_quarantined").html(a)},error:reportError})}
function article_reviewed(a){jq.ajax({type:"POST",url:"/xml/article_reviewed.php",data:{art_id:a},success:function(a){jq("#article_reviewed").html(a)},error:reportError});return!1}function user_reviewed(a){jq.ajax({type:"POST",url:"/xml/user_reviewed.php",data:{user_id:a},success:function(a){jq("#user_reviewed").html(a)},error:reportError});return!1}function request_sensitive(a){change_sensitive(a,"request");return!1}function article_sensitive(a){change_sensitive(a,"article");return!1}
var modstatus_changed=0,modstatus_timeout;
function change_sensitive(a,b){var c=1E3;0<window.location.href.indexOf("review/hop")&&(c=0);clearTimeout(modstatus_timeout);var d=jq("#"+b+"_sensitive").text(),e=d;"OK -> ?"==d?e="OK -> Bad":"OK -> Bad"==d?e="OK -> OK":"OK -> OK"==d?e="OK -> ?":"Bad -> ?"==d?e="Bad -> OK":"Bad -> OK"==d?e="Bad -> Bad":"Bad -> Bad"==d?e="Bad -> ?":jQuery.error("Invalid status: "+d);jq("#"+b+"_sensitive").html('<a href="#" onclick="return '+b+"_sensitive("+a+')">'+e+"</a>");modstatus_changed=a;modstatus_timeout=setTimeout(function(){force_change_sensitive(b)},
c);return!1}
function force_change_sensitive(a){var b={};b[a.substr(0,3)+"_id"]=modstatus_changed;b.sensitive_status=jq("#"+a+"_sensitive").text();jq.ajax({type:"POST",url:"/xml/"+a+"_sensitive.php",data:b,async:!1,success:function(b){modstatus_changed=0;jq("#"+a+"_sensitive").html(b);b=jq("#"+a+"_sensitive a").text();"OK -> ?"==b||"OK -> OK"==b||"BAD -> OK"==b?(jq("#ec_sensitive_bad").hide(),jq("#quickec_ec").attr("disabled",!1)):(jq("#ec_sensitive_bad").show(),jq("#quickec_ec").attr("disabled",!0))}})}
function article_learn(a,b,c){jQuery("#learnlink_"+b).toggleClass("warning_collapsed").toggleClass("warning_expanded");jQuery("#learn_"+b).is(":visible")&&jQuery("#learn_"+b).parent("#learnlink_"+b)?jQuery("#learn_"+b).hide():(0==jQuery("#learn_"+b).length&&(jQuery("#learnlink_"+b).append('<div id="learn_'+b+'" class="learnlink_info"></div>'),jQuery("#learn_"+b).load("/xml/authorcenter_learn.php",{artId:a,key:b,squidooGrace:c},function(a,b){"error"==b&&reportError})),jQuery("#learn_"+b).show())}
function moderate_comment(a,b,c,d){void 0===d&&(d="none");if(a&&b&&c)return ccId="cc_"+a+"_"+b,a={mod_id:a,comment_id:b,action:c,section:d},jQuery("#"+ccId).load("/xml/modcom.php",a,function(a,b,c){"success"!=b&&"notmodified"!=b&&reportError(c)}),!1}function show_moderate_buttons(a,b){a||(a=window.event);a.srcElement&&(a.target=a.srcElement);jq(a.target).hide();jq("#mod_buttons_"+b).show()}
function toggle_comment_reply_control(a){jq("#mod_buttons_"+a+" li.reply").toggle().closest(".commentcenter").children(".reply_form").slideToggle()}
function bindReplyEventListeners(a){jQuery("#commentReplyText"+a).focus(function(){jQuery(this).removeClass("alertBorder").prev(".alert").empty()});var b=new hpFormHandler("commentReplyForm"+a);b.method="post";b.submitUri="/xml/comment.php";b.skipValidationOfResponse=!0;b.nextUri=null;b.saveCallback=function(){jQuery("#commentReplyText"+a).val("");toggle_comment_reply_control(a);jQuery("#mod_buttons_"+a+" li.reply").remove();var b=jQuery('<div class="success_message">Your reply has been submitted.</div>');
jQuery("#mod_buttons_"+a).siblings(":last").after(b);b.delay(5E3).slideToggle("slow",function(){jQuery(this).remove()})};b.individualerrors=!0;b.useEffects=!1;var c={};c["commentReplyText"+a]=function(a){b.validateMandatory(a,"Comment can not be empty.");b.validateLengthMin(a,4,"Your comment is rather short.");b.validateLengthMax(a,8192,"Your comments is too long.")};b.setValidators({},c);jQuery("#commentReplyForm"+a+" a.reply").click(function(){var a=jQuery(this);if(a.data("inProgress"))return!1;
b.save();b.hasErrors()||a.data("inProgress",!0).removeClass("green_bg").addClass("gray_bg");return!1})}function moderate_fanmail(a,b,c){if(a&&b){ccId="fanmail__"+a+"__"+b;var d=jq("#"+ccId);if(d.length)return jq.ajax({type:"POST",url:"/xml/modfanmail.php",data:{fan_id:a,comment_id:b,action:c},success:function(a){d.html(a)},error:reportError}),!1}}
function ignoreBrokenLink(a,b,c){jq.ajax({type:"POST",url:"/xml/removelinkwarning.php",data:{urlId:b,articleId:a},success:function(){jq("#"+c).parent().html("<span class='recorded ignored'>ignored</span>")},error:reportError});return!1}
function toggleActivityPrefs(){var a=jq("#edit_button"),b=jq("#filter").val(),c="edit";"save changes"==a.html()&&(c="save");if("save"==c){var d=0;jq(".ht_box:checked").each(function(){d+=Number(this.name.substr(3))});var e=jq("#current_prefs");d!=e.val()?(jq.ajax({type:"POST",url:"/xml/activityPref.php",data:{prefs:d,filter:b},success:function(){a.html("saved");a.css("background","#ebb");a.animate({backgroundColor:"#999"},1300,"swing",function(){a.html("edit preferences")})},error:reportError}),e.val(d)):
(a.html("no changes"),a.css("background","#ebb"),a.css("text-decoration","none"),a.animate({backgroundColor:"#999"},1300,"swing",function(){a.html("edit preferences")}))}var f=jq(".ht_cur").attr("class");jq(".ht_pref").each(function(){"edit"==c?"ht_all ht_cur"==f?this.style.display="block":this.parentNode.className==f&&(this.style.display="block"):this.style.display="none"});"edit"==c&&a.html("save changes");return!1}
function requestStatus(a,b,c){jq.ajax({type:"POST",url:"/xml/request.php",data:{a:a,v:c},success:function(a){jq("#"+b).html(a)},error:reportError});return!1}function initializeInlineHelp(){jq(".inline_help").fancybox({overlayColor:"#000",overlayOpacity:0.8,titleShow:!1,onStart:function(){var a=document.location.pathname.split("/");a.pop();a.join("/")}})}
function toggleInlineHelp(){var a=jq(this);"show help"==a.text()?(a.html("hide help"),jq(".inline_help").show()):(a.html("show help"),jq(".inline_help").hide());return!1}
function togglePaymentDetails(a,b,c,d){a=a.target;var e="payment_details_"+b+"_"+c;d&&(e+="_returned");"hide"==jq(a).text()?(jq("#"+e).hide(),jq(a).html("details")):(0==jq("#"+e).size()&&(jq(a).after('<div id="'+e+'" class="payment_details"></div>'),jq("#"+e).load("/my/earnings/history",{ajax:1,typeId:b,paymentId:c})),jq("#"+e).show(),jq(a).html("hide"));return!1}function showHelpFancybox(a,b){b||(b={});var c=jq.extend({overlayColor:"#000",overlayOpacity:0.8,href:a},b);jq.fancybox(c);return!1}
function submitMoreTransactions(a){a||(a=window.event);a.srcElement&&(a.target=a.srcElement);form=jq(a.target).closest("form");form.ajaxSubmit({beforeSubmit:function(){s=1*form.children("input[name=s]").val()+50;form.children("input[name=s]").val(s);submitter=form.children(".more_transactions_submit");s>=1*form.children("input[name=transaction_count]").val()&&submitter.remove()},success:function(a){table=form.prev(".ep_transactions");0==table.size()?(form.before(a),form.children(".more_transactions_submit").text("see more")):
table.children("tbody").append(a);0==form.children(".remove_transactions").size()&&form.append(' <a href="#" class="txtbutton remove_transactions" onclick="return hideTransactions(event);">hide</a>')}});return!1}
function hideTransactions(a){a||(a=window.event);a.srcElement&&(a.target=a.srcElement);hider=jq(a.target);form=hider.closest("form");form.prev(".ep_transactions").remove();form.children("input[name=s]").val(0);submitter=form.children(".more_transactions_submit");0==submitter.size()?hider.before('<a href="#" class="txtbutton more_transactions_submit" onclick="return submitMoreTransactions(event);">view recent sales</a>'):submitter.text("view recent sales");hider.remove();return!1}
function EngagementWizard(a,b){this.articleId=b;this.containerId=a;this.lastRemovedPosition=this.lastRemovedNode=this.replacementNode=this.currentItemRemoved=this.currentItem=!1;this.position=-1;this.clicks={};this.busy=!1;this.init=function(){this.checklist={};var a=this;jq.post("/xml/article/ewizard.php",{a:b},function(b){if(b.success){var e=jq.parseXML(b.checklists);jq(e).find("checklist").each(function(b,d){var e=jq(d).attr("for");a.checklist[e]=[];jq(d).children().each(function(b,d){a.checklist[e].push(jq(d).text())})});
a.clicks=b.clicks;a.finishInit()}else alert("Sorry, the wizard is down for maintenance")},"json")};this.finishInit=function(){this.updateItems();var a=this;jq("#fancybox-outer").delegate("#ewizard_next","click",function(b){a.stepForward();b.preventDefault()}).delegate("#ewizard_previous","click",function(b){a.stepBackward();b.preventDefault()}).delegate("#ewizard_recommend","click",function(b){a.makeRecommendation();b.preventDefault()}).delegate("#ewizard_checklist_back","click",function(b){a.checklistGoBack();
b.preventDefault()}).delegate("#ewizard_remove","click",function(b){a.removeCurrentItem(!1);b.preventDefault()}).delegate("#ewizard_undo_remove","click",function(b){a.undoRemoveCurrentItem();b.preventDefault()}).delegate("#ewizard_remove_keep_text","click",function(b){a.removeCurrentItem(!0);b.preventDefault()}).delegate("#ewizard_exit","click",function(a){jq.fancybox.close();a.preventDefault()});this.replaceOverlay();jq(window).on("scroll resize",function(){a.positionOverlaysAroundCurrentItem();
a.showAndPositionClickableItems()});this.stepForward()};this.updateItems=function(){this.items=jq(this.containerId).find(".moduleText a,.moduleAmazing")};this.getCurrentItemType=function(){if(!this.currentItem)return!1;var a=this.currentItem.closest(".module");return 0==a.length?!1:a.hasClass("moduleText")?"link":a.hasClass("moduleAmazing")?"amazon":!1};this.getChecklistItems=function(){var a=this.getCurrentItemType();return!a||"undefined"==typeof this.checklist[a]?[]:this.checklist[a]};this.getChecklistHTML=
function(){var a=this.getChecklistItems(),b='<ul id="ewizard_checklist">';jq.each(a,function(a,c){var g="ewizard_check_"+a;b+="<li>"+c+'<br><input type="radio" value="yes" name="'+g+'" id="'+g+'_yes"> <label for="'+g+'_yes">yes</label> <input type="radio" value="no" name="'+g+'" id="'+g+'_no"> <label for="'+g+'_no">no</label></li>'});b+="</ul>";b+='<a href="#" id="ewizard_recommend">get recommendation</a><br>';0<this.position&&(b+='<a href="#" id="ewizard_previous">previous item</a><br>');b+='<a href="#" id="ewizard_next">next item</a><br>';
b+='<a href="#" id="ewizard_exit">exit wizard</a>';return b=b.replace("**CTR**",this.renderClickDataForCurrentItem())};this.renderClickDataForCurrentItem=function(){var a="",b=this.currentItem.attr("href");b||(b=this.currentItem.find("a").first().attr("href"));b="-"+b;"undefined"!=typeof this.clicks[b]&&(a="("+this.clicks[b].ctr+"%)");return a};this.makeRecommendation=function(){var a=jq("#ewizard_checklist input[type=radio]"),b=a.length;if(0!=b){var e=0,f=0;jq.each(a.filter(":checked"),function(a,
b){"yes"==jq(b).attr("value")?e++:f++});a="removing";if(e==b/2)a="keeping";else if(e+f!=b/2){alert("Please answer all of the questions");return}b=this.getCurrentItemType();a="<p>We recommend "+a+" this "+("link"==b?"link":"product")+("removing"==a?".":"!")+'</p><div id="ewizard_remove_wrapper">';"link"==b?(a+='<a href="#" id="ewizard_remove_keep_text">remove link</a><br>',a+='<a href="#" id="ewizard_remove">remove link and anchor text</a><br>'):a+='<a href="#" id="ewizard_remove">remove product</a><br>';
a+='</div><br><div id="ewizard_undo_wrapper" style="display: none;"><a href="#" id="ewizard_undo_remove">undo</a></div>';a+='<a href="#" id="ewizard_checklist_back">answer questions again</a><br>';0<this.position&&(a+='<a href="#" id="ewizard_previous">previous item</a><br>');a+='<a href="#" id="ewizard_next">next item</a>';jq.fancybox.setContent(a)}};this.checklistGoBack=function(){jq.fancybox.setContent(this.getChecklistHTML())};this.focusOnCurrentItem=function(){if(!this.currentItem)return!1;this.stopShowingItems();
var a=this;jq.fancybox({content:this.getChecklistHTML(),width:300,height:400,autoDimensions:!1,overlayShow:!1,leftPosition:function(){return a.currentItemRemoved?jq("#fancybox-wrap").offset().left:a.currentItem.offset().left+a.currentItem.width()+20},topPosition:function(){return a.currentItemRemoved?jq("#fancybox-wrap").offset().top:a.currentItem.offset().top-30},centerOnScroll:!0,onComplete:function(){jq.fancybox.center();a.positionOverlaysAroundCurrentItem()},onClosed:function(){a.unfocus()}})};
this.unfocus=function(){this.currentItemRemoved&&this.updateItems();this.currentItem=this.currentItemRemoved=!1;this.position=-1;jq.each("n ne e se s sw w nw".split(" "),function(a,b){jq("#fancybox-overlay-"+b).hide()});jq("#fancybox-highlighter").hide();this.showAndPositionClickableItems()};this.setCurrentItem=function(a){var b=this.items.index(a);return 0<=b?(this.currentItem=jq(a),this.position=b,this.lastRemovedPosition=this.lastRemovedNode=this.replacementNode=this.currentItemRemoved=!1,this.focusOnCurrentItem(),
!0):!1};this.getNextItem=function(){return this.position+1<this.items.size()?this.items.get(this.position+1):null};this.getPreviousItem=function(){return 0<this.position?this.items.get(this.position-1):null};this.showAndPositionClickableItems=function(){if(!this.currentItem){var a=this;this.items.each(function(b,e){e=jq(e);var f=e.data("clickable");f||(f=jq("<div></div>").addClass("engagement_wizard_clickable").on("click",function(b){a.setCurrentItem(e);b.preventDefault()}).insertAfter(jq("#fancybox-overlay")),
e.data("clickable",f));var g=e.offset();f.css({position:"absolute",left:g.left-6-2,top:g.top-6-2,width:e.width()+12,height:e.height()+12,border:"2px solid #f90",cursor:"pointer",zIndex:1100,backgroundColor:"rgba(255,153,0,0.1)"});f.show()})}};this.stopShowingItems=function(){jq(".engagement_wizard_clickable").hide()};this.replaceOverlay=function(){var a=jq("#fancybox-overlay");jq.each(["n","e","s","w"],function(b,e){jq("<div></div>").attr("id","fancybox-overlay-"+e).css({display:"none",position:"absolute",
backgroundColor:"#000",zIndex:1100,top:0,left:0,opacity:0.3}).insertAfter(a)});jq("<div></div>").attr("id","fancybox-highlighter").css({border:"2px solid #f90",position:"absolute",display:"none",zIndex:1101}).insertAfter(a);jq("<div></div>").attr("id","fancybox-overlay-all").css({display:"none",position:"fixed",backgroundColor:"#000",zIndex:1100,top:0,left:0,right:0,bottom:0,opacity:0.3}).insertAfter(a)};this.positionOverlaysAroundCurrentItem=function(){if(this.currentItem){var a;if(this.currentItemRemoved)a=
!1;else{a=this.currentItem[0].getBoundingClientRect();var b=jq(window).height(),e=jq(window).width(),f=-300<=a.left&&a.left<=e+300||-300<=a.right&&a.right<=e+300;a=(-300<=a.bottom&&a.bottom<=b+300||-300<=a.top&&a.top<=b+300)&&f}if(a){a=this.currentItem.offset();var f=this.currentItem.width(),g=this.currentItem.height();jq.each(["n","e","s","w"],function(a,c){jq("#fancybox-overlay-"+c).css({width:5*e,height:5*b})});jq("#fancybox-overlay-all").hide();jq("#fancybox-overlay-n").css({width:f+12,top:-5*
b+a.top-6,left:a.left-6}).show();jq("#fancybox-overlay-s").css({width:f+12,top:a.top+g+6,left:a.left-6}).show();jq("#fancybox-overlay-e").css({left:a.left+f+6,top:a.top-Math.floor(2.5)*b}).show();jq("#fancybox-overlay-w").css({top:a.top-Math.floor(2.5)*b,left:-5*e+a.left-6}).show();jq("#fancybox-highlighter").css({top:a.top-6-2,left:a.left-6-2,width:f+12,height:g+12}).show()}else jq.each(["n","e","s","w"],function(a,b){jq("#fancybox-overlay-"+b).hide()}),jq("#fancybox-highlighter").hide(),jq("#fancybox-overlay-all").show()}};
this.removeCurrentItem=function(a){if(this.currentItem&&!this.busy){this.busy=!0;var b=this.getCurrentItemType(),e=this;if("link"==b){var f=this.currentItem.closest(".txtd"),g=f.attr("id").substring(5),j=f.find("a").index(this.currentItem),h=f.clone();this.lastRemovedNode=f;this.replacementNode=h;f=h.find("a").eq(j);a?f.replaceWith(f.html()):f.remove();jq.post("/xml/article/ewizard.php",{type:"text",id:g,content:h.html()},function(a){e.finishRemoveCurrentItem(b,a)},"json")}else"amazon"==b&&(this.lastRemovedNode=
a=this.currentItem.closest(".moduleAmazing"),this.replacementNode=jq("<div></div>"),jq.post("/xml/article/ewizard.php",{type:"amazon",id:a.attr("id").substring(4),content:-1},function(a){e.lastRemovedPosition=a.position;e.finishRemoveCurrentItem(b,a)},"json"))}};this.finishRemoveCurrentItem=function(a,b){b.success?(this.lastRemovedNode.replaceWith(this.replacementNode),jq("#ewizard_remove_wrapper").hide(),jq("#ewizard_undo_wrapper").show(),jq("#ewizard_checklist_back").hide(),this.currentItemRemoved=
a,this.positionOverlaysAroundCurrentItem()):alert(b.error?b.error:"Something went wrong");this.busy=!1};this.undoRemoveCurrentItem=function(){if(!this.busy){this.busy=!0;var a=this;"link"==this.currentItemRemoved?jq.post("/xml/article/ewizard.php",{type:"text",id:this.lastRemovedNode.attr("id").substring(5),content:this.lastRemovedNode.html()},function(b){a.finishUndoRemove(b)},"json"):"amazon"==this.currentItemRemoved&&jq.post("/xml/article/ewizard.php",{type:"amazon",id:this.lastRemovedNode.attr("id").substring(4),
content:this.lastRemovedPosition},function(b){a.finishUndoRemove(b)},"json")}};this.finishUndoRemove=function(a){a.success?(this.replacementNode.replaceWith(this.lastRemovedNode),jq("#ewizard_undo_wrapper").hide(),jq("#ewizard_remove_wrapper").show(),jq("#ewizard_checklist_back").show(),this.currentItemRemoved=!1,this.positionOverlaysAroundCurrentItem()):alert(a.error?a.error:"Something went wrong");this.busy=!1};this.stepForward=function(){this.takeStep(1)};this.stepBackward=function(){this.takeStep(-1)};
this.takeStep=function(a){if(this.busy)return!1;this.busy=!0;this.currentItemRemoved&&(this.updateItems(),0<a&&this.position--);a=0<a?this.getNextItem():this.getPreviousItem();var b=this;if(a){var e=jq(document).scrollTop(),f=jq(a).offset().top-40,e=Math.max(800,Math.min(4E3,1E3*(Math.abs(e-f)/600)));this.setCurrentItem(a);jq("html, body").animate({scrollTop:f},e,"swing",function(){b.busy=!1})}else jq.fancybox.close(),alert("Congrats! You are finished reviewing this Hub."),this.busy=!1}}
var linkStatsTool={remove:function(a){jq(".linkstats_highlight").remove();jq("#link_stats").unbind().click(function(){linkStatsTool.show(a);return!1}).html("clicks");return!1},show:function(a){var b=this;jq.ajax({type:"POST",url:"/xml/articlelinkstats.php",dataType:"json",success:function(c){b.highlight(c);jq("#link_stats").prop("onclick","");jq("#link_stats").unbind().click(function(){linkStatsTool.remove(a);return!1}).html("hide clicks")},data:{art_id:a},error:reportError})},highlight:function(a){var b=
this;jq("a").each(function(){var c=jq(this),d=findClosestIdAndClass(c),g=c.attr("href");if("#"==g){var j=c.attr("onclick");j&&(j=j.match(/window\.open\(\'(http:\/\/.*?)\'/))&&(g=j[1])}g||(g="");g.match(/www\.amazon\.com/)&&(g=g.replace(/\?.*$/,""),g=g.replace(/%3F.*$/,""));d=d+"-"+g;j=a[d];j||(d="-"+g,j=a[d]);j&&(g=b.getSmallStatsOverlay(j),c.parent().append(g),g.position({my:"center center",at:"center center",of:c,collision:"none"}),a[d]=null)});var c=jq('<div class="linkstats_highlight" style="font-size: 1.9em, border-radius: 15px; padding: 5px; background-color: yellow; position: absolute; max-width:40%;"><strong style="text-align: center">Additional Clicks Not Found on Page</strong> (<a href="#" onclick="jq(this).parent().remove(); return false;">Close</a>)<ul></ul></div>');
jq("body").append(c);for(key in a)if(a[key]&&0<a[key].clicks){var d=jq("<li>"+key+": "+a[key].clicks+" clicks</li>");c.find("ul").append(d)}c.css("left","10px");c.css("top","10px")},getSmallStatsOverlay:function(a){var b=jq('<div class="linkstats_highlight" style="opacity:0.9;font-size:18px;border-radius:15px;padding:5px;background-color:#ccc;position:absolute;font-weight:normal;line-height:20px"></div>');b.height(24);var c="",c=5+Math.round(95*a.impressions/1E4),d,e;70<=c?(c=100,d="#00ff00",e="High Accuracy"):
35<=c?(d="#ffff00",e="Medium Accuracy"):(d="#ff0000",e="Low Accuracy");var f=" 95% confidence interval is "+a.ctrrange[0]+"% to "+a.ctrrange[1]+"%",c='<div title="'+e+" - "+f+'" style="background-color:#fff;width:80%;margin:auto;"><div style="background-color:'+d+";height:3px;width:"+c.toFixed(0)+'%"></div></div>';1E3<=a.impressions?(10<a.ctr?b.width(70):b.width(60),b.html('<div style="text-align:center;opacity:1.0;color:black;">'+a.ctr.toFixed(2)+"%<br/>"+c+"</div>")):100<=a.impressions?(d=100*a.clicks/
a.impressions,10<d?b.width(70):b.width(60),b.html('<div style="text-align:center;opacity:1.0;color:black;">'+d.toFixed(2)+"%<br/>"+c+"</div>")):(b.width(90).height(20),b.html('<div style="text-align:center;opacity:1.0;color:black;font-size:10px;line-height:12px">insufficient<br/>data</div>'));0<a.impressions?b.attr("title",a.clicks+"/"+a.impressions+" - "+f):b.attr("title",a.clicks+" clicks");return b}},stuffedtool={stuffedkeywords:null,highlighttree:function(a){jQuery(a).children();this.highlighttext(a)},
highlighttext:function(a){if("text/javascript"!=a.type){for(var b=!1,c=jQuery(a).text(),d=jQuery(a).html(),c=c.split(/[^a-zA-Z0-9']/),e=0,f=this;e<c.length;){var g=c[e],j=wordTriple=!1,h=[g];if(e<c.length-1){var l=[c[e],c[e+1]];h[1]=l.join(" ");l.sort();j=l.join(" ")}e<c.length-2&&(l=[c[e],c[e+1],c[e+2]],h[2]=l.join(" "),l.sort(),wordTriple=l.join(" "));jq.each([wordTriple,j,g],function(a,c){if(!c)return!0;if(void 0!=f.stuffedkeywords[c.toLowerCase()]&&"keyword"==f.stuffedkeywords[c.toLowerCase()]){var g=
h[2-a];b=!0;for(var j=RegExp(g.replace(/ /g,"\\s+"),"g"),l="",L,S=!1;d.length;){var Q=d.indexOf("<"),X=Q;-1==X&&(X=d.length);0<X&&(L=d.substring(0,X),d=d.substring(X),l=S?l+L:l+L.replace(j,'<span class="keyword_highlight" style="background-color:yellow;color:black;font-size:inherit;">'+g+"</span>"));-1<Q&&(L=d.indexOf(">"),-1<L?(Q=d.substring(0,L+1),-1<Q.indexOf('class="keyword_highlight"')&&(S=!0),"</span>"==Q&&(S=!1),l+=Q,d=d.substring(L+1)):(l+=d,d=""))}d=l;e+=a;return!1}});e++}b&&jQuery(a).html(d)}},
highlightkeys:function(a){this.stuffedkeywords=[];this.url=null;var b=this;jQuery.get("/xml/moderate/stuffed.php","articleId="+a,function(a){var d=jq(a).find("chance").text();a=jq(a).find("keyword");if(0==a.size())return alert("No potential stuffed phrases found"),jQuery("#check_stuffed").text("Stuffed?"),!1;alert((20>d?"It is unlikely that this Hub is stuffed":40>d?"It is possible but unlikely that this this Hub is stuffed":60>d?"This Hub might be stuffed, but we aren't sure":85>d?"This Hub is probably stuffed":
"This Hub is very likely to be stuffed")+"\n(percent chance: about "+d+"%)");a.each(function(){b.stuffedkeywords[jQuery(this).text()]="keyword"});jQuery("#title h1, #hubtitle h1").each(function(){b.highlighttree(this)});jQuery(".moduleText").each(function(){b.highlighttree(this)});jQuery(".module .subtitle").each(function(){b.highlighttree(this)});jQuery(".keyword_highlight").each(function(){jQuery(this).html(jQuery(this).text())});jQuery("#check_stuffed").text("Stuffed?")});jQuery("#check_stuffed").text("processing");
return!1}};
function toggleAutoeditEnabled(){var a=jq(this).parent(),b=a.attr("data-id"),c=a.hasClass("edit_filter_disabled");jq.post("/xml/article/autoedit.php",{id:b,enable:c?1:0},function(b){if(!b)return alert("We were not able to make the change that you requested at this time"),!1;c?a.removeClass("edit_filter_disabled").addClass("edit_filter").children(".autoedit_toggle").attr({checked:"checked",title:"Click to stop making this suggested correction"}):a.removeClass("edit_filter").addClass("edit_filter_disabled").children(".autoedit_toggle").attr({checked:!1,title:"Click to start making this suggested correction"})},
"json");return!1}function initAutoeditAdmin(a){jq("#show_autoedits").data("reviewed")?initAutoeditAdminMain():jq.post("/xml/article/autoedit.php",{a:a,reviewed:1},function(){jq("#show_autoedits").data("reviewed",1);jq(".edit_filter_unreviewed").addClass("edit_filter_callout");initAutoeditAdminMain()})}
function initAutoeditAdminMain(){jq(".edit_filter_inactive").removeClass("edit_filter_inactive").addClass("edit_filter").prepend('<input type="checkbox" class="autoedit_toggle" title="Click to stop making this suggested correction" checked="checked">');jq(".edit_filter_inactive_disabled").removeClass("edit_filter_inactive_disabled").addClass("edit_filter_disabled").prepend('<input type="checkbox" class="autoedit_toggle" title="Click to stop making this suggested correction">');jq(".autoedit_toggle").click(toggleAutoeditEnabled);
var a=jq(".edit_filter_unreviewed").first();0==a.size()&&(a=jq(".edit_filter, .edit_filter_disabled").first());if(a.size()){if(!a.is(":visible")){var b=a.closest(".module"),c=a.parent().prev().attr("id");c&&"slide_img_"==c.substring(0,10)?(c=jq("#t_"+c.substring(10)),0<c.size()?c.trigger("click"):a=b):a=b}jq("html, body").animate({scrollTop:a.offset().top},1500)}else alert("No corrections found")}
function uninitAutoeditAdmin(){jq(".edit_filter_unreviewed").removeClass("edit_filter_callout").removeClass("edit_filter_unreviewed");jq("#show_autoedits span").html("0");jq(".autoedit_toggle").remove();jq(".edit_filter").removeClass("edit_filter").addClass("edit_filter_inactive");jq(".edit_filter_disabled").removeClass("edit_filter_disabled").addClass("edit_filter_inactive_disabled")}
function revealEditbotLink(a){var b=jq(".edit_filter_inactive, .edit_filter_inactive_disabled").size();if(0<b){var c=jq(".edit_filter_unreviewed").size();jq('<a href="#" id="show_autoedits">show '+b+" correction"+(1==b?"":"s")+" (<span>"+c+"</span> new)</a>").appendTo("#show_editbot").click(function(){initAutoeditAdmin(a);jq(this).hide();jq("#hide_autoedits").show();return!1});jq('<a href="#" id="hide_autoedits" style="display: none;">hide corrections</a>').appendTo("#show_editbot").click(function(){uninitAutoeditAdmin();
jq(this).hide();jq("#show_autoedits").show();return!1});jq("#show_editbot").show()}}
var snippingTool={updateSnipStats:function(){this.snipChanges.text_capsule_html={};jq(".moduleText").each(function(){var a=jq(this);a.find('span[id*="link_snipped_"]').length&&(snippingTool.snipChanges.text_capsule_html[a.attr("id")]="")});var a=this.snipChanges.remove_modules.length,b=this.snipChanges.newTitle,c=Object.keys(this.snipChanges.text_capsule_html).length,d=this.snipChanges.remove_image_captions.length,e=jq("<ul>");e.append(jq("<li>Title Fixed: "+(b?"Yes":"No")+"</li>").css("font-weight",
b?"bold":""));e.append(jq("<li>Modules Removed: "+a+"</li>").css("font-weight",a?"bold":""));e.append(jq("<li>Modules w/ snips: "+c+"</li>").css("font-weight",c?"bold":""));e.append(jq("<li>Image source snips: "+d+"</li>").css("font-weight",d?"bold":""));jq("#snipper_stats").html(e)},start:function(){this.snipChanges={snip:!0,newTitle:"",remove_modules:[],remove_image_captions:[],text_capsule_html:{}};this.linksSnipped={};jq("#hop_hubcontainer").addClass("snip_mode");jq(".module").prepend('<a class="snip_module_btn" onclick="snippingTool.removeModule(this); return false;" href="#">Remove</a>');
jq("#hubtitle h1").after('<a id="fix_title_btn" class="button small red_bg" onclick="snippingTool.editTitle(); return false" style="margin-left:10px;">Fix Typo</a>');jq("#hop_hubcontainer").append('<div id="snipper_stats" style="background-color:#e66; max-width:250px; padding:15px 20px 15px 0; position:fixed; top:0; left:0;">');this.updateSnipStats();var a=0;jq(".moduleText > div a").each(function(){var b=jq(this);b.attr("snip-id",a);b.after('<span class="snip_link_span"> [<small><a class="button small" href="#" onclick="snippingTool.snipLink(this, '+
a+', true); return false">Snip&nbsp;Link&nbsp;Only</a>, <a class="button small" href="#" onclick="snippingTool.snipLink(this, '+a+', false); return false;">Snip&nbsp;Link+Text</a></small>]</span>');a++});jq(".moduleImage .caption_full a, .moduleImage .caption_half a").each(function(){jq(this).after('<span class="snip_link_span"> <a class="button small" href="#" onclick="snippingTool.snipImageSource(this); return false;">Snip Source</a>')});jq("#start_snip_btn").val("Done Snipping");jq("#start_snip_btn").attr("onclick",
"snippingTool.stop(); return false");jq("#hub_court_form input[type=submit]").attr("disabled",!0);this.clearStuffedButton()},stop:function(){jq("#hubtitle > textarea").length&&this.finishEditTitle();this.clearStuffedButton();var a=this.snipChanges.remove_modules.length||this.snipChanges.remove_image_captions.length||Object.keys(this.snipChanges.text_capsule_html).length||this.snipChanges.newTitle;if(!a&&!confirm("No snips were detected!\n\nDo you wish to leave Snip mode and return to hopping?"))return!1;
jq("#start_snip_btn").removeClass("green_bg").attr("disabled","disabled");jq("#hop_hubcontainer").removeClass("snip_mode");jq(".snip_module_btn").remove();jq("#fix_title_btn").remove();jq(".snip_link_span").remove();jq("#snipper_stats").remove();jq(".moduleText > div a").each(function(){jq(this).removeAttr("snip-id")});jq(".link_snipped_placeholder").each(function(){var a=jq(this).html();jq(this).replaceWith(a)});jq(".linkstats_highlight").remove();if(a){for(k in this.snipChanges.text_capsule_html)this.snipChanges.text_capsule_html[k]=
jq("#"+k+" .txtd").html();snipSubmitHandler()}else jq("#start_snip_btn").remove(),jq("#hub_court_form input[type=submit]").attr("disabled",!1)},snipLink:function(a,b,c){jq(a).parents(".snip_link_span").html(' [<small><a class="button small" href="#" onclick="snippingTool.undoSnipLink(this, '+b+'); return false">Undo</a></small>]');a=jq(".moduleText a[snip-id="+b+"]");a.parents(".module");a.length&&(this.linksSnipped[b]=jq("<div>").append(a.clone()).html(),c?(c=a.html(),a.replaceWith('<span class="link_snipped_placeholder" id="link_snipped_'+
b+'">'+c+"</span>")):a.replaceWith('<span id="link_snipped_'+b+'" class="snip_link_span error">&lt;snipped&gt;</span>'),this.updateSnipStats())},undoSnipLink:function(a,b){jq(a).parents(".snip_link_span").html(' [<small><a class="button small" href="#" onclick="snippingTool.snipLink(this, '+b+', true); return false">Snip&nbsp;Link&nbsp;Only</a>, <a class="button small" href="#" onclick="snippingTool.snipLink(this, '+b+', false); return false;">Snip&nbsp;Link+Text</a></small>]');jq("#link_snipped_"+
b).replaceWith(this.linksSnipped[b]);this.updateSnipStats()},snipImageSource:function(a){a=jq(a);var b=a.closest(".module").attr("id"),c=a.closest(".caption_full, .caption_half").attr("id");this.snipChanges.remove_image_captions.push([b,c]);a.closest("div").remove();this.updateSnipStats()},removeModule:function(a){a=jq(a).html("Undo");a.attr("onclick","snippingTool.undoRemoveModule(this); return false;");a=a.parents(".module").addClass("undo");this.snipChanges.remove_modules.push(a.attr("id"));this.updateSnipStats()},
undoRemoveModule:function(a){a=jq(a).html("Remove");a.attr("onclick","snippingTool.removeModule(this); return false;");a=a.parents(".module").removeClass("undo");for(var b=0;b<this.snipChanges.remove_modules.length;b++)this.snipChanges.remove_modules[b]==a.attr("id")&&this.snipChanges.remove_modules.splice(b,1);this.updateSnipStats()},editTitle:function(){this.clearStuffedButton();var a=jq("#hubtitle h1").html();this.snipChanges.oldTitle=a;jq("#hubtitle h1").replaceWith('<textarea style="width:80%">'+
a+"</textarea>");jq("#fix_title_btn").html("Done").attr("onclick","snippingTool.finishEditTitle(); return false;")},finishEditTitle:function(){var a=jq("#hubtitle textarea").val();jq("#hubtitle textarea").replaceWith("<h1>"+a+"</h1>");a&&a!=this.snipChanges.oldTitle?(this.snipChanges.newTitle=a,jq("#hubtitle h1").append('<small style="color:#e66; margin-left:5px;">(edited)</small>'),jq("#fix_title_btn").html("Undo Fix").attr("onclick","snippingTool.undoTitle(); return false;")):jq("#fix_title_btn").html("Fix Typo").attr("onclick",
"snippingTool.editTitle(); return false;");this.updateSnipStats()},undoTitle:function(){this.snipChanges.newTitle="";jq("#hubtitle h1").replaceWith("<h1>"+this.snipChanges.oldTitle+"</h1>");jq("#fix_title_btn").html("Fix Typo").attr("onclick","snippingTool.editTitle(); return false;");this.updateSnipStats()},clearStuffedButton:function(){var a=jq(".keyword_highlight");a.length&&a.replaceWith(a.html())}};
(function(a){a.fn.simpleAccordion=function(){var b=this.children("a");b.click(function(c){c.preventDefault();c=a(this).hasClass("accordion_active");b.removeClass("accordion_active");b.next().hide();c||(a(this).addClass("accordion_active"),a(this).next().show())});return this}})(jQuery);function getEvent(a){return window.event||a}
function getKeyProperties(a){a=getEvent(a);return{evt:a,keyCode:a.keyCode?a.keyCode:a.charCode?a.charCode:a.which,target:a.target?a.target:a.srcElement?a.srcElement:a.which}}function checkTabKeyAlone(a){a=getKeyProperties(a);return 9==a.keyCode&&!a.evt.shiftKey&&!a.evt.ctrlKey&&!a.evt.altKey}function checkShiftTabKey(a){a=getKeyProperties(a);return 9==a.keyCode&&a.evt.shiftKey&&!a.evt.ctrlKey&&!a.evt.altKey}
function getSelectionProperties(a){var b=getKeyProperties(a),c=b.target.setSelectionRange?null:document.selection.createRange(),d=String.fromCharCode(9);if(c){a=document.body.createTextRange();a.moveToElementText(b.target);a.setEndPoint("StartToStart",c);var e=b.target.value.length-a.text.length,f=e+c.text.length}else e=b.target.selectionStart,f=b.target.selectionEnd;return{setSelection:function(a,e){if(c){var f=a-d.length*(b.target.value.substring(0,a).split("\n").length-1),l=e+d.length*(b.target.value.substring(e,
b.target.value.length).split("\n").length-1),m=document.body.createTextRange();m.moveToElementText(b.target);m.moveStart("character",f);m.moveEnd("character",-(b.target.value.length-l));m.select()}else b.target.selectionStart=a,b.target.selectionEnd=e},isMultiline:function(){return f>e+2&&-1!=b.target.value.slice(e,f-2).indexOf("\n")},removeTab:function(){if(this.isMultiline()){for(var a=b.target.value.slice(e,f),a=a.split("\n"),c=0;c<a.length;c++)if(a[c].slice(0,1)==d||" "==a[c].slice(0,1))a[c]=
a[c].slice(1,a[c].length);var a=a.join("\n"),c=b.target.value.slice(0,e),h=b.target.value.slice(f,b.target.value.length);b.target.value=c.concat(a,h);this.setSelection(e,c.length+a.length)}else if(a=b.target.value.slice(0,e),c=a.slice(a.length-1,a.length),c==d||" "==c)b.target.value=a.slice(0,a.length-1).concat(b.target.value.slice(e,b.target.value.length)),this.setSelection(e-1,f-1)},addTab:function(){if(this.isMultiline()){0<e&&(e=b.target.value.slice(0,e).lastIndexOf("\n")+1);var a=b.target.value.slice(0,
e),c=b.target.value.slice(e,f),h=b.target.value.slice(f,b.target.value.length),c=c.replace(/\n/g,"\n"+d),a=a.concat(d);b.target.value=a.concat(c,h);this.setSelection(e,f+d.length*c.split("\n").length)}else a=b.target.value.substring(0,e),c=b.target.value.substring(e,f),h=b.target.value.substring(f,b.target.value.length),a=a.concat(d),b.target.value=a.concat(c,h),this.setSelection(e+d.length,f+d.length)}}}function ImageViewerControl(a,b,c){this.initialize(a,b,c)}
ImageViewerControl.prototype={initialize:function(a,b,c){this.modId=a;this.floatStatus=b;this.displayStatus=c;this.photoData={};this.photoOrder=[];this.timer=this.viewer_id=null;this.slide_idx=-1;this.displaySlideshowLinks=!1;this.resources={ht_viewer_sect:"image_viewer_"+this.modId,ht_inline_sect:"image_inline_"+this.modId,ht_slideshow_sect:"image_slideshow_"+this.modId,ht_thumbnail_sect:"image_thumbnail_"+this.modId,inline_images:"imgs_"+this.modId,viewer_display:"slide_display_"+this.modId,viewer_photo:"slide_img_"+
this.modId,viewer_caption:"slide_desc_"+this.modId,thumb_tn_section:"slide_tn_section_"+this.modId}},setMaxHeight:function(a){this.firstTimeLoadingImage=!0;this.maxHeight=a},addPhoto:function(a){this.photoData[a.id]=a;this.photoOrder.push(a.id)},clear:function(){delete this.photoData;this.photoData={};this.photoOrder.clear()},render:function(){switch(this.displayStatus){case "No Border":case "With Border":this.renderInlineImages();break;case "Thumbnail":this.renderThumbnails()}},toggleViewer:function(){switch(this.displayStatus){case "No Border":case "With Border":jq("#"+
this.resources.ht_viewer_sect).hide();jq("#"+this.resources.ht_inline_sect).show();jq("#"+this.resources.ht_thumbnail_sect).hide();break;case "Thumbnail":jq("#"+this.resources.ht_viewer_sect).show(),jq("#"+this.resources.ht_inline_sect).hide(),jq("#"+this.resources.ht_thumbnail_sect).show()}},loadSlide:function(a){!this.firstTimeLoadingImage&&this.maxHeight&&jq("#"+this.resources.viewer_display).css("height",this.maxHeight+"px");this.viewer_id=a;rec=this.photoData[a];jq("#"+this.resources.viewer_photo).html(this._getDisplayUrl());
jq("#"+this.resources.viewer_caption).html(this._getCaptionAndSource(rec));this.firstTimeLoadingImage=!1},getMaxDisplayHeight:function(){var a=0;this.photoOrder.each(function(b){var c=this.photoData[b];b=this._getDisplayHeight(b)+this._getCaptionHeight(c);a=b>a?b:a}.bind(this));return a},setDisplaySlideshowLinks:function(a){this.displaySlideshowLinks=a},_getDisplayUrl:function(){rec=this.photoData[this.viewer_id];var a=200<=rec.origWidth&&150<=rec.origHeight;if(2==rec.maxSize&&"With Border"==this.displayStatus)return this._createImageTag(rec.urlQuarter,
"quarter_frame",rec.esc_cap)+(a&&this.displaySlideshowLinks?getHubSlideshowHtml("quarter","With Border"==this.displayStatus):"");if(2==rec.maxSize)return this._createImageTag(rec.urlQuarter,"quarter",rec.esc_cap)+(a&&this.displaySlideshowLinks?getHubSlideshowHtml("quarter","With Border"==this.displayStatus):"");if(("right"==this.floatStatus||1==rec.maxSize)&&"With Border"==this.displayStatus)return this._createImageTag(rec.urlHalfPad,"half_frame",rec.esc_cap)+(a&&this.displaySlideshowLinks?getHubSlideshowHtml("half",
"With Border"==this.displayStatus):"");if("right"==this.floatStatus||1==rec.maxSize)return this._createImageTag(rec.urlHalf,"half",rec.esc_cap)+(a&&this.displaySlideshowLinks?getHubSlideshowHtml("half","With Border"==this.displayStatus):"");if("none"==this.floatStatus&&"With Border"==this.displayStatus)return this._createImageTag(rec.urlFullPad,"full_frame",rec.esc_cap)+(a&&this.displaySlideshowLinks?getHubSlideshowHtml("full","With Border"==this.displayStatus):"");if("none"==this.floatStatus)return this._createImageTag(rec.urlFull,
"full",rec.esc_cap)+(a&&this.displaySlideshowLinks?getHubSlideshowHtml("full","With Border"==this.displayStatus):"")},_createImageTag:function(a,b,c){void 0==c&&(c="");return"<img class='"+b+"' title='"+c+"' alt='"+c+"' src='"+a+"' />"},_getDisplayHeight:function(a){rec=this.photoData[a];if(2==rec.maxSize)return 120*rec.ratio;if(("right"==this.floatStatus||1==rec.maxSize)&&"With Border"==this.displayStatus)return 248*rec.ratio;if("right"==this.floatStatus||1==rec.maxSize)return 260*rec.ratio;if("none"==
this.floatStatus&&"With Border"==this.displayStatus)return 496*rec.ratio;if("none"==this.floatStatus)return 520*rec.ratio},_getCaptionHeight:function(a){var b;b=""==a.sourceUrl?a.sourceName:""==a.sourceName?a.sourceUrl.truncate(50):a.sourceName;""!=b&&(b="Source: "+b);var c="right"==this.floatStatus?49:98;return 15*(1+Math.ceil(b.length/c)+Math.ceil(a.caption.length/c))},_getCaptionAndSource:function(a){var b=a.nofollow?' rel="nofollow"':"",c="",c=""==a.sourceUrl?a.sourceName:""==a.sourceName?'<a href="'+
a.sourceUrl.replace(/"/g,"")+'"'+b+">"+a.sourceUrl.truncate(50)+"</a>":'<a href="'+a.sourceUrl.replace(/"/g,"")+'"'+b+">"+a.sourceName+"</a>";""!=c&&(c="<div>Source: "+c+"</div>");return a.caption+c},_addInlineImage:function(a){this.viewer_id=a;a=this.photoData[a];var b=jq("<div/>"),c=this._getDisplayUrl(),d="none"==this.floatStatus?"caption_full":"caption_half";b.attr("id","img_"+a.id);b.html("<div id='img_url_"+a.id+"'>"+c+"</div><div class='"+d+"' id='img_desc_"+a.id+"'>"+this._getCaptionAndSource(a)+
"</div>");jq("#"+this.resources.inline_images).append(b)},renderInlineImages:function(){jq("#"+this.resources.inline_images).html("");this.photoOrder.each(function(a){this._addInlineImage(a)}.bind(this))},_addThumbnail:function(a){var b=this.photoData[a];a=document.createElement("img");a.id="slide_tn_"+b.id;a.src=b.urlThumb;a.alt=b.caption;a.title=b.caption;a.onclick=function(){this.loadSlide(b.id)}.bind(this);jq("#"+this.resources.thumb_tn_section).append(a)},renderThumbnails:function(){jq("#"+this.resources.thumb_tn_section).html("");
this.photoOrder.each(function(a){this._addThumbnail(a)}.bind(this));0<this.photoOrder.length&&jq("#slide_tn_"+this.photoOrder[0]).click()}};CodeModuleEdit.prototype=new ModuleEdit;
function CodeModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.edit_id="code_e_"+a;this.resources.code_div_id="code_d_"+a;this.resources.code_textarea_id="code_txt_area_"+a;this.resources.code_type_id=a+"_code_type";this.resources.code_include_line_numbers_id=a+"_code_lines";this.resources.code_display_size_id=a+"_code_display_size";this.resources.code_max_size_id=a+"_code_max_size";this.resources.code_size_left_id="codesize_numcharsvalue_"+a;this.FUDGE_WIDTH=-2;this.COLORED_FUDGE_WIDTH=
-20;this.MIN_HEIGHT=150;this.ADDITIONAL_HEIGHT=10}CodeModuleEdit.prototype.saveContent=function(){};
CodeModuleEdit.prototype.onEditClose=function(){code_div=jq("#"+this.resources.code_div_id);this.data.content=jq("#"+this.resources.code_textarea_id).val();this.data.codeTypeId=jq("#"+this.resources.code_type_id).val();this.data.includeLineNumbers=jq("#"+this.resources.code_include_line_numbers_id).is(":checked")?1:0;this.data.codeDisplaySize=jq("#"+this.resources.code_display_size_id).val();var a=jq("<div/>");a.text(this.data.content);code_div.empty();code_div.append(a);code_div.css("display","");
code_div.width("auto");code_div.height("auto");delete this.state.origtext_width;delete this.state.origtext_height};
CodeModuleEdit.prototype.onEditOpen=function(){code_div=jq("#"+this.resources.code_div_id);var a=code_div.html();code_div.html('<textarea id="'+this.resources.code_textarea_id+'" class="moduleCodeEdit" rows="10">'+a+"</textarea>");checkCharCount(jq("#"+this.resources.code_max_size_id).val(),this.resources.code_textarea_id,this.resources.code_size_left_id);jq("#"+this.resources.code_textarea_id).keypress(function(a){return checkTabKeyAlone(a)||checkShiftTabKey(a)?(a.stopPropagation(),!1):!0});jq("#"+
this.resources.code_textarea_id).bind("keydown",function(a){var b;return checkTabKeyAlone(a)?(b=getSelectionProperties(a),b.addTab(),a.stopPropagation(),!1):checkShiftTabKey(a)?(b=getSelectionProperties(a),b.removeTab(),a.stopPropagation(),!1):!0});this.state.origtext_width=jq("#"+this.data.div_id).width()+this.FUDGE_WIDTH+(this.state.floatright&&!code_div.parent().hasClass("color0")?this.COLORED_FUDGE_WIDTH:0);this.state.origtext_height=code_div.height();var a=this.state.origtext_height<this.MIN_HEIGHT?
this.MIN_HEIGHT:this.state.origtext_height,b=this.getMaxHeight();b>this.MIN_HEIGHT&&a>b&&(a=b);a+=this.ADDITIONAL_HEIGHT;code_div.height(a);code_div.width(this.state.origtext_width);code_div.css("padding","13px");code_div.show()};CodeModuleEdit.prototype.getMaxHeight=function(){return 0.5*((window.innerHeight||document.documentElement.clientHeight)-this.ADDITIONAL_HEIGHT)};CommentModuleEdit.prototype=new ModuleEdit;
function CommentModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.edit_id=a+"_comment";this.resources.comment_moderated_id=a+"_moderated";this.resources.comment_emailme_id=a+"_emailme";this.resources.comment_noanonymous_id=a+"_anonymous";this.resources.comment_max_id=a+"_max";this.resources.comment_reversed_id=a+"_reversed";this.resources.comment_nomore_id=a+"_nomore"}CommentModuleEdit.prototype.saveContent=function(){};
CommentModuleEdit.prototype.onEditClose=function(){jq("#"+this.resources.comment_moderated_id)&&(this.data.moderated=jq("#"+this.resources.comment_moderated_id).prop("checked"),this.data.anonymous=jq("#"+this.resources.comment_noanonymous_id).prop("checked"),this.data.reversed=jq("#"+this.resources.comment_reversed_id).prop("checked"),this.data.nomore=jq("#"+this.resources.comment_nomore_id).prop("checked"),this.data.max=jq("#"+this.resources.comment_max_id).val())};
CommentModuleEdit.prototype.onEditOpen=function(){};CommentModuleEdit.prototype.isFloatable=function(){return!1};CommentModuleEdit.prototype.isMovable=function(){return!1};PollModuleEdit.prototype=new ModuleEdit;
function PollModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.edit_id=a+"_poll";this.resources.poll_question_id=a+"_question";this.resources.poll_closed_id=a+"_closed";this.resources.poll_answers_id=a+"_answers";this.resources.poll_answer_id=a+"_answer_";this.resources.poll_answer_li_id=a+"_answer_li_";this.resources.poll_answer_class=a+"_answer";this.resources.poll_results_id=a+"_poll_results";this.resources.poll_status_id=a+"_status_";this.resources.poll_display_type_id=
a+"_display_type"}PollModuleEdit.prototype.saveContent=function(){};PollModuleEdit.prototype.onEditClose=function(){jq("#"+this.resources.poll_results_id).show();this.data.question=jq("#"+this.resources.poll_question_id).val();this.data.isClosed=jq("#"+this.resources.poll_closed_id+":checked").length;this.data.dispTypeId=jq("#"+this.resources.poll_display_type_id).val();this.keepPollChanges();var a=jq("."+this.resources.poll_answer_class);this.data.answers=this._implode(a,"%*%")};
PollModuleEdit.prototype.onEditOpen=function(){this.state.next_poll_question_id||(this.state.next_poll_question_id=jq("."+this.resources.poll_answer_class).size());jq("#"+this.resources.poll_results_id).hide()};PollModuleEdit.prototype.processSaveResults=function(a,b){this.setClean(a,b);if(!this.data.deleted&&a.responseText){var c=JSONstring.toObject(a.responseText);c.error&&jq("#"+this.resources.poll_results_id).html(c.error)}};
PollModuleEdit.prototype.validateBeforeOpen=function(a){var b=jq("#"+this.data.mod_data_id+"_pollVotes");return null!=b&&(b=b.val(),0<b&&!a&&!confirm("Are you sure that you want to edit this poll? \n\nIf you make changes to the question or answer choices in this capsule, then the "+(1==b?"1 vote that has been counted will be deleted.":b+" votes that have been counted will be deleted.")+" (Merely closing the poll to new votes will NOT delete the votes that have already been counted.)"))?!1:!0};
PollModuleEdit.prototype._implode=function(a,b){var c="";a.each(function(a,e){c+=jq(e).val()+b});""!=c&&(c=c.substring(0,c.length-b.length));return c};PollModuleEdit.prototype.keepPollChanges=function(){elts=jq(".answerLi");elts.each(function(a,b){var c=jq(b).find('input[type="hidden"]');switch(c.val()){case "1":c.val(0);break;case "2":jq(b).remove()}})};
PollModuleEdit.prototype.discardChanges=function(){this.data.discard=!0;elts=jq(".answerLi");elts.each(function(a,b){var c=jq(b).find('input[type="hidden"]');switch(c.val()){case "1":jq(b).remove();break;case "2":jq(b).show(),c.val(0)}})};function pollHandler(a){var b=jq.makeArray(arguments);b.shift();this.deletePollChoice(b[0]);jq(a).stopPropagation()}
PollModuleEdit.prototype.newPollChoice=function(){var a=jq('<li class="answerLi"></li>');a.attr("id",this.resources.poll_answer_li_id+this.state.next_poll_question_id);var b=jq('<a href="#"></a>');b.attr("title","delete this choice");b.attr("x-question-id",this.state.next_poll_question_id);var c=jq("<img/>");c.attr("src","http://x.hubpages.com/x/hubtool_discard_tag.gif");c.attr("alt","delete choice");c.addClass("delete");b.append(c);c=jq('<input type="text"/>');c.addClass("textInput");c.addClass(this.data.id+
"_answer");c.attr("tabIndex",this.state.next_poll_question_id+2);c.attr("id",this.resources.poll_answer_id+this.state.next_poll_question_id);c.attr("name",this.resources.poll_answer_id+this.state.next_poll_question_id);var d=jq('<input type="hidden"></input>');d.val(1);d.attr("id",this.resources.poll_status_id+this.state.next_poll_question_id);d.attr("name",d.id);a.append(c);a.append(d);a.append(b);jq("#"+this.resources.poll_answers_id).append(a);var e=this;b.click(function(){e.deletePollChoice(jq(this).attr("x-question-id"));
return!1});this.state.next_poll_question_id+=1};PollModuleEdit.prototype.deletePollChoice=function(a){var b=jq("#"+this.resources.poll_status_id+a);a=jq("#"+this.resources.poll_answer_li_id+a);1==b.val()?a.remove():(a.hide(),b.val(2))};AmazonModuleEdit.prototype=new ModuleEdit;
function AmazonModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.edit_id=a+"_amazon";this.resources.amazon_numbered_id=a+"_numbered";this.resources.amazon_searchindex_id=a+"_searchIndex";this.resources.amazon_searchtype_id=a+"_searchType";this.resources.amazon_results_id=a+"_amazon_results";this.resources.amazon_asin_input_id=a+"_asin";this.resources.amazon_asin_div_id=a+"_asinDiv";this.resources.amazon_asin_search_div_id=a+"_asinSearchDiv";this.resources.amazon_keyword_search_div_id=
a+"_keywordSearchDiv";this.resources.amazon_description_id=a+"_description";this.resources.amazon_description_div_id=a+"_descriptionDiv";this.resources.amazon_description_link_id=a+"_descriptionLink";this.resources.amazon_searchtype_div_id=a+"_searchTypeDiv";this.resources.amazon_max_display_div_id=a+"_maxDisplayDiv";this.resources.amazon_asin_search_div_id=a+"_asinSearchDiv";this.resources.too_many_products_id=a+"_too_many_products"}
AmazonModuleEdit.prototype.saveContent=function(){jq("#"+this.resources.too_many_products_id).html("");var a=jq("#"+this.resources.amazon_max_display_div_id),b=a.find("select");b.size()&&a.html('<input type="hidden" name="'+b.attr("name")+'" + id="'+b.attr("id")+'" value="1"/>');jq("#"+this.resources.amazon_asin_search_div_id).children("div").each(function(a,b){0!=a&&(jq(b).find("input").val(""),jq(b).find("textarea").val(""),jq(b).hide())})};
AmazonModuleEdit.prototype.onEditClose=function(){0<jq("#"+this.resources.amazon_searchindex_id).length&&(this.data.searchtype=jq("#"+this.resources.amazon_searchtype_id).val(),this.data.searchindex=jq("#"+this.resources.amazon_searchindex_id).val(),this.data.maxitems=jq("#"+this.resources.max_id).val(),this.data.keywords=jq("#"+this.resources.keywords_id).val(),this.data.asins=this.implodeAsins(),this.data.descriptions=this.implodeDescriptions());this.onclickAmazonPreview()};
AmazonModuleEdit.prototype.onEditOpen=function(){this.displayCorrectAmazonType();this.changeNumDisplayedAmazon()};AmazonModuleEdit.prototype.clearAmazonAsin=function(a){jq("#"+this.resources.amazon_asin_input_id+a).val("");jq("#"+this.resources.amazon_description_id+a).val("");jq("#"+this.resources.amazon_description_link_id+a).css("display","inline");jq("#"+this.resources.amazon_description_div_id+a).hide()};
AmazonModuleEdit.prototype.changeNumDisplayedAmazon=function(){var a=jq("#"+this.resources.max_max_id).val(),b=jq("#"+this.resources.max_id).val(),c;for(c=1;c<=a;c+=1)c<=b?jq("#"+this.resources.amazon_asin_div_id+c).show():(jq("#"+this.resources.amazon_asin_div_id+c).hide(),this.clearAmazonAsin(c))};
AmazonModuleEdit.prototype.displayAmazonKeywordUI=function(){jq("#"+this.resources.amazon_searchtype_div_id).hide();jq("#"+this.resources.amazon_asin_search_div_id).hide();jq("#"+this.resources.amazon_keyword_search_div_id).show();jq("#"+this.resources.amazon_max_display_div_id).hide();jq("#"+this.resources.max_id).hide()};
AmazonModuleEdit.prototype.displayAmazonAsinUI=function(){jq("#"+this.resources.amazon_searchtype_div_id).hide();jq("#"+this.resources.amazon_asin_search_div_id).show();jq("#"+this.resources.amazon_keyword_search_div_id).hide();jq("#"+this.resources.amazon_max_display_div_id).show();jq("#"+this.resources.max_id).show()};
AmazonModuleEdit.prototype.displayAmazonUndecidedUI=function(){jq("#"+this.resources.amazon_searchtype_div_id).show();jq("#"+this.resources.amazon_asin_search_div_id).hide();jq("#"+this.resources.amazon_keyword_search_div_id).hide();jq("#"+this.resources.amazon_max_display_div_id).hide()};
AmazonModuleEdit.prototype.displayCorrectAmazonType=function(){var a=this.data.searchtype;"Keyword"==a&&""==this.data.keywords&&(a="Undecided");"Asin"==a&&""==this.data.asins&&(a="Undecided");switch(a){case "Keyword":this.displayAmazonKeywordUI();break;case "Asin":this.displayAmazonAsinUI();break;case "Undecided":this.displayAmazonUndecidedUI()}};
AmazonModuleEdit.prototype.setAmazonSearchType=function(a){jq("#"+this.resources.amazon_searchtype_id).val(a);switch(a){case "Keyword":this.displayAmazonKeywordUI();break;case "Asin":this.displayAmazonAsinUI()}};
AmazonModuleEdit.prototype.amazonStartOver=function(){var a=jq("#"+this.resources.max_max_id).val(),b;for(b=1;b<=a;b+=1)this.clearAmazonAsin(b);jq("#"+this.resources.max_id).val(1);this.changeNumDisplayedAmazon();jq("#"+this.resources.keywords_id).val("");jq("#"+this.resources.amazon_searchindex_id).val("All");jq("#"+this.resources.amazon_results_id).html("");this.displayAmazonUndecidedUI()};
AmazonModuleEdit.prototype.addAmazonDescription=function(a){jq("#"+this.resources.amazon_description_link_id+a).hide();jq("#"+this.resources.amazon_description_div_id+a).show()};AmazonModuleEdit.prototype.getSafeAsin=function(a){a=jq("#"+a).val();return a=a.replace(/\s+/g,"")};
AmazonModuleEdit.prototype.parseAsin=function(a){var b=/amazon/i.test(a);if(b&&/tag=/.test(a)&&!/tag=~~~~AMAZONTEXT~~~~/.test(a))return!1;var c=!1;14===a.length||13===a.length?(pattern=/[0-9]{3}-?[0-9]{10}/,c=!0):pattern=b?/\/[A-Z0-9]{10}/:/^[A-Z0-9]{10}$/;return pattern.test(a)?c?a.match(pattern)[0].replace(/-/g,""):a.match(pattern)[0].replace(/\//g,""):!1};
AmazonModuleEdit.prototype.getSafeDescription=function(a){a=jq("#"+this.resources.amazon_description_id+a).val();return a=a.replace(/%\*%/g,"")};AmazonModuleEdit.prototype.implodeAsins=function(){var a=jq("#"+this.resources.max_max_id).val(),b="",c;for(c=1;c<=a;c+=1){var d=this.getSafeAsin(this.resources.amazon_asin_input_id+c),e=this.parseAsin(d),e=!e&&200<d.length?"Invalid":e?e:d;""!=e&&(jq("#"+this.resources.amazon_asin_input_id+c).val(e),b+=e+"\n")}return b};
AmazonModuleEdit.prototype.implodeDescriptions=function(){if("Keyword"==jq("#"+this.resources.amazon_searchtype_id).val())return"";var a=jq("#"+this.resources.max_id).val(),b="",c;for(c=1;c<=a;c+=1){var d=this.getSafeAsin(this.resources.amazon_asin_input_id+c),b=b+(d+":"+this.getSafeDescription(c));c!=a&&(b+="%*%")}return b};
AmazonModuleEdit.prototype.onclickAmazonPreview=function(){var a=this.implodeAsins(),b=this.implodeDescriptions(),c=0;jq("#"+this.resources.amazon_numbered_id).size()&&(c=jq("#"+this.resources.amazon_numbered_id).val());var a={search:jq("#"+this.resources.keywords_id).val(),maxitems:jq("#"+this.resources.max_id).val(),searchIndex:jq("#"+this.resources.amazon_searchindex_id).val(),searchType:jq("#"+this.resources.amazon_searchtype_id).val(),asins:a,descriptions:b,numbered:c},d=this;jq.post("/xml/amazonresults.php",
a,function(a){jq("#"+d.resources.amazon_results_id).html(a)})};MapModuleEdit.prototype=new ModuleEdit;
function MapModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.data.map_json="";this.state.map_state=null;this.state.map_listeners=[];this.state.map_marker_index=0;this.resources.edit_id=a+"_map";this.resources.map_canvas_id="map_canvas_"+a;this.resources.map_json_id="map_json_"+a;this.resources.map_type_select_id="map_type_select_"+a;this.resources.map_geocode_address_id="geocode_address_"+a;this.resources.map_geocode_search_id="geocode_search_"+a;this.resources.map_geocode_results_id=
"geocode_results_"+a;this.resources.map_markers_reorder_id="map_markers_reorder_"+a;this.resources.map_legend_id="map_legend_"+a;this.resources.map_bounds_id="map_bounds_"+a;this.resources.map_adjusting_id="map_adjusting_"+a}MapModuleEdit.prototype.saveContent=function(){this.updateMapMarkerProperties();this.saveMapState()};MapModuleEdit.prototype.onEditClose=function(){this.removeMapListeners();this.renderMap(!0)};
MapModuleEdit.prototype.onEditOpen=function(){var a=this;this.state.reorder||(jq("#"+this.resources.map_type_select_id).change(function(){a.changeMapType()}),jq("#"+this.resources.map_geocode_search_id).click(function(){a.geocodeSearch()}),jq("#"+this.resources.map_bounds_id).click(function(b){a.updateMapBounds();var d=jq("#"+this.resources.map_adjusting_id);d.show();d.fadeTo(1500,0);b.preventDefault()}),this.loadMapState(),this.state.reorder=new ModuleContentReorder(this.resources.map_markers_reorder_id,
1,150,24),this.state.reorder.setonchangecallback(function(){this.updateMapMarkerProperties();this.renderMap(!0)}.bind(this)));this.state.reorder.removeAll();for(var b=0;b<this.state.map_state.markers.length;b++)this.renderMapMarkerEditor(this.state.map_state.markers[b]);this.renderMap();jq("#"+this.resources.map_type_select_id).val(this.state.map_state.mapType);this.state.map_listeners.push(google.maps.event.addListener(this.getMap(),"zoom_changed",function(){this.state.map_state.zoom=this.getMap().getZoom()}.bind(this)));
this.state.map_listeners.push(google.maps.event.addListener(this.getMap(),"center_changed",function(){var a=this.getMap().getCenter();this.state.map_state.lat=a.lat();this.state.map_state.lng=a.lng()}.bind(this)))};MapModuleEdit.prototype.discardChanges=function(){this.loadMapState()};MapModuleEdit.prototype.getMap=function(){return mm.getMapById(this.data.id).map};
MapModuleEdit.prototype.updateMapMarkerProperties=function(){var a=[];this.state.map_state.markers=[];jq("#"+this.resources.map_markers_reorder_id+" .map_marker_reorder").each(function(){var b=jq(this);a.push([parseInt(b.css("top")),b])});a.sort(function(a,b){return a[0]-b[0]});for(var b=0;b<a.length;b++){elt=a[b][1];var c={lat:elt.find("input[name=lat]").val(),lng:elt.find("input[name=lng]").val(),position:b,name:elt.find("input[name=name]").val(),address:elt.find("input[name=address]").val(),description:elt.find("textarea").val(),
id:elt.find("input[name=id]").val()};this.state.map_state.markers.push(c);elt.find("strong.marker_letter").html(mapLetterFromPosition(b)+".")}};
MapModuleEdit.prototype.geocodeSearch=function(){var a=jq("#"+this.resources.map_geocode_address_id).val().strip();""==a?jq("#"+this.resources.map_geocode_results_id).html("<p>Please type an address to search for.</p>"):(this.state.geocoder||(this.state.geocoder=new google.maps.Geocoder),this.state.geocoder.geocode({address:a},function(b,c){if(c==google.maps.GeocoderStatus.OK){this.state.geocode_results=b;this.state.geocode_search_phrase=a;for(var d="<ol>",e=0;e<b.length;e++)var f=b[e],d=this.state.map_state.markers.length?
d+("<li><strong>"+f.formatted_address+'</strong> - <a href="#" class="add_marker" title="add location to map" onclick="man.getById('+this.data.id+").addMapResultMarker("+e+'); return false;">Pin a marker</a></li>'):d+("<li><strong>"+f.formatted_address+'</strong> - <a href="#" onclick="man.getById('+this.data.id+").addMapResultMarker("+e+'); return false;">Pin a marker</a> or <a href="#" onclick="man.getById('+this.data.id+").mapResult("+e+'); return false;">just go to this location</a>.</li>');jq("#"+
this.resources.map_geocode_results_id).html(d+"</ol>")}else c==google.maps.GeocoderStatus.ZERO_RESULTS?jq("#"+this.resources.map_geocode_results_id).html("<p>No results found for '"+a+"'. Please try again.</p>"):jq("#"+this.resources.map_geocode_results_id).html("<p>Uh oh! There was a problem. Please contact team@hubpages.com for assistance.</p>")}.bind(this)))};
MapModuleEdit.prototype.mapResult=function(a){jq("#"+this.resources.map_geocode_address_id).val("");if(a=this.state.geocode_results[a])this.getMap().setCenter(a.geometry.location),this.getMap().fitBounds(a.geometry.viewport),jq("#"+this.resources.map_geocode_results_id).html("")};
MapModuleEdit.prototype.addMapResultMarker=function(a){jq("#"+this.resources.map_geocode_address_id).val("");if(a=this.state.geocode_results[a]){mm.getMapById(this.data.id);var b=this.state.map_state.markers.length;if(10<=b)alert("Sorry, you can't have more than 10 markers on your map!");else{var c=a.geometry.location,c={name:this.state.geocode_search_phrase,address:a.formatted_address,description:"",lat:c.lat(),lng:c.lng(),id:"new_"+this.data.id+"_"+this.state.map_marker_index++};this.state.map_state.markers.push(c);
this.renderMap(!0);0==b?this.getMap().fitBounds(a.geometry.viewport):this.updateMapBounds();jq("#"+this.resources.map_geocode_results_id).html("");this.renderMapMarkerEditor(c,!0)}}};
MapModuleEdit.prototype.renderMapMarkerEditor=function(a,b){var c=this,d=jq("#"+this.resources.map_markers_reorder_id).children().length,e=jq("<div></div>");e.addClass("map_marker_drag_bar");var f;f='<ul class="map_buttons"><li><a href="#" title="delete" class="marker_delete"><img src="/x/hubtool_discard_tag.gif" alt="delete"/></a></li><li><a href="#" class="marker_edit">edit</a></li>';f+='<li><a href="#" class="marker_done" style="display: none;">done</a></li>';f+="</ul>";f+='<strong class="marker_letter">'+
mapLetterFromPosition(d)+".</strong> ";f+='<span class="marker_name">'+a.name.truncate(60)+"</span>";e.html(f);f=jq("<div></div>");f.addClass("map_marker");f.css("display","none");var g="marker_des_"+a.id,j="marker_chars_"+a.id,h="charCounter('"+g+"','"+j+"',150);",l;l="<label>Location name:</label><br/>"+('<input type="text" name="name" maxlength="100" value="'+a.name+'"/><br/>');l=l+"<label>Address:</label><br/>"+('<input type="text" name="address" maxlength="100" value="'+a.address+'"/><br/>');
l+="<label>Description:</label><br/>";l+='<textarea name="description" id="'+g+'" onkeyup="'+h+'" onkeydown="'+h+'" onchange="'+h+'">'+a.description+"</textarea>";l+='<input type="text" id="'+j+'" class="chars_left" value="'+(150-a.description.length)+'" /> characters left';l+="<p>The location name will be displayed when a user's mouse hovers over the marker. When clicked, the full description will be displayed.</p>";l+='<input name="id" type="hidden" value="'+a.id+'"/>';l+='<input name="lat" type="hidden" value="'+
a.lat+'"/>';l+='<input name="lng" type="hidden" value="'+a.lng+'"/>';f.html(l);g=jq("<div></div>");g.attr("id","map_marker_reorder_"+a.id);g.addClass("map_marker_reorder");g.append(e);g.append(f);g.click(function(){});0==d&&jq("#"+this.resources.map_edit_id+" .map_marker_present").show();1==d&&jq("#"+this.resources.map_edit_id+" .multiple_map_markers").show();jq("#"+this.resources.map_markers_reorder_id).append(g);g=new ModuleContentReorderItem(g.attr("id"),a.id,this.state.reorder);this.state.reorder.add(g);
this.state.reorder.relayout();f.find("input").keyup(function(a){a=jq(a.target).closest("input");a.parents(".map_marker_reorder").find(".map_marker_drag_bar").find(".marker_name").html(a.val().truncate(60))});e.find("a.marker_delete").click(function(a){var b=jq(a.target).closest("a"),e=b.parents(".map_marker_reorder");e.find(".map_marker").is(":visible")&&(b=b.parents(".map_buttons").find(".marker_done"),c.doneEditingMarker(b));for(var b=this.state.reorder.getitemstate(),f=d=0;f<b.length;f++)if("map_marker_reorder_"+
b[f].id==e[0].id){d=b[f].position;break}e=this.state.map_state.markers.splice(d,1);this.state.reorder.remove(e[0].id);for(f=d+1;f<b.length;f++)e=jq("#map_marker_reorder_"+b[f].id),e.css({top:parseInt(e.css("top"),10)-this.state.reorder.options.ele_space_per_v}),e.find(".marker_letter").html(mapLetterFromPosition(f-1)+".");this.renderMap(!0);this.updateMapBounds();0==this.state.map_state.markers.length&&jq("#"+this.resources.map_edit_id+" .map_marker_present").hide();2>this.state.map_state.markers.length&&
jq("#"+this.resources.map_edit_id+" .multiple_map_markers").hide();a.preventDefault()}.bind(this));e.find("a.marker_edit").click(function(a){var b=jq(a.target).closest("a");this.editMapMarker(b);a.preventDefault()}.bind(this));e.find("a.marker_done").click(function(a){var b=jq(a.target).closest("a"),d=b.parents(".map_marker_reorder"),e=d.find("input[name=name]");if(""==e.val().strip()){var f=d.previousSiblings().size(),f=c.state.map_state.markers[f].name;e.val(f);d.find(".marker_name").html(f.truncate(60))}this.updateMapMarkerProperties();
this.renderMap();this.doneEditingMarker(b);this.state.reorder.enable();jQuery(".map_marker_drag_bar").each(function(){this.setStyle({cursor:"move"})});a.preventDefault()}.bind(this));b&&this.editMapMarker(e.find("a.marker_edit"))};
MapModuleEdit.prototype.editMapMarker=function(a){var b=a.parents("li"),c=b.parents(".map_marker_drag_bar"),d=c.parents(".map_marker_reorder"),e=c.next();d.siblings().each(function(a,b){var c=jq(b).find(".marker_done:visible");c.length&&this.doneEditingMarker(c)}.bind(this));var f=[];jq("#"+this.resources.map_markers_reorder_id+" .map_marker_reorder").each(function(){var a=jq(this);f.push([parseInt(a.css("top")),a])});f.sort(function(a,b){return a[0]-b[0]});for(var c=c.outerHeight(),g=e.outerHeight(),
j=!1,h=100,l=0;l<f.length;l++)j?(h=parseInt(f[l][1].css("top"),10)+g+10,f[l][1].css("top",h),h+=c):(f[l][1].is(d)&&(j=!0),h=parseInt(f[l][1].css("top"),10)+c+g);jq("#"+this.resources.map_markers_reorder_id).height(h);a.hide();b.next().find(".marker_done").show();e.show();this.state.reorder.disable();jQuery(".map_marker_drag_bar").each(function(){this.setStyle({cursor:"default"})})};
MapModuleEdit.prototype.doneEditingMarker=function(a){a.hide();a.parents("li").prev().find(".marker_edit").show();a.parents(".map_marker_drag_bar").next().hide();this.state.reorder.relayout()};
MapModuleEdit.prototype.updateMapBounds=function(){var a=this.state.map_state.markers;if(0!=a.length)if(1==a.length)this.getMap().setCenter(new google.maps.LatLng(a[0].lat,a[0].lng));else{var b,c,d,e;b=1*a[0].lat;d=1*a[1].lat;b<d?(c=b,b=d):c=d;e=1*a[0].lng;var f=1*a[1].lng;e>f&&180>=e-f||e<f&&180<=f-e?(d=e,e=f):d=f;c=new google.maps.LatLng(c,e);b=new google.maps.LatLng(b,d);c=new google.maps.LatLngBounds(c,b);for(b=2;b<a.length;b++)c.extend(new google.maps.LatLng(a[b].lat,a[b].lng));this.getMap().fitBounds(c)}};
MapModuleEdit.prototype.mapResized=function(){google.maps.event.trigger(mm.getMapById(this.data.id).map,"resize");this.renderMap()};MapModuleEdit.prototype.changeMapType=function(){this.state.map_state.mapType=jq("#"+this.resources.map_type_select_id).val();this.getMap().setMapTypeId(google.maps.MapTypeId[this.state.map_state.mapType])};
MapModuleEdit.prototype.renderMap=function(a){this.state.map_state||this.loadMapState();var b=Object.clone(this.state.map_state);b.hubtool=!0;renderMapFromData(this.data.id,b,a)};MapModuleEdit.prototype.removeMapListeners=function(){for(var a=0;a<this.state.map_listeners.length;a++)google.maps.event.removeListener(this.state.map_listeners[a]);this.state.map_listeners=[]};MapModuleEdit.prototype.loadMapState=function(){this.state.map_state=JSONstring.toObject(jq("#"+this.resources.map_json_id).html())};
MapModuleEdit.prototype.saveMapState=function(){this.data.map_json=JSONstring.make(this.state.map_state);jq("#"+this.resources.map_json_id).html(this.data.map_json)};CookTimeModuleEdit.prototype=new ModuleEdit;
function CookTimeModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.cooktime_times_id=a+"_cooktime_times";this.resources.cooktime_form_id="cooktime_form";this.resources.cooktime_errors="cooktime_errors";this.resources.edit_id="cooktime_"+a;this.resources.cooktime_edit_id="cooktime_"+a;this.resources.cooktime_preptime_hr_id="preptime_hr_"+a;this.resources.cooktime_preptime_mn_id="preptime_mn_"+a;this.resources.cooktime_cooktime_hr_id="cooktime_hr_"+a;this.resources.cooktime_cooktime_mn_id=
"cooktime_mn_"+a;this.resources.cooktime_amount_id="yield_"+a}CookTimeModuleEdit.prototype.saveContent=function(){};CookTimeModuleEdit.prototype.validateOnSave=function(){return jq("#"+this.resources.cooktime_form_id).valid()};
CookTimeModuleEdit.prototype.onToggle=function(){this.data.preptime_hr=jq("#"+this.resources.cooktime_preptime_hr_id).val();this.data.preptime_mn=jq("#"+this.resources.cooktime_preptime_mn_id).val();this.data.cooktime_hr=jq("#"+this.resources.cooktime_cooktime_hr_id).val();this.data.cooktime_mn=jq("#"+this.resources.cooktime_cooktime_mn_id).val();this.data.cooks_amount=jq("#"+this.resources.cooktime_amount_id).val()};CookTimeModuleEdit.prototype.onEditClose=function(){jq("#"+this.resources.cooktime_times_id).show()};
CookTimeModuleEdit.prototype.onEditOpen=function(){jq("#"+this.resources.cooktime_times_id).hide()};CookTimeModuleEdit.prototype.processSaveResults=function(a,b){this.setClean(a,b);if(!this.data.deleted&&a.responseText){var c=JSONstring.toObject(a.responseText);c.error&&jq("#"+this.resources.cooktime_times_id).html(c.error)}updateHubtoolWarningsAndProgress();checkRestrictiveFilters()};CookTimeModuleEdit.prototype.discardChanges=function(){jq("#"+this.resources.cooktime_errors).hide();jq("input.error").removeClass("error")};
NutritionModuleEdit.prototype=new ModuleEdit;
function NutritionModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.nutrition_id=a+"_nutrition";this.resources.nutrition_form_id="nutrition_form";this.resources.edit_id="nutrition_"+a;this.resources.nutrition_edit_id="nutrition_"+a;this.resources.nutrition_serving_size_id="serving_size_"+a;this.resources.nutrition_calories_id="calories_"+a;this.resources.nutrition_fat_id="fat_"+a;this.resources.nutrition_saturated_fat_id="saturated_fat_"+a;this.resources.nutrition_unsaturated_fat_id=
"unsaturated_fat_"+a;this.resources.nutrition_carbohydrates_id="carbohydrates_"+a;this.resources.nutrition_sugar_id="sugar_"+a;this.resources.nutrition_fiber_id="fiber_"+a;this.resources.nutrition_protein_id="protein_"+a;this.resources.nutrition_cholesterol_id="cholesterol_"+a;this.resources.nutrition_sodium_id="sodium_"+a}NutritionModuleEdit.prototype.saveContent=function(){};NutritionModuleEdit.prototype.validateOnSave=function(){return jq("#"+this.resources.nutrition_form_id).valid()};
NutritionModuleEdit.prototype.onToggle=function(){this.data.nut_serving_size=jq("#"+this.resources.nutrition_serving_size_id).val();this.data.nut_calories=jq("#"+this.resources.nutrition_calories_id).val();this.data.nut_fat=jq("#"+this.resources.nutrition_fat_id).val();this.data.nut_saturated_fat=jq("#"+this.resources.nutrition_saturated_fat_id).val();this.data.nut_unsaturated_fat=jq("#"+this.resources.nutrition_unsaturated_fat_id).val();this.data.nut_carbohydrates=jq("#"+this.resources.nutrition_carbohydrates_id).val();
this.data.nut_sugar=jq("#"+this.resources.nutrition_sugar_id).val();this.data.nut_fiber=jq("#"+this.resources.nutrition_fiber_id).val();this.data.nut_protein=jq("#"+this.resources.nutrition_protein_id).val();this.data.nut_cholesterol=jq("#"+this.resources.nutrition_cholesterol_id).val();this.data.nut_sodium=jq("#"+this.resources.nutrition_sodium_id).val()};NutritionModuleEdit.prototype.onEditClose=function(){jq("#"+this.resources.nutrition_id).show()};
NutritionModuleEdit.prototype.onEditOpen=function(){jq("#"+this.resources.nutrition_id).hide();jq("#"+this.resources.nutrition_form_id).valid()};NutritionModuleEdit.prototype.processSaveResults=function(a,b){this.setClean(a,b);if(!this.data.deleted&&a.responseText){var c=JSONstring.toObject(a.responseText);c.error&&jq("#"+this.resources.nutrition_id).html(c.error)}updateHubtoolWarningsAndProgress();checkRestrictiveFilters()};IngredientsModuleEdit.prototype=new ModuleEdit;
function IngredientsModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.ingredients_id=a+"_ingredients";this.resources.ingredient_class=a+"_ingredient";this.resources.ingredient_id="row_ingredient_";this.resources.ingredient_id_select="ingredient_"+a;this.resources.ingredient_form_id="form_ingredients";this.resources.ingredient_errors_id="ingredient_errors";this.resources.ingredient_status_id=a+"_status_";this.resources.edit_id="ingredients_"+a;this.resources.ingredients_edit_id=
"ingredients_"+a}IngredientsModuleEdit.prototype.saveContent=function(){};IngredientsModuleEdit.prototype.onEditClose=function(){jq("#"+this.resources.ingredient_form_id+" input.inputError").removeClass("inputError");jq("#"+this.resources.ingredient_errors_id).text("");jq("#"+this.resources.ingredients_id).show();this.data.ingredients=JSONstring.make(this.getIngredients())};IngredientsModuleEdit.prototype.onEditOpen=function(){jq("#"+this.resources.ingredients_id).hide()};
IngredientsModuleEdit.prototype.validateOnSave=function(){var a=this.getIngredients(),b=!0,c=null;if(0<a.length)for(var d=0;d<a.length;d++)c=jq("#"+a[d].id),""==a[d].ingredient&&(c.addClass("inputError"),b=!1);a=jq("#"+this.resources.ingredient_form_id+" input.inputError");b?(jq("#"+this.resources.ingredient_errors_id).text(""),a.each(function(){jq(this).removeClass("inputError")})):(jq("#"+this.resources.ingredient_errors_id).text("Before saving the capsule you need to enter an ingredient in the highlighted fields:"),
a.each(function(){""!=jq.trim(jq(this).val())&&jq(this).removeClass("inputError")}),jq("#"+this.resources.ingredient_form_id+" input.inputError").eq(0).focus());b&&(a=jq("."+this.resources.ingredient_class),jq.each(a,function(){jq(this).find('input[type="hidden"]').val("0")}));return b};
IngredientsModuleEdit.prototype.processSaveResults=function(a,b){this.setClean(a,b);if(!this.data.deleted&&a.responseText){var c=JSONstring.toObject(a.responseText);c.error&&jq("#"+this.resources.ingredients_id).html(c.error)}updateHubtoolWarningsAndProgress();checkRestrictiveFilters()};
IngredientsModuleEdit.prototype.getIngredients=function(){var a=[],b="",c=0,d={},e=!0,f=jq("."+this.resources.ingredient_class),g="";jq.each(f,function(){d={};e=!0;g=jq(this).find('input[type="hidden"]');rowFields=jq(this).find("input.txtInput");"2"!=g.val()?(jq.each(rowFields,function(){""!=jq.trim(jq(this).val())&&(e=!1);c=jq(this).attr("id");b=c.match(/^[a-z]+/);d[b]=jq(this).val();"ingredient"==b&&(d.id=c)}),e||a.push(d)):jq(this).remove()});return a};
IngredientsModuleEdit.prototype.newIngredient=function(){var a=jq("#"+this.resources.ingredients_edit_id+" table"),b=parseInt(jq("#"+this.resources.ingredients_edit_id+" table tr:last").attr("id").replace("row_ingredient_",""))+1,c=jq("<tr/>").attr("id",this.resources.ingredient_id+b).attr("class",this.resources.ingredient_class),d,e;jq.each(jq("#"+this.resources.ingredients_edit_id+" table tr:last td input"),function(){d=jq(this).clone();d.removeClass("inputError");e=jq("<td/>");d.attr("value","");
d.attr("id",jq(this).attr("id").replace(/[0-9]$/,b));d.attr("name",jq(this).attr("name").replace(/[0-9]$/,b));d.attr("tabindex",parseInt(jq(this).attr("tabindex")));d.appendTo(e);e.appendTo(c)});var f=jq("<a/>");f.attr("href","#");f.attr("title","delete this ingredient");var g=jq("<img/>");g.attr("src","/x/hubtool_discard_tag.gif");g.addClass("delete");g.attr("alt","delete this ingredient");e=jq("<td/>");f.html(g);var j=this;f.bind("click",function(a){a.preventDefault();j.deleteIngredient(b)});g=
jq("<input/>");g.attr("type","hidden");g.val("1");g.attr("id",this.resources.ingredient_status_id+b);g.attr("name",this.resources.ingredient_status_id+b);f.appendTo(e);g.appendTo(c);e.appendTo(c);c.appendTo(a);jq("#add_ingredient").appendTo("#"+this.resources.ingredient_form_id)};IngredientsModuleEdit.prototype.deleteIngredient=function(a){var b=jq("#"+this.resources.ingredient_id+a);a=jq("#"+this.resources.ingredient_status_id+a);1===parseInt(a.val())?b.remove():(b.hide(),a.val("2"))};
IngredientsModuleEdit.prototype.discardChanges=function(){this.data.discard=!0;var a=jq("."+this.resources.ingredient_class);jq.each(a,function(){switch(jq(this).children("input").val()){case "1":jq(this).remove();break;case "2":jq(this).show(),jq(this).val("0")}})};InstructionsModuleEdit.prototype=new ModuleEdit;
function InstructionsModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.instructions_id=a+"_instructions";this.resources.instruction_class=a+"_instruction";this.resources.instruction_id="row_instruction_";this.resources.instruction_form_id="instructions_form";this.resources.instruction_status_id=a+"_status_";this.resources.instruction_errors="instruction_errors";this.resources.edit_id="instructions_"+a;this.resources.instructions_edit_id="instructions_"+a}
InstructionsModuleEdit.prototype.saveContent=function(){};InstructionsModuleEdit.prototype.onEditClose=function(){jq("#"+this.resources.instructions_id).show()};InstructionsModuleEdit.prototype.onEditOpen=function(){jq("#"+this.resources.instructions_id).hide()};
InstructionsModuleEdit.prototype.validateOnSave=function(){var a=jq("#"+this.resources.instruction_form_id).valid();if(a){this.data.instructions=JSONstring.make(this.getInstructions());var b=jq("."+this.resources.instruction_class);jq.each(b,function(){jq(this).children("input[type=hidden]").val("0")})}return a};
InstructionsModuleEdit.prototype.processSaveResults=function(a,b){this.setClean(a,b);if(!this.data.deleted&&a.responseText){var c=JSONstring.toObject(a.responseText);c.error&&jq("#"+this.resources.instructions_id).html(c.error)}updateHubtoolWarningsAndProgress();checkRestrictiveFilters()};
InstructionsModuleEdit.prototype.getInstructions=function(){var a=[],b=jq("."+this.resources.instruction_class),c="";jq.each(b,function(){c=jq(this).find("input[type=hidden]").val();"2"!=c?jq.each(jq(this).find("textarea"),function(){""!=jq.trim(jq(this).val())&&a.push(jq.trim(jq(this).val()))}):jq(this).remove()});return a};
InstructionsModuleEdit.prototype.newInstruction=function(){var a=jq("#"+this.resources.instructions_edit_id+" ol"),b=parseInt(jq("#"+this.resources.instructions_edit_id+" ol li:last").attr("id").replace("row_instruction_",""))+1,c=jq("<li/>").attr("id",this.resources.instruction_id+b).attr("class",this.resources.instruction_class),d;jq.each(jq("#"+this.resources.instructions_edit_id+" ol li:last textarea"),function(){d=jq(this).clone();d.attr("value","");d.attr("id",jq(this).attr("id").replace(/[0-9]$/,
b));d.attr("name",jq(this).attr("name").replace(/[0-9]$/,b));d.attr("tabindex",parseInt(jq(this).attr("tabindex"))+3);d.appendTo(c)});var e=jq("<a/>");e.attr("href","#");e.attr("title","delete this instruction");var f=jq("<img/>");f.attr("src","/x/hubtool_discard_tag.gif");f.addClass("delete");f.attr("alt","delete this instruction");e.html(f);f=jq("<input/>");f.attr("type","hidden");f.val("1");f.attr("id",this.resources.instruction_status_id+b);f.attr("name",this.resources.instruction_status_id+b);
var g=this;e.bind("click",function(a){a.preventDefault();g.deleteInstruction(b)});f.appendTo(c);e.appendTo(c);c.appendTo(a);jq("#add_instruction").appendTo("#"+this.resources.instruction_form_id);loadInstructionValidations()};function loadInstructionValidations(){jq("#instructions_form").find("ol textarea").each(function(a,b){jq(b).rules("add",{maxlength:1E3,messages:{maxlength:"Your instruction is too large.  Please make it shorter."}})})}
InstructionsModuleEdit.prototype.deleteInstruction=function(a){var b=jq("#"+this.resources.instruction_id+a);a=jq("#"+this.resources.instruction_status_id+a);1===parseInt(a.val())?b.remove():(b.hide(),a.val("2"))};InstructionsModuleEdit.prototype.discardChanges=function(){this.data.discard=!0;var a=jq("."+this.resources.instruction_class);jq.each(a,function(){switch(jq(this).children("input").val()){case "1":jq(this).remove();break;case "2":jq(this).show(),jq(this).val("0")}});jq("#"+this.resources.instruction_errors).hide()};
RatingModuleEdit.prototype=new ModuleEdit;
function RatingModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.edit_id=a+"_rating";this.resources.rating_results_id=a+"_rating_results";this.resources.rating_ratingtype_id=a+"_ratingType";this.resources.rating_totalratings_id=a+"_totalRatings";this.resources.rating_description_id="rating_description";this.resources.rating_single_id="single_rating";this.resources.rating_multiple_id="multiple_rating";this.resources.rating_recipe_id="recipe_rating";this.resources.rating_single_subject_id=
a+"_single_subject";this.resources.rating_multiple_subject_id=a+"_multiple_subject";this.resources.rating_recipe_subject_id=a+"_recipe_subject";this.state.delete_confirm_text="Are you sure you want to delete this Capsule? Doing so will remove the special review or recipe format your Hub is given in search engine results.";this.resources.change_confirm_text="Are you sure that you want to proceed? If you make changes to this capsule, any ratings that have been submitted will be deleted. Ratings will not be deleted if you only change the Capsule subtitle.";
this.resources.rating_form_class="rating";this.resources.rating_single_form_class="single_rating";this.resources.rating_preview_id="preview_rating";this.resources.single_rating_object=null;this.resources.is_closed=!0}RatingModuleEdit.prototype.saveContent=function(){"Single"==jq("#"+this.resources.rating_ratingtype_id).val()&&jq("#hubtool_messages p").remove()};
RatingModuleEdit.prototype.validateBeforeOpen=function(a){var b=0<jq(".ratingTotals span[itemprop=votes]").length?parseInt(jq(".ratingTotals span[itemprop=votes]").text()):0,c=jq("#"+this.resources.rating_ratingtype_id).val();return!a&&0<b&&"Single"!=c&&!confirm(this.resources.change_confirm_text)?!1:!0};RatingModuleEdit.prototype.discardChanges=function(){};
RatingModuleEdit.prototype.onEditClose=function(){this.resources.is_closed=!0;jq(".moduleRating").find("#"+this.resources.rating_results_id).show();jq("#"+this.resources.rating_preview_id).hide();this.data.ratingtype=jq("#"+this.resources.rating_ratingtype_id).val();switch(this.data.ratingtype){case "Single":this.data.subject=jq("#"+this.resources.rating_single_subject_id).val();this.data.star_rating=this.getCurrentSingleRating();break;case "Multiple":this.data.subject=jq("#"+this.resources.rating_multiple_subject_id).val();
break;case "Recipe":this.data.subject=jq("#"+this.resources.rating_recipe_subject_id).val()}};
RatingModuleEdit.prototype.onEditOpen=function(){this.resources.is_closed=!1;jq(".moduleRating").find("#"+this.resources.rating_results_id).hide();jq("#"+this.resources.rating_ratingtype_id).hide();jq("#"+this.resources.rating_totalratings_id).hide();this.data.ratingtype=jq("#"+this.resources.rating_ratingtype_id).val();this.data.star_rating=void 0;"Single"===this.data.ratingtype&&(this.data.star_rating=this.getCurrentSingleRating());this.displayCorrectRatingType()};
RatingModuleEdit.prototype.displayCorrectRatingType=function(){var a=this.data.ratingtype;"Single"==a?""==this.data.star_rating&&""==this.data.subject&&(a="Undecided"):"New"==this.data.ratingtype&&(a="Undecided");switch(a){case "Single":this.displaySingleRatingUI();break;case "Multiple":this.displayMultipleRatingUI();break;case "Recipe":this.displayRecipeRatingUI();break;case "Undecided":this.displayRatingUndecidedUI()}};
RatingModuleEdit.prototype.setRatingType=function(a){jq("#"+this.resources.rating_ratingtype_id).val(a);jq("#"+this.resources.rating_description_id).hide();switch(a){case "Single":this.displaySingleRatingUI();break;case "Multiple":this.displayMultipleRatingUI();break;case "Recipe":this.displayRecipeRatingUI()}};
RatingModuleEdit.prototype.displaySingleRatingUI=function(){jq("#"+this.resources.rating_single_id).show();jq("#"+this.resources.rating_description_id).hide();jq("#"+this.resources.rating_multiple_id).hide();jq("#"+this.resources.rating_recipe_id).hide()};RatingModuleEdit.prototype.displayMultipleRatingUI=function(){jq("#"+this.resources.rating_multiple_id).show();jq("#"+this.resources.rating_description_id).hide();jq("#"+this.resources.rating_single_id).hide();jq("#"+this.resources.rating_recipe_id).hide()};
RatingModuleEdit.prototype.displayRecipeRatingUI=function(){jq("#"+this.resources.rating_recipe_id).show();jq("#"+this.resources.rating_description_id).hide();jq("#"+this.resources.rating_multiple_id).hide();jq("#"+this.resources.rating_single_id).hide()};RatingModuleEdit.prototype.displayRatingUndecidedUI=function(){jq("#"+this.resources.rating_description_id).show();jq("#"+this.resources.rating_single_id).hide();jq("#"+this.resources.rating_multiple_id).hide();jq("#"+this.resources.rating_recipe_id).hide()};
RatingModuleEdit.prototype.ratingStartOver=function(){jq("#"+this.resources.rating_single_subject_id).val("");jq("#"+this.resources.rating_multiple_subject_id).val("");jq("#"+this.resources.rating_recipe_subject_id).val("");jq("#"+this.resources.rating_preview_id).html("");jq("#"+this.resources.rating_ratingtype_id).val("");this.data.star_rating="";this.displayRatingUndecidedUI()};
RatingModuleEdit.prototype.previewRatings=function(){var a=jq("input[id*=ratingType]").val(),b="input[id*="+(a.toLowerCase()+"_subject")+"]",b=jq(b).val();this.data.star_rating="Single"==a?this.getCurrentSingleRating():this.data.star_rating;if("Single"==a&&void 0===this.data.star_rating)jq("#preview_rating").html("You need to cast your vote.").show();else if(""==b)jq("#preview_rating").html("You need to specify a subject.").show();else{var c=this;jq.ajax({type:"POST",url:"/xml/preview_ratings.php",
data:{id:this.data.id,subject:b,type:a,rating:this.data.star_rating},success:function(a){jq("#"+c.resources.rating_preview_id).html(a).show()}})}};
RatingModuleEdit.prototype.processSaveResults=function(a,b){this.setClean(a,b);if(!this.data.deleted&&a.responseText){var c=JSONstring.toObject(a.responseText);c.error&&jq(".moduleRating").find("#"+this.resources.rating_results_id).html(c.error);"Single"==this.data.ratingtype?loadRatingSystem(!0,this.data.ratingtype,this.resources.rating_totalratings_id,this.data.id):loadRatingSystem(!1,this.data.ratingtype,this.resources.rating_totalratings_id,this.data.id)}updateHubtoolWarningsAndProgress();checkRestrictiveFilters()};
RatingModuleEdit.prototype.loadSingleRatingSystem=function(a,b){var c=this;jq("form."+b).starrating({isStatic:!0,success:function(a){c.data.star_rating=parseInt(a)},disabled:a,ratingClass:b})};RatingModuleEdit.prototype.getCurrentSingleRating=function(){var a;if(jq("."+this.resources.rating_single_form_class)){var b=jq(".single_rating").find("div.on:last a");void 0!=b.attr("href")&&(a=b.attr("href").split("#")[1])}return a};CalloutModuleEdit.prototype=new ModuleEdit;
function CalloutModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.callout_id=a+"_callout";this.resources.callout_type_id=a+"_callout_type";this.resources.callout_text_id=a+"_calloutText";this.resources.callout_text_counter_id="calloutsize_numcharsvalue_"+a;this.resources.callout_max_size_id=a+"_callout_max_size";this.resources.callout_quote_name_id=a+"_quoteName";this.resources.callout_quote_wrap_id=a+"_quoteWrap";this.resources.edit_id="callout_"+a;this.resources.callout_edit_id=
"callout_"+a}CalloutModuleEdit.prototype.discardChanges=function(){jq("#"+this.resources.callout_text_id).val(this.data.callout_text)};CalloutModuleEdit.prototype.saveContent=function(){};CalloutModuleEdit.prototype.validateOnSave=function(){return!0};CalloutModuleEdit.prototype.onToggle=function(){this.data.callout_type=jq("#"+this.resources.callout_type_id).val();this.data.callout_text=jq("#"+this.resources.callout_text_id).val();this.data.callout_quote_name=jq("#"+this.resources.callout_quote_name_id).val()};
CalloutModuleEdit.prototype.onEditClose=function(){jq("#"+this.resources.callout_id).show()};CalloutModuleEdit.prototype.onEditOpen=function(){jq("#"+this.resources.callout_id).hide();checkCharCount(jq("#"+this.resources.callout_max_size_id).val(),this.resources.callout_text_id,this.resources.callout_text_counter_id,!1)};CalloutModuleEdit.prototype.isFloatable=function(){return!1};CalloutModuleEdit.prototype.processSaveResults=function(a,b){this.setClean(a,b);updateHubtoolWarningsAndProgress();checkRestrictiveFilters()};
CalloutModuleEdit.prototype.changeCalloutType=function(){switch(jq("#"+this.resources.callout_type_id).val()){case "3":jq("#"+this.resources.callout_quote_wrap_id).css("display","");break;default:jq("#"+this.resources.callout_quote_wrap_id).css("display","none"),jq("#"+this.resources.callout_quote_name_id).val("")}};QuizModuleEdit.prototype=new ModuleEdit;
function QuizModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.edit_id=a+"_quiz";this.resources.quiz_view_id=a+"_quiz";this.resources.quiz_rendered_id="rendered_quiz_"+a;this.resources.quiz_results_id="results_"+a;this.resources.quiz_question_drag_area_id="question_drag_"+a;this.resources.quiz_edit_id="edit_quiz_"+a;this.resources.quiz_json_id="quiz_json_"+a;this.resources.quiz_result_add_input_id="question_add_result_"+a;this.resources.quiz_question_add_input_id="question_add_input_"+
a;this.resources.quiz_type_name_id="quiz_type_"+a;this.resources.quiz_type_form_id="quiz_type_form"+a;this.resources.quiz_result_sentence_id="quiz_result_sentence_"+a;this.resources.quiz_edit_question_id=a+"_edit_question_";this.resources.quiz_done_question_id=a+"_done_question_";this.resources.quiz_edit_result_id=a+"_edit_result_";this.resources.quiz_done_result_id=a+"_done_result_";this.resources.quiz_question_span_id=a+"_question_span_";this.resources.quiz_value_id=a+"_value_";this.resources.quiz_value_label_id=
a+"_value_label_";this.resources.quiz_question_id=a+"_question_";this.resources.quiz_answer_id=a+"_answer_";this.resources.quiz_answer_list_id=a+"_answer_list_";this.resources.quiz_answer_li_id=a+"_answer_item_";this.resources.quiz_answer_area_id=a+"_answer_area_";this.resources.quiz_result_id=a+"_result_";this.resources.quiz_result_values_id=a+"_result_values_";this.resources.quiz_result_area_id=a+"_result_area_";this.resources.quiz_result_description_id=a+"_result_description_";this.resources.quiz_result_span_id=
a+"_result_span_";this.resources.quiz_result_name_id=a+"_result_name_";this.resources.quiz_question_input_id=a+"_question_input_"}
QuizModuleEdit.prototype.onEditOpen=function(){$(this.resources.content_id).hide();this.state.questions_removed=[];this.state.quiz=JSONstring.toObject($(this.resources.quiz_json_id).innerHTML);this.quizBuildInterface();$(this.resources.quiz_question_drag_area_id)&&!this.state.reorder&&this.quizCreateContentReorder();var a=[];$H(this.state.quiz.questions).values().each(function(b){a[b.position]=b});a.each(function(a){if(a.id){this.quizBuildQuestion(a.question,a.id);var c=0;$H(a.answers).values().each(function(d){"undefined"!=
typeof d.id&&(c++,d.id&&this.quizBuildAnswerChoice(a.id,d.id,2<c,d.value,d.answer,d.resultValues))}.bind(this))}}.bind(this))};QuizModuleEdit.prototype.onEditClose=function(){$(this.resources.content_id).show();$(this.resources.quiz_edit_id).innerHTML="";delete this.state.reorder};
QuizModuleEdit.prototype.saveContent=function(){if(this.data.dirty&&0<this.state.quiz.quizTypeId){this.state.select_id&&this.toggleAnswersForQuizQuestion(null,this.state.select_id,0);this.state.select_result_id&&this.toggleQuizResult(null,this.state.select_result_id,0);this.state.reorder.getitemstate().each(function(a){this.state.quiz.questions[a.id].position=a.position}.bind(this));this.state.questions_removed.each(function(a){this.state.quiz.questions[a].position=-1}.bind(this));var a=this.state.quiz.quizTypeId;
if(1==a||2==a){this.state.quiz.resultSentence=$F(this.resources.quiz_result_sentence_id);var b=$A(),c=$A();$H(this.state.quiz.questions).values().each(function(a){a.id&&-1!=a.position&&(a=$H(a.answers).values(),minQuestionScore=9999,a.each(function(a){a.id&&!a.isDeleted&&(minQuestionScore=Math.min(minQuestionScore,a.value))}),maxQuestionScore=-9999,a.each(function(a){a.id&&!a.isDeleted&&(maxQuestionScore=Math.max(maxQuestionScore,a.value))}),b.push(minQuestionScore),c.push(maxQuestionScore))});var d=
b.inject(0,function(a,b){return a+ +b}),e=c.inject(0,function(a,b){return a+ +b});this.state.quiz.minimumScore=d;this.state.quiz.maximumScore=e;var f=e-d,a=$H(this.state.quiz.results).values();i=0;var g=d;a.each(function(a){if(a.id){var b=this.state.quiz_score_ranges[i],b=100==b?e:Math.floor(b*f/100+d);this.state.quiz.results[a.id]={id:a.id,minimumValue:g,maximumValue:b,description:$F(this.resources.quiz_result_description_id+a.id),result:"",isDeleted:a.isDeleted};g=b;i++}}.bind(this))}this.data.quiz_json=
JSONstring.make(this.state.quiz);$(this.resources.quiz_json_id).innerHTML=this.data.quiz_json}};
QuizModuleEdit.prototype._renderQuiz=function(){if($(this.resources.quiz_json_id)){this.state.quiz=JSONstring.toObject($(this.resources.quiz_json_id).innerHTML);var a=$(this.resources.quiz_rendered_id);a.innerHTML="";if(0!=this.state.quiz.quizTypeId)if(this.state.quiz.error)a.innerHTML='<p class="error">'+this.state.quiz.error+" No one will be able to take your quiz until you fix the problem.</p>";else{var b=0,c=$H(this.state.quiz.questions).values();this.state.floatright?(c.each(function(a){if(a.id){var c=
Math.ceil(a.question.length/22)+2;$H(a.answers).values().each(function(a){a.id&&(c+=1+Math.ceil(a.answer.length/25))});c>b&&(b=c)}}),c=9+b,1==this.state.quiz.quizTypeId&&(c+=3)):(c.each(function(a){if(a.id){var c=Math.ceil(a.question.length/75)+2;$H(a.answers).values().each(function(a){a.id&&(c+=1+Math.ceil(a.answer.length/75))});c>b&&(b=c)}}),c=9+b,1==this.state.quiz.quizTypeId&&(c+=2));var d=0,e=$H(this.state.quiz.results).values();this.state.floatright?(e.each(function(a){a.id&&(a=Math.ceil(a.description.length/
32),a>d&&(d=a))}),e=Math.ceil(1.6*(this.state.quiz.resultSentence.length/17)),e=d+e+13,1==this.state.quiz.quizTypeId&&(e+=3)):(e.each(function(a){a.id&&(a=Math.ceil(a.description.length/75),a>d&&(d=a))}),e=Math.ceil(1.6*(this.state.quiz.resultSentence.length/56)),e=d+e+13,1==this.state.quiz.quizTypeId&&(e+=2));c=Math.max(c,e);c=Math.max(18,c);height=14*c;var c=this.state.floatright?240:520,f="color0";this.state.floatright&&$w($(this.resources.content_id).className).each(function(a){if(-1!=a.indexOf("color"))throw f=
a,$break;});a.innerHTML='<embed src="/quizwidget/Widget.swf" width="'+c+'" height="'+height+'" align="middle" name="Widget'+this.data.id+'" wmode="opaque" play="true" loop="false" quality="high" flashvars="id='+this.data.mod_data_id+"&cssClass="+f+'" allowScriptAccess="always" type="application/x-shockwave-flash" pluginspage="http://www.adobe.com/go/getflashplayer"></embed>'}}};
QuizModuleEdit.prototype.quizUpdateType=function(){var a=Form.getInputs(this.resources.quiz_type_form_id,"radio",this.resources.quiz_type_name_id).find(function(a){return a.checked}).value;this.state.quiz.quizTypeId=a;this.quizBuildInterface()};
QuizModuleEdit.prototype.quizBuildInterface=function(){var a=[,"Add some questions and answer choices to your quiz. Mark the correct answer to each question by checking the radio button next to the right answer. Click on the edit quiz results link to change the messages that are displayed to people when they are done taking your quiz.","Add some questions and answer choices to your quiz. For each answer choice, decide how many points that answer choice is worth (between -5 and +5) and select that number from the menu. Click on the edit quiz results link to change the messages that are displayed to people when they are done taking your quiz.",
'Add a result for each possible outcome of your quiz. For example, if your quiz tells someone whether they are type A or type B, add one result called "type A" and another result called "type B." Then add some questions and answer choices. For each answer choice, decide how many points are contributed to each result possibility when someone chooses that answer. At the end of the quiz, the result with the largest number of points will be the one that is displayed to the quiz taker.'],b=$(this.resources.quiz_edit_id);
b.innerHTML="";var c=this.state.quiz.quizTypeId;if(0==c){a=[,'<strong>Option 1.</strong> Every question has exactly one correct answer. <div class="quizTypeDescription">* Good for fact-based quizzes such as a movie trivia quiz.</div>','<strong>Option 2.</strong> Every answer choice is worth a different numbers of points. <div class="quizTypeDescription">* Good for quizzes that measure where someone falls between two extremes, such as: How liberal are you?</div>','<strong>Option 3.</strong> A quiz with multiple possible results. <div class="quizTypeDescription">* Good for quizzes that tell someone what type they are, such as what political party they identify most with.</div>'];
c=$(document.createElement("form"));c.name=this.resources.quiz_type_form_id;c.id=this.resources.quiz_type_form_id;var d=$(document.createElement("ul"));d.addClassName("quizTypeList");for(var e=1;3>=e;e++){var f=$(document.createElement("li")),g='<input type="radio" name="'+this.resources.quiz_type_name_id+'" value="'+e+'"/>',j=$(document.createElement("div"));j.className="quizType";j.innerHTML=a[e];f.innerHTML=g;f.appendChild(document.createTextNode(" "));f.appendChild(j);d.appendChild(f)}a=$(document.createElement("input"));
a.type="button";a.value="Next step";a.observe("click",this.quizUpdateType.bind(this));c.appendChild(d);c.appendChild(a);d=$(document.createElement("h2"));d.appendChild($(document.createTextNode("What type of quiz do you want to make?")));b.appendChild(d);b.appendChild(c)}else d=$(document.createElement("p")),d.appendChild($(document.createTextNode(a[c]))),a=$(document.createElement("h3")),a.appendChild($(document.createTextNode("Instructions"))),b.appendChild(a),b.appendChild(d),d=$(document.createElement("div")),
d.id=this.resources.quiz_results_id,d.addClassName("resultArea"),b.appendChild(d),1==c||2==c?(this.quizBuildResultBar(0,"Quiz Results",0),this.quizBuildResultsByPercentageScore(0)):3==c&&($H(this.state.quiz.results).values().each(function(a){a.id&&this.quizBuildResult(a.id,a.result,a.description)}.bind(this)),c=$(document.createElement("form")),d=$(document.createElement("label")),d.htmlFor=this.resources.quiz_result_add_input_id,d.appendChild($(document.createTextNode("Name of Result: "))),a=$(document.createElement("input")),
a.type="text",a.id=this.resources.quiz_result_add_input_id,a.addClassName("quizResultInput"),a.maxLength=120,e=$(document.createElement("input")),e.type="button",e.value="Add Result",e.observe("click",this.quizAddResult.bind(this)),c.observe("submit",function(a){Event.stop(a);this.quizAddResult();return!1}.bindAsEventListener(this)),c.appendChild(d),c.appendChild(a),c.appendChild(e),b.appendChild(c)),c=$(document.createElement("form")),d=$(document.createElement("label")),d.htmlFor=this.resources.quiz_question_add_input_id,
d.appendChild($(document.createTextNode("Question: "))),e=$(document.createElement("input")),e.type="text",e.id=this.resources.quiz_question_add_input_id,e.addClassName("quizQuestionInput"),e.maxLength=120,a=$(document.createElement("input")),a.type="button",a.value="Add Question",f=$(document.createElement("div")),f.addClassName("questionDragArea"),f.id=this.resources.quiz_question_drag_area_id,g=$(document.createElement("small")),g.appendChild($(document.createTextNode("*Drag and drop questions to reorder them."))),
b.appendChild(f),c.appendChild(d),c.appendChild(e),c.appendChild(a),b.appendChild(c),b.appendChild(g),a.observe("click",this.quizAddQuestion.bind(this)),c.observe("submit",function(a){Event.stop(a);this.quizAddQuestion()}.bind(this)),this.quizCreateContentReorder()};
QuizModuleEdit.prototype.quizBuildResultsByPercentageScore=function(a){var b=$(document.createElement("div"));b.id=this.resources.quiz_result_area_id+a;b.addClassName("editResultArea");var c=$(document.createElement("p"));c.appendChild($(document.createTextNode('Choose the message that will be displayed when someone is done taking your quiz. Any occurrence of the characters #% will be replaced with the person\'s percentage score. For example, "You scored #% on the intelligence test!" might become "You scored 87% on the intelligence test!"')));a=
$(document.createElement("label"));a.appendChild($(document.createTextNode("Message: ")));var d=$(document.createElement("input"));d.type="text";d.value=this.state.quiz.resultSentence.unescapeHTML();d.id=this.resources.quiz_result_sentence_id;d.addClassName("quizResultSentence");d.maxLength=120;var e=$(document.createElement("p"));e.appendChild($(document.createTextNode("You can display a custom message depending on how someone scores on your quiz. Type your custom messages in the boxes below.")));
b.appendChild(c);b.appendChild(a);b.appendChild(d);b.appendChild(e);var f=this.state.quiz_score_ranges,g=0,j=0,h=$(document.createElement("ol"));h.addClassName("messageByPercent");for($H(this.state.quiz.results).values().each(function(a){if(a.id){var b=$(document.createElement("li")),c=f[j],d=$(document.createElement("label"));d.htmlFor=this.resources.quiz_result_description_id+a.id;d.appendChild(document.createTextNode("For a score between "+g+"% and "+c+"%: "));b.appendChild(d);d=$(document.createElement("textarea"));
d.appendChild($(document.createTextNode(a.description.unescapeHTML())));d.id=this.resources.quiz_result_description_id+a.id;b.appendChild(d);h.appendChild(b);g=c;j++}}.bind(this));j<f.length;j++)c=$(document.createElement("li")),d="new"+j,score=f[j],a=$(document.createElement("label")),a.htmlFor=this.resources.quiz_result_description_id+d,a.appendChild(document.createTextNode("For a score between "+g+"% and "+score+"%:")),c.appendChild(a),a=$(document.createElement("textarea")),a.id=this.resources.quiz_result_description_id+
d,c.appendChild(a),h.appendChild(c),g=score,this.state.quiz.results[d]={id:d,description:"",result:"",minimumValue:0,maximumValue:0,isDeleted:0};b.appendChild(h);b.hide();$(this.resources.quiz_results_id).appendChild(b)};
QuizModuleEdit.prototype.quizBuildResult=function(a,b,c,d){b=b.unescapeHTML();c=c.unescapeHTML();this.quizBuildResultBar(a,b,d);d=$(document.createElement("div"));d.id=this.resources.quiz_result_area_id+a;d.addClassName("editResultArea");var e=$(document.createElement("label"));e.appendChild($(document.createTextNode("Result Name: ")));e.htmlFor=this.resources.quiz_result_name_id+a;var f=$(document.createElement("input"));f.type="text";f.value=b;f.addClassName("quizResultInput");f.id=this.resources.quiz_result_name_id+
a;f.observe("keyup",function(a){$(this.resources.quiz_result_span_id+a).innerHTML=$F(this.resources.quiz_result_name_id+a)}.bind(this,a));var g=$(document.createElement("label"));g.appendChild($(document.createTextNode("Explain the meaning of this result: ")));g.htmlFor=this.resources.quiz_result_description_id+a;var j=$(document.createElement("textarea"));j.appendChild($(document.createTextNode(c)));j.id=this.resources.quiz_result_description_id+a;var h=$(document.createElement("p")),l=$(document.createElement("small"));
l.appendChild($(document.createTextNode("This will be the payoff for taking your quiz, so make it good!")));h.appendChild(l);d.appendChild(e);d.appendChild(f);d.appendChild(g);d.appendChild(j);d.appendChild(h);d.hide();$(this.resources.quiz_results_id).appendChild(d);this.state.quiz.results[a]={id:a,result:b,description:c,minimumValue:0,maximumValue:0,isDeleted:0}};
QuizModuleEdit.prototype.quizAddResult=function(){this.state.select_id&&this.toggleAnswersForQuizQuestion(null,this.state.select_id,0);var a="new"+this.state.results_added;this.state.results_added++;var b=$F(this.resources.quiz_result_add_input_id);$(this.resources.quiz_result_add_input_id).value="";this.quizBuildResult(a,b,"",1);this.quizUpdateResultSelectors();this.toggleQuizResult(null,a,1)};
QuizModuleEdit.prototype.quizUpdateResultSelectors=function(){var a=$H(this.state.quiz.questions).values(),b=$H(this.state.quiz.results).values();a.each(function(a){a.id&&-1!=a.position&&$H(a.answers).values().each(function(d){d.id&&!d.isDeleted&&b.each(function(b){if(b.id){var f=$(this.resources.quiz_value_id+d.id+"_"+b.id);if(b.isDeleted&&f)$(this.resources.quiz_value_label_id+d.id+"_"+b.id).remove(),Element.remove(f);else if(!b.isDeleted&&!f){var g=$(this.resources.quiz_result_values_id+d.id),
f=$(document.createElement("select"));f.id=this.resources.quiz_value_id+d.id+"_"+b.id;var j=$(document.createElement("label"));j.htmlFor=f.id;j.appendChild(document.createTextNode(b.result+": "));j.id=this.resources.quiz_value_label_id+d.id+"_"+b.id;for(var h=5;-5<=h;h--){var l=$(document.createElement("option"));l.value=h;l.appendChild($(document.createTextNode(0<h?"+"+h:h)));f.appendChild(l);0==h&&(l.selected="selected")}g.appendChild(j);g.appendChild(f);g.appendChild($(document.createTextNode(" ")));
this.state.quiz.questions[a.id].answers[d.id].resultValues["rv"+b.id]=0}}}.bind(this))}.bind(this))}.bind(this))};
QuizModuleEdit.prototype.toggleQuizResult=function(a,b,c){c?($(this.resources.quiz_result_area_id+b).show(),$(this.resources.quiz_edit_result_id+b).hide(),$(this.resources.quiz_done_result_id+b).show(),this.state.select_result_id&&this.toggleQuizResult(null,this.state.select_result_id,0),this.state.select_result_id=b):($(this.resources.quiz_result_area_id+b).hide(),$(this.resources.quiz_edit_result_id+b).show(),$(this.resources.quiz_done_result_id+b).hide(),this.state.select_result_id&&this.state.select_result_id==
b&&(this.state.select_result_id=null),3==this.state.quiz.quizTypeId&&(this.state.quiz.results[b].description=$F(this.resources.quiz_result_description_id+b),this.state.quiz.results[b].result=$F(this.resources.quiz_result_name_id+b)));a&&Event.stop(a)};
QuizModuleEdit.prototype.quizBuildResultBar=function(a,b){var c=$(this.resources.quiz_results_id),d=$(document.createElement("div"));d.addClassName("resultBar");d.id=this.resources.quiz_result_id+a;var e=$(document.createElement("span"));e.appendChild($(document.createTextNode(b)));e.id=this.resources.quiz_result_span_id+a;var f=$(document.createElement("ul"));f.addClassName("quizButtons");var g=$(document.createElement("li")),j=$(document.createElement("a")),h=$(document.createElement("img"));h.src=
"/x/hubtool_discard_tag.gif";h.alt="delete";j.title="delete";j.href="#";j.appendChild(h);Event.observe(j,"click",this.quizDeleteResult.bindAsEventListener(this,a));g.appendChild(j);f.appendChild(g);g=$(document.createElement("li"));g.id=this.resources.quiz_edit_result_id+a;j=$(document.createElement("a"));j.appendChild($(document.createTextNode("edit")));j.href="#";Event.observe(j,"click",this.toggleQuizResult.bindAsEventListener(this,a,1));g.appendChild(j);f.appendChild(g);g=$(document.createElement("li"));
g.id=this.resources.quiz_done_result_id+a;j=$(document.createElement("a"));j.href="#";j.appendChild($(document.createTextNode("done")));Event.observe(j,"click",this.toggleQuizResult.bindAsEventListener(this,a,0));g.hide();g.appendChild(j);f.appendChild(g);d.appendChild(f);d.appendChild(e);c.appendChild(d)};QuizModuleEdit.prototype.quizCreateContentReorder=function(){this.state.reorder=new ModuleContentReorder(this.resources.quiz_question_drag_area_id,1,550,20)};
QuizModuleEdit.prototype.quizBuildAnswerChoice=function(a,b,c,d,e,f){e=e.unescapeHTML();var g=$(document.createElement("li"));g.id=this.resources.quiz_answer_li_id+b;g.addClassName("quizAdded");var j=this.state.quiz.quizTypeId;if(1==j)var h='<input type="radio" name="'+(this.resources.quiz_value_id+a)+'" id="'+(this.resources.quiz_value_id+b)+'" class="correctAnswerRadio" '+(0<d?'checked="checked"':"")+"/>";else if(2==j){var l=$(document.createElement("select"));l.id=this.resources.quiz_value_id+
b;for(var m=5;-5<=m;m--){var w=$(document.createElement("option"));w.value=m;w.appendChild($(document.createTextNode((0<m?"+":"")+m)));d==m&&(w.selected="selected");l.appendChild(w)}}else if(3==j){var m=$H(this.state.quiz.results).values(),q=$(document.createElement("div"));q.id=this.resources.quiz_result_values_id+b;m.each(function(a){if(a.id){var c=$(document.createElement("select"));c.id=this.resources.quiz_value_id+b+"_"+a.id;var d=$(document.createElement("label"));d.htmlFor=c.id;d.appendChild(document.createTextNode(a.result+
": "));d.id=this.resources.quiz_value_label_id+b+"_"+a.id;for(var e=5;-5<=e;e--){var g=$(document.createElement("option"));g.value=e;g.appendChild($(document.createTextNode(0<e?"+"+e:e)));c.appendChild(g);f&&f["rv"+a.id]==e&&(g.selected="selected")}q.appendChild(d);q.appendChild(c);q.appendChild($(document.createTextNode(" ")))}}.bind(this))}m=$(document.createElement("input"));m.type="text";m.id=this.resources.quiz_answer_id+b;m.value=e;m.addClassName("quizAnswerInput");m.maxLength=120;1==j&&(g.innerHTML=
h);g.appendChild(m);2==j&&g.appendChild(l);c&&(c=$(document.createElement("a")),h=$(document.createElement("img")),c.href="#",c.title="delete",c.addClassName("quizDeleteAnswer"),h.src="/x/hubtool_discard_tag.gif",h.alt="delete",c.appendChild(h),g.appendChild(c),Event.observe(c,"click",this.quizDeleteAnswer.bindAsEventListener(this,a,b)));3==j&&g.appendChild(q);$(this.resources.quiz_answer_list_id+a).appendChild(g);e||(e="");f||(f={});this.state.quiz.questions[a].answers[b]={id:b,answer:e,value:d,
resultId:0,isDeleted:0,resultValues:f}};QuizModuleEdit.prototype.quizAddAnswerChoice=function(a,b,c){var d="new"+this.state.answers_added;this.state.answers_added++;if(3==this.state.quiz.quizTypeId){var e={};$H(this.state.quiz.results).values().each(function(a){a.id&&!a.isDeleted&&(e["rv"+a.id]=0)})}this.quizBuildAnswerChoice(a,d,b,c,"",e)};
QuizModuleEdit.prototype.quizDeleteAnswer=function(a,b,c){1==this.state.quiz.quizTypeId&&$(this.resources.quiz_value_id+c).checked&&$H(this.state.quiz.questions[b].answers).values().each(function(a){if(a.id&&!a.isDeleted)throw $(this.resources.quiz_value_id+a.id).checked="checked",$break;}.bind(this));$(this.resources.quiz_answer_li_id+c).remove();this.state.quiz.questions[b].answers[c].isDeleted=1;a&&Event.stop(a)};
QuizModuleEdit.prototype.quizDeleteResult=function(a,b){this.state.select_result_id==b&&(this.state.select_result_id=null);$(this.resources.quiz_result_id+b).remove();$(this.resources.quiz_result_area_id+b).remove();this.state.quiz.results[b].isDeleted=1;this.quizUpdateResultSelectors();a&&Event.stop(a)};
QuizModuleEdit.prototype.quizDeleteQuestion=function(a,b){this.state.select_id==b&&(this.state.select_id=null);this.state.reorder.remove(b);this.state.questions_removed.push(b);$(this.resources.quiz_answer_area_id+b).remove();a&&Event.stop(a)};
QuizModuleEdit.prototype.quizBuildQuestion=function(a,b){a=a.unescapeHTML();var c=$(document.createElement("div"));c.addClassName("draggableQuestionBar");c.id=this.resources.quiz_question_id+b;c.onclick=function(){};var d=$(document.createElement("div"));d.addClassName("editAnswerArea");d.hide();d.id=this.resources.quiz_answer_area_id+b;var e=$(document.createElement("ul"));e.addClassName("quizButtons");var f=$(document.createElement("li")),g=$(document.createElement("a")),j=$(document.createElement("img"));
j.src="/x/hubtool_discard_tag.gif";j.alt="delete";g.title="delete";g.href="#";g.appendChild(j);Event.observe(g,"click",this.quizDeleteQuestion.bindAsEventListener(this,b));f.appendChild(g);e.appendChild(f);f=$(document.createElement("li"));f.id=this.resources.quiz_edit_question_id+b;g=$(document.createElement("a"));g.appendChild($(document.createTextNode("edit")));g.href="#";Event.observe(g,"click",this.toggleAnswersForQuizQuestion.bindAsEventListener(this,b,1));f.appendChild(g);e.appendChild(f);
f=$(document.createElement("li"));f.id=this.resources.quiz_done_question_id+b;g=$(document.createElement("a"));g.href="#";g.appendChild($(document.createTextNode("done")));Event.observe(g,"click",this.toggleAnswersForQuizQuestion.bindAsEventListener(this,b,0,1));f.hide();f.appendChild(g);e.appendChild(f);j=$(document.createElement("span"));j.appendChild($(document.createTextNode(a.truncate(this.state.truncated_question_length))));j.id=this.resources.quiz_question_span_id+b;f=$(document.createElement("label"));
f.appendChild(document.createTextNode("Question: "));g=$(document.createElement("input"));g.type="text";g.id=this.resources.quiz_question_input_id+b;g.hide();g.value=a;g.maxLength=120;g.addClassName("quizQuestionInput");c.appendChild(e);c.appendChild(j);e=$(document.createElement("ol"));e.id=this.resources.quiz_answer_list_id+b;e.addClassName("quizAnswerList");j=$(document.createElement("input"));j.type="button";j.value="add new answer choice";d.appendChild(f);d.appendChild(g);d.appendChild(e);d.appendChild(j);
j.observe("click",function(a){this.quizAddAnswerChoice(a,1,0);this.quizRearrangeItems(a)}.bind(this,b));g.observe("keyup",function(a){$(this.resources.quiz_question_span_id+a).innerHTML=$F(this.resources.quiz_question_input_id+a).truncate(this.state.truncated_question_length)}.bind(this,b));e=$(this.resources.quiz_question_drag_area_id);e.appendChild(c);e.appendChild(d);c=new ModuleContentReorderItem(this.resources.quiz_question_id+b,b,this.state.reorder);this.state.reorder.add(c);this.state.reorder.relayout();
this.state.quiz.questions[b]={id:b,question:a,answers:{}}};QuizModuleEdit.prototype.quizAddQuestion=function(){var a="new"+this.state.questions_added;this.state.questions_added++;var b=$F(this.resources.quiz_question_add_input_id);$(this.resources.quiz_question_add_input_id).value="";this.quizBuildQuestion(b,a);for(b=0;2>b;b++)this.quizAddAnswerChoice(a,0,0==b&&1==this.state.quiz.quizTypeId?1:0);this.toggleAnswersForQuizQuestion(null,a,1)};
QuizModuleEdit.prototype.updateQuizStateForQuestion=function(a){var b=this.state.quiz.questions[a];b.question=$F(this.resources.quiz_question_input_id+a);$H(b.answers).values().each(function(a,b){if(b.id&&!b.isDeleted){this.state.quiz.questions[a].answers[b.id].answer=$F(this.resources.quiz_answer_id+b.id);var e=this.state.quiz.quizTypeId;1==e?this.state.quiz.questions[a].answers[b.id].value=$(this.resources.quiz_value_id+b.id).checked?1:0:2==e?this.state.quiz.questions[a].answers[b.id].value=$(this.resources.quiz_value_id+
b.id).value:3==e&&(e=$H(this.state.quiz.results).values(),resultValues={},e.each(function(a){if(a.id&&!a.isDeleted){var c=$F(this.resources.quiz_value_id+b.id+"_"+a.id);resultValues["rv"+a.id]=c}}.bind(this)),this.state.quiz.questions[a].answers[b.id].resultValues=resultValues)}}.bind(this,a))};
QuizModuleEdit.prototype.quizRearrangeItems=function(a){for(var b=this.state.reorder.items,c=this.state.reorder.options,d=this.state.reorder.canvas,e=0,f=b[0];f.item_id!=a;)f=b[++e];f=$(this.resources.quiz_answer_area_id+a);a=Math.ceil(b.length/c.num_cols)*c.ele_space_per_v+f.getHeight()+c.ele_buffer_v;a!=parseInt(d.css("height"),10)&&d.css("height",a+"px");d=Math.floor((e+1)/c.num_cols)*c.ele_space_per_v;f.setStyle({position:"absolute",top:d+"px"});offset=f.getHeight()+c.ele_buffer_v+c.offset_v;
for(e++;e<b.length;e++)f=b[e],d=Math.floor(e/c.num_cols)*c.ele_space_per_v+offset,$(this.resources.quiz_question_id+f.item_id).setStyle({top:d+"px"})};
QuizModuleEdit.prototype.toggleAnswersForQuizQuestion=function(a,b,c,d){c?(this.state.select_id&&this.toggleAnswersForQuizQuestion(null,this.state.select_id,0,0),this.quizRearrangeItems(b),$(this.resources.quiz_answer_area_id+b).show(),$(this.resources.quiz_question_input_id+b).show(),$(this.resources.quiz_edit_question_id+b).hide(),$(this.resources.quiz_done_question_id+b).show(),this.state.select_id=b,this.state.reorder.disable()):(this.state.reorder.relayout(),$(this.resources.quiz_answer_area_id+
b).hide(),$(this.resources.quiz_question_input_id+b).hide(),$(this.resources.quiz_edit_question_id+b).show(),$(this.resources.quiz_done_question_id+b).hide(),this.updateQuizStateForQuestion(b),this.state.select_id=null,d&&this.state.reorder.enable());a&&Event.stop(a);return!1};LinkModuleEdit.prototype=new ModuleEdit;
function LinkModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.edit_id=a+"_link";this.resources.link_edit_url=a+"_url_edit";this.resources.json_links_id="json_links_"+a;this.resources.link_edit_title=a+"_link_title";this.resources.link_edit_desc=a+"_desc";this.resources.link_edit_desc_len=a+"_len";this.resources.link_drag_section="link_drag_"+a;this.resources.link_drag_title="link_drag_txt_"+a;this.resources.link_results_id=a+"_link_search_results";this.resources.link_edit_id=
a+"_link";this.resources.link_display_id=a+"_link_results";this.resources.links_list=a+"_linkitem";this.resources.link_url_id=a+"_url";this.resources.link_search_term_id=a+"_search_term";this.resources.link_title_id=a+"_link_title";this.resources.link_desc_id=a+"_desc";this.resources.link_desc_len_id=a+"_len";this.resources.link_submit_button=a+"_submit_button";this.resources.link_edit_box=a+"_link_edit_box";this.resources.link_status_id="test_status_"+a;this.resources.link_status_button_id="test_status_button_"+
a;this.resources.link_findbox_id="link_findbox_"+a;this.resources.link_show_add_field="link_show_add_field_"+a;this.resources.link_show_search_field="link_show_search_field_"+a;this.resources.link_add_field="link_add_field_"+a;this.resources.link_search_field="link_search_field_"+a;this.resources.link_warning_id="link_warning_"+a}
LinkModuleEdit.prototype.onEditOpen=function(){this.state.select_id=null;jq("#"+this.resources.link_display_id).hide();this.state.links||this.loadLinkState();this.state.reorder=new ModuleContentReorder(this.resources.link_drag_section,1,150,24);for(var a in this.state.links.links){var b=this.state.links.links[a];b.id&&this.addLinkDragElement(b.id,b.name,!1)}this.state.reorder.relayout();0<jq("#"+this.resources.link_show_search_field+":checked").length?this.linkDisplay("link_search_field"):this.linkDisplay("link_add_field")};
LinkModuleEdit.prototype.onEditClose=function(){jq("#"+this.resources.link_display_id).show();jq("#"+this.resources.link_warning_id).hide();jq("#"+this.resources.links_list).html("");this.state.reorder.items.each(function(a){var b=this.state.linkIndex[a.item_id];if(b){var c=b.url,g=b.description,b=b.name,j=jq("<li></li>");j.attr("id","linkitem_"+a.item_id);j.html('<a class="link_hub" target="new" href="'+c+'">'+b+"</a><p>"+g+"</p>");jq("#"+this.resources.links_list).append(j)}}.bind(this));var a=
this.state.reorder.getitemstateRec();for(pos in this.state.links.links){var b=this.state.links.links[pos];if(b.id&&a[b.id]){var c=a[b.id].position;if(c!=pos||b.isnew)b.move=!0,b.newpos=c,b.dirty=!0}}this.data.links_json=JSONstring.make(this.state.links);this.linkDisplay("link_add_field");jq("#"+this.resources.link_drag_title).hide();this.stretched=!1;jq("#"+this.resources.link_drag_section).html("");delete this.state.reorder};LinkModuleEdit.prototype.saveContent=function(){};
ModuleEdit.prototype.toggleLink=function(){this.toggleDisplay(this.resources.link_edit_id)};ModuleEdit.prototype.loadLinkState=function(){if(0<jq("#"+this.resources.json_links_id).length){this.state.links=JSONstring.toObject(jq("#"+this.resources.json_links_id).html());this.state.linkIndex={};for(var a in this.state.links.links){var b=this.state.links.links[a];b.id&&(this.state.linkIndex[b.id]=b)}}};
ModuleEdit.prototype.unselectDragElements=function(){this.state.reorder.items.each(function(a){a.ele.style.backgroundColor=""})};ModuleEdit.prototype.wireLinkCtrlHandlers=function(){var a=this;jq("#"+this.data.div_id).find(".link_add_button").each(function(){jq(this).click(function(b){a.onclickLinkFindAdd(b);return!1})})};
ModuleEdit.prototype.onclickLinkFindAdd=function(a){a=jq(a.target);console.log(a);var b=a.parent().find(".link_hub");jq("#"+this.resources.link_status_id).html("");this.addLink(b.attr("href"),b.html(),b.attr("title"));a.remove();return!1};ModuleEdit.prototype.onclickLinkAddInfo=function(){var a=jq("#"+this.resources.link_url_id).val().trim().toString(),b=jq("#"+this.resources.link_title_id).val().trim().toString(),c=jq("#"+this.resources.link_desc_id).val().trim().toString();this.addLink(a,b,c)};
ModuleEdit.prototype.addLink=function(a,b,c){if(0!==a.trim().length){0===b.length&&(b=a);var d="";this.data.links_added++;d="n"+(this.data.links_added-1);b=b.replace(/(\s|&nbsp;|\xA0)+/g," ");c=c.replace(/(\s|&nbsp;|\xA0)+/g," ");this.state.links.links[d]={id:d,dirty:!0,isnew:!0,url:a.stripScripts().stripTags(),name:b.escapeHTML(),description:c.escapeHTML()};this.state.linkIndex[d]=this.state.links.links[d];this.addLinkDragElement(d,b.toString(),!0);this.state.reorder.relayout();jq("#"+this.resources.link_url_id).val("");
jq("#"+this.resources.link_title_id).val("");jq("#"+this.resources.link_desc_id).val("");jq("#"+this.resources.link_desc_len_id).val("");1<this.state.reorder.items.length?jq("#"+this.resources.link_drag_title).show():jq("#"+this.resources.link_drag_title).hide();this.openEditBox(d)}};ModuleEdit.prototype.onclickLinkUrlUpdate=function(){this.linkHide(this.resources.link_status_id)};
ModuleEdit.prototype.onclickLinkUpdate=function(){var a=jq("#"+this.resources.link_edit_url).val().trim().stripScripts().stripTags(),b=jq("#"+this.resources.link_edit_title).val().trim().escapeHTML(),c=jq("#"+this.resources.link_edit_desc).val().trim().escapeHTML();if(0!==a.length){0===b.length&&(b=a);var d=this.state.select_id,e=this.state.linkIndex[d];e.dirty=!0;e.url=a.toString();e.name=b.toString();e.description=c.toString();a=e.name.replace(/\<[^>]*\>/gi,"");jq("#link_name_"+d).val(ellipse(a,
60))}};ModuleEdit.prototype.onclickLinkSelect=function(a){if(this.state.select_id!=a){this.state.select_id=a;this.unselectDragElements();jq("#linkdrg_"+a).css("backgroundColor","#ffc");var b=this.state.linkIndex[a];this.populateLinkEdit(b.url,b.name,b.description)}a&&this.linkDisplay("link_edit_box")};
ModuleEdit.prototype.populateLinkEdit=function(a,b,c){a==b&&(b="");c=c.unescapeHTML().substring(0,250);jq("#"+this.resources.link_edit_url).val(a);jq("#"+this.resources.link_edit_title).val(b.unescapeHTML());jq("#"+this.resources.link_edit_desc).val(c.unescapeHTML());jq("#"+this.resources.link_edit_desc_len).val(250-c.length)};
ModuleEdit.prototype.onclickLinkRemove=function(a){this.state.linkIndex[a].deleted=!0;this.state.linkIndex[a].dirty=!0;this.state.reorder.remove(a);Field.clear(this.resources.link_edit_url);Field.clear(this.resources.link_edit_title);Field.clear(this.resources.link_edit_desc);0<this.state.reorder.items.length?jq("#"+this.resources.link_drag_title).show():jq("#"+this.resources.link_drag_title).hide();this.state.reorder.relayout(!0);this.state.select_id!=a&&null!=this.state.select_id?this.openEditBox(this.state.select_id):
this.state.select_id=null};
ModuleEdit.prototype.onclickLinkAdd=function(a,b,c){var d=this;!c&&this.state.select_id&&this.closeEditBox(this.state.select_id);jq("#"+this.resources.link_warning_id).hide();b||(b=jq("#"+this.resources.link_url_id).val().trim().toString());if(!b||0==b.trim().length)return!1;b.match(/^[A-Za-z0-9\.-]{3,}\.[A-Za-z]{2}/)&&(b="http://"+b);if(b.match(/^((http|https|ftp):\/\/(?:(?:(?:(?:(?:[a-zA-Z\d](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?)\.)*(?:[a-zA-Z](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?))|(?:(?:\d+)(?:\.(?:\d+)){3}))(?::(?:\d+))?)(?:\/(?:(?:(?:(?:[a-zA-Z\d$\-_.+!*\'(),~]|(?:%[a-fA-F\d]{2}))|[;:@&=])*)(?:\/(?:(?:(?:[a-zA-Z\d$\-_.+!*\'(),~]|(?:%[a-fA-F\d]{2}))|[;:@&=])*))*)(?:\?(?:(?:(?:[a-zA-Z\d$\-_.+!*\'(),~]|(?:%[a-fA-F\d]{2}))|[;:@&=])*))?(?:#(?:(?:(?:[a-zA-Z\d$\-_.+!*\'(),~]|(?:%[a-fA-F\d]{2}))|[;:@&=])*))?)?)/))b=RegExp["$&"];
else if(!c){jq("#"+this.resources.link_warning_id).html("Invalid Link");jq("#"+this.resources.link_warning_id).show();return}c?jq("#"+this.resources.link_edit_url).val(b):jq("#"+this.resources.link_url_id).val(b);jq.ajax({type:"GET",url:"/xml/checklink.php",data:{url:b},success:function(b){a?d.renderLinkTest(b):d.renderLinkAdd(b)},error:reportError})};ModuleEdit.prototype.onclickLinkTest=function(){this.onclickLinkAdd(this.renderLinkTest.bind(this),jq("#"+this.resources.link_edit_url).val(),1)};
ModuleEdit.prototype.renderLinkAdd=function(a){jq("#"+this.resources.link_title_id).val("");jq("#"+this.resources.link_desc_id).val("");try{var b=JSONstring.toObject(a)}catch(c){}if(b)return b.title&&0<b.title.length&&jq("#"+this.resources.link_title_id).val(this.betterUnescapeHtml(b.title)),b.desc&&0<b.desc.length&&jq("#"+this.resources.link_desc_id).val(b.desc.unescapeHTML()),jq("#"+this.resources.link_desc_len_id).val(null!=b.desc?250-b.desc.length:250),jq("#"+this.resources.link_warning_id).hide(),
b.valid||(jq("#"+this.resources.link_warning_id).html(b.status),jq("#"+this.resources.link_warning_id).show()),this.onclickLinkAddInfo()};ModuleEdit.prototype.betterUnescapeHtml=function(a){return a.stripTags().replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&#039;/,"'")};
ModuleEdit.prototype.renderLinkTest=function(a){try{var b=JSONstring.toObject(a)}catch(c){}b&&(b.status&&0<b.status.length)&&(jq("#"+this.resources.link_status_id).html(b.status),this.linkShow(this.resources.link_status_id),b.title&&0<b.title.length&&jq("#"+this.resources.link_title_id).val(this.betterUnescapeHtml(b.title)),b.desc&&0<b.desc.length&&jq("#descriptionoverride").val()&&(jq("#"+this.resources.link_desc_id).val(b.desc.unescapeHTML()),jq("#"+this.resources.link_desc_len_id).val(null!=b.desc?
250-b.desc.length:250)),this.onclickLinkUpdate())};ModuleEdit.prototype.linkHide=function(a){switch(a){case this.resources.link_add_field:jq("#"+this.resources.link_add_field).hide();break;case this.resources.link_search_field:jq("#"+this.resources.link_findbox_id).hide();jq("#"+this.resources.link_search_field).hide();break;case this.resources.link_edit_box:this.closeEditBox(this.state.select_id);break;case this.resources.link_status_id:jq("#"+this.resources.link_status_id).hide(),jq("#"+this.resources.link_status_button_id).show()}};
ModuleEdit.prototype.linkShow=function(a){switch(a){case this.resources.link_add_field:jq("#"+this.resources.link_add_field).show();break;case this.resources.link_search_field:jq("#"+this.resources.link_search_field).show();break;case this.resources.link_edit_box:jq("#"+this.resources.link_edit_box).show();break;case this.resources.link_findbox_id:jq("#"+this.resources.link_findbox_id).show();break;case this.resources.link_status_id:jq("#"+this.resources.link_status_id).show(),jq("#"+this.resources.link_status_button_id).hide()}};
ModuleEdit.prototype.linkDisplay=function(a){"link_add_field"==a&&this.linkHide(this.resources.link_search_field);"link_search_field"==a&&this.linkHide(this.resources.link_add_field);"link_edit_box"!=a&&this.linkHide(this.resources.link_edit_box);switch(a){case "link_add_field":this.linkShow(this.resources.link_add_field);break;case "link_search_field":this.linkShow(this.resources.link_search_field);break;case "link_edit_box":this.linkShow(this.resources.link_edit_box);break;case "link_find_box":this.linkShow(this.resources.link_findbox_id)}};
ModuleEdit.prototype.getElementPosition=function(a){var b=0,c=0;for(a=document.getElementById(a);a;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;return{left:b,top:c}};ModuleEdit.prototype.closeEditBox=function(a){a&&(this.displayLinkDragElement(a,"edit link"),this.state.select_id=a,this.onclickLinkUpdate());jq("#"+this.resources.link_edit_box).hide();this.state.reorder.enable();this.state.reorder.relayout(!0);this.state.select_id=null;return!1};
ModuleEdit.prototype.displayLinkDragElement=function(a,b,c,d){bgColor=c?"#ffc":"#e5e5e5";jq("#linkedit_"+a+"_span").html(b);jq("#linkdrg_"+a).css("backgroundColor",bgColor);d&&jq(d.ele).css("top",d.startY+"px")};
ModuleEdit.prototype.openEditBox=function(a){var b=this.state.reorder.items,c=this.state.reorder.options,d=this.state.reorder.canvas,e,f=b[0];if(f.id!=a)for(e=0;f.item_id!=a&&e<b.length;e++,f=b[e])this.displayLinkDragElement(f.item_id,"edit link");if(f.item_id==a){this.displayLinkDragElement(f.item_id,"done",!0);a=Math.ceil(b.length/c.num_cols)*c.ele_space_per_v+jq("#"+this.resources.link_edit_box).height()+c.ele_buffer_v;a!=parseInt(d.css("height"),10)&&d.css("height",a+"px");this.state.select_id=
f.item_id;this.linkHide(this.resources.link_status_id);d=this.state.linkIndex[f.item_id];this.populateLinkEdit(d.url,d.name,d.description);d=Math.floor((e+1)/c.num_cols)*c.ele_space_per_v-1;jq("#"+this.resources.link_edit_box).css("top",d+"px");var g=jq("#"+this.resources.link_edit_box).height()+c.ele_buffer_v;jq("#"+this.resources.link_edit_box).css("overflow","auto");jq("#"+this.resources.link_edit_box).slideDown(250)}if(e<b.length){e++;for(f=b[e];e<b.length;e++,f=b[e])f.startY=Math.floor(e/c.num_cols)*
c.ele_space_per_v+g,this.displayLinkDragElement(f.item_id,"edit link",!1,f)}this.state.reorder.disable();this.linkDisplay("link_edit_box");return!1};
ModuleEdit.prototype.addLinkDragElement=function(a,b,c){var d=this;if(this.state.reorder){b=ellipse(b,60);b=b.replace(/\<[^>]*\>/gi,"");var e=jq("<div/>");e.attr("id","linkdrg_"+a);e.addClass("reorderableLinkWrapper");e.css("zIndex",1);e.css("overflow","hidden");e.click(function(){return!1});e.bind("selectstart",function(){return!1});var f="linkedit_"+a,g="linkremove_"+a;e.html('<span class="linkname" id="link_name_'+a+'" style="float: left;">'+b+'</span> <ul class="linkButtons">'+('<li style="padding-left:18px"><a title="delete" id="'+
g+'" href="#"><img alt="delete" src="/x/hubtool_discard_tag.gif"></a></li>')+('<li><a id="'+f+'" href="#"><span id="'+f+'_span" class="editbtn">edit link</span></a></li>')+"</ul>");c?jq("#"+this.resources.link_drag_section).prepend(e):jq("#"+this.resources.link_drag_section).append(e);jq("#"+g).click(function(){jq("#"+this.resources.link_edit_box).hide();d.onclickLinkRemove(a);return!1}.bind(this));jq("#"+f).click(function(){d.state.reorder.relayout(!0);"done"==jq("#linkedit_"+a+"_span").html()?d.closeEditBox(a):
d.openEditBox(a);return!1});this.state.reorder.add(new ModuleContentReorderItem("linkdrg_"+a,a,this.state.reorder),c);jq("#"+this.resources.link_drag_title).show()}};ModuleEdit.prototype.onclickCapsuleRenderFromDB=function(a){jq.ajax({type:"POST",url:"/xml/capsule_render.php",data:{art_id:this.data.art_id,id:this.data.id},success:function(b){jq("#"+a).html(b)},error:reportError})};EbayModuleEdit.prototype=new ModuleEdit;
function EbayModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.edit_id=a+"_ebay";this.resources.ebay_edit_id=a+"_ebay";this.resources.ebay_results_id=a+"_ebay_results";this.resources.ebay_preview_id="preview_"+a;this.resources.ebay_keywords_id="keywords_"+a;this.resources.ebay_seller_id="seller_"+a}EbayModuleEdit.prototype.onEditOpen=function(){jq("#"+this.resources.ebay_preview_id).click(function(){this.onclickEbayPreview()}.bind(this))};
EbayModuleEdit.prototype.onEditClose=function(){this.data.keywords=jq("#"+this.resources.ebay_keywords_id).val();this.data.seller=jq("#"+this.resources.ebay_seller_id).val();this.onclickEbayPreview()};EbayModuleEdit.prototype.saveContent=function(){};
EbayModuleEdit.prototype.onclickEbayPreview=function(){var a=jq("#"+this.resources.ebay_keywords_id).val(),b=jq("#"+this.resources.ebay_seller_id).val();jq.ajax({type:"POST",url:"/xml/ebayresults.php",data:{search:a,seller:b},success:function(a){jq("#"+this.resources.ebay_results_id).html(a)}.bind(this),error:reportError})};TableModuleEdit.prototype=new ModuleEdit;
function TableModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.edit_id="div_table_edit_"+a;this.resources.table_view_id="div_table_view_"+a;this.resources.table_edit_id="div_table_edit_"+a;this.resources.table_edit_content_id="table_edit_"+a;this.resources.table_view_content_id="table_view_"+a;this.resources.table_view_thead_id="thead_view_"+a;this.resources.table_view_tbody_id="tbody_view_"+a;this.resources.table_edit_thead_id="thead_edit_"+a;this.resources.table_edit_tbody_id=
"tbody_edit_"+a;this.resources.table_edit_form_id="form_table_"+a;this.resources.table_file_id="file_"+a;this.resources.table_url_id="url_"+a;this.resources.table_loading_id="div_loading_"+a;this.resources.table_action1_id="table_action1_"+a;this.resources.table_action2_id="table_action2_"+a;this.resources.table_action3_id="table_action3_"+a;this.resources.table_style_id="table_style_"+a;this.resources.table_loading_status_id="div_loading_status_"+a;this.resources.table_radio_current_id="radio_current_"+
a;this.resources.table_radio_url_id="radio_url_"+a;this.resources.table_radio_pc_id="radio_pc_"+a;this.resources.table_div_current_id="div_radio_current_"+a;this.resources.table_div_url_id="div_radio_url_"+a;this.resources.table_div_pc_id="div_radio_pc_"+a;this.resources.table_previous_element=null;this.resources.table_max_rows_id="max_rows_"+a;this.resources.table_max_cols_id="max_cols_"+a;this.resources.table_checkbox_sortable_id="checkbox_sortable_"+a;this.resources.table_caption_id="table_caption_"+
a;this.resources.table_description_id="table_desc_"+a}TableModuleEdit.prototype.onEditOpen=function(){this.showTableView();var a=jq("#"+this.resources.table_view_thead_id),b=jq("#"+this.resources.table_view_tbody_id);this.updateEditTable(a,b)};TableModuleEdit.prototype.onEditClose=function(){jq("#"+this.resources.table_view_id).show()};
TableModuleEdit.prototype.saveContent=function(){var a=this.buildCsv(jq("#"+this.resources.table_edit_content_id));this.data.content=a;this.data.tableStyle=jq("#"+this.resources.table_style_id).val();this.data.sortable=jq("#"+this.resources.table_checkbox_sortable_id).is(":checked")?1:0;this.data.caption=jq("#"+this.resources.table_caption_id).val();thead=jq("#"+this.resources.table_edit_thead_id);tbody=jq("#"+this.resources.table_edit_tbody_id);this.updateViewTable(thead,tbody);jq("#"+this.resources.table_view_content_id).removeClass();
jq("#"+this.resources.table_view_content_id).addClass(this.data.tableStyle);this.data.numRows=jq("#"+this.resources.table_view_tbody_id).find("tr").length+1;this.data.numCols=jq("#"+this.resources.table_view_thead_id).find("tr").first().find("td").length;jq("#"+this.resources.table_description_id).html(this.data.caption);jq("#"+this.resources.table_view_id).show()};
TableModuleEdit.prototype.getTableCell=function(a,b,c){b=jq(a.find("tr").get(b));return 0<b.find("th").length?b.find("th:nth-child("+(c+1)+")"):b.find("td:nth-child("+(c+1)+")")};TableModuleEdit.prototype.getTableBodyCell=function(a,b,c){b=jq(a.find("tbody tr").get(b));return b.find("td:nth-child("+(c+1)+")")};
TableModuleEdit.prototype.buildCsv=function(a){var b=new StringBuffer,c=this.getTableNumRows(a),d=this.getTableNumCols(a),e=this.getTableCell(a,0,0).hasClass("extraCell")?1:0;for(this.resources.table_previous_element=null;e<c;e++)if(!this.getTableCell(a,e,0).hasClass("extraCell")){for(var f=0;f<d;f++)this._addCSVCell(b,a,e,f);b.append("\n")}return b.toString()};
TableModuleEdit.prototype._addCSVCell=function(a,b,c,d){b=this.getTableCell(b,c,d);if(!b.hasClass("extraCell"))if(0<d&&a.append(","),0==b.length)a.append('[ncb]" "');else{d="";for(var e=0;e<b.find("div,input").length;e++){c=b.find(":nth-child("+(e+1)+")");var f=c.get(0).nodeName.toLowerCase();if("div"==f){d=c.html();break}else if("input"==f){d=this.escapeHTML(c.val());e=jq("<div/>");e.html(d);c.parent().removeClass("selectedCell");c.parent().hasClass("tableCell")||c.parent().addClass("tableCell");
c.parent().empty().append(e);break}}c=b.hasClass("boldCell")?"b":"n";e="c";b.hasClass("centerCell")||(e=b.hasClass("leftCell")?"l":"r");b=b.parent().parent().get(0).nodeName.toLowerCase();d=d.replace(/(,|")/g,function(a,b){return","==b?"^COMMA^":'"'==b?"^QUOTE^":b});a.append("[").append(c.substring(0,1)).append(e.substring(0,1)).append(b.substring(1,2)).append(']"').append(d).append('"')}};
TableModuleEdit.prototype.onclickCsvLoad=function(){if(""!=jq("#"+this.resources.table_file_id).val().strip()||""!=jq("#"+this.resources.table_url_id).val().strip())jq("#"+this.resources.table_loading_id).show(),jq("#"+this.resources.table_edit_form_id).submit()};
TableModuleEdit.prototype.insertExtraCellOld=function(a){var b="thead"==a.parentNode.tagName.toLowerCase()?document.createElement("th"):document.createElement("td");a.appendChild(b);b.className="extraCell centerCell";"th"==b.tagName.toLowerCase()&&(b.className+=" boldCell");b.innerHTML="<div></div>"};
TableModuleEdit.prototype.insertExtraCell=function(a){var b="thead"==a.parent().get(0).nodeName.toLowerCase()?jq("<th/>"):jq("<td/>");a.append(b);b.addClass("extraCell").addClass("centerCell");"th"==b.get(0).nodeName.toLowerCase()&&b.addClass("boldCell");b.html("<div></div>")};TableModuleEdit.prototype.isExtraCell=function(a){return a.hasClass("extraCell")};TableModuleEdit.prototype.isExtraCellOld=function(a){a.prop("class")||Element.extend(a);return a.hasClass("extraCell")};
TableModuleEdit.prototype.getTableNumCols=function(a){return 0==this.getTableNumRows(a)?0:0<a.find("tr").first().find("th").length?a.find("tr").first().find("th").length:a.find("tr").first().find("td").length};TableModuleEdit.prototype.getTableNumRows=function(a){return a.find("tr").length};TableModuleEdit.prototype.hasTableHeader=function(a){return 0==this.getTableNumRows(a)||0==this.getTableNumCols(a)?!1:!a.find("tr").first().find("td").first().hasClass("extraCell")};
TableModuleEdit.prototype.tableInsertRow=function(a,b){var c=jq("<tr/>");a.find("tbody tr:nth-child("+(b-1)+")").after(c);return c};
TableModuleEdit.prototype.updateEditTable=function(a,b){a=jq(a);b=jq(b);var c=a.parent(),d=jq("#"+this.resources.table_edit_thead_id),e=jq("#"+this.resources.table_edit_tbody_id);e.empty();var f=jq("<tr/>");d.empty();d.append(f);var d=this.getTableNumCols(c),g=b.find("tr").length,j=jq("#"+this.resources.table_max_rows_id).val(),h=jq("#"+this.resources.table_max_cols_id).val();if(0<this.getTableNumRows(c)){for(var l=a.find("tr").first(),m=0;m<d;m++){var w=jq("<th/>");f.append(w);headerCell=l.find("th:nth-child("+
(m+1)+")");w.html(headerCell.html());w.addClass(headerCell.attr("class"));w.attr("noWarp","noWrap")}d<h&&this.insertExtraCell(f)}else if(0<b.find("tr").length){for(m=0;m<d;m++)this.insertExtraCell(f);d<h&&this.insertExtraCell(f)}else this.insertExtraCell(f);if(0<g&&0<b.find("tr").first().find("td").length)for(l=0;l<g;l++){f=jq("<tr/>");e.append(f);f.addClass(b.find("tr").get(l).className);for(m=0;m<d;m++){w=jq("<td/>");f.append(w);var q=this.getTableBodyCell(c,l,m);w.html(q.html());w.addClass(q.attr("class"));
w.attr("noWrap","noWrap")}d<h&&this.insertExtraCell(f)}if(g<j-1){f=jq("<tr/>");e.append(f);for(m=0;m<d;m++)this.insertExtraCell(f);d<h&&this.insertExtraCell(f)}var u=this;jq("#"+this.resources.table_edit_content_id).click(function(a){a=jq(a.target);"td"==a.get(0).nodeName.toLowerCase()||"th"==a.get(0).nodeName.toLowerCase()?(a=a.find("div"),0<a.length&&u.selectCell(jq(a.get(0)))):"div"==a.get(0).nodeName.toLowerCase()&&null!=a.parent().get(0)&&null!=a.parent().get(0).nodeName&&("td"==a.parent().get(0).nodeName.toLowerCase()||
"th"==a.parent().get(0).nodeName.toLowerCase())&&u.selectCell(a)})};
TableModuleEdit.prototype.updateViewTable=function(a,b){var c=a.parent(),d=jq("#"+this.resources.table_view_thead_id),e=jq("#"+this.resources.table_view_tbody_id);d.empty();e.empty();var f=this.getTableNumCols(c);if(this.hasTableHeader(c)){var g=jq("<tr/>");d.append(g);for(d=0;d<f;d++){var j=this.getTableCell(c,0,d);if(!j.hasClass("extraCell")){var h=jq("<th/>");g.append(h);h.html(j.html());"<div></div>"==h.html().trim().toLowerCase()&&h.html("<div>&nbsp;</div>");h.addClass(j.attr("class"));0==d?
h.addClass("firstCell"):h.removeClass("firstCell");h.removeClass("lastCell")}}h.addClass&&h.addClass("lastCell")}if(1<b.find("tr").length)for(f=0;f<b.find("tr").length;f++){var j=jq(b.find("tr").get(f)),l=this.getTableBodyCell(c,f,0);if(!l.hasClass("extraCell")){g=jq("<tr/>");e.append(g);g.addClass(j.attr("class"));for(d=0;d<j.find("td").length;d++)l=this.getTableBodyCell(c,f,d),l.hasClass("extraCell")||(h=jq("<td/>"),g.append(h),h.html(l.html()),"<div></div>"==h.html().trim().toLowerCase()&&h.html("<div>&nbsp;</div>"),
h.addClass(l.attr("class")),0==d&&!h.hasClass("firstCell")?h.addClass("firstCell"):h.hasClass("firstCell")&&h.removeClass("firstCell"),h.hasClass("lastCell")&&h.removeClass("lastCell"))}h.addClass&&h.addClass("lastCell")}};
TableModuleEdit.prototype.showTableView=function(a){jq("#"+this.resources.table_loading_status_id).hide();a&&Event.element(a).id!=this.resources.table_radio_current_id&&jq("#"+this.resources.table_radio_current_id).attr("checked",!1);jq("#"+this.resources.table_radio_current_id).is(":checked")?jq("#"+this.resources.table_div_current_id).show():jq("#"+this.resources.table_div_current_id).hide();jq("#"+this.resources.table_radio_url_id).is(":checked")?jq("#"+this.resources.table_div_url_id).show():
(jq("#"+this.resources.table_div_url_id).hide(),jq("#"+this.resources.table_url_id).val(""));jq("#"+this.resources.table_radio_pc_id).is(":checked")?jq("#"+this.resources.table_div_pc_id).show():(jq("#"+this.resources.table_div_pc_id).hide(),jq("#"+this.resources.table_file_id).val(""))};TableModuleEdit.prototype.showTableStatusMessage=function(a){jq("#"+this.resources.table_loading_status_id).html(a);jq("#"+this.resources.table_loading_status_id).show()};
TableModuleEdit.prototype.hideTableStatusMessage=function(){jq("#"+this.resources.table_loading_status_id).hide()};TableModuleEdit.prototype.handleSelectionsForTable=function(a){a=jq(a.target);a.attr("id")!=this.resources.table_action1_id&&jq("#"+this.resources.table_action1_id).val(0);a.attr("id")!=this.resources.table_action2_id&&jq("#"+this.resources.table_action2_id).val(0);a.attr("id")!=this.resources.table_action3_id&&jq("#"+this.resources.table_action3_id).val(0)};
TableModuleEdit.prototype.updateTableRowClasses=function(a){for(var b=0;b<a.find("tr").length;b++)a.find("tr:nth-child("+(b+1)+")").addClass(0==b%2?"oddRow":"evenRow")};
TableModuleEdit.prototype.handleTableActions=function(){if(null==this.resources.table_previous_element||null==this.resources.table_previous_element.parent())alert("You need to select a column or row before hitting the 'update' button.");else{var a=jq("#"+this.resources.table_max_rows_id).val(),b=jq("#"+this.resources.table_max_cols_id).val(),c=this.resources.table_previous_element.parent(),d=c[0].cellIndex,e=c.parent()[0].rowIndex,f=jq("#"+this.resources.table_edit_content_id),g=jq("#"+this.resources.table_edit_thead_id),
j=jq("#"+this.resources.table_edit_tbody_id),h=this.getTableNumRows(f),l=this.getTableNumCols(f),m=parseInt(jq("#"+this.resources.table_action1_id).val())+parseInt(jq("#"+this.resources.table_action2_id).val())+parseInt(jq("#"+this.resources.table_action3_id).val());switch(m){case 1:if(0!=e&&e<h-1||e==h-1&&h==a){c=h==a&&!this.isExtraCell(this.getTableCell(f,h-1,0));f.get(0).deleteRow(e);if(c){e=jq("<tr/>");f.append(e);for(d=0;d<l;d++)this.insertExtraCell(e)}this.updateTableRowClasses(j)}else 0==e?
alert("You are not able to delete the header row"):alert("You are not able to delete the extra row");break;case 2:if(2<l&&d<l-1||d==l-1&&l==b){c=l==b&&!this.isExtraCell(this.getTableCell(f,0,l-1));for(e=0;e<h;e++)jq(jq(f.find("tr").get(e)).find("td,th").get(d)).remove(),c&&this.insertExtraCell(jq(f.find("tr").get(e)))}else 2==l&&0==d?alert("You must have at least one column."):alert("You are not able to delete the extra column");break;case 4:e<h-1&&e++;case 3:if(0==e)alert("Rows above the header row are not alloweed");
else if(h==a)alert("You have reached the maximum number of rows");else{h=this.tableInsertRow(f,e);for(a=0;a<l;a++)c=h.parent()==g?jq("<th/>"):jq("<td/>"),h.append(c),c.addClass(a==l-1?"extraCell":"tableCell"),c.width(200),c.html("<div></div>");this.updateTableRowClasses(j);this.selectCell(this.getTableCell(f,e,d))}break;case 6:d<l-1&&d++;case 5:if(l==b)alert("You have reached the maximum number of columns");else{for(a=0;a<h;a++)l=a==h-1?"extraCell":"tableCell",c=0!=a||!this.hasTableHeader(f)?jq("<td/>"):
jq("<th/>"),this.getTableCell(f,a,d).before(c),c.addClass(l),c.html("<div></div>");this.selectCell(this.getTableCell(f,e,d))}break;case 16:case 14:for(a=0;a<l;a++)c=this.getTableCell(f,e,a),j=14==m?"boldCell":"unboldCell",g=14==m?"unboldCell":"boldCell",c.hasClass(j)||(c.removeClass(g),c.addClass(j));break;case 15:case 13:for(a=0;a<h;a++)if(0!=a||!this.hasTableHeader(f))c=this.getTableCell(f,a,d),j=13==m?"boldCell":"unboldCell",g=13==m?"unboldCell":"boldCell",c.hasClass(j)||(c.removeClass(g),c.addClass(j));
break;case 7:case 8:case 9:var w,q,u;7==m?(w="centerCell",q="leftCell",u="rightCell"):8==m?(w="rightCell",q="leftCell",u="centerCell"):9==m&&(w="leftCell",q="rightCell",u="centerCell");for(a=0;a<h;a++)if(0!=a||!this.hasTableHeader(f))c=this.getTableCell(f,a,d),c.hasClass(w)||(c.addClass(w),c.removeClass(q),c.removeClass(u));break;case 10:case 11:case 12:10==m?(w="centerCell",q="leftCell",u="rightCell"):11==m?(w="rightCell",q="leftCell",u="centerCell"):12==m&&(w="leftCell",q="rightCell",u="centerCell");
for(a=0;a<l;a++)c=this.getTableCell(f,e,a),c.hasClass(w)||(c.addClass(w),c.removeClass(q),c.removeClass(u));break;case 17:this.resources.table_previous_element.val("");break;case 18:for(a=0;a<j.prop("rows").length;a++)a==e&&"th"!=c.tagName.toLowerCase()?this.resources.table_previous_element.val(""):(h=j.prop(rows)[a].cells[d],h.prop("class")||Element.extend(h),h.hasClass("extraCell")||h.update("<div></div>"));break;case 19:for(a=0;a<l;a++)a==d?this.resources.table_previous_element.val(""):(h=this.getTableCell(f,
e,a),h.hasClass("extraCell")||h.html("<div></div>"));break;case 20:case 21:case 22:20==m?(w="centerCell",q="rightCell",u="leftCell"):21==m?(w="rightCell",q="centerCell",u="leftCell"):22==m&&(w="leftCell",q="rightCell",u="centerCell");c.prop("class")||Element.extend(c);c.hasClass(w)||(c.removeClass(q),c.removeClass(u),c.addClass(w));break;case 23:case 24:w=23==m?"boldCell":"unboldCell",q=23==m?"unboldCell":"boldCell",c.prop("class")||Element.extend(c),c.hasClass(w)||(c.removeClass(q),c.addClass(w))}}};
TableModuleEdit.prototype.tableHandleTabsAndArrows=function(a){var b=Event.element(a);if(!b.tagName||("input"!=b.tagName.toLowerCase()||"td"!=b.parentNode.tagName.toLowerCase()&&"th"!=b.parentNode.tagName.toLowerCase())||!checkTabKeyAlone(a)&&!checkShiftTabKey(a)&&a.keyCode!=Event.KEY_UP&&a.keyCode!=Event.KEY_DOWN)return!0;var c=b.parentNode,b=c.cellIndex,c=c.parentNode.rowIndex,d=jq("#"+this.resources.table_edit_content_id),e=this.getTableNumRows(d),f=this.getTableNumCols(d);if(checkTabKeyAlone(a)){if(b<
f-1||c<e-1)b==f-1?this.selectCell(this.getTableCell(d,c+1,0)):this.selectCell(this.getTableCell(d,c,b+1));Event.stop(a);return!1}if(checkShiftTabKey(a)){if(0!=b||0!=c)0==b?this.selectCell(this.getTableCell(d,c-1,f-1)):this.selectCell(this.getTableCell(d,c,b-1));Event.stop(a);return!1}if(a.keyCode==Event.KEY_UP){if(0<c)return this.selectCell(this.getTableCell(d,c-1,b)),Event.stop(a),!1}else if(a.keyCode==Event.KEY_DOWN&&c<e-1)return this.selectCell(this.getTableCell(d,c+1,b)),Event.stop(a),!1;return!0};
TableModuleEdit.prototype.escapeHTML=function(a){return jq("<div />").text(a).html()};TableModuleEdit.prototype.unescapeHTML=function(a){return jq("<div />").html(a).text()};
TableModuleEdit.prototype.selectCell=function(a){var b=this.resources.table_previous_element;if(a&&a.parent()&&a.get(0).nodeName&&!(b==a||null!=b&&b.parent()==a)){if(null!=b&&null!=b.parent()){var c=this.escapeHTML(b.val()),b=b.parent();b.html("<div>"+c+"</div>");b.removeClass("selectedCell")}if("div"!=a.get(0).nodeName.toLowerCase()){list=a.find("div");if(0==list.length)return;a=jq(list.get(0))}var d=jq("#"+this.resources.table_max_rows_id).val(),e=jq("#"+this.resources.table_max_cols_id).val(),
c=a.html(a.html().replace(/&nbsp;/g," "));a=a.parent();b=a.width();a.empty();a.addClass("selectedCell");var f=jq("<input type='text'/>");f.val(this.unescapeHTML(c).strip());a.append(f);a=a.width();c=f.width();a<b&&f.width(b-a+c);f.focus();setTimeout(function(){f.focus()},10);this.resources.table_previous_element=f;var g=this;f.keydown(function(a){a=getEvent(a);return g.tableHandleTabsAndArrows(a)});f.keypress(function(a){a=getEvent(a);if(checkTabKeyAlone(a)||checkShiftTabKey(a))return Event.stop(a),
!1;if(a.keyCode!=Event.KEY_BACKSPACE&&a.keyCode!=Event.KEY_LEFT&&a.keyCode!=Event.KEY_RIGHT&&a.keyCode!=Event.KEY_UP&&a.keyCode!=Event.KEY_DOWN){a=jq(a.target).parent();var b=a[0].cellIndex,c=a.parent(),f=c[0].rowIndex,w=jq("#"+g.resources.table_edit_content_id),q=g.getTableNumRows(w),u=g.getTableNumCols(w);if(0==f&&a.hasClass("extraCell"))for(var r=0;r<u;r++)if(a=jq(c.find("td,th").get(r)),r<u-1||u==e)a.removeClass("extraCell"),a.addClass("tableCell"),a.addClass("boldCell"),a.addClass("centerCell");
if(b==u-1){for(r=0;r<q;r++){b=jq(w.find("tr").get(r));if(r<q-1||r==q-1&&q>=d-1){a=b.cells[u-1];a.removeClass("extraCell");a.addClass("tableCell");var L=a.find("div");null!=L&&0<L.length&&(L=L[0],L.minWidth(200),L.width(200));0==r&&a.addClass("boldCell")}u<e&&this.insertExtraCell(b)}u++}if(f==q-1){var S;q<d&&(S=g.tableInsertRow(w,f+1));for(r=0;r<u;r++)if(q<d&&g.insertExtraCell(S),r<u-1||u==e)jq(c.get(0).cells[r]).removeClass("extraCell"),jq(c.get(0).cells[r]).addClass("tableCell");c.addClass(0==q%
2?"oddRow":"evenRow")}}return!0})}};VideoModuleEdit.prototype=new ModuleEdit;
function VideoModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.state.video_type=null;this.state.video_current_css=null;this.resources.edit_id="video_"+a;this.resources.video_edit_id="video_"+a;this.resources.video_url_input_id="video_url_"+a;this.resources.video_key_id="video_key_"+a;this.resources.video_type_id="video_type_"+a;this.resources.video_results_id="video_results_"+a;this.resources.video_jump_id="video_jump_"+a}VideoModuleEdit.prototype.onEditOpen=function(){this.onclickVideoPreview()};
VideoModuleEdit.prototype.onEditClose=function(){this.onclickVideoPreview(this.state.floatnone?"Big":"Small");0<jq("#"+this.resources.video_url_input_id).length&&(this.data.url=jq("#"+this.resources.video_url_input_id).val())};VideoModuleEdit.prototype.saveContent=function(){};
VideoModuleEdit.prototype.onclickVideoPreview=function(a){a||(a="Big");var b=jq("#"+this.resources.video_url_input_id).val(),c=this;jq.ajax({type:"POST",url:"/xml/videoresults.php",dataType:"json",data:{url:b,size:a},success:function(a){var b="Unrecognized URL"==a.key;hpFormHandler.lightEle(c.resources.video_key_id,b);hpFormHandler.lightEle(c.resources.video_type_id,b);hpFormHandler.lightEle(c.resources.video_jump_id,b);jq("#"+c.resources.video_key_id).html(a.key);jq("#"+c.resources.video_type_id).html(a.type);
jq("#"+c.resources.video_jump_id).html(a.fullJump);c.state.video_type=a.type;a.showPreview&&insertVideo(a.type,a.key,a.jump,a.cssClass,"",c.resources.video_results_id)},error:reportError})};VideoModuleEdit.prototype._renderVideo=function(){var a="video"+this.state.video_type+(this.state.floatnone?"Big":"Small");if(this.state.video_css_class!=a){var b=jq("#"+this.resources.video_results_id).find("embed");0<b.length&&(b[0].className!=a&&b.addClass(a),this.state.video_css_class=a)}};
ImageModuleEdit.prototype=new ModuleEdit;
function ImageModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.edit_id="image_"+a;this.resources.image_edit_id="image_"+a;this.resources.image_caption_input="descinput_"+a;this.resources.image_size_input="sizeinput_"+a;this.resources.image_display_style_id="dispstyle_"+a;this.resources.image_drag_section="image_drag_"+a;this.resources.image_drag_title="image_drag_txt_"+a;this.resources.image_load_id="image_load_"+a;this.resources.image_web_radio_id="image_web_radio_"+a;this.resources.image_viewer_display=
"slide_display_"+a;this.resources.image_viewer_caption="slide_desc_"+a;this.resources.image_insert_wrapper_id="image_insert_wrapper_"+a;this.resources.image_width_warning_id="image_width_warning_"+a}
ImageModuleEdit.prototype.onEditOpen=function(){jq("#"+this.resources.content_id).hide();this.batch_first_image_id=0;var a=photoGalleryInserter.instance();a.setOptions({hide_insert_menu:!1,close_on_select:!1,style:"capsule",queue_limit:window.max_file_uploads?window.max_file_uploads:5,import_queue_limit:5});a.setOnImageSelect(function(a,c,d,e,f){if(this.state.photoData)if(this.state.photoData&&void 0!=this.state.photoData[a])alert("This photo already exists in this capsule!");else{this.batch_first_image_id||
(this.batch_first_image_id=a);var g=250<f.length?f.substring(0,247)+"...":f,j="http://"+photoGalleryInserter.getUserImageDomain(a);f=function(f){f&&(this.state.photoData[a]={id:a,urlOriginal:j+""+a+"."+c,urlFull:j+"/"+a+"_f520.jpg",urlFullPad:j+"/"+a+"_f496.jpg",urlHalf:j+"/"+a+"_f260.jpg",urlHalfPad:j+"/"+a+"_f248.jpg",urlQuarter:j+"/"+a+"_f120.jpg",urlBigThumb:j+"/"+a+"_100.jpg",urlThumb:j+"/"+a+"_50.jpg",caption:g,esc_cap:g.escapeHTML(),origHeight:e,origWidth:d,ratio:e/d,maxSize:0},this.addImageDragElement(a,
j+"/"+a+"_100.jpg",g,f.sourceUrl,f.sourceName,f.hubpagesOwned,window.userIsEditor),this.state.reorder.relayout(),this.imageBatchComplete(!0,"none"))}.bind(this);jq.ajax({type:"POST",url:"/xml/photos/insert.php",success:f,data:{id:a,artId:article},error:reportError})}}.bind(this));a.setOnBatchComplete(this.imageBatchComplete.bind(this));0<jq("#device_is_ipad").length?jq("#photo_insert_import a").click():jq("#photo_insert_upload a").click();a=jq("#photo_insert");jq("#"+this.resources.image_insert_wrapper_id).append(a);
a.show();this.state.image_ctrl||eval("this.state.image_ctrl = imgCtrl_"+this.data.id);this.state.reorder=new ModuleContentReorder(this.resources.image_drag_section,1,245,this.state.image_reorder_height);this.state.photoData={};this.state.image_ctrl.photoOrder.each(function(a){var c=this.state.image_ctrl.photoData[a];this.state.photoData[a]={};for(key in c)this.state.photoData[a][key]=c[key];this.addImageDragElement(a,c.urlBigThumb,c.caption,c.sourceUrl,c.sourceName,c.hubpagesOwned,window.userIsEditor)}.bind(this));
this.state.reorder.relayout()};ImageModuleEdit.prototype.onEditClose=function(){this.state.image_ctrl.toggleViewer();jq("#"+this.resources.content_id).show();jq("#"+this.resources.image_drag_section).html("");delete this.state.reorder;delete this.state.photoData;photoGalleryInserter.instance().close()};
ImageModuleEdit.prototype.saveContent=function(){this.updateImageData();var a=this.state.reorder.getitemstate();a.each(function(a){a.caption=this.state.photoData[a.id].caption;a.maxSize=this.state.photoData[a.id].maxSize;a.sourceUrl=this.state.photoData[a.id].sourceUrl;a.sourceName=this.state.photoData[a.id].sourceName;a.hubpagesOwned=this.state.photoData[a.id].hubpagesOwned}.bind(this));this.state.images_removed.each(function(b){a.push({id:b,caption:"",position:-1})});this.data.images_json=JSONstring.make(a);
if(jq("#"+this.resources.image_display_style_id)[0]){this.data.dispTypeId=jq("#"+this.resources.image_display_style_id).val();var b=jq("#"+this.resources.image_display_style_id)[0];this.state.image_ctrl.displayStatus=b.options[b.selectedIndex].text}this.state.image_ctrl.clear();this.state.reorder.items.each(function(a){this.state.image_ctrl.addPhoto(this.state.photoData[a.item_id])}.bind(this));this.updateImageControlHeight();this.state.image_ctrl.render()};
ImageModuleEdit.prototype.imageBatchComplete=function(a,b){if(!(0==this.batch_first_image_id||"gallery"==b)&&a){var c=jq("#image_tn_wrapper_"+this.batch_first_image_id);c.size()&&(this.batch_first_image_id=0,c=c.offset(),c.top>jq(window).scrollTop()+jq(window).height()&&(jq("#"+this.data.div_id+" .image_organize").append('<div id="ind" style="left: '+c.left+'px;"><div><strong><img src="http://x.hubpages.com/x/dn-w.gif" style="width: 11px; height: 10px;" /> Added photo(s) below</strong></div></div>'),
setTimeout("jq('#ind').remove();",3500)))}};ImageModuleEdit.prototype.updateImageControlHeight=function(){var a=this.state.image_ctrl.getMaxDisplayHeight();jq("#"+this.resources.image_viewer_display).css("height",a+"px");this.state.image_ctrl.setMaxHeight(a)};
ImageModuleEdit.prototype.adjustImageWidth=function(){if("Image"==this.data.type){this.state.image_ctrl||eval("this.state.image_ctrl = imgCtrl_"+this.data.id);2<this.data.horiz_id&&!this.isLast()?"none"==this.state.image_ctrl.floatStatus&&(this.state.image_ctrl.floatStatus="right",this.updateImageControlHeight(),jq("#"+this.resources.image_viewer_caption)[0].className="caption_half"):"right"==this.state.image_ctrl.floatStatus&&(this.state.image_ctrl.floatStatus="none",this.updateImageControlHeight(),
jq("#"+this.resources.image_viewer_caption)[0].className="caption_full");var a=this.state.image_ctrl.displayStatus;"No Border"==a||"With Border"==a?this.state.image_ctrl.renderInlineImages():this.state.image_ctrl.loadSlide(this.state.image_ctrl.viewer_id)}};ImageModuleEdit.prototype.onclickImageAddUpload=function(){var a=document.createElement("input");a.type="file";a.className="upload";a.name=this.resources.image_upload_id+(new Date).getTime().toString().substr(3);jq("#"+this.resources.image_upload_section_id)[0].getElementsByTagName("div")[0].appendChild(a)};
ImageModuleEdit.prototype.addImageDragElement=function(a,b,c,d,e,f,g){var j="image_caption_"+a,h=jq('<div id="image_tn_wrapper_'+a+'" class="reorderable_image"></div>');jq('<img src="'+b+'"/><div class="image_protector"></div>').appendTo(h);b="image_source_name_"+a;var l="image_source_url_"+a,m="image_hubpages_owned_"+a;h.append('<div class="image_source">'+(g?'<label><input type="checkbox" id="'+m+'" style="width:10px"> This image is owned by HubPages</label><br />':"")+'<label>Name of source (optional):</label><br/><input type="text" id="'+
b+'" maxlength="150"/><br/><label>Source URL (optional):</label><br/><input type="text" id="'+l+'" maxlength="250"/><br/><label>Caption (optional):</label><br/><textarea name="'+j+'" id="'+j+'">'+c+"</textarea></div>");h.append('<a href="#" class="image_remove" title="remove">remove</a>');jq("#"+this.resources.image_drag_section).append(h);jq("#"+b).val(e);jq("#"+l).val(d);g&&(document.getElementById(m).checked=!0==f);var w=this;jq("#image_tn_wrapper_"+a+" .image_remove").click(function(){w.onclickImageRemove(a);
return!1});jq("#"+b).keyup(function(){100<jq(this).val().length&&jq(this).val(jq(this).val().substring(0,100))});regex=/^(ftp|https?):\/\/.+/;jq("#image_source_url_"+a).blur(function(){var a=jq(this).val();0<a.length&&!regex.test(a.toLowerCase())&&jq(this).val("http://"+a)}).keyup(function(){var a=jq(this).val();regex.test(a.toLowerCase())?250<jq(this).val().length&&jq(this).val(jq(this).val().substring(0,250)):243<jq(this).val().length&&jq(this).val(jq(this).val().substring(0,243))});jq("#"+j).keyup(function(){250<
jq(this).val().length&&jq(this).val(jq(this).val().substring(0,250))});c=new ModuleContentReorderItem("image_tn_wrapper_"+a,a,this.state.reorder);c.setBeforeStartCallback(imageDraggableBeforeStartCallback);this.state.reorder.add(c)};function imageDraggableBeforeStartCallback(a){return null!=a&&("TEXTAREA"==a.target.tagName||"INPUT"==a.target.tagName||"SELECT"==a.target.tagName)?!1:!0}
ImageModuleEdit.prototype.updateImageData=function(){var a=this.state.photoData;jq("#"+this.resources.image_drag_section+" textarea").each(function(b,c){var d=jq(c).attr("id").substr(14);a[d].caption=jq(c).val().replace(/<.*?>/ig,"");a[d].maxSize=0;a[d].sourceName=jq("#image_source_name_"+d).val().replace(/<.*?>/ig,"");a[d].sourceUrl=jq("#image_source_url_"+d).val().replace(/<.*?>/ig,"");a[d].hubpagesOwned=null!=document.getElementById("image_hubpages_owned_"+d)?document.getElementById("image_hubpages_owned_"+
d).checked:!1;a[d].editor=window.userIsEditor})};ImageModuleEdit.prototype.onclickImageRemove=function(a){jq("#photo_gallery_content a.img_"+a).css({opacity:1});this.state.images_removed.push(a);delete this.state.photoData[a];var b=jq("#image_tn_wrapper_"+a)[0],b=b.nextSibling?b.nextSibling:b.previousSibling;null!=b&&b.id&&b.id.match(/[0-9]+/g);this.state.reorder.remove(a);this.state.reorder.relayout();1<this.state.reorder.items.length?jq("#"+this.resources.image_drag_title).show():jq("#"+this.resources.image_drag_title).hide()};
TextModuleEdit.prototype=new ModuleEdit;function TextModuleEdit(a){var b=[];b.push(a);ModuleEdit.apply(this,b);this.resources.edit_id="txte_"+a;this.resources.text_edit_id="txte_"+a;this.resources.text_div_id="txtd_"+a}
TextModuleEdit.prototype.onEditOpen=function(){var a=0.5*((window.innerHeight||document.documentElement.clientHeight)-75),b=jq("#"+this.resources.text_div_id)[0];b.innerHTML=b.innerHTML.replace(/<\s*p\s*>\s*<\s*\/\s*p\s*>/gi,"");this.state.origtext_width=parseFloat(jq("#"+this.data.div_id).width())+-2+(this.state.floatright&&!b.parentNode.hasClassName("color0")?-20:0);this.state.origtext_height=jq("#"+b.id).height();var c=150>this.state.origtext_height?150:this.state.origtext_height;150<a&&c>a&&(c=
a);b.style.height=c+75+"px";b.style.width=this.state.origtext_width+"px";if("Konqueror"==browser)jq("#"+b.id).html('<textarea id="txta_konqueror" rows="10" cols="80">'+b.innerHTML+"</textarea>");else if(tinyMCE.execCommand("mceAddControl",!1,b.id),a=tinyMCE.getInstanceById(b.id))a.getWin&&a.getWin()?this.state.mce_ele_id=a.getWin().id:(this.state.mce_ele_id=a.id,tinyMCE.execInstanceCommand(a.id,"FormatBlock",!1,"p"))};
TextModuleEdit.prototype.onEditClose=function(){var a;if("Konqueror"==browser)this.data.content=jq("#txta_konqueror")[0].value,jq("#"+this.resources.text_div_id).html(this.data.content);else{if(a=tinyMCE.getInstanceById(this.resources.text_div_id)){jq("#"+this.state.mce_ele_id)[0]&&(a.contentDocument?(a.contentWindow=jq("#"+this.state.mce_ele_id)[0].contentWindow,a.contentWindow.document.body.innerHTML=a.contentDocument.body.innerHTML):(a.contentWindow=jq("#"+this.state.mce_ele_id)[0].contentWindow,
a.getWin().document.body.innerHTML=a.getDoc().body.innerHTML));tinyMCE.triggerSave(!1,!0);jq("#"+this.data.id+"_wordcount").hide();tinyMCE.activeEditor?(this.needsHtmlCleanUp=!0,this.data.content=this._cleanUpHtml(this.tiny_mce_editor,this.getContent(tinyMCE),!1)):this.data.content=this.getContent(tinyMCE);if(""==this.data.content){for(a=new Date;!((new Date).getTime()>a.getTime()););this.data.content=this.getContent(tinyMCE)}if(tinyMCE.activeEditor){try{tinyMCE.execCommand("mceCloseHubHtmlEditor",
!1,null)}catch(b){}try{tinyMCE.execCommand("mceCloseHubLink",!1,null)}catch(c){}try{tinyMCE.execCommand("mceCloseHubDraft",!1,null)}catch(d){}}tinyMCE.execCommand("mceRemoveControl",!1,this.resources.text_div_id)}a=jq("#"+this.resources.text_div_id)[0];"input"==a.nodeName.toLowerCase()&&a.parentNode.removeChild(a)}a=jq("#"+this.resources.text_div_id)[0];a.innerHTML=this.data.content;a.style.display="";a.style.width="auto";a.style.height="auto";delete this.state.origtext_width;delete this.state.origtext_height};
TextModuleEdit.prototype.discardChanges=function(){this.tiny_mce_editor.isDirty()&&jq.ajax({type:"POST",url:"/xml/textdraft.php",data:{id:this.data.id,save:1,art_id:this.data.art_id,content:this.getContent(tinyMCE)},error:function(){},success:function(a){resp=JSONstring.toObject(a)}})};TextModuleEdit.prototype.saveContent=function(){};TextModuleEdit.prototype.getContent=function(a){return a.getContent?a.getContent():a.activeEditor.getContent()};
TextModuleEdit.prototype._cleanUpHtml=function(a,b,c){b=b.replace(/<\s*a\s+([^>]+\s+)?href\s*=\s*('[^']*'|"[^"]*")(\\s[^>]*)>/ig,function(a,b,c,g){b=!b?" ":" "+b.strip()+" ";g=!g?"":" "+g.strip();return"<a"+b+"href="+c+g+">"}.bind(this));b=b.replace(/<\s*span\s*[^>]*style=([^>]*)>([^<]*)<\s*\/span\s*>/ig,function(a,b,c){var g=a="";b.match(/font-weight:\s*bold(\s+|;|'|")/ig)&&(a+="<strong>",g="</strong>"+g);b.match(/font-style:\s*italic(\s+|;|'|")/ig)&&(a+="<em>",g="</em>"+g);b.match(/text-decoration:\s*underline(\s+|;|'|")/ig)&&
(a+="<u>",g="</u>"+g);return a+c+g});b=b.replace(/<\s*pre\s*>([\s\S]*)<\s*\/pre\s*>/ig,function(a,b){return"<pre>"+b.replace(/(<\s*br\s*>|<\s*br\s*\/\s*>)/ig,"\n")+"</pre>"});c&&(b=b.replace(/(<\s*pre\s*>([\s\S]*)<\s*\/\s*pre\s*>\s*)+/ig,function(a){return"<pre>"+a.replace(/<\s*\/\s*pre\s*><\s*pre\s*>/ig,"\n").replace(/<\s*\/?\s*pre\s*>/ig,"")+"</pre>"}));b=b.replace(/<\s*p\s*>\s+<\s*\/\s*p\s*/g,"<p><br/></p");b=b.replace(/<\s*p\s*>(\s|&nbsp;)*<\s*\/\s*p\s*>/ig,"");this.cleanUpRules&&(this.cleanUpRules.emptyReg&&
(b=b.replace(this.cleanUpRules.emptyReg,function(a,b){var c=this.cleanUpRules.value["$"+b.toLowerCase()];return"-"==c?"":"+"==c?"<"+b+">&nbsp;</"+b+">":"<"+b+"/>"}.bind(this))),this.cleanUpRules.synReg&&(b=b.replace(this.cleanUpRules.synReg,function(a,b,c,g){if(void 0==g||null==g)g="";return"<"+b+this.cleanUpRules.value[c.toLowerCase()]+" "+g+">"}.bind(this))));if(!this.needsHtmlCleanUp)return b;jq.ajax({type:"POST",url:"/xml/verifyhtml.php",data:{content:b,tidy:c},error:function(){},success:function(a){a&&
(b=JSONstring.toObject(a).cleanedText,b=b.replace(/<\s*p\s*>(\s|&nbsp;)*<\s*\/\s*p\s*>/ig,""),b=b.replace(/<\s*a[^>]*>(\s|&nbsp;|<\s*br\s*\/?\s*>|<[^>]*>)*<\s*\/\s*a\s*>/ig,""),this.needsHtmlCleanUp=!1)}.bind(this)});return b};
TextModuleEdit.prototype._handleAutoSave=function(){if(!this.editting||!this.tiny_mce_editor||!this.tiny_mce_editor.getDoc())return null!=this.autoSavePeriodicalExecuter&&(this.autoSavePeriodicalExecuter.stop(),this.autoSavePeriodicalExecuter=null),null;var a=this;if(this.tiny_mce_editor.isDirty()&&!(0<jQuery(this.tiny_mce_editor.contentDocument.documentElement).find(".mceItemHiddenSpellWord").length)){var b=tinymce.DOM.get("editor_status_"+this.data.id);tinymce.DOM.setHTML(b,"Saving draft...");var c=
this.data.id,d=this.getContent(tinyMCE);jq.ajax({type:"POST",url:"/xml/textdraft.php",data:{id:c,save:1,content:d,art_id:this.data.art_id},error:function(){jq("#editor_status_"+c).html("Autosave failed: will try again later.")},success:function(d){if((d=JSONstring.toObject(d))&&"success"==d.result){d=new Date;var f="AM",g=d.getHours(),j=10>d.getMinutes()?"0"+d.getMinutes():d.getMinutes(),h=d.getDate(),l=d.getFullYear(),m="Jan Feb Mar Apr May Jun July Aug Sept Oct Nov Dec".split(" ")[d.getMonth()],
f=12<=d.getHours()?"PM":"AM",g=0==d.getHours()%12?12:d.getHours()%12;tinymce.DOM.setHTML(b,"Draft saved at "+g+":"+j+" "+f+" on "+m+" "+h+", "+l+"!");a&&a.tiny_mce_editor&&(a.tiny_mce_editor.isNotDirty=1);a._activateRecoverButton()}else jq("#editor_status_"+c).html("Autosave failed: will try again later.")}})}};
TextModuleEdit.prototype._checkNetworkConnection=function(a,b){if(!this.editting||!this.tiny_mce_editor||!this.tiny_mce_editor.getDoc())return null!=this.checkNetworkPeriodicalExecutor&&(this.checkNetworkPeriodicalExecuter.stop(),this.checkNetworkPeriodicalExecuter=null),null;var c=this.tiny_mce_editor.id+"_network_indicator";this.tiny_mce_editor.isDirty()&&jq.ajax({type:"POST",url:"/xml/verifynetwork.php",data:{check:"ping"},error:function(){jq("#"+c).src=b.src;jq("#"+c).title=b.title},success:function(d){(d=
JSONstring.toObject(d))&&"success"==d.result?(jq("#"+c).src=a.src,jq("#"+c).title=a.title):(jq("#"+c).src=b.src,jq("#"+c).title=b.title)}})};TextModuleEdit.prototype._activateRecoverButton=function(){jq("#"+this.tiny_mce_editor.id+"_recover_button").show()};
TextModuleEdit.prototype._initializeTinyMCE=function(){this.tiny_mce_editor=tinyMCE.activeEditor;var a=this,b=new Image,c=new Image;b.src="http://x.hubpages.com/x/icon_internet_on.gif";c.src="http://x.hubpages.com/x/icon_internet_off.gif";b.title="The network connection is good.";c.title="The network connection is bad.";this.needsHtmlCleanUp=!1;this.tiny_mce_editor.onChange.add(function(a){this.needsHtmlCleanUp&&a.setContent(this._cleanUpHtml(a,a.getContent(),!1))}.bind(this));this.tiny_mce_editor.addCommand("hp_html_cleanup",
function(a,b){this.needsHtmlCleanUp=!0;return this._cleanUpHtml(this.tiny_mce_editor,b,!1)}.bind(this));this.tiny_mce_editor.addCommand("hp_html_tidy",function(a,b){this.needsHtmlCleanUp=!0;return this._cleanUpHtml(this.tiny_mce_editor,b,!0)}.bind(this));var d="";this.tiny_mce_editor.addCommand("mceHubHtmlEditorContent",function(a,b){return null!=b?d=b:""==d?null:d}.bind(this));if(!tinymce.DOM.get(this.tiny_mce_editor.id+"_network_indicator")){var e=tinymce.DOM.get(this.tiny_mce_editor.id+"_path_row");
tinymce.DOM.add(e,"img",{id:this.tiny_mce_editor.id+"_network_indicator",src:b.src,title:b.title});tinymce.DOM.add(e,"span",{},"&nbsp;");var f=tinymce.DOM.add(e,"a",{id:this.tiny_mce_editor.id+"_recover_button",style:{display:"none","margin-left":"10px",padding:"1px","font-size":"12px","font-weight":"bold",color:"#297ccf",cursor:"pointer"},title:"Press this button to recover using an autosaved draft",href:"#"},"recover draft");tinymce.dom.Event.add(f,"click",function(a){tinyMCE.execCommand("mceHubDraft",
!1,this.data.id);this.tiny_mce_editor.selection.collapse();tinymce.dom.Event.stop(a);return!1}.bind(this));jq.ajax({type:"POST",url:"/xml/checkifdrafts.php",data:{id:a.data.id,check:1},success:function(b){(b=JSONstring.toObject(b))&&"success"==b.result&&a._activateRecoverButton()}});tinymce.DOM.add(e,"span",{style:"padding-left:1em;",id:"editor_status_"+this.data.id},"&nbsp;")}e=this.tiny_mce_editor.getParam("tiny_mce_autosave_period",0);f=this.tiny_mce_editor.getParam("tiny_mce_check_network_period",
0);0<e&&null==this.autoSavePeriodicalExecuter&&(this.autoSavePeriodicalExecuter=new PeriodicalExecuter(function(){this._handleAutoSave(this)}.bind(this),e));0<f&&null==this.checkNetworkPeriodicalExecuter&&(this.checkNetworkPeriodicalExecuter=new PeriodicalExecuter(function(){this._checkNetworkConnection(b,c,this)}.bind(this),f));null==this.cleanUpRules&&(this.cleanUpRules={value:{},syn:null,empty:null,synReg:null,emptyReg:null},this.tiny_mce_editor.settings.valid_elements.split(",").each(function(b){b=
b.split("/");var c=b[0].replace(/^[\-#]/,""),d=null;if(1<b.length){var e=b[1].replace(/^[\-#]/,"");a.cleanUpRules.value[e.toLowerCase()]=c;a.cleanUpRules.syn=a.cleanUpRules.syn?a.cleanUpRules.syn+"|"+e:e;if(d="#"==b[1].charAt(0)?"+":"-"==b[1].charAt(0)?"-":null)a.cleanUpRules.empty=a.cleanUpRules.empty?a.cleanUpRules.empty+"|"+e:e,a.cleanUpRules.value["$"+e.toLowerCase()]=d}if(d="#"==b[0].charAt(0)?"+":"-"==b[0].charAt(0)?"-":null)c=c.replace(/\[.*/,""),a.cleanUpRules.empty=a.cleanUpRules.empty?a.cleanUpRules.empty+
"|"+c:c,a.cleanUpRules.value["$"+c.toLowerCase()]=d}),this.cleanUpRules.syn&&(this.cleanUpRules.synReg=RegExp("<\\s*(/?)\\s*("+this.cleanUpRules.syn+")(\\s[^>]*)?>","ig")),this.cleanUpRules.empty&&(this.cleanUpRules.emptyReg=RegExp("<\\s*("+this.cleanUpRules.empty+")\\s*/\\s*>","ig")))};
TextModuleEdit.prototype._cleanupTinyMCE=function(){this.checkNetworkPeriodicalExecuter&&this.checkNetworkPeriodicalExecuter.stop();this.autoSavePeriodicalExecuter&&this.autoSavePeriodicalExecuter.stop();this.cleanUpRules=null;this.needsHtmlCleanUp=!1;this.checkNetworkPeriodicalExecuter=this.autoSavePeriodicalExecuter=null};
function ModuleEdit(a){this.data={id:a,mod_data_id:null,div_id:null,art_id:null,type:null,links_json:"",images_json:"",quiz_json:"",links_added:0,position:0};this.state={select_id:null,is_new:!1,delete_confirm_text:"Are you sure you want to delete this capsule?",empty_notification_shown:!1,links:null,tiny_mce_editor:null,origtext_width:0,origtext_height:0,quiz_type:0,answers_added:0,questions_added:0,results_added:0,questions_removed:[],truncated_question_length:60,quiz_score_ranges:[30,60,80,90,
100],select_result_id:null,image_reorder_height:220,images_removed:[]};this.editting=!1;this.cleanUpRules=this.checkNetworkPeriodicalExecuter=this.autoSavePeriodicalExecuter=null;this.layout={topleft:[15,150],bottomright:[465,750],width:450,height:600};this.resources={edit_button_id:"edit_"+a,edit_link_id:"editlink_"+a,discard_button_id:"discard_"+a,up_button_id:"up_"+a,down_button_id:"down_"+a,chooser_id:"capsule_chooser_"+a,content_id:"modcont_"+a,keywords_id:a+"_keywords",max_id:a+"_max",max_max_id:a+
"_max_max",colorbar_id:"colorbar_"+a,hidebar_id:"hidebar_"+a,titlebar_id:"titlebar_"+a,title_id:a+"_title",title_input_id:a+"_titleinput",modal_id:a+"_modal",hide_id:a+"_hide",hide_text_id:a+"_hidetext",empty_notification_id:"modempty_"+a}}ModuleEdit.Manager=null;ModuleEdit.options={capsule_edit_reposition_duration:600,upload_status_hide_timeout:8E3,drag_enabled:!0,drag_reorder_enabled:!0};ModuleEdit.prototype.cleanUp=function(){this.state=this.data=this.editting=ModuleEdit.Manager=null};
ModuleEdit.make=function(a,b,c,d){jq.ajax({url:"/xml/modules.php",type:"post",data:{"new":1,art_id:b,type:a,position:c},dataType:"json",error:reportError,success:d})};
ModuleEdit.makeBulk=function(a,b,c,d){var e=this;jq.ajax({url:"/xml/modules.php",type:"post",data:{"new":1,art_id:b,type:a[d],position:c,bulkType:"recipe"},dataType:"json",error:reportError,success:function(f){ModuleEdit.Manager._handleAddNewResponse(c,f,!0);d+1<=a.length?(f=ModuleEdit.Manager.getLastPosition(),e.makeBulk(a,b,f,d+1)):ModuleEdit.Manager.bulkMode=!1}})};ModuleEdit.toggleIcon=function(a,b){jq("#"+a).length&&(b?ModuleEdit.disableIcon(a):ModuleEdit.reenableIcon(a))};
ModuleEdit.disableIcon=function(a){a=jq("#"+a);a.length&&(a.attr("class","disabledicon"),a=a.children().first(),a.attr("disabled")||(a.attr("href")&&"#"!=a.attr("href")&&a.atrr("bhref",a.attr("href")),a.attr("alt")&&a.attr("balt",a.attr("alt")),a.attr("title")&&a.attr("btitle",a.attr("title")),a.attr("alt",""),a.attr("title",""),a.attr("href","#"),a.attr("disabled",!0)))};
ModuleEdit.reenableIcon=function(a){a=jq("#"+a);a.length&&(a.attr("class","icon"),a=a.children().first(),a.prop("disabled")&&(a.attr("bhref")&&a.atrr("href",a.attr("bhref")),a.attr("balt")&&a.attr("alt",a.attr("balt")),a.attr("btitle")&&a.attr("title",a.attr("btitle")),a.attr("disabled",!1)))};ModuleEdit.getFromJSON=function(a){var b=a.data.display_type;"Photo"==b&&(b="Image");b=new window[b+"ModuleEdit"](a.data.mod_id);Object.extend(b.data,a.data);Object.extend(b.state,a.state);return b};
ModuleEdit.toggleCurtain=function(){jq("#modalarea").toggle()};ModuleEdit.prototype.validateBeforeOpen=function(){return!0};ModuleEdit.prototype.validateOnSave=function(){return!0};
ModuleEdit.prototype.toggle=function(a){!this.editting&&"Table"==this.data.type&&jq("#"+this.resources.table_view_id).hide();if(!this.editing&&("Rating"!=this.data.type||void 0===this.resources.is_closed||this.resources.is_closed)&&!this.validateBeforeOpen(a))return!1;this.editting=!this.editting;a=jq("#"+this.data.div_id);a.hasClass("in_modal")?(window.onbeforeunload=dont_prompt_navigate_away,a.removeClass("in_modal")):(window.onbeforeunload=prompt_navigate_away,a.addClass("in_modal"));this.editting&&
(this.state.original_html=jq("#"+this.data.div_id).html(),this.state.original_form="Text"==this.data.type?"":jq("#"+this.data.div_id+" :input").serializeArray(),this.data.hide=jq("#"+this.resources.hide_id).prop("checked"),this.state.original_hide=this.data.hide);this._togglePlaceholder();this._toggleTitle();this._toggleBorder();this._toggleEditButton();this._toggleDiscardButton();this._toggleDeleteButton();this._toggleZIndex();this._toggleSize();this._toggleEmptyNotification();this.doToggle();this._toggleAnimate();
this._toggleDrag();this.editting?this.setDirty():this.save();this.render();return!0};ModuleEdit.prototype._toggleZIndex=function(){var a=this.state.div_ele;this.editting?a.css("z-index",2E3):a.css("z-index",1)};
ModuleEdit.prototype._togglePlaceholder=function(){this.editting?(this.non_editting_height=jq("#"+this.data.div_id).outerHeight(),jq("#"+this.data.div_id).after(jq("<div></div>").addClass("module_placeholder").height(this.non_editting_height+"px"))):(jq("#"+this.data.div_id).next(".module_placeholder").remove(),jq("#"+this.data.id+"_wordcount").hide())};
ModuleEdit.prototype._toggleSize=function(){var a=jq("#"+this.data.div_id);this.editting?(thedivoffset=a.position(),a.css({width:"630px",position:"absolute",left:"0px",top:thedivoffset.top+"px"})):a.css({position:"static",width:"auto",top:"0px",left:"0px"})};
ModuleEdit.prototype._toggleAnimate=function(){if(this.editting){this.computeState();var a=ModuleEdit.Manager.layout,a=a.viewportScroll[1]+0.15*a.viewportSize[1]-a.canvasOffset[1],b=ModuleEdit.options.capsule_edit_reposition_duration,c=jq("#"+this.data.div_id),d=c.outerHeight();d>this.non_editting_height&&c.next(".module_placeholder").height(d+"px");c.animate({left:"102px",top:a+"px"},b)}};
ModuleEdit.prototype._toggleDrag=function(){var a=jq("#"+this.data.div_id),b=jq("#dragbar_"+this.data.id);ModuleEdit.options.drag_enabled&&this.editting?(ModuleEdit.options.allowDrag=!0,b.css("cursor","move"),a.draggable({handle:".dragbar"})):b.css("cursor","default")};ModuleEdit.prototype._toggleEmptyNotification=function(){if(this.editting&&this.data.div_id){var a=jq("#"+this.resources.empty_notification_id);this.state.empty_notification_shown=!a.is(":hidden");a.hide();a.closest(".mod").removeClass("empty")}};
ModuleEdit.prototype._toggleTitle=function(){jq("#"+this.resources.title_id)&&(this.editting?jq("#"+this.resources.title_input_id).val(jq("#"+this.resources.title_id).text()):(this.data.title=jq("#"+this.resources.title_input_id).val().replace(/<[^>]+(>|$)/g,""),null!==this.data.title&&(jq("#"+this.resources.title_id).html(this.data.title),""==this.data.title?jq("#"+this.resources.title_id).hide():jq("#"+this.resources.title_id).show())),this.toggleDisplay(this.resources.colorbar_id),this.toggleDisplay(this.resources.hidebar_id),
this.toggleDisplay(this.resources.titlebar_id),"Callout"==this.data.display_type?jq("#"+this.resources.title_id).hide():this.toggleDisplay(this.resources.title_id,!this.editting))};ModuleEdit.prototype.discardChanges=function(){};
ModuleEdit.prototype.discard=function(){this.setClean();this.discardChanges();if("Text"!=this.data.type&&"Code"!=this.data.type){for(var a=jq(this.state.original_form),b=0;b<a.length;b++)jq("#"+this.data.div_id+" *[name="+a[b].name+"]").val(a[b].value);this.data.hide=this.state.original_hide;jq("#"+this.resources.hide_id).attr("checked",this.data.hide?!0:!1);ModuleEdit.Manager.toggle(this.data.id,"discard")}else this.data.hide=this.state.original_hide,jq("#"+this.resources.hide_id).attr("checked",
this.data.hide?!0:!1),ModuleEdit.Manager.toggle(this.data.id,"discard"),jq("#"+this.data.div_id).html(this.state.original_html.replace(/(<[^<>]+)\s+_extended="true"/ig,"$1"));this.state.original_html=null;this.state.original_form=null;delete this.state.original_html;delete this.state.original_form;"Link"==this.data.type&&(this.loadLinkState(),this.onclickCapsuleRenderFromDB(this.resources.link_display_id));this.state.empty_notification_shown&&(jq("#"+this.resources.empty_notification_id).show(),jq("#"+
this.resources.empty_notification_id).closest(".mod").addClass("empty"))};ModuleEdit.prototype.computeState=function(){var a=this.getHoriz();this.state.floatleft=2>a?!0:!1;this.state.floatright=2<a?!0:!1;this.state.floatnone=2==a?!0:!1;a=this.state.div_ele=jq("#"+this.data.div_id);if(this.editting){var b=this.layout;b.topleft=a.offset();b.height=a.height();b.width=a.width();b.bottomright=[b.topleft[0]+b.width,b.topleft[1]+b.height]}};
ModuleEdit.prototype.toggleDisplay=function(a,b){var c;c=null!=b?b:this.editting;el=jq("#"+a);el.length&&(c?el.show():el.hide())};ModuleEdit.prototype.setDirty=function(){this.data.dirty=!0};
ModuleEdit.prototype.setClean=function(a,b){this.data.dirty=!1;var c=jq("#"+this.resources.empty_notification_id);if("Link"==this.data.type)a&&a.responseText&&JSONstring.toObject(b).id&&jq("#"+this.resources.json_links_id).html(b),this.loadLinkState(),0==jq("#"+this.resources.links_list+" li").length&&c.show();else if("Map"==this.data.type)a&&a.getResponseHeader("X-JSON")&&(jq("#"+this.resources.map_json_id).html(a.getResponseHeader("X-JSON")),this.loadMapState());else if(a&&a.responseText){var d=
JSONstring.toObject(a.responseText);if(d.error)if("Text"==this.data.type)alert(d.error);else return;"Text"==this.data.type&&(this.needsHtmlCleanUp=!1,d.cleanedText&&(this.data.content=d.cleanedText));d.moduleContent&&jq("#"+this.resources.content_id).replaceWith(d.moduleContent)}c.is(":hidden")||c.closest(".mod").addClass("empty")};ModuleEdit.prototype.getHoriz=function(){return this.isLast()?2:this.data.horiz_id};ModuleEdit.prototype.setHoriz=function(a){this.data.horiz_id=a};
ModuleEdit.prototype.isLast=function(){return this.state.is_last};ModuleEdit.prototype.isFloated=function(){return 2!=this.getHoriz()};ModuleEdit.prototype.setColorbar=function(a){"Image"==this.data.type||("Video"==this.data.type||"Map"==this.data.type||"Comment"==this.data.type)||(3==a?(jq("#nocolor_"+this.data.id).hide(),jq("#yescolor_"+this.data.id).show()):(jq("#nocolor_"+this.data.id).show(),jq("#yescolor_"+this.data.id).hide()))};
ModuleEdit.prototype.renderExhaustive=function(){"Image"==this.data.type?this.adjustImageWidth():"Map"==this.data.type&&this.mapResized();this.computeState();this._renderFloat();this.render()};
ModuleEdit.prototype.render=function(){this.computeState();this._renderSize();this._renderHide();this._renderBackground();this._renderTypeSpecific();this._renderMoveButtons();this._renderFloatButtons();"Text"==this.data.type&&(this.editting&&tinyMCE.activeEditor?this._initializeTinyMCE():this.tiny_mce_editor&&this._cleanupTinyMCE());setTimeout(function(){jq("#"+this.data.div_id).hide().show()}.bind(this),400)};ModuleEdit.prototype._renderSize=function(){this.state.div_ele.height("auto")};
ModuleEdit.prototype._renderFloat=function(){var a=this.state.div_ele;this.editting||(!this.state.floatnone&&!this.state.is_last&&!ModuleEdit.Manager.bulkMode?a.css("display","inline-block"):a.css("display","block"))};ModuleEdit.prototype._renderTypeSpecific=function(){switch(this.data.type){case "Video":this._renderVideo();break;case "Quiz":this._renderQuiz()}};
ModuleEdit.prototype._renderHide=function(){0!=jq("#"+this.resources.content_id).length&&null!=this.data.hide&&(this.data.hide?jq("#"+this.resources.hide_text_id).addClass("mod_hidden").attr({title:"This module is hidden."}):jq("#"+this.resources.hide_text_id).removeClass("mod_hidden").attr({title:""}))};
ModuleEdit.prototype._toggleBorder=function(){var a=jq("#"+this.data.div_id);if(0!=a.length){var b=this.editting?"solid 1px #ccc":"none";a.css("borderRight",b);a.css("borderLeft",b);a.css("borderBottom",b)}};
ModuleEdit.prototype._renderBackground=function(){var a=jq("#"+this.resources.content_id);if(0!=a.length){var b=-1;null!=this.data.color&&(b=ModuleEdit._getBackgroundColor("color"+this.data.color));this.state.current_color||(this.state.current_color=a.css("background-color"));if(this.state.current_color&&-1!=b&&b!=this.state.current_color){var c=jq("#"+this.resources.text_div_id+"_tbl");if(c)if("0"==this.data.color){var d=c.width()- -20;c.width(d)}else a.hasClass("color0")&&(d=c.width()+-20,c.width(d));
a.removeClass("color0").removeClass("color1").removeClass("color2");a.addClass("color"+this.data.color);this.state.current_color=b}}};ModuleEdit._getBackgroundColor=function(a){a=jq("."+a);return 0<a.length?a.css("background-color"):null};
ModuleEdit.prototype._renderMoveButtons=function(){var a=ModuleEdit.Manager.findModuleRightAbove(this.data.id),b=!1;a&&!a.isMovable()&&(ModuleEdit.Manager.findModuleRightAbove(a.data.id)||(b=!0));var a=ModuleEdit.Manager.findModuleRightBelow(this.data.id),c=!1;a&&!a.isMovable()&&(c=!0);ModuleEdit.toggleIcon(this.resources.up_button_id,b||!this.isMovable()||this.editting||0==this.data.position);ModuleEdit.toggleIcon(this.resources.down_button_id,c||!this.isMovable()||this.editting||this.isLast())};
ModuleEdit.prototype._renderFloatButtons=function(){if(this.isFloatable()){var a=!this.isMovable()||this.editting||this.state.floatnone;ModuleEdit.toggleIcon("cent_"+this.data.id,a);a=!this.isMovable()||this.editting||this.state.floatright||this.isLast();ModuleEdit.toggleIcon("rt_"+this.data.id,a)}else ModuleEdit.toggleIcon("cent_"+this.data.id,!0),ModuleEdit.toggleIcon("rt_"+this.data.id,!0)};ModuleEdit.prototype._toggleDeleteButton=function(){ModuleEdit.toggleIcon(this.data.id+"_delete",this.editting)};
ModuleEdit.prototype._toggleDiscardButton=function(){this.toggleDisplay(this.resources.discard_button_id)};ModuleEdit.prototype._toggleEditButton=function(){jq("#"+this.resources.edit_button_id).attr("class",this.editting?"savebtn":"editbtn");jq("#"+this.resources.edit_button_id).html(this.editting?"save&nbsp;":"edit&nbsp;");jq("#"+this.resources.edit_link_id).attr("title",this.editting?"Save this Capsule":"Edit this Capsule")};
ModuleEdit.prototype.setHide=function(){this.data.hide=0<jq("#"+this.resources.hide_id+":checked").length;this.render()};ModuleEdit.prototype.setColor=function(a){this.data.color=String(a);var b=jq("#colorbar_"+this.data.id).find(".selected");b.removeClass("selected");b.addClass("unselected");a=jq("#"+this.data.id+"_color"+a);a.addClass(a,"selected");a.removeClass(a,"unselected");this.render()};
ModuleEdit.prototype.load=function(a){var b=this;jq.ajax({type:"POST",url:"/xml/modules.php",data:jq.extend({load:!0},this.data),error:reportError,success:function(c){jq("#"+b.data.div_id).html(c);b.render();setTimeout(initializeInlineHelp,2500);a&&b.drawPointer()}})};ModuleEdit.prototype.drawPointer=function(){var a=Position.viewportPosition(this.data.div_id);ModuleEdit.Manager.drawPointer(a)};
ModuleEdit.prototype.save=function(){if(this.data.dirty){"Ingredients"==this.data.type&&(jq.each(jq(".ingredientsEdit table tr:nth-child(1)").find("input"),function(){jq(this).removeClass("faded")}),jq("#original_form").val("0"));"Image"==this.data.type&&jq("#"+this.resources.image_width_warning_id).remove();this.tiny_mce_editor&&(this.needsHtmlCleanUp=!1,this.data.content=this._cleanUpHtml(this.tiny_mce_editor,this.data.content,!1));var a=this.data.moveHoriz,b=this;"Quiz"==this.data.type&&!this.data.deleted?
jq.ajax({type:"POST",url:"/xml/modules.php",data:this.data,dataType:"json",error:this.reportSaveError,success:function(c){a||(jq("#"+b.resources.quiz_json_id).html(JSON.stringify(c)),b._renderQuiz())}}):jq.ajax({type:"POST",url:"/xml/modules.php",data:this.data,error:this.reportSaveError,success:function(a,d,e){b.processSaveResults(e,a)}})}};ModuleEdit.prototype.processSaveResults=function(a,b){this.setClean(a,b);updateHubtoolWarningsAndProgress();checkRestrictiveFilters()};
ModuleEdit.prototype.scrollTo=function(){jq("body").scrollTo(jq("#"+this.data.div_id))};ModuleEdit.prototype.remove=function(a){"Image"==this.data.type&&jq("#photo_insert").detach().insertAfter("#modules");if(a){this.data.deleted=!0;this.setDirty();this.save();var b=this;jq("#"+this.data.div_id).slideUp({duration:500,complete:function(){jq("#"+b.data.div_id).remove();ModuleEdit.Manager.render()}})}else jq("#"+this.data.div_id).remove();updateHubtoolWarningsAndProgress()};
ModuleEdit.prototype.reportSaveError=function(a){alert("Oops!\r\nThere was an error saving this capsule.  Please click EDIT and then SAVE to try again.  This error will be reported to the HubPages engineering team.  We thank you for your patience and understanding.");jq.ajax({type:"POST",url:"/xml/reporterror.php",data:{response:a.responseText,status:a.status,headers:a.getAllResponseHeaders(),hubtoolsave:1},success:function(){}})};
ModuleEdit.prototype.doToggle=function(){this.toggleDisplay(this.resources.edit_id);this.onToggle();if(this.editting)this.onEditOpen();else this.data.dirty&&this.saveContent(),this.onEditClose()};ModuleEdit.prototype.onToggle=function(){};ModuleEdit.prototype.isMovable=function(){return!0};ModuleEdit.prototype.isFloatable=function(){return!0};
ModuleEdit.prototype.getLinkTabLoader=function(){this.linkDisplay("link_find_box");if(!this._linkTabLoader){var a="#"+this.resources.link_search_term_id;this._linkTabLoader=new ModuleEdit.TabLoader({baseId:this.data.id+"_link_results",childrenSelector:".link_item",tabs:[{label:"My Hubs",url:"/xml/linkresults.php"},{label:"Hubs",url:"/xml/linkresults.php"}],paramCollector:function(b){return{search:jQuery(a).val(),maxitems:10,type:b.label}},callback:jQuery.proxy(this.wireLinkCtrlHandlers,this)})}return this._linkTabLoader};
ModuleEdit.Tab=function(a,b){this._tab=jQuery("#tab_"+a+"_"+b);this._tabContent=jQuery("#tabcontent_"+a+"_"+b)};ModuleEdit.Tab.prototype.updateContent=function(a){this._tabContent.html(a)};ModuleEdit.Tab.prototype.updateLabel=function(a){this._tab.text(a)};ModuleEdit.Tab.prototype.count=function(a){return this._tabContent.find(a).size()};
ModuleEdit.TabManager=function(a,b,c){this._options={baseId:b,rowSelector:c};jQuery.isArray(a)||(a=[a]);this._tabs=[];jQuery(a).each(jQuery.proxy(function(a,c){this._tabs.push({label:c,obj:new ModuleEdit.Tab(b,a)})},this))};ModuleEdit.TabManager.prototype.updateContent=function(a,b){this._tabs[a].obj.updateContent(b)};ModuleEdit.TabManager.prototype.updateLabel=function(a){var b=this._tabs[a].label,c=this.count(a);0<c&&(b+=" ("+c+")");this._tabs[a].obj.updateLabel(b)};
ModuleEdit.TabManager.prototype.selectNonEmptyTab=function(){jQuery(this._tabs).each(jQuery.proxy(function(a){if(0<this.count(a))return selectTab(this._options.baseId,a,this._tabs.length),!1},this))};ModuleEdit.TabManager.prototype.count=function(a){return this._tabs[a].obj.count(this._options.rowSelector)};ModuleEdit.TabLoader=function(a){this._options=jQuery.extend(ModuleEdit.TabLoader.DEFAULT_OPTIONS,a);jQuery.isArray(this._options.tabs)||(this._options.tabs=[this._options.tabs]);this.init()};
ModuleEdit.TabLoader.DEFAULT_OPTIONS={baseId:"",childrenSelector:null,paramCollector:null,callback:null,tabs:[],loadingText:"Searching...",emptyText:"No results found."};ModuleEdit.TabLoader.prototype.init=function(){var a=[];this._urls=[];jQuery(this._options.tabs).each(jQuery.proxy(function(b,c){a.push(c.label);this._urls.push(c.url)},this));this._tabManager=new ModuleEdit.TabManager(a,this._options.baseId,this._options.childrenSelector)};
ModuleEdit.TabLoader.prototype.load=function(){jQuery(this._urls).each(jQuery.proxy(this.loadTab,this))};
ModuleEdit.TabLoader.prototype.loadTab=function(a){var b=null;this._options.paramCollector&&(b=this._options.paramCollector(this._options.tabs[a]));this._tabManager.updateContent(a,"");this._tabManager.updateLabel(a);this._tabManager.updateContent(a,this._options.loadingText);jQuery.ajax({url:this._urls[a],data:b,type:b?"POST":"GET",complete:jQuery.proxy(function(b,d){"success"!=d&&"notmodified"!=d?reportError(b):(this._tabManager.updateContent(a,b.responseText),this._tabManager.updateLabel(a),this._tabManager.selectNonEmptyTab(),
0==this._tabManager.count(a)&&this._options.emptyText&&this._tabManager.updateContent(a,this._options.emptyText),this._options.callback&&this._options.callback(this._options.tabs[a],b))},this)})};function ModuleManager(a,b,c){this.initialize(a,b,c)}
ModuleManager.prototype={initialize:function(a,b,c){insideHubEditor=!0;this.div_id=jq("#"+a).attr("id");this.art_id=b;this.modules_by_order=[];this.modules_by_id=[];this.layout={};this.valid_capsule=!0;this.bulkMode=this.editting=!1;this.mod_enabled=!0;this.ADD_BUTTONS="Text Link Image Comment Ebay Amazon Video Poll Code Table Quiz Map CookTime Ingredients Nutrition Instructions Rating AllRecipe Callout".split(" ");this.RECIPE_MODS="Rating Text Image CookTime Ingredients Instructions Nutrition".split(" ");
this.insert_animating=this.inserting=!1;ModuleEdit.Manager=this;c&&JSONstring.toObject(c).each(function(a){a=ModuleEdit.getFromJSON(a);this.add(a,!1,!0)}.bind(this));jq("#capsule_inserter_area").mousemove(function(a){if(!this.inserting&&!this.insert_animating&&!this.editting){var b=jq("#capsule_inserter_area").offset().top,c=jq(window).scrollTop(),g=jq("#hubtool_canvas").offset().top+jq("#hubtool_canvas").outerHeight();a=Math.max(b-c,a.pageY-c-15);a=Math.min(a,g-c);0>a&&(a=0);jq("#capsule_inserter").css("top",
a+"px")}}.bind(this)).mouseover(function(){jq("#capsule_inserter").removeClass("dimmed")}).mouseleave(function(){this.inserting||jq("#capsule_inserter").addClass("dimmed")}.bind(this));jq("#capsule_inserter").click(this.addHere.bind(this));jq(window).scroll(this.moveInserter.bind(this)).resize(this.moveInserter.bind(this));this._renumber();this.render()},message:function(a,b){b=b||"";a=a||"";jq("#hubtool_messages").html('<p class="'+b+'">'+a+"</p>")},moveInserter:function(){if(!this.insert_animating){var a=
jq("#capsule_inserter"),b=jq(window).scrollTop(),c=jq(window).height();if(this.inserting){var d=a.offset().top;(d<b||d>b+c)&&this.closeInserter(!1)}else{var d=parseInt(a.css("top"),10),e=jq("#capsule_inserter_area").offset().top,f=Math.max(0,c-40),e=e-b,g=jq("#hubtool_canvas").offset().top+jq("#hubtool_canvas").outerHeight();g<b+c&&(f=Math.min(f,g-b));d<e?a.css("top",e+"px"):d>f&&e<f&&a.css("top",f+"px")}}},getLength:function(){return this.modules_by_order.length},getLastPosition:function(){var a=
this.getLength();0<a&&(this.getByPosition(a-1).isMovable()||a--);return a},closeInserter:function(a){if(!this.insert_animating){var b=jq("#capsule_inserter"),c=parseInt(b.css("top"),10)+jq("#capsule_inserter_area").offset().top-jq(window).scrollTop(),d=Math.max(0,jq(window).height()-40);0>c?c=20:c>d&&(c=d);a||jq("#capsule_inserter").addClass("dimmed");b.html("add &rarr;").css({position:"fixed",top:c+"px"});b.removeClass("cancel");jq("#capsule_chooser").hide().detach().insertAfter("#capsule_inserter");
this.render();this.inserting=!1}},addHere:function(a){var b=jq("#capsule_inserter");if("cancel"==b.html())this.closeInserter(!0);else{this.insert_animating=this.inserting=!0;b.html("cancel");var b=jq("#capsule_chooser"),c=a.pageY;a=0;for(var d=99999,e=this.getLength(),f=0;f<e;f++){var g=this.modules_by_order[f],j=jq("#"+g.data.div_id);if(j.offset()&&(j=j.offset().top,j=Math.abs(j-c),j<d&&(g.isMovable()||0!=f)))a=f,d=j}e&&a>=e-2&&(g=jq("#modules"),Math.abs(g.offset().top+g.height()-c)<d&&(a=e));a==
e&&0<e&&(g=this.modules_by_order[e-1],g.isMovable()||a--);a<e?(g=this.modules_by_order[a],c=jq("#"+g.data.div_id),2==g.getHoriz()?b.detach().insertBefore(c):(d=c.parent(),c=c.prevAll(),c.size()&&(d.before('<div class="modfloat right"></div>'),c.detach().appendTo(d.prev())),b.detach().insertBefore(d))):0<e?b.detach().insertAfter(jq("#"+this.modules_by_order[e-1].data.div_id)):b.detach().appendTo("#modules");b.data("insertPosition",a).show();setTimeout(this._insertionAnimation.bind(this),200)}return!1},
_insertionAnimation:function(){var a=jq("#capsule_inserter"),b=jq("#capsule_chooser");if(b.offset()){var c=b.offset().top;this.computeState();this.insert_animating=!0;if(c>this.layout.viewportScroll[1]&&c<this.layout.viewportScroll[1]+this.layout.viewportSize[1]-40)a.animate({top:c-this.layout.viewportScroll[1]+"px"},400,function(){a.css({position:"absolute",top:c-jq("#capsule_inserter_area").offset().top+"px"});this.insert_animating=!1;a.addClass("cancel")}.bind(this));else{var b=Math.min(this.layout.documentSize[1]-
this.layout.viewportSize[1],c-50),d=!0,e=!0;a.animate({top:c-b+"px"},500,function(){e=!1;d||setTimeout(function(){this.insert_animating=!1}.bind(this),300)}.bind(this));jq("html, body").animate({scrollTop:b},500,function(){a.css({position:"absolute",top:c-jq("#capsule_inserter_area").offset().top+"px"});d=!1;e||setTimeout(function(){this.insert_animating=!1}.bind(this),300);a.addClass("cancel")}.bind(this))}}},addNewInline:function(a){this.addNew(a,jq("#capsule_chooser").data("insertPosition"));this.closeInserter(!1)},
add:function(a,b,c){b+="";a.data.position="false"==b||"bottom"==b.toLowerCase()?this.getLength():"top"==b.toLowerCase()?0:Math.min(this.getLength(),parseInt(b));b=a.data.position==this.getLength();this.modules_by_order.splice(a.data.position,0,a);this.modules_by_id[a.data.id]=a;if(!c){if(ModuleEdit.options.drag_reorder_enabled){c=a.data.display_type.toLowerCase();var d=".gif";this.isRecipeCapsule(a.data.display_type)&&("cooktime"==c&&(c="cook_time"),d=".png");"comment"==c&&(c="comments");"rating"==
c&&(c="ratings");new Insertion.Bottom("caps_reorder_canvas",'<div class="reorder_bar" id="caps_reorder_'+a.data.id+'" style="width: 100%; height:25px; bottom: 0px; line-height:25px; z-index: 1; background: url(/x/hubtool_'+c+d+') 2px 50% no-repeat #e5e5e5; cursor:move;" onselectstart="return false">'+("<b>"+c+"</b>")+"</div>");c=new ReorderItem("caps_reorder_"+a.data.id,a.data.id,a.isFloated(),a.isFloatable(),a.isMovable());this.reorder.addAtPosition(c,a.data.position);c.repaint();this.reorder.relayout(!0)}this._renumber();
b&&1<this.getLength()&&this.getByPosition(this.getLength()-2).renderExhaustive()}},addNew:function(a,b){void 0==b&&(b=this.getLastPosition());"Comment"==a&&(b=this.getLength());this.isRecipeCapsule(a)&&("Rating"!=a&&0===this.moduleCountByType("Rating"))&&this.message("It looks like you are using one or more of our Recipe Capsules in your Hub. If you would like your Hub to appear as a recipe in search results, be sure to add the Ratings Capsule.");"Rating"==a&&!this.allRecipeCapsulesAdded()&&this.message("Are you writing a Recipe Hub? You can improve it by adding other Recipe Capsules, such as the Cook Time, Ingredients, Instructions, and Nutrition Capsules.");
addTime=new Timer;ModuleEdit.make(a,this.art_id,b,this._handleAddNewResponse.bind(this,b))},addNewInBulk:function(a){var b=this.getLastPosition();this.bulkMode=!0;ModuleEdit.makeBulk(a,this.art_id,b,0)},isRecipeCapsule:function(a){return"CookTime"==a||"Ingredients"==a||"Instructions"==a||"Nutrition"==a||"Rating"==a?!0:!1},showDuplicateMessage:function(a){alert("Rating"==a?"Only one Ratings Capsule is allowed per Hub.":"Comment"==a?"Only one Comments Capsule is allowed per Hub.":"CookTime"==a?"Only one Cook Time Capsule is allowed per Hub.":
"AllRecipe"==a?"All Recipe Capsules are already contained in this Hub.":"Only one "+a+" Capsule is allowed per Hub.")},allRecipeCapsulesAdded:function(){return 1<=this.moduleCountByType("CookTime")&&1<=this.moduleCountByType("Nutrition")&&1<=this.moduleCountByType("Ingredients")&&1<=this.moduleCountByType("Instructions")?!0:!1},getByPosition:function(a){return this.modules_by_order[a]},getById:function(a){return this.modules_by_id[a]},getByType:function(a){var b=[];jq.each(this.modules_by_order,function(){a==
this.data.type&&b.push(this)});return b},getPosition:function(a){return this.modules_by_order.indexOf(a)},getPositionById:function(a){return this.getPosition(this.modules_by_id[a])},removeById:function(a,b){var c=this.modules_by_id[a];if(!c.editting){var d=!0;if("undefined"!=typeof c.resources.delete_capsule_warning)if(confirm(c.resources.delete_capsule_warning))d=!1;else return;var e=c.isLast(),f="none"!=jq("#"+c.resources.empty_notification_id).css("display")||"Comment"==c.data.type&&isNewHub?!0:
!1;if(!d||f||confirm(c.state.delete_confirm_text))delete this.modules_by_id[a],this.modules_by_order=this.modules_by_order.reject(function(a){return a.data.id==c.data.id}),c.remove(b),this._renumber(),e&&0<this.getLength()&&this.getByPosition(this.getLength()-1).renderExhaustive(),ModuleEdit.options.drag_reorder_enabled&&(this.reorder.remove(c.data.id),this.reorder.relayout(!0))}},removeByPosition:function(a){var b=this.getByPosition(a);b.editting||(b=this.modules_by_order.splice(a,1),delete this.modules_by_id[b.data.id],
b.remove(!1),this._renumber())},renderExhaustive:function(){this._renderFloatDivs();this.modules_by_order.each(function(a){Position.set(jq("#"+a.data.div_id)[0],[0,0]);a.renderExhaustive()});this._sweepDeadWrappers();this.getRealPositions()},render:function(){this._renderFloatDivs();this.modules_by_order.each(function(a){a.render()});this._sweepDeadWrappers();this.setupAddButtons();this.getRealPositions()},getRealPositions:function(){var a=jq("#modules").find("div[id^=mod_]"),b=null,c=!1,d=0;a.each(function(){b=
jq(this);c=!1;a.each(function(){d=jq(this).offset().top+jq(this).height();b.attr("id")!=jq(this).attr("id")&&b.offset().top>=jq(this).offset().top&&b.offset().top<d&&"modfloat full"==b.parent().attr("class")&&(c=!0)});c?b.addClass("hasFloatedRight"):b.removeClass("hasFloatedRight")})},moduleCountByType:function(a){var b=0;this.modules_by_order.each(function(c){c.data.display_type==a&&b++});return b},setupAddButtons:function(){var a=this;this.ADD_BUTTONS.each(function(b){jq(".add"+b+"Mod").each(function(){var c=
jq(this);c.unbind("click");var d=jq("#addInline"+b);d.unbind("click");a.allRecipeCapsulesAdded()&&1<=a.moduleCountByType("Rating")&&"AllRecipe"==b?(c.addClass("disabled"),c.click(function(){a.showDuplicateMessage(b);return!1})):(a.isRecipeCapsule(b)||"Comment"==b)&&1<=a.moduleCountByType(b)?(c.addClass("disabled"),c.click(function(){a.showDuplicateMessage(b);return!1}),d.addClass("disabled"),d.click(function(){a.showDuplicateMessage(b);return!1})):(c.removeClass("disabled"),c.click(function(){if(a.mod_enabled)if(a.mod_enabled=
!1,setTimeout(function(){a.mod_enabled=!0},500),"AllRecipe"==b){for(var c="",d=[],g=0;g<a.RECIPE_MODS.length;g++)c="Image"==a.RECIPE_MODS[g]?"Photo":a.RECIPE_MODS[g],0===a.moduleCountByType(c)&&d.push(a.RECIPE_MODS[g]);man.addNewInBulk(d)}else man.addNew(b);return!1}),d.removeClass("disabled"),d.click(function(){man.addNewInline(b);return!1}))})})},toggle:function(a,b){var c=this.getById(a);this.valid_capsule=!0;this.editting&&void 0===b&&(this.valid_capsule=c.validateOnSave());this.valid_capsule&&
((this.editting=!this.editting)?(jq("#capsule_inserter").hide(),this.computeState(),this.computeListener=this.computeState.bindAsEventListener(this),Event.observe(window,"resize",this.computeListener,!1)):(jq("#capsule_inserter").show(),Event.stopObserving(window,"resize",this.computeListener,!1),this.computeListener=null),c.toggle("discard"==b)&&this.displayCurtain(c.resources.modal_id))},moveLeft:function(a){this.moveHoriz(a,1)},moveCenter:function(a){this.moveHoriz(a,2)},moveRight:function(a){this.moveHoriz(a,
3)},moveHoriz:function(a,b){var c=this.getById(a);if(!c.editting&&(c.setColorbar(b),c.setHoriz(b),c.setDirty(),c.data.moveHoriz=!0,c.save(),c.data.moveHoriz=!1,this.renderExhaustive(),this.callEvent("onmove",this.modules_by_order),void 0!=c.state.video_type))c.onclickVideoPreview(c.state.floatnone?"Big":"Small")},moveUp:function(a){this.moveVert(a,0)},moveDown:function(a){this.moveVert(a,1)},moveVert:function(a,b){this._sweepDeadWrappers();var c=this.getById(a),d=this.getPosition(c),e=this.getLength(),
f=2*b-1;if(!(0===d&&0===b)&&!(d==e-1&&1==b)&&!c.editting){var e=1==b?d:d-1,g=1==b?d+1:d,d=this.getByPosition(f+d),j=this.getByPosition(e);this.modules_by_order.splice(e,1);this.modules_by_order.splice(g,0,j);this._saveSwap(c,d);this._renumber();this._animateSwap(c,d,f);this.callEvent("onmove",this.modules_by_order)}},moveToPosition:function(a,b){this._sweepDeadWrappers();if(0>b||b>this.getLength()-1)return!1;if(0==b&&!this.modules_by_order[b].isMovable())return this.render(),!1;var c=this.getLength();
if(b==c-1&&!this.modules_by_order[b].isMovable())return this.render(),!1;c=this.getById(a);if(!c.isMovable())return this.render(),!1;if(c.editting)return!0;var d=this.getPosition(c);if(b==d)return!0;this.modules_by_order.splice(d,1);this.modules_by_order.splice(b,0,c);this._renumber();this.reorder.save();this.render();c.renderExhaustive();b==this.getLength()-1&&1<this.getLength()?this.getByPosition(this.getLength()-2).renderExhaustive():d==this.getLength()-1&&1<this.getLength()&&this.getByPosition(this.getLength()-
1).renderExhaustive();this.callEvent("onmove",this.modules_by_order);return!0},_sweepDeadWrappers:function(){setTimeout(this._sweepDeadWrappersHandler.bind(this),500)},_sweepDeadWrappersHandler:function(){var a=jq("modfloat,modules");1!=a.length&&a.each(function(a){a.hasChildNodes()||Element.remove(a)});a=jq("floatclear,modules");a.each(function(a){(!a.nextSibling||"DIV"!=a.nextSibling.nodeName)&&Element.remove(a)})},load:function(){this.modules_by_order.each(function(a){a.load()})},save:function(){this.modules_by_order.each(function(a){a.save()})},
cleanUp:function(){this.modules_by_order.each(function(a){a.cleanUp()});this.modules_by_order=this.modules_by_id=this.art_id=this.div_id=null},computeState:function(){var a=jq("#hubtool_canvas").offset();this.layout.canvasOffset=[a.left,a.top];this.layout.documentSize=[Position.getDocumentWidth(),Position.getDocumentHeight()];this.layout.viewportSize=[Position.getViewportWidth(),Position.getViewportHeight()];this.layout.viewportScroll=[Position.getViewportScrollX(),Position.getViewportScrollY()]},
displayCurtain:function(){ModuleEdit.toggleCurtain()},toggleAutoSummary:function(){jq("#autoSummary").attr("checked")?(jq("#articleSummary").hide(),jq("#autoSummaryPreview").children().remove(),jq("#autoSummaryPreview").append("<em>Calculating ... please wait</em>").show().load("/xml/article.php",{a:this.art_id,autosummary:1})):(jq("#autoSummaryPreview").hide(),jq("#articleSummary").show())},_saveSwap:function(a,b){jq.ajax({type:"POST",url:"/xml/modulesswap.php",success:function(){},data:{swap:1,
art_id:a.data.art_id,id:a.data.id,id2:b.data.id},error:reportError})},_animateSwap:function(a,b){var c=jq("#"+a.data.div_id),d=jq("#"+b.data.div_id),e=!0;c.offset().top>d.offset().top&&(e=!1);c.css("position","relative");d.css("position","relative");var f=this;jq.when(c.animate({top:(e?1:-1)*d.outerHeight()},400),d.animate({top:(e?-1:1)*c.outerHeight()},400)).done(function(){c.css("position","static").css("top",0);d.css("position","static").css("top",0);f.render();a.renderExhaustive();b.renderExhaustive()});
c.css("zIndex","2")},_renumber:function(){var a=this.getLength();this.modules_by_order.each(function(b,c){b.data.position=c;b.state.is_last=c==a-1})},_renderFloatDivs:function(){var a="first",b,c=jq("#modules"),d=c.firstChild;this.modules_by_order.each(function(e){var f=jq("#"+e.data.div_id),g=e.getHoriz();0==f.length&&alert("Unable to find mobule "+e.data.div_id);e.isLast()&&(g=2);if(g!=a){var j=["modfloat"];switch(g){case 1:j.push("left");break;case 3:j.push("right");break;case 2:j.push("full")}"first"!=
a&&b&&(3==a&&(breakDiv=jq("<div></div>"),breakDiv.addClass("floatclear")),c.append(b),3==g&&(breakDiv=jq("<div></div>"),breakDiv.addClass("floatclear"),c.append(breakDiv)));b=jq("<div></div>");b.addClass(j.join(" "));c.append(b)}a=g;if(("Comment"==e.data.type||"Poll"==e.data.type||"Quiz"==e.data.type||"Image"==e.data.type||"Video"==e.data.type||"Code"==e.data.type||"Table"==e.data.type||"Map"==e.data.type||"Nutrition"==e.data.type)&&2==g)breakDiv=jq("<br/>"),breakDiv.addClass("floatclear"),b.append(breakDiv);
b.append(f);0===jq(".modfloat").length&&(c.append(b),d=b);e.isLast()&&b.insertBefore(d)});jq("#modules .modfloat:not(:has(.mod))").remove()},_handleAddNewResponse:function(a,b){var c=b&&b.render?b.render.match(/ id="(.*?)" /):!1,c=c&&1<c.length?c[1]:!1;if(b&&b.error)alert(b.error);else{if(c&&b){var d=0,e=!1;jq("#modules div.modfloat").each(function(c,f){jq(f).children(".mod").each(function(c,f){if(d==a)return jq(f).before(b.render),e=!0,!1;d++});if(e)return!1});e||jq("#modules").append(b.render);
c=ModuleEdit.getFromJSON(b);this.add(c,a);c.load(!0);if(this.isRecipeCapsule(c.data.display_type)&&0<this.moduleCountByType("Rating")){var f=this.getByType("Rating")[0].data.id,c=jq("#"+f+"_rating_results"),f=jq("#"+f+"_ratingType");0==c.find(".ratingTotals").length&&0<f.length&&f.val("Recipe")}}this.render()}},drawPointer:function(a){0!=a&&(-1==a?(a='<div id="indup"><div><b><img src="http://x.hubpages.com/x/up-w.gif" style="width: 11px; height: 10px;" /> Added capsule above</b></div></div>',setTimeout("if (jq('#indup').length > 0) Element.remove('indup');",
3500)):(a='<div id="ind"><div><b><img src="http://x.hubpages.com/x/dn-w.gif" style="width: 11px; height: 10px;" /> Added capsule below</b></div></div>',setTimeout("if (jq('#ind').length > 0) Element.remove('ind');",3500)),new Insertion.Bottom("modules",a))},findModuleRightAbove:function(a){a=this.getPositionById(a);return 0==a?null:this.getByPosition(a-1)},findModuleRightBelow:function(a){a=this.getPositionById(a);return this.getByPosition(a+1)},callEvent:function(a){return this[a]instanceof Function?
this[a].apply(this,[].slice.call(arguments,1)):void 0}};function prompt_navigate_away(){return"\n\nAre you sure you want to leave the Hubtool now?\nYou may lose some or all of your work.\n\n"}function dont_prompt_navigate_away(){jq("#savebar_buttons a").data("disabled",!1)}ModuleReorder=function(a){this.initialize(a)};
ModuleReorder.prototype={initialize:function(a){ReorderItem.reorder=this;this.art_id=a;this.canvas=jq("#caps_reorder_canvas");this.items=[];this.options={border_repaint_delay:800,filter_additional_overhang:40,empty_space_at_top:10,ele_height:25,ele_float_bump:10,ele_float_width:130,ele_full_width:240};this.options.ele_space_per=this.options.empty_space_at_top+this.options.ele_height},add:function(a){this.items.push(a)},addAtPosition:function(a,b){this.items.splice(b,0,a)},remove:function(a){var b=
this.items.findAll(function(b){return b.mod_id==a});b&&0<b.length&&(b=b[0],this.items=this.items.reject(function(b){return b.mod_id==a}),b.ele.remove())},findById:function(a){return this.items.detect(function(b){return b.mod_id==a})},save:function(){this._getorder();var a=this.items.collect(function(a){return{id:a.mod_id,floated:a.floated}}),a=JSONstring.make(a);jq.ajax({type:"POST",url:"/xml/modulesreorder.php",data:{art_id:this.art_id,json:a},error:reportError})},canAppearToFloat:function(a){var b=
0;0<this.items.length&&(b=this.items.length-1);return this.items[b].mod_id!=a.mod_id},onfloatdone:function(a){a.floated?man.moveRight(a.mod_id):man.moveCenter(a.mod_id)},ondragdone:function(a){this._getorder();var b=this.items;a=a.mod_id;for(var c=0;c<b.length;c++)if(b[c].mod_id==a){moved_to_pos=c;break}this.relayout();man.moveToPosition(a,moved_to_pos)||(this.items=this.items_lastorder,this.relayout(!0))},resetorder:function(a){var b=[];this.items=b=a.collect(function(a){var b=this.findById(a.data.id);
b.floated=3==a.data.horiz_id;return b}.bind(this));this.relayout(!0)},_getorder:function(){this.items_lastorder=this.items;this.items=this.items.sortBy(function(a){return parseInt(a.ele.css("top"),10)})},relayout:function(a){var b=1;this.items.each(function(a){var c=a.ele;a=a.appearFloated()?this.options.ele_float_bump:0;a=b*this.options.ele_space_per+a;c.css("bottom","");c.css("top",a+"px");b++}.bind(this));var c=(this.items.length+2)*(this.options.ele_height+10);jq("#caps_reorder_canvas").height(c);
a&&this.items.each(function(a){a.updateDragFilter();a.repaint()})}};ReorderItem=function(a,b,c,d,e){this.initialize(a,b,c,d,e)};ReorderItem.reorder=null;
ReorderItem.prototype={initialize:function(a,b,c,d,e){this.mod_id=b;this.ele=jq("#"+a);this.opts=ReorderItem.reorder.options;this.floated=c;this.floatable=e&&d;this.movable=e;this.dragged=!1;this.dragger=new Dragger(this.ele[0],!0);this.updateDragFilter();this.movable||this.dragger.setonbeforestart(function(){return!1});this.dragger.onstop=this.ondragdone.bind(this);this.dragger.ondrag=this.ondrag.bind(this);this.ondblclickListener=this.ondblclick.bindAsEventListener(this);this.ele.bind("dblclick",
this.ondblclickListener)},updateDragFilter:function(){var a=[0,0],b=ReorderItem.reorder.canvas,c=this.opts.filter_additional_overhang;this.dragger.removeFilters();this.dragger.addFilter(Dragger.filters.SQUARE,a[0]-c,a[1],b.width()-c,b.height()-this.opts.ele_height)},ondblclick:function(){this.floatable&&(this.floated=!this.floated,this.repaint(),ReorderItem.reorder.ondragdone(this),ReorderItem.reorder.onfloatdone(this))},ondrag:function(){this.dragged=!0;this.ele.css("zIndex",100);this.ele.css("border",
"solid 2px #297ccf");jq("body").css("-webkit-user-select","none")},ondragdone:function(){this.dragged&&(this.repaint(),this.dragged=!1,ReorderItem.reorder.ondragdone(this));jq("body").css("-webkit-user-select","inherit")},appearFloated:function(){return this.floated&&ReorderItem.reorder.canAppearToFloat(this)},width:function(){return this.appearFloated()?this.opts.ele_float_width:this.opts.ele_full_width},height:function(){return this.opts.ele_height},zindex:function(){return this.appearFloated()?
"2":"1"},repaint:function(){"IE"!=browser&&Field.focus(this.ele);this.ele.css("left","");this.ele.css("right","5px");this.ele.css("zIndex",this.zindex());this.ele.width(this.width());setTimeout("if (jq('#"+this.ele.id+"').length > 0) jq('#"+this.ele.id+"').css('border', 'solid 1px #aaa');",this.opts.border_repaint_delay)}};
ReorderItem.make=function(a){new Insertion.Bottom("caps_reorder_canvas",'<div class="dragbar" id="caps_reorder_'+a.data.id+'" style="width:100%; height:25px; bottom:0px; border:solid 1px #999; font-size:9px; padding:1px; overflow:hidden; right:5px; z-index:1;cursor:pointer" onselectstart="return false">'+("<b>"+a.data.display_type+"</b>")+"</div>");a=new ReorderItem("caps_reorder_"+a.data.id,a.data.id,a.isFloated(),a.isFloatable(),a.isMovable());a.repaint();return a};
ModuleContentReorder=function(a,b,c,d){this.initialize(a,b,c,d)};
ModuleContentReorder.prototype={disabled:!1,initialize:function(a,b,c,d){this.canvas=jq("#"+a);this.items=[];this.options={num_cols:b,filter_additional_overhang:40,ele_buffer_v:10,ele_buffer_h:10,ele_height:d,ele_width:c,offset_v:5,offset_h:0};this.options.ele_space_per_v=this.options.ele_buffer_v+this.options.ele_height;this.options.ele_space_per_h=this.options.ele_buffer_h+this.options.ele_width},add:function(a,b){b?this.items.unshift(a):this.items.push(a)},enable:function(){if(!this.disabled)return!0;
this.items.each(function(a){a.ele.ondblclick=a.ondblclickListener;a.ele.setStyle({cursor:"move"});a.d.enable(a.ele)}.bind(this));this.disabled=!1},disable:function(){this.items.each(function(a){a.d.disable(a.ele);a.ele.ondblclick=function(){return!1};a.ele.setStyle({cursor:"default"})}.bind(this));this.disabled=!0},remove:function(a){this.items=this.items.reject(function(b){return b.item_id==a?(b.ele.remove(),!0):!1})},removeAll:function(){this.items.each(function(a){a.ele.remove()});this.items=[]},
setonchangecallback:function(a){this.onchangecallback=a},ondragdone:function(){this._getorder(!0);this.relayout()},_getorder:function(a){var b=this.items.sortBy(function(a){if(1==this.options.num_cols)return parseInt(a.ele.style.top,10);var b=parseInt(a.ele.style.top,10),c=parseInt(a.ele.style.left,10),b=Math.round((b-this.options.offset_v)/this.options.ele_space_per_v),c=Math.round((c-this.options.offset_h)/this.options.ele_space_per_h);if(a.dropped){0>c&&(c=0);c>=this.options.num_cols&&(c=this.options.num_cols-
1);var g=Math.round((a.startY-this.options.offset_v)/this.options.ele_space_per_v);a=Math.round((a.startX-this.options.offset_h)/this.options.ele_space_per_h);c=g<b||g==b&&a<c?c+0.5:c-0.5}return b*this.options.num_cols+c}.bind(this));if(a&&this.onchangecallback){a=!1;if(b.length!=this.items.length)a=!0;else for(var c=0;c<b.length;c++)if(b[c]!=this.items[c]){a=!0;break}if(a)this.onchangecallback()}this.items=b},relayout:function(a){var b=0;this.items.each(function(a){var d=jq(a.ele),e=b%this.options.num_cols;
a.startY=Math.floor(b/this.options.num_cols)*this.options.ele_space_per_v+this.options.offset_v;a.startX=e*this.options.ele_space_per_h+this.options.offset_h;d.css("bottom","");d.css("top",a.startY+"px");d.css("left",a.startX+"px");b++}.bind(this));a&&this.items.each(function(a){a.repaint()});a=Math.ceil(this.items.length/this.options.num_cols)*this.options.ele_space_per_v+10;a!=parseInt(this.canvas.height(),10)&&this.canvas.height(a)},getitemstate:function(){this._getorder();items_state=[];var a=
0;this.items.each(function(b){items_state.push({id:b.item_id,position:a++})});return items_state},getitemstateRec:function(){this._getorder();items_state={};var a=0;this.items.each(function(b){items_state[b.item_id]={id:b.item_id,position:a++}});return items_state}};ModuleContentReorderItem=function(a,b,c){this.initialize(a,b,c)};
ModuleContentReorderItem.prototype={initialize:function(a,b,c){a=jq("#"+a)[0];this.item_id=b;this.ele=a;this.reorder=c;this.opts=this.reorder.options;this.dropped=this.dragged=!1;this.startY=this.startX=0;this.d=new Dragger(a,!0);this.d.onstart=this.onstart.bind(this);this.d.onstop=this.ondragdone.bind(this);this.ondblclickListener=this.ondblclick.bindAsEventListener(this);this.ele.ondblclick=this.ondblclickListener;this.d.setonbeforestart(function(){return!this.reorder.disabled}.bind(this))},ondblclick:function(){},
setBeforeStartCallback:function(a){this.d.setonbeforestart(a)},onstart:function(){if(this.ele.onclick)this.ele.onclick();this.dragged=!0;this.ele.style.zIndex="100"},ondrag:function(){},ondragdone:function(){this.dragged&&(this.repaint(),this.dragged=!1,this.dropped=!0,this.reorder.ondragdone(),this.dropped=!1)},repaint:function(){"IE"!=browser&&Field.focus(this.ele);this.ele.style.zIndex=1}};
function doUpdateNotificationsPane(a){updateNotificationPane();a=parseInt(a)+2E4;setTimeout("doUpdateNotificationsPane('"+a+"')",a)}
function updateNotificationPane(){jq.ajax({type:"GET",url:"https:"==window.location.protocol?"/sxml/get_online_notifications":"/xml/get_online_notifications",dataType:"json",global:!1,success:function(a){"error"==a.count||0==a.count?jq("#notifications_count").css("visibility","hidden"):jq("#notifications_count").css("visibility","visible");jq("#notifications_count").html(a.count);jq("#notifications_menu").html(a.html)},error:function(a){jq("#notifications_count").html("error");jq("#notifications_count").attr("visibility",
"hidden");jq("#notifications_menu").html("<li>Error "+a.status+" when loading notifications</li>")}})}
function resetNotificationCheckpoint(){"0"!=jq("#notifications_count").html()&&"error"!=jq("#notifications_count").html()&&jq.ajax({url:"https:"==window.location.protocol?"/sxml/register_user_click_online_notifications":"/xml/register_user_click_online_notifications",global:!1,success:function(){jq("#notifications_count").css("visibility","hidden");jq("#notifications_count").html(0);jq("#notifications_menu .notification").children().removeClass("new")}})}
function setupNotifications(){jq(document).ready(function(){jq("#header_notifications").length&&(updateNotificationPane(),setTimeout("doUpdateNotificationsPane(20000)",2E4))});jq(document).ready(function(){jq("#header_notifications").length&&jq("#header_notifications").hover(function(){resetTimer=setTimeout("resetNotificationCheckpoint()",1E3)},function(){clearTimeout(resetTimer)})})}
(function(a){a.Jcrop=function(b,c){function d(b){b=a(b).offset();return[b.left,b.top]}function e(a){return[a.pageX-F[0],a.pageY-F[1]]}function f(b){"object"!==typeof b&&(b={});n=a.extend(n,b);a.each(["onChange","onSelect","onRelease","onDblClick"],function(a,b){"function"!==typeof n[b]&&(n[b]=function(){})})}function g(a,b){F=d(I);ha.setCursor("move"===a?a:a+"-resize");if("move"===a)return ha.activateHandlers(h(b),u);var c=R.getFixed(),e=l(a),f=R.getCorner(l(e));R.setPressed(R.getCorner(e));R.setCurrent(f);
ha.activateHandlers(j(a,c),u)}function j(a,b){return function(c){if(n.aspectRatio)switch(a){case "e":c[1]=b.y+1;break;case "w":c[1]=b.y+1;break;case "n":c[0]=b.x+1;break;case "s":c[0]=b.x+1}else switch(a){case "e":c[1]=b.y2;break;case "w":c[1]=b.y2;break;case "n":c[0]=b.x2;break;case "s":c[0]=b.x2}R.setCurrent(c);M.update()}}function h(a){var b=a;ua.watchKeys();return function(a){R.moveOffset([a[0]-b[0],a[1]-b[1]]);b=a;M.update()}}function l(a){switch(a){case "n":return"sw";case "s":return"nw";case "e":return"nw";
case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function m(a){return function(b){if(n.disabled||"move"===a&&!n.allowMove)return!1;F=d(I);oa=!0;g(a,e(b));b.stopPropagation();b.preventDefault();return!1}}function w(a,b,c){var d=a.width(),e=a.height();d>b&&0<b&&(d=b,e=b/a.width()*a.height());e>c&&0<c&&(e=c,d=c/a.height()*a.width());T=a.width()/d;Y=a.height()/e;a.width(d).height(e)}function q(a){return{x:a.x*T,y:a.y*Y,x2:a.x2*T,y2:a.y2*Y,w:a.w*
T,h:a.h*Y}}function u(){var a=R.getFixed();a.w>n.minSelect[0]&&a.h>n.minSelect[1]?(M.enableHandles(),M.done()):M.release();ha.setCursor(n.allowSelect?"crosshair":"default")}function r(a){if(n.disabled||!n.allowSelect)return!1;oa=!0;F=d(I);M.disableHandles();ha.setCursor("crosshair");var b=e(a);R.setPressed(b);M.update();ha.activateHandlers(L,u);ua.watchKeys();a.stopPropagation();a.preventDefault();return!1}function L(a){R.setCurrent(a);M.update()}function S(){var b=a("<div></div>").addClass(n.baseClass+
"-tracker");a.browser.msie&&b.css({opacity:0,backgroundColor:"white"});return b}function Q(a){X([a[0]/T,a[1]/Y,a[2]/T,a[3]/Y]);n.onSelect.call(ia,q(R.getFixed()));M.enableHandles()}function X(a){R.setPressed([a[0],a[1]]);R.setCurrent([a[2],a[3]]);M.update()}function W(){n.disabled=!0;M.disableHandles();M.setCursor("default");ha.setCursor("default")}function B(){n.disabled=!1;t()}function D(b,c,d){c=c||n.bgColor;n.bgFade&&a.fx.step.hasOwnProperty("backgroundColor")&&n.fadeTime&&!d?b.animate({backgroundColor:c},
{queue:!1,duration:n.fadeTime}):b.css("backgroundColor",c)}function t(a){n.allowResize?a?M.enableOnly():M.enableHandles():M.disableHandles();ha.setCursor(n.allowSelect?"crosshair":"default");M.setCursor(n.allowMove?"move":"default");n.hasOwnProperty("trueSize")&&(T=n.trueSize[0]/C,Y=n.trueSize[1]/J);n.hasOwnProperty("setSelect")&&(Q(n.setSelect),M.done(),delete n.setSelect);ka.refresh();n.bgColor!=na&&(D(n.shade?ka.getShades():K,n.shade?n.shadeColor||n.bgColor:n.bgColor),na=n.bgColor);ea!=n.bgOpacity&&
(ea=n.bgOpacity,n.shade?ka.refresh():M.setBgOpacity(ea));ga=n.maxSize[0]||0;V=n.maxSize[1]||0;N=n.minSize[0]||0;fa=n.minSize[1]||0;n.hasOwnProperty("outerImage")&&(I.attr("src",n.outerImage),delete n.outerImage);M.refresh()}var n=a.extend({},a.Jcrop.defaults),F,v=!1;a.browser.msie&&"6"===a.browser.version.split(".")[0]&&(v=!0);"object"!==typeof b&&(b=a(b)[0]);"object"!==typeof c&&(c={});f(c);var A={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},z=a(b),H=!0;
if("IMG"==b.tagName){if(0!=z[0].width&&0!=z[0].height)z.width(z[0].width),z.height(z[0].height);else{var P=new Image;P.src=z[0].src;z.width(P.width);z.height(P.height)}var I=z.clone().removeAttr("id").css(A).show();I.width(z.width());I.height(z.height());z.after(I).hide()}else I=z.css(A).show(),H=!1,null===n.shade&&(n.shade=!0);w(I,n.boxWidth,n.boxHeight);var C=I.width(),J=I.height(),K=a("<div />").width(C).height(J).addClass(n.baseClass+"-holder").css({position:"relative",backgroundColor:n.bgColor}).insertAfter(z).append(I);
n.addClass&&K.addClass(n.addClass);var Z=a("<div />"),ma=a("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),ca=a("<div />").width("100%").height("100%").css("zIndex",320),da=a("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=R.getFixed();n.onDblClick.call(ia,a)}).insertBefore(I).append(ma,ca);H&&(Z=a("<img />").attr("src",I.attr("src")).css(A).width(C).height(J),ma.append(Z));v&&da.css({overflowY:"hidden"});var aa=n.boundary,
ba=S().width(C+2*aa).height(J+2*aa).css({position:"absolute",top:-aa+"px",left:-aa+"px",zIndex:290}).mousedown(r),na=n.bgColor,ea=n.bgOpacity,ga,V,N,fa,T,Y,oa,hb;F=d(I);var ja,Ka=function(){var a={},b=["touchstart","touchmove","touchend"],c=document.createElement("div"),d;try{for(d=0;d<b.length;d++){var e=b[d],e="on"+e,f=e in c;f||(c.setAttribute(e,"return;"),f="function"==typeof c[e]);a[b[d]]=f}return a.touchstart&&a.touchend&&a.touchmove}catch(g){return!1}};ja={createDragger:function(a){return function(b){b.pageX=
b.originalEvent.changedTouches[0].pageX;b.pageY=b.originalEvent.changedTouches[0].pageY;if(n.disabled||"move"===a&&!n.allowMove)return!1;oa=!0;g(a,e(b));b.stopPropagation();b.preventDefault();return!1}},newSelection:function(a){a.pageX=a.originalEvent.changedTouches[0].pageX;a.pageY=a.originalEvent.changedTouches[0].pageY;return r(a)},isSupported:Ka,support:!0===n.touchSupport||!1===n.touchSupport?n.touchSupport:Ka()};var R,La=function(){if(!n.aspectRatio){var a=U-E,b=O-G;ga&&Math.abs(a)>ga&&(U=0<
a?E+ga:E-ga);V&&Math.abs(b)>V&&(O=0<b?G+V:G-V);fa/Y&&Math.abs(b)<fa/Y&&(O=0<b?G+fa/Y:G-fa/Y);N/T&&Math.abs(a)<N/T&&(U=0<a?E+N/T:E-N/T);0>E&&(U-=E,E-=E);0>G&&(O-=G,G-=G);0>U&&(E-=U,U-=U);0>O&&(G-=O,O-=O);U>C&&(a=U-C,E-=a,U-=a);O>J&&(a=O-J,G-=a,O-=a);E>C&&(a=E-J,O-=a,G-=a);G>J&&(a=G-J,O-=a,G-=a);return Na(Ea(E,G,U,O))}var a=n.aspectRatio,b=n.minSize[0]/T,c=n.maxSize[0]/T,d=U-E,e=O-G,f=Math.abs(d),g=Math.abs(e);0===c&&(c=10*C);f/g<a?(f=O,g*=a,g=0>d?E-g:g+E,0>g?(g=0,f=Math.abs((g-E)/a),f=0>e?G-f:f+G):
g>C&&(g=C,f=Math.abs((g-E)/a),f=0>e?G-f:f+G)):(g=U,f/=a,f=0>e?G-f:G+f,0>f?(f=0,g=Math.abs((f-G)*a),g=0>d?E-g:g+E):f>J&&(f=J,g=Math.abs(f-G)*a,g=0>d?E-g:g+E));g>E?(g-E<b?g=E+b:g-E>c&&(g=E+c),f=f>G?G+(g-E)/a:G-(g-E)/a):g<E&&(E-g<b?g=E-b:E-g>c&&(g=E-c),f=f>G?G+(E-g)/a:G-(E-g)/a);0>g?(E-=g,g=0):g>C&&(E-=g-C,g=C);0>f?(G-=f,f=0):f>J&&(G-=f-J,f=J);return Na(Ea(E,G,g,f))},Ma=function(a){0>a[0]&&(a[0]=0);0>a[1]&&(a[1]=0);a[0]>C&&(a[0]=C);a[1]>J&&(a[1]=J);return[a[0],a[1]]},Ea=function(a,b,c,d){var e=a,f=c,
g=b,h=d;c<a&&(e=c,f=a);d<b&&(g=d,h=b);return[e,g,f,h]},Na=function(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}},E=0,G=0,U=0,O=0,Oa,Pa;R={flipCoords:Ea,setPressed:function(a){a=Ma(a);U=E=a[0];O=G=a[1]},setCurrent:function(a){a=Ma(a);Oa=a[0]-U;Pa=a[1]-O;U=a[0];O=a[1]},getOffset:function(){return[Oa,Pa]},moveOffset:function(a){var b=a[0];a=a[1];0>E+b&&(b-=b+E);0>G+a&&(a-=a+G);J<O+a&&(a+=J-(O+a));C<U+b&&(b+=C-(U+b));E+=b;U+=b;G+=a;O+=a},getCorner:function(a){var b=La();switch(a){case "ne":return[b.x2,
b.y];case "nw":return[b.x,b.y];case "se":return[b.x2,b.y2];case "sw":return[b.x,b.y2]}},getFixed:La};var ka,Ra=function(){return Qa(R.getFixed())},Qa=function(a){pa.top.css({left:a.x+"px",width:a.w+"px",height:a.y+"px"});pa.bottom.css({top:a.y2+"px",left:a.x+"px",width:a.w+"px",height:J-a.y2+"px"});pa.right.css({left:a.x2+"px",width:C-a.x2+"px"});pa.left.css({width:a.x+"px"})},va=function(){return a("<div />").css({position:"absolute",backgroundColor:n.shadeColor||n.bgColor}).appendTo(qa)},Ta=function(){sa||
(sa=!0,qa.insertBefore(I),Ra(),M.setBgOpacity(1,0,1),Z.hide(),Sa(n.shadeColor||n.bgColor,1),M.isAwake()?wa(n.bgOpacity,1):wa(1,1))},Sa=function(a,b){D(Ua(),a,b)},Va=function(){sa&&(qa.remove(),Z.show(),sa=!1,M.isAwake()?M.setBgOpacity(n.bgOpacity,1,1):(M.setBgOpacity(1,1,1),M.disableHandles()),D(K,0,1))},wa=function(a,b){sa&&(n.bgFade&&!b?qa.animate({opacity:1-a},{queue:!1,duration:n.fadeTime}):qa.css({opacity:1-a}))},Ua=function(){return qa.children()},sa=!1,qa=a("<div />").css({position:"absolute",
zIndex:240,opacity:0}),pa={top:va(),left:va().height(J),right:va().height(J),bottom:va()};ka={update:Ra,updateRaw:Qa,getShades:Ua,setBgColor:Sa,enable:Ta,disable:Va,resize:function(a,b){pa.left.css({height:b+"px"});pa.right.css({height:b+"px"})},refresh:function(){n.shade?Ta():Va();M.isAwake()&&wa(n.bgOpacity)},opacity:wa};var M,Wa=function(b,c){var d=a("<div />").mousedown(m(b)).css({cursor:b+"-resize",position:"absolute",zIndex:c}).addClass("ord-"+b);ja.support&&d.bind("touchstart.jcrop",ja.createDragger(b));
ca.append(d);return d},Ya=function(){var a=R.getFixed();R.setPressed([a.x,a.y]);R.setCurrent([a.x2,a.y2]);Xa()},Xa=function(a){if(ra)return Za(a)},Za=function(a){var b=R.getFixed(),c=b.h;da.width(b.w).height(c);var c=b.x,d=b.y;n.shade||Z.css({top:-d+"px",left:-c+"px"});da.css({top:d+"px",left:c+"px"});n.shade&&ka.updateRaw(b);ra||(da.show(),n.shade?ka.opacity(ea):Fa(ea,!0),ra=!0);a?n.onSelect.call(ia,q(b)):n.onChange.call(ia,q(b))},Fa=function(a,b,c){if(ra||b)n.bgFade&&!c?I.animate({opacity:a},{queue:!1,
duration:n.fadeTime}):I.css("opacity",a)},$a=function(){xa=!0;if(n.allowResize)return ca.show(),!0},ya=function(){xa=!1;ca.hide()},ab=function(a){void 0===a?ya():$a()},ra,bb=370,xa=!1;if(n.dragEdges&&a.isArray(n.createDragbars)){var cb=n.createDragbars,za;for(za=0;za<cb.length;za++)Wa(cb[za],bb++).addClass("jcrop-dragbar")}if(a.isArray(n.createHandles)){var db=n.createHandles,Aa;for(Aa=0;Aa<db.length;Aa++){var eb=n.handleSize;Wa(db[Aa],bb++).css({opacity:n.handleOpacity}).width(eb).height(eb).addClass(n.baseClass+
"-handle")}}if(n.drawBorders&&a.isArray(n.createBorders)){var fb=n.createBorders,ta,Ba;for(Ba=0;Ba<fb.length;Ba++){switch(fb[Ba]){case "n":ta="hline";break;case "s":ta="hline bottom";break;case "e":ta="vline right";break;case "w":ta="vline"}var ib=ta,jb=a("<div />").css({position:"absolute",opacity:n.borderOpacity}).addClass(n.baseClass+"-"+ib);ma.append(jb)}}a(document).bind("touchstart.jcrop-ios",function(b){a(b.currentTarget).hasClass("jcrop-tracker")&&b.stopPropagation()});var Ga=S().mousedown(m("move")).css({cursor:"move",
position:"absolute",zIndex:360});ja.support&&Ga.bind("touchstart.jcrop",ja.createDragger("move"));ma.append(Ga);ya();M={updateVisible:Xa,update:Za,release:function(){ya();da.hide();n.shade?ka.opacity(1):Fa(1);ra=!1;n.onRelease.call(ia)},refresh:Ya,isAwake:function(){return ra},setCursor:function(a){Ga.css("cursor",a)},enableHandles:$a,enableOnly:function(){xa=!0},showHandles:function(){xa&&ca.show()},disableHandles:ya,animMode:ab,setBgOpacity:Fa,done:function(){ab(!1);Ya()}};var ha,Ia=function(a){Ha(e(a));
return!1},Ca=function(b){b.preventDefault();b.stopPropagation();oa&&(oa=!1,Ja(e(b)),M.isAwake()&&n.onSelect.call(ia,q(R.getFixed())),ba.css({zIndex:290}),a(document).unbind(".jcrop"),Ha=function(){},Ja=function(){});return!1},kb=function(a){a.pageX=a.originalEvent.changedTouches[0].pageX;a.pageY=a.originalEvent.changedTouches[0].pageY;return Ia(a)},lb=function(a){a.pageX=a.originalEvent.changedTouches[0].pageX;a.pageY=a.originalEvent.changedTouches[0].pageY;return Ca(a)},Ha=function(){},Ja=function(){},
gb=n.trackDocument;gb||ba.mousemove(Ia).mouseup(Ca).mouseout(Ca);I.before(ba);ha={activateHandlers:function(b,c){oa=!0;Ha=b;Ja=c;ba.css({zIndex:450});ja.support&&a(document).bind("touchmove.jcrop",kb).bind("touchend.jcrop",lb);gb&&a(document).bind("mousemove.jcrop",Ia).bind("mouseup.jcrop",Ca);return!1},setCursor:function(a){ba.css("cursor",a)}};var ua,mb=function(){la.hide()},Da=function(a,b,c){n.allowMove&&(R.moveOffset([b,c]),M.updateVisible(!0));a.preventDefault();a.stopPropagation()},nb=function(a){if(a.ctrlKey||
a.metaKey)return!0;var b=(hb=a.shiftKey?!0:!1)?10:1;switch(a.keyCode){case 37:Da(a,-b,0);break;case 39:Da(a,b,0);break;case 38:Da(a,0,-b);break;case 40:Da(a,0,b);break;case 27:n.allowSelect&&M.release();break;case 9:return!0}return!1},la=a('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}),ob=a("<div />").css({position:"absolute",overflow:"hidden"}).append(la);n.keySupport&&(la.keydown(nb).blur(mb),v||!n.fixedSupport?(la.css({position:"absolute",left:"-20px"}),ob.append(la).insertBefore(I)):
la.insertBefore(I));ua={watchKeys:function(){n.keySupport&&(la.show(),la.focus())}};ja.support&&ba.bind("touchstart.jcrop",ja.newSelection);ca.hide();t(!0);var ia={setImage:function(a,b){M.release();W();var c=new Image;c.onload=function(){var d=c.height,e=n.boxWidth,f=n.boxHeight;I.width(c.width).height(d);I.attr("src",a);Z.attr("src",a);w(I,e,f);C=I.width();J=I.height();Z.width(C).height(J);ba.width(C+2*aa).height(J+2*aa);K.width(C).height(J);ka.resize(C,J);B();"function"===typeof b&&b.call(ia)};
c.src=a},animateTo:function(a,b){var c=a[2]/T,d=a[3]/Y,e=R.flipCoords(a[0]/T,a[1]/Y,c,d),f=R.getFixed(),g=[f.x,f.y,f.x2,f.y2],h=n.animationDelay,j=e[0]-g[0],l=e[1]-g[1],m=e[2]-g[2],q=e[3]-g[3],r=0,t=n.swingSpeed;x=g[0];y=g[1];c=g[2];d=g[3];M.animMode(!0);var u=function(){r+=(100-r)/t;g[0]=x+r/100*j;g[1]=y+r/100*l;g[2]=c+r/100*m;g[3]=d+r/100*q;99.8<=r&&(r=100);100>r?(X(g),window.setTimeout(u,h)):(M.done(),"function"===typeof b&&b.call(ia))};window.setTimeout(u,h)},setSelect:Q,setOptions:function(a){f(a);
t()},tellSelect:function(){return q(R.getFixed())},tellScaled:function(){return R.getFixed()},setClass:function(a){K.removeClass().addClass(n.baseClass+"-holder").addClass(a)},disable:W,enable:B,cancel:function(){M.done();ha.activateHandlers(null,null)},release:M.release,destroy:function(){K.remove();z.show();a(b).removeData("Jcrop")},focus:ua.watchKeys,getBounds:function(){return[C*T,J*Y]},getWidgetSize:function(){return[C,J]},getScaleFactor:function(){return[T,Y]},getOptions:function(){return n},
ui:{holder:K,selection:da}};a.browser.msie&&K.bind("selectstart",function(){return!1});z.data("Jcrop",ia);return ia};a.fn.Jcrop=function(b,c){var d;this.each(function(){if(a(this).data("Jcrop")){if("api"===b)return a(this).data("Jcrop");a(this).data("Jcrop").setOptions(b)}else"IMG"==this.tagName?a.Jcrop.Loader(this,function(){a(this).css({display:"block",visibility:"hidden"});d=a.Jcrop(this,b);a.isFunction(c)&&c.call(d)}):(a(this).css({display:"block",visibility:"hidden"}),d=a.Jcrop(this,b),a.isFunction(c)&&
c.call(d))});return this};a.Jcrop.Loader=function(b,c,d){function e(){g.complete?(f.unbind(".jcloader"),a.isFunction(c)&&c.call(g)):window.setTimeout(e,50)}var f=a(b),g=f[0];f.bind("load.jcloader",e).bind("error.jcloader",function(){f.unbind(".jcloader");a.isFunction(d)&&d.call(g)});g.complete&&a.isFunction(c)&&(f.unbind(".jcloader"),c.call(g))};a.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:!1,borderOpacity:0.4,
handleOpacity:0.5,handleSize:7,aspectRatio:0,keySupport:!0,createHandles:"n s e w nw ne se sw".split(" "),createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery);
